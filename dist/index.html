<!DOCTYPE html>
<html>
  <head>
    <!--<link rel="stylesheet" href="css/styles.css" type="text/css">-->
    <script src="prop/prop_scripts_js.js"></script>
    <script src="resources/pako/pako.min.js"></script>
    <script src="resources/jsPDF/jspdf.umd.min.js"></script>
    <script src="resources/jsPDF/print.js"></script>
    <title>Eendraadschema online tekenen</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="keywords" content="Eendraadschema, online, tekenen, svg, gratis">
    <meta name="description" content="Een tool om ééndraadschema’s te tekenen">
    <meta name="author" content="Ivan Goethals">
    <style type="text/css" media="print">
      @page {
        size: landscape;
      }
    </style>
    <script type="module" crossorigin>var Pi=Object.defineProperty,Ei=Object.defineProperties;var Ii=Object.getOwnPropertyDescriptors;var Xe=Object.getOwnPropertySymbols;var Qt=Object.prototype.hasOwnProperty,es=Object.prototype.propertyIsEnumerable;var Yt=(i,e,t)=>e in i?Pi(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Q=(i,e)=>{for(var t in e||(e={}))Qt.call(e,t)&&Yt(i,t,e[t]);if(Xe)for(var t of Xe(e))es.call(e,t)&&Yt(i,t,e[t]);return i},_e=(i,e)=>Ei(i,Ii(e));var de=(i,e)=>{var t={};for(var s in i)Qt.call(i,s)&&e.indexOf(s)<0&&(t[s]=i[s]);if(i!=null&&Xe)for(var s of Xe(i))e.indexOf(s)<0&&es.call(i,s)&&(t[s]=i[s]);return t};(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();class Ai{constructor(e,t,s){this.ulElement=document.getElementById(e),this.liClassName=t,this.menuItems=s,this.renderMenu(),this.resetToFirstItem()}renderMenu(){const e=Array.from(this.ulElement.children).filter(t=>{var s;return(s=t.classList)==null?void 0:s.contains("menu-item-right")});this.ulElement.innerHTML="",this.menuItems.forEach(t=>{const s=document.createElement("li"),n=document.createElement("a");s.className=this.liClassName,n.innerText=t.name,n.addEventListener("click",()=>{this.selectItem(n),t.callback()}),s.appendChild(n),this.ulElement.appendChild(s)}),e.forEach(t=>this.ulElement.appendChild(t))}selectItem(e){this.ulElement.querySelectorAll("a").forEach(s=>s.removeAttribute("id")),e.id="current"}findAnchorByName(e){return Array.from(this.ulElement.querySelectorAll("a")).find(t=>t.innerText===e)||null}highlightMenuItemByName(e){const t=this.findAnchorByName(e);t&&this.selectItem(t)}resetToFirstItem(){const e=this.ulElement.querySelector("a");e&&this.selectItem(e)}selectMenuItemByName(e){const t=this.menuItems.find(s=>s.name===e);if(t){const s=this.findAnchorByName(e);s&&(this.selectItem(s),t.callback())}}setMenuItems(e){const t=this.ulElement.querySelector("a#current"),s=t==null?void 0:t.innerText;this.menuItems=e,this.renderMenu(),s&&this.menuItems.some(n=>n.name===s)?this.highlightMenuItemByName(s):this.resetToFirstItem()}selectMenuItemByOrdinal(e){const t=this.ulElement.querySelectorAll("a");t.forEach(s=>s.removeAttribute("id")),this.selectItem(t[e])}}class J{constructor(){this.data="",this.xleft=0,this.xright=0,this.xrightmin=0,this.yup=0,this.ydown=0,this.firstChildydown=null,this.lastChildyup=null,this.connectorPos=[]}}class Pt{constructor(e){this.id=0,this.parent=0,this.indent=0,this.collapsed=!1,this.props={},this.sourcelist=e}resetProps(){this.props={}}getMaxNumChilds(){return 18}isActief(){let e=this.sourcelist.getOrdinalById(this.id);return e===null?!1:this.sourcelist.active[e]}getParent(){let e=this.sourcelist.getOrdinalById(this.parent);if(e===null)return null;let t=this.sourcelist.data[e];return t===void 0&&(t=null),t}stringPropToHTML(e,t){let s="";if(e=="naam")switch(this.props.type){case"Aansluiting":case"Bord":s+="font-weight: bold;";break;case"Kring":case"Zekering/differentieel":case"Splitsing":s+="font-weight: bold; background-color:#FFFFE0;";break;case"Domotica":case"Domotica module (verticaal)":s+="font-weight: bold; background-color: lightgreen;";break}let n="",r="";return t!=null&&(r=' size="'+t+'" '),n=`<input type="text"${r} style="${s}" id="HL_edit_${this.id}_${e}" value="${this.props[e]}">`,n}checkboxPropToHTML(e){let t;return t='<input type="checkbox" id="HL_edit_'+this.id+"_"+e+'" '+(this.props[e]?" checked":"")+">",t}selectPropToHTML(e,t,s){let n="HL_edit_"+this.id+"_"+e,r="",a="",o="";if(e=="type")switch(this.props.type){case"Aansluiting":case"Bord":o+="background-color: #FFD580;";break;case"Kring":case"Zekering/differentieel":case"Splitsing":o+="background-color:#FFFFE0;";break;case"Domotica":case"Domotica module (verticaal)":o+="background-color: lightgreen;";break}s!=null&&(o+="width: "+s+"px;"),r=`<select style="${o}" id="${n}">`;for(let l=0;l<t.length;l++)a="",this.props[e]==t[l]&&(a+=" selected"),t[l]=="---"&&(a+=" disabled",t[l]="---------------------------"),t[l]=="-"&&(a+=" disabled",t[l]="---"),r+='<option value="'+t[l]+'" '+a+">"+t[l]+"</option>";return r+="</select>",r}toHTML(e){return"toHTML() function not defined for base class List_Item. Extend class first."}toSVG(){return new J}}function E(i){let e;typeof i=="undefined"?e="":e=i.toString();var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(s){return t[s]})}const fe=(function(){let i=null;return function(){return i!==null||("InstallTrigger"in window?i=!0:i=navigator.userAgent.toLowerCase().includes("firefox")),i}})(),oe=(()=>{const i={};return(e,t=10,s="")=>{const n=`${e}|${t}|${s}`;if(n in i)return i[n];const r=document.createElement("div");r.innerHTML=`<svg width="1000" height="20"><text x="0" y="10" style="text-anchor:start" font-family="Arial, Helvetica, sans-serif" font-size="${t}" ${s}>${e}</text></svg>`,document.body.appendChild(r);const a=r.children[0].children[0].getBBox().width;return document.body.removeChild(r),i[n]=Math.ceil(a),i[n]}})();function ts(i="black"){return`
    <div style="display:inline-block; width:1em; height:1em; vertical-align:middle;">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="100%" height="100%">
        <path d="M4 11h12M4 11L4 4M16 11L11 6M16 11L11 16" stroke="${i}" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </div>
  `}function Et(i,e){for(let t=0;t<i.length;t++)if(i[t]===e)return!0;return!1}function F(i){if(i==null||typeof i=="undefined")return"";if(typeof i!="string")try{i=String(i)}catch(e){return""}return i.trim()}function De(i){let e=new i.constructor,t=function(s){return Object.prototype.toString.call(s).slice(8,-1)};for(let s in i)i.hasOwnProperty(s)&&(e[s]=t(i[s])==="Object"||t(i[s])==="Array"?De(i[s]):i[s]);return e}const Ci=(()=>{const i={};return(e="Rnd_")=>{e in i||(i[e]=0);const t=i[e];return i[e]++,`${e}${t.toString()}`}})();async function Mi(i,e){return new Promise(t=>{const s=document.createElement("div");Object.assign(s.style,{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",visibility:"hidden",zIndex:9999}),document.body.appendChild(s);const n=document.createElement("div");Object.assign(n.style,{backgroundColor:"white",border:"1px solid #ccc",padding:"20px",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.1)"}),s.appendChild(n);const r=document.createElement("div");r.style.display="flex",r.style.alignItems="center";const a=document.createElement("p");a.textContent=i,r.appendChild(a);const o=document.createElement("select");e.forEach(h=>{const p=document.createElement("option");p.value=h,p.textContent=h,o.appendChild(p)}),o.style.marginLeft="10px",r.appendChild(o),n.appendChild(r);const l=document.createElement("div");Object.assign(l.style,{display:"flex",justifyContent:"center",marginTop:"10px"});const c=document.createElement("button");c.textContent="OK",c.style.marginRight="10px",l.appendChild(c);const d=document.createElement("button");d.textContent="Annuleren",l.appendChild(d),n.appendChild(l),c.addEventListener("click",()=>{const h=o.value;s.style.visibility="hidden",s.removeChild(n),document.body.removeChild(s),t(h)}),d.addEventListener("click",()=>{s.style.visibility="hidden",s.removeChild(n),document.body.removeChild(s),t(null)}),s.style.visibility="visible"})}function Ss(i,e,t,s,n=0,r=null){var v,S;s==0&&globalThis.structure.print_table.pagemarkers.clear();var a="",o=new XMLSerializer;new DOMParser;var l=!1,c=i;if(i.localName=="svg"){const L=(S=(v=c.attributes)==null?void 0:v.getNamedItem)==null?void 0:S.call(v,"data-eds-id");L&&typeof L.nodeValue=="string"&&L.nodeValue!==""&&(r=L.nodeValue),c.attributes.getNamedItem("newPage")&&(l=!0),c.attributes.getNamedItem("x")&&(e+=parseFloat(c.attributes.getNamedItem("x").nodeValue),c.attributes.getNamedItem("x").nodeValue=0),c.attributes.getNamedItem("y")&&(t+=parseFloat(c.attributes.getNamedItem("y").nodeValue),c.attributes.getNamedItem("y").nodeValue=0);for(var d=0;d<i.children.length;d++)a=a.concat(Ss(i.children[d],e,t,s+1,n,r),`
`);s<=0&&(c.attributes.getNamedItem("width")?a='<svg id="EDSSVG" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" transform="scale(1,1)" width="'+(parseInt(c.attributes.getNamedItem("width").nodeValue)+n)+'" height="'+c.attributes.getNamedItem("height").nodeValue+'">'+a+"</svg>":a="<svg>"+a+"</svg>")}else{if(r!=null&&r!=="")try{c.setAttribute("data-eds-id",r)}catch(L){}if(i.localName=="line"&&(e!=0&&(c.attributes.getNamedItem("x1").nodeValue=parseFloat(c.attributes.getNamedItem("x1").nodeValue)+e,c.attributes.getNamedItem("x2").nodeValue=parseFloat(c.attributes.getNamedItem("x2").nodeValue)+e),t!=0&&(c.attributes.getNamedItem("y1").nodeValue=parseFloat(c.attributes.getNamedItem("y1").nodeValue)+t,c.attributes.getNamedItem("y2").nodeValue=parseFloat(c.attributes.getNamedItem("y2").nodeValue)+t)),i.localName=="use"&&(e!=0&&(c.attributes.getNamedItem("x").nodeValue=parseFloat(c.attributes.getNamedItem("x").nodeValue)+e),t!=0&&(c.attributes.getNamedItem("y").nodeValue=parseFloat(c.attributes.getNamedItem("y").nodeValue)+t)),i.localName=="rect"&&(e!=0&&(c.attributes.getNamedItem("x").nodeValue=parseFloat(c.attributes.getNamedItem("x").nodeValue)+e),t!=0&&(c.attributes.getNamedItem("y").nodeValue=parseFloat(c.attributes.getNamedItem("y").nodeValue)+t)),i.localName=="circle"&&(e!=0&&(c.attributes.getNamedItem("cx").nodeValue=parseFloat(c.attributes.getNamedItem("cx").nodeValue)+e),t!=0&&(c.attributes.getNamedItem("cy").nodeValue=parseFloat(c.attributes.getNamedItem("cy").nodeValue)+t)),i.localName=="text"&&(c.attributes.getNamedItem("x").nodeValue=parseFloat(c.attributes.getNamedItem("x").nodeValue)+e,c.attributes.getNamedItem("y").nodeValue=parseFloat(c.attributes.getNamedItem("y").nodeValue)+t,c.attributes.getNamedItem("transform")&&(c.attributes.getNamedItem("transform").value.includes("rotate")?c.attributes.getNamedItem("transform").value="rotate(-90 "+c.attributes.getNamedItem("x").nodeValue+","+c.attributes.getNamedItem("y").nodeValue+")":c.attributes.getNamedItem("transform").value="scale(-1,1) translate(-"+c.attributes.getNamedItem("x").nodeValue*2+",0)")),i.localName=="polygon"){var h="",p=c.attributes.getNamedItem("points").nodeValue,g=p.split(" ");for(let L=0;L<g.length;L++){let A=g[L].split(",");h+=A[0]*1+e+","+(A[1]*1+t),L<g.length-1&&(h+=" ")}c.attributes.getNamedItem("points").nodeValue=h}a=o.serializeToString(c);var m=/xmlns="[^"]+"/g;a=a.replace(m,"")}return globalThis.structure.print_table.pagemarkers.addMarker(s,e,l),a}function Ot(i,e=0){var t="",s=new DOMParser,n=s.parseFromString(i,"text/xml");return t=Ss(n.childNodes[0],0,0,0,e,null),t}function Hi(i){return!isNaN(i)&&parseInt(i)==i&&!isNaN(parseInt(i,10))}function Bi(){var i=window.navigator.userAgent,e=i.indexOf("MSIE "),t=i.indexOf("Trident/");return e>0||t>0}function Ce(i,e=6){if(isNaN(i)||!isFinite(i))return"";e=Math.floor(e);let s=(Math.round(i*10**e)/10**e).toString();return s=s.replace(/(\.\d*?[1-9])0+$/,"$1").replace(/\.$/,""),s}function ce(i){if(typeof i!="string"||i.trim()==="")return NaN;const e=i.trim();let t=parseFloat(e);if(!isNaN(t)&&!e.includes(","))return t;if(e.includes(",")){const s=e.replace(",",".");return t=parseFloat(s),t}return t}const bt=class bt{static addSymbol(e){this.neededSymbols.includes(e)||this.neededSymbols.push(e)}static clearSymbols(){this.neededSymbols=[]}static getNeededSymbols(e=!1){let t="<defs>";this.neededSymbols.includes("VerticalStripe")&&(t+='<pattern id="VerticalStripe" x="5" y="0" width="5" height="10" patternUnits="userSpaceOnUse" ><line x1="0" y1="0" x2="0" y2="10" stroke="black" /></pattern>');for(let s in this.data)if(this.neededSymbols.includes(s))if(!e)t+=`<g id="${s}">${this.data[s].replace(/\n/g,"")}</g>`;else{let n=this.data[s].replace(/fill="white"/g,'fill="#e8e8e8"');n=n.replace(/<use xlink:href="#/g,'<use xlink:href="#SB_'),t+=`<g id="SB_${s}">${n.replace(/\n/g,"")}</g>`}return t+="</defs>",t}static outputSVGSymbols(){let e='<defs><pattern id="VerticalStripe" x="5" y="0" width="5" height="10" patternUnits="userSpaceOnUse" ><line x1="0" y1="0" x2="0" y2="10" stroke="black" /></pattern>';for(let t in this.data)t!="VerticalStripe"&&(e+=`<g id="${t}">${this.data[t].replace(/\n/g,"")}</g>`);return e+="</defs>",e}};bt.neededSymbols=[],bt.data={aardingsonderbreker:`
<line x1="0" y1="0" x2="5" y2="0" stroke="black"/>
<line x1="10" y1="0" x2="30" y2="0" stroke="black"/>
<line x1="35" y1="0" x2="40" y2="0" stroke="black"/>
<line x1="5" y1="-5" x2="5" y2="5" stroke="black"/>
<line x1="10" y1="-5" x2="10" y2="5" stroke="black"/>
<line x1="30" y1="-5" x2="30" y2="5" stroke="black"/>
<line x1="35" y1="-5" x2="35" y2="5" stroke="black"/>
`,batterij:`
<rect x="0" y="-12" width="40" height="27" stroke="black" fill="none"/>
<rect x="5" y="-15" width="10" height="3" stroke="black" fill="none"/>
<rect x="25" y="-15" width="10" height="3" stroke="black" fill="none"/>
<line x1="8" y1="-5" x2="12" y2="-5" stroke="black"/>
<line x1="10" y1="-7" x2="10" y2="-3" stroke="black"/>
<line x1="28" y1="-5" x2="32" y2="-5" stroke="black"/>
`,batterij_nieuw:`
<line x1="0" y1="-15" x2="0" y2="+15" stroke="black" stroke-linecap="round" />
<line x1="7" y1="-8" x2="7" y2="+8" stroke="black" stroke-width="3" stroke-linecap="round" />
<line x1="8.5" y1="0" x2="21.5" y2="0" stroke="black" stroke-dasharray="3,3" stroke-linecap="round" />
<line x1="22" y1="-15" x2="22" y2="+15" stroke="black" stroke-linecap="round" />
<line x1="29" y1="-8" x2="29" y2="+8" stroke="black" stroke-width="3" stroke-linecap="round" />
`,contactdoos:`
<path d="M20 0 A15 15 0 0 1 35 -15" stroke="black" fill="none" stroke-width="2" />
<path d="M20 0 A15 15 0 0 0 35 15" stroke="black" fill="none" stroke-width="2" />
<line x1="0" y1="0" x2="20" y2="0" stroke="black" />
`,deurslot:`
<line x1="1" y1="-15" x2="31" y2="-15" stroke="black"/>
<line x1="1" y1="15"  x2="46" y2="15" stroke="black"/>
<line x1="1" y1="-15" x2="1" y2="15" stroke="black"/>
<line x1="31" y1="-15" x2="46" y2="15" stroke="black"/>
<path d="M 7 3 A 6 6 0 0 1 19 3 A 6 6 0 0 1 31 3" stroke="black" fill="none" />
`,ster:`
<line x1="0" y1="-5" x2="0" y2="5" style="stroke:black" />
<line x1="-4.33" y1="-2.5" x2="4.33" y2="2.5" style="stroke:black" />
<line x1="-4.66" y1="2.5" x2="4.33" y2="-2.5" style="stroke:black" />
`,EVlader:`
<rect x="0" y="13" width="40" height="7" fill="none" style="stroke:black" />
<line x1="0" y1="0" x2="7" y2="0" style="stroke:black" />
<line x1="7" y1="-20" x2="7" y2="13" style="stroke:black" />
<line x1="33" y1="-20" x2="33" y2="13" style="stroke:black" />
<line x1="7" y1="-20" x2="33" y2="-20" style="stroke:black" />
<rect x="10" y="-17" width="20" height="8" fill="none" style="stroke:black" />
<line x1="20" y1="-6" x2="20" y2="10" style="stroke:black" />
<line x1="33" y1="-6" x2="36" y2="-6" style="stroke:black" />
<line x1="36" y1="-6" x2="36" y2="4" style="stroke:black" />
<line x1="36" y1="4" x2="39" y2="4" style="stroke:black" />
<line x1="39" y1="4" x2="39" y2="-15" style="stroke:black" />
<line x1="39" y1="-6" x2="39" y2="-15" style="stroke:black;stroke-width:2" />
<text x="15" y="1" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-weight="bold" font-size="6">V</text>
<text x="25" y="1" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-weight="bold" font-size="6">E</text>
<text x="15" y="9" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-weight="bold" font-size="6">E</text>
<text x="25" y="9" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-weight="bold" font-size="6">V</text>
`,lamp:`
<line x1="-10.61" y1="-10.61" x2="10.61" y2="10.61" stroke="black" stroke-width="2" />
<line x1="-10.61" y1="10.61" x2="10.61" y2="-10.61" stroke="black" stroke-width="2" />
`,led:`
<line x1="0" y1="-7" x2="0" y2="7" stroke="black" stroke-width="2" />
<line x1="0" y1="-7" x2="12" y2="0" stroke="black" stroke-width="2" />
<line x1="0" y1="7" x2="12" y2="0" stroke="black" stroke-width="2" />
<line x1="12" y1="-7" x2="12" y2="7" stroke="black" stroke-width="2" />
<line x1="6" y1="-6" x2="7" y2="-11" stroke="black" stroke-width="1" />
<line x1="7" y1="-11" x2="8.11" y2="-9.34" stroke="black" stroke-width="1" />
<line x1="7" y1="-11" x2="5.34" y2="-9.9" stroke="black" stroke-width="1" />
<line x1="9" y1="-6" x2="10" y2="-11" stroke="black" stroke-width="1" />
<line x1="10" y1="-11" x2="11.11" y2="-9.34" stroke="black" stroke-width="1" />
<line x1="10" y1="-11" x2="8.34" y2="-9.9" stroke="black" stroke-width="1" />
`,luidspreker:`
<polygon points="0,-10 7,-10 17,-20 17,20 7,10 0,10" fill="none" stroke="black"/>
<line x1="7" y1="-10" x2="7" y2="10" stroke="black" stroke-width="1" />
`,magneetcontact:`
<rect x="0" y="-10" width="20" height="20" fill="black" stroke="black"/>
`,sinus:`
<path d="M0,0 C2,-5 8,-5 10,0 S18,5 20,0" style="stroke:black;fill:none" />
`,sinusVerticaal:`
<path d="M0,0 C-5,-2 -5,-8 0,-10 S5,-18 0,-20" style="stroke:black;fill:none" />
`,spot:`
<path d="M0 0 A10 10 0 0 1 10 -10" stroke="black" fill="white" stroke-width="1" />
<path d="M0 0 A10 10 0 0 0 10 10" stroke="black" fill="white" stroke-width="1" />
<circle cx="10" cy="0" r="6" style="stroke:black;fill:none" />
<line x1="5.76" x2="14.24" y1="-4.24" y2="4.24" stroke="black" stroke-width="1" />
<line x1="5.76" x2="14.24" y1="4.24" y2="-4.24" stroke="black" stroke-width="1" />
`,noodlamp_decentraal:`
<rect x="-10.61" y="-10.61" width="21.22" height="21.22" fill="white" stroke="black" />
<circle cx="0" cy="0" r="5" style="stroke:black;fill:black" />
<line x1="-7" y1="-7" x2="7" y2="7" stroke="black" stroke-width="2" />
<line x1="-7" y1="7" x2="7" y2="-7" stroke="black" stroke-width="2" />
`,signalisatielamp:`
<circle cx="0" cy="0" r="5" fill="white" stroke="black" />
<line x1="-3" y1="-3" x2="3" y2="3" stroke="black" />
<line x1="-3" y1="3" x2="3" y2="-3" stroke="black" />
`,schakelaar_enkel:`
<line x1="0" y1="0" x2="10" y2="-20" stroke="black" />
<line x1="10" y1="-20" x2="15" y2="-17.5" stroke="black" />
<circle cx="0" cy="0" r="5" fill="white" stroke="black" />
`,schakelaar_klein:`
<line x1="0" y1="0" x2="6" y2="-12" stroke="black" />
<line x1="6" y1="-12" x2="9" y2="-10.5" stroke="black" />
<circle cx="0" cy="0" r="3" fill="white" stroke="black" />
`,schakelaar_dubbel:`
<line x1="0" y1="0" x2="10" y2="-20" stroke="black" />
<line x1="10" y1="-20" x2="15" y2="-17.5" stroke="black" />
<line x1="8" y1="-16" x2="13" y2="-13.5" stroke="black" />
<circle cx="0" cy="0" r="5" fill="white" stroke="black" />
`,schakelaar_trippel:`
<line x1="0" y1="0" x2="10" y2="-20" stroke="black" />
<line x1="10" y1="-20" x2="15" y2="-17.5" stroke="black" />
<line x1="8" y1="-16" x2="13" y2="-13.5" stroke="black" />
<line x1="6" y1="-12" x2="11" y2="-9.5" stroke="black" />
<circle cx="0" cy="0" r="5" fill="white" stroke="black" />
`,schakelaar_wissel_enkel:`
<line x1="0" y1="0" x2="10" y2="-20" stroke="black" />
<line x1="10" y1="-20" x2="15" y2="-17.5" stroke="black" />
<line x1="0" y1="0" x2="-10" y2="20" stroke="black" />
<line x1="-10" y1="20" x2="-15" y2="17.5" stroke="black" />
<circle cx="0" cy="0" r="5" fill="white" stroke="black" />
`,schakelaar_rolluik:`
<line x1="0" y1="0" x2="10" y2="-20" stroke="black" />
<line x1="10" y1="-20" x2="15" y2="-17.5" stroke="black" />
<line x1="0" y1="0" x2="-10" y2="-20" stroke="black" />
<line x1="-10" y1="-20" x2="-15" y2="-17.5" stroke="black" />
<rect x="-8" y="-8" width="16" height="16" fill="white" stroke="black" />
<text x="0" y="6" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-weight="bold" font-size="16">S</text>
`,schakelaar_enkel_dim:`
<line x1="0" y1="0" x2="10" y2="-20" stroke="black" />
<line x1="10" y1="-20" x2="15" y2="-17.5" stroke="black" />
<circle cx="0" cy="0" r="5" fill="white" stroke="black" />
<polygon points="-1,-8 11,-8 11,-15" fill="black" stroke="black" />
`,schakelaar_wissel_dim:`
<line x1="0" y1="0" x2="10" y2="-20" stroke="black" />
<line x1="10" y1="-20" x2="15" y2="-17.5" stroke="black" />
<line x1="0" y1="0" x2="-10" y2="20" stroke="black" />
<line x1="-10" y1="20" x2="-15" y2="17.5" stroke="black" />
<circle cx="0" cy="0" r="5" fill="white" stroke="black" />
<polygon points="-1,-8 11,-8 11,-15" fill="black" stroke="black" />
`,schakelaar_kruis_enkel:`
<line x1="0" y1="0" x2="10" y2="-20" stroke="black" />
<line x1="10" y1="-20" x2="15" y2="-17.5" stroke="black" />
<line x1="0" y1="0" x2="-10" y2="20" stroke="black" />
<line x1="-10" y1="20" x2="-15" y2="17.5" stroke="black" />
<line x1="0" y1="0" x2="-10" y2="-20" stroke="black" />
<line x1="-10" y1="-20" x2="-15" y2="-17.5" stroke="black" />
<line x1="0" y1="0" x2="10" y2="20" stroke="black" />
<line x1="10" y1="20" x2="15" y2="17.5" stroke="black" />
<circle cx="0" cy="0" r="5" fill="white" stroke="black" />
`,schakelaar_dubbelaansteking:`
<line x1="0" y1="0" x2="-10" y2="-20" stroke="black" />
<line x1="-10" y1="-20" x2="-15" y2="-17.5" stroke="black" />
<line x1="0" y1="0" x2="10" y2="-20" stroke="black" />
<line x1="10" y1="-20" x2="15" y2="-17.5" stroke="black" />
<circle cx="0" cy="0" r="5" fill="white" stroke="black" />
`,schakelaar_wissel_dubbel:`
<line x1="0" y1="0" x2="10" y2="-20" stroke="black" />
<line x1="10" y1="-20" x2="15" y2="-17.5" stroke="black" />
<line x1="8" y1="-16" x2="13" y2="-13.5" stroke="black" />
<line x1="0" y1="0" x2="-10" y2="20" stroke="black" />
<line x1="-10" y1="20" x2="-15" y2="17.5" stroke="black" />
<line x1="-8" y1="16" x2="-13" y2="13.5" stroke="black" />
<circle cx="0" cy="0" r="5" fill="white" stroke="black" />
`,aansluitpunt:`
<circle cx="5" cy="0" r="5" style="stroke:black;fill:none" />
`,aftakdoos:`
<circle cx="15" cy="0" r="15" style="stroke:black;fill:none" />
<circle cx="15" cy="0" r="7.5" style="stroke:black;fill:black" />
`,bewegingsschakelaar:`
<rect x="0" y="-13" width="10" height="26" fill="none" style="stroke:black" />
<rect x="10" y="-13" width="30" height="26" fill="none" style="stroke:black" />
<line x1="10" y1="13" x2="40" y2="-13"  stroke="black" />
<line x1="15" y1="-5" x2="20" y2="-5"  stroke="black" />
<line x1="20" y1="-10" x2="20" y2="-5"  stroke="black" />
<line x1="20" y1="-10" x2="25" y2="-10"  stroke="black" />
<text x="22" y="11" style="text-anchor:start" font-family="Arial, Helvetica, sans-serif" font-weight="bold" font-size="10">PIR</text>
`,schakelaar:`
<line x1="0" y1="0" x2="5" y2="0"  stroke="black" />
<line x1="5" y1="0" x2="35" y2="-10"  stroke="black" />
<line x1="35" y1="0" x2="40" y2="0"  stroke="black" />
`,schemerschakelaar:`
<line x1="0" y1="0" x2="5" y2="0"  stroke="black" />
<line x1="5" y1="0" x2="35" y2="-10"  stroke="black" />
<line x1="35" y1="0" x2="40" y2="0"  stroke="black" />
<use xlink:href="#arrow" x="14" y="-17" transform="rotate(90 14 -17)" />
<use xlink:href="#arrow" x="18" y="-17" transform="rotate(90 18 -17)" />
`,stoomoven:`
<rect x="0" y="-20" width="40" height="40" fill="none" style="stroke:black" />
<path d="M 6 -2 A 7 5 0 0 1 13 -7 A 7 5 0 0 1 27 -7 A 7 5 0 0 1 33 -2" stroke="black" fill="none" />
<path d="M 6  5 A 7 5 0 0 1 13  0 A 7 5 0 0 1 27  0 A 7 5 0 0 1 33  5" stroke="black" fill="none" />
<path d="M 6 12 A 7 5 0 0 1 13  7 A 7 5 0 0 1 27  7 A 7 5 0 0 1 33 12" stroke="black" fill="none" />
`,contactdoos_aarding:`
<line x1="20" y1="-15" x2="20" y2="15"  stroke="black" stroke-width="2" />
`,contactdoos_kinderveilig:`
<line x1="35" y1="-20" x2="35" y2="-14.1"  stroke="black" stroke-width="2" />
<line x1="35" y1="20" x2="35" y2="14.1"  stroke="black" stroke-width="2" />
`,bel:`
<path d="M20 0 A15 15 0 0 1 0 15" stroke="black" fill="none" stroke-width="2" />
<path d="M20 0 A15 15 0 0 0 0 -15" stroke="black" fill="none" stroke-width="2" />
<line x1="0" y1="15" x2="0" y2="-15" stroke="black" stroke-width="2" />
`,boiler:`
<circle cx="20" cy="0" r="20" style="stroke:black; fill:url(#VerticalStripe);" />
`,boiler_accu:`
<circle cx="20" cy="0" r="20" style="stroke:black;fill:none" />
<circle cx="20" cy="0" r="15" style="stroke:black;fill:url(#VerticalStripe)" />
`,motor:`
<circle cx="20" cy="0" r="20" style="stroke:black;fill:none" />
<text x="20" y="6" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-weight="bold" font-size="16">M</text>
`,elektriciteitsmeter:`
<rect x="0" y="-20" width="40" height="40" fill="none" style="stroke:black" />
<line x1="0" y1="-6" x2="40" y2="-6" stroke="black" stroke-width="1" />
<text x="20" y="10" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-weight="bold" font-size="12">kWh</text>
`,diepvriezer:`
<rect x="0" y="-20" width="40" height="40" fill="none" style="stroke:black" />
<use xlink:href="#ster" x="10" y="0" />
<use xlink:href="#ster" x="20" y="0" />
<use xlink:href="#ster" x="30" y="0" />
`,zonnepaneel:`
<rect x="0" y="-20" width="50" height="40" fill="none" style="stroke:black" />
<line x1="0" y1="0" x2="50" y2="0" stroke="black" />
<use xlink:href="#arrow" x="5" y="-12" transform="rotate(45 5 -10)" />
<use xlink:href="#arrow" x="10" y="-14" transform="rotate(45 10 -14)" />
`,zonnepaneel_driehoek:`
<rect x="0" y="-20" width="50" height="40" fill="none" style="stroke:black" />
<line x1="0" y1="-20" x2="20" y2="0" stroke="black" />
<line x1="0" y1="20" x2="20" y2="0" stroke="black" />
`,drukknop_klein:`
<circle cx="8" cy="0" r="7" style="stroke:black;fill:none" />
<circle cx="8" cy="0" r="4" style="stroke:black;fill:none" />
`,draadloos_klein:`
<path d="M 10 -7 A 10 10 0 0 1 10 7" stroke="black" fill="none" /> 
<path d="M 7 -5 A 8 8 0 0 1 7 5" stroke="black" fill="none" /> 
<path d="M 4 -3 A 6 6 0 0 1 4 3" stroke="black" fill="none" /> 
`,detectie_klein:`
<path d="M 10 -7 A 10 10 0 0 1 10 7" stroke="black" fill="none" /> 
<path d="M 5 -7 A 10 10 0 0 1 5 7" stroke="black" fill="none" /> 
`,drukknop:`
<circle cx="12" cy="0" r="12" style="stroke:black;fill:none" />
<circle cx="12" cy="0" r="7" style="stroke:black;fill:none" />
`,teleruptor:`
<rect x="0" y="-13" width="40" height="26" fill="none" style="stroke:black" />
<line x1="8" y1="6" x2="16" y2="6"  stroke="black" />
<line x1="24" y1="6" x2="32" y2="6"  stroke="black" />
<line x1="16" y1="-6" x2="16" y2="6"  stroke="black" />
<line x1="24" y1="-6" x2="24" y2="6"  stroke="black" />
`,dimmer:`
<rect x="0" y="-13" width="40" height="26" fill="none" style="stroke:black" />
<line x1="10" y1="5" x2="30" y2="5"  stroke="black" />
<line x1="10" y1="5" x2="10" y2="-5"  stroke="black" />
<line x1="10" y1="-5" x2="30" y2="5"  stroke="black" />
`,relais:`
<rect x="0" y="-13" width="40" height="26" fill="none" style="stroke:black" />
<line x1="10" y1="-13" x2="30" y2="13"  stroke="black" />
`,minuterie:`
<rect x="0" y="-13" width="40" height="26" fill="none" style="stroke:black" />
<text x="20" y="6" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="16">t</text>
`,thermostaat:`
<rect x="0" y="-13" width="40" height="26" fill="none" style="stroke:black" />
<circle cx="20" cy="0" r="8" style="stroke:black;fill:none" />
<line x1="12" y1="0" x2="28" y2="0"  stroke="black" />
`,tijdschakelaar:`
<rect x="0" y="-13" width="40" height="26" fill="none" style="stroke:black" />
<circle cx="11" cy="0" r="8" style="stroke:black;fill:none" />
<line x1="10" y1="0"  x2="17" y2="0"  stroke="black" />
<line x1="11" y1="-6" x2="11" y2="1"  stroke="black" />
<line x1="21" y1="0"  x2="25" y2="0"  stroke="black" />
<line x1="25" y1="0"  x2="31" y2="-5"  stroke="black" />
<line x1="31" y1="0"  x2="36" y2="0"  stroke="black" />
`,tijdschakelaar_klein:`
<circle cx="8" cy="0" r="7" style="stroke:black;fill:none" />
<line x1="7" y1="0"  x2="13" y2="0"  stroke="black" />
<line x1="8" y1="-5" x2="8" y2="1"  stroke="black" />
`,droogkast:`
<rect x="0" y="-20" width="40" height="40" fill="none" style="stroke:black" />
<circle cx="15" cy="-7.5" r="5" style="stroke:black;fill:none" />
<circle cx="25" cy="-7.5" r="5" style="stroke:black;fill:none" />
<circle cx="20" cy="7.5" r="3" style="stroke:black;fill:black" />
`,omvormer:`
<rect x="0" y="-20" width="40" height="40" fill="none" style="stroke:black" />
<line x1="0" y1="20" x2="40" y2="-20" stroke="black" />
<use xlink:href="#sinus" x="5" y="-12" />"
<line x1="20" y1="10" x2="35" y2="10" stroke="black" />
<line x1="20" y1="13" x2="35" y2="13" stroke="black" stroke-dasharray="3" />
`,overspanningsbeveiliging:`
<rect x="0" y="-15" width="15" height="30" fill="none" style="stroke:black" />
<line x1="7.5" y1="-18" x2="7.5" y2="-5" stroke="black" />
<line x1="7.5" y1="-5" x2="4.5" y2="-9" stroke="black" />
<line x1="7.5" y1="-5" x2="10.5" y2="-9" stroke="black" />
<line x1="7.5" y1="18" x2="7.5" y2="5" stroke="black" />
<line x1="7.5" y1="5" x2="4.5" y2="9" stroke="black" />
<line x1="7.5" y1="5" x2="10.5" y2="9" stroke="black" />
`,koelkast:`
<rect x="0" y="-20" width="40" height="40" fill="none" style="stroke:black" />
<use xlink:href="#ster" x="20" y="0" />"
`,kookfornuis:`
<rect x="0" y="-20" width="40" height="40" fill="none" style="stroke:black" />
<circle cx="10" cy="10" r="3" style="stroke:black;fill:black" />
<circle cx="30" cy="10" r="3" style="stroke:black;fill:black" />
<circle cx="30" cy="-10" r="3" style="stroke:black;fill:black" />
`,microgolf:`
<rect x="0" y="-20" width="40" height="40" fill="none" style="stroke:black" />
<use xlink:href="#sinus" x="10" y="-10" />"
<use xlink:href="#sinus" x="10" y="0" />"
<use xlink:href="#sinus" x="10" y="10" />"
`,oven:`
<rect x="0" y="-20" width="40" height="40" fill="none" style="stroke:black" />
<line x1="0" y1="-5" x2="40" y2="-5" stroke="black" />
<circle cx="20" cy="7.5" r="3" style="stroke:black;fill:black" />
`,usblader:`
<rect x="0" y="-15" width="60" height="30" fill="none" style="stroke:black" />
<circle cx="12" cy="-5" r="5" style="stroke:black;fill:none" />
<circle cx="19" cy="-5" r="5" style="stroke:black;fill:none" />
<text x="15" y="8" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="8">AC/DC</text>
<text x="42" y="4" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="11">USB</text>
`,vaatwasmachine:`
<rect x="0" y="-20" width="40" height="40" fill="none" style="stroke:black" />
<line x1="0" y1="-20" x2="14.34" y2="-5.66" style="stroke:black;fill:none" />
<line x1="40" y1="20" x2="25.66" y2="5.66" style="stroke:black;fill:none" />
<line x1="0" y1="20" x2="14.34" y2="5.66" style="stroke:black;fill:none" />
<line x1="40" y1="-20" x2="25.66" y2="-5.66" style="stroke:black;fill:none" />
<circle cx="20" cy="0" r="8" style="stroke:black;fill:none" />
`,ventilator:`
<rect x="0" y="-15" width="30" height="30" fill="none" style="stroke:black" />
<circle cx="10" cy="0" r="5" style="stroke:black;fill:none" />
<circle cx="20" cy="0" r="5" style="stroke:black;fill:none" />
`,transformator:`
<circle cx="8" cy="0" r="8" style="stroke:black;fill:none" />
<circle cx="20" cy="0" r="8" style="stroke:black;fill:none" />
`,verwarmingstoestel:`
<rect x="0" y="-15" width="50" height="30" fill="url(#VerticalStripe)" style="stroke:black" />
`,verwarmingstoestel_accu:`
<rect x="0" y="-15" width="50" height="30" fill="none" style="stroke:black" />
<rect x="5" y="-10" width="40" height="20" fill="url(#VerticalStripe)" style="stroke:black" />
`,verwarmingstoestel_accu_ventilator:`
<rect x="0" y="-15" width="70" height="30" fill="none" style="stroke:black" />
<rect x="5" y="-10" width="35" height="20" fill="url(#VerticalStripe)" style="stroke:black" />
<circle cx="50" cy="0" r="5" style="stroke:black;fill:none" />
<circle cx="60" cy="0" r="5" style="stroke:black;fill:none" />
`,verbruiker:`
<rect x="0" y="-20" width="40" height="40" fill="none" style="stroke:black" />
`,wasmachine:`
<rect x="0" y="-20" width="40" height="40" fill="none" style="stroke:black" />
<circle cx="20" cy="0" r="3" style="stroke:black;fill:black" />
<circle cx="20" cy="0" r="15" style="stroke:black;fill:none" />
`,zekering_automatisch:`
<g transform="rotate(-20)">
<line x1="0" y1="-30" x2="0" y2="0"  stroke="black" />
<rect x="-4" y="-30" width="4" height="10" style="fill:black" />
</g>
`,zekering_automatisch_horizontaal:`
<g transform="rotate(-20)">
<line x1="0" y1="0" x2="30" y2="0"  stroke="black" />
<rect x="20" y="-4" height="4" width="10" style="fill:black" />
</g>
`,zekering_smelt:`
<rect x="-4" y="-30" width="8" height="30" style="stroke:black;fill:none" />
<line x1="0" y1="-30" x2="0" y2="0" stroke="black" />
`,zekering_smelt_horizontaal:`
<rect x="0" y="-4" height="8" width="30" style="stroke:black;fill:none" />
<line x1="0" y1="0" x2="30" y2="0" stroke="black" />
`,relais_kring:`
<rect x="-8" y="-30" width="16" height="30" style="stroke:black;fill:none" />
<line x1="8" y1="-22.5" x2="-8" y2="-7.5" stroke="black" />
`,overspanningsbeveiliging_inline:`
-> shift x -7.5  y -15
<rect x="-7.5" y="-30" width="15" height="30" fill="none" style="stroke:black" />
<line x1="0" y1="-30" x2="0" y2="-20" stroke="black" />
<line x1="0" y1="-20" x2="-3" y2="-24" stroke="black" />
<line x1="0" y1="-20" x2="3" y2="-24" stroke="black" />
<line x1="0" y1="0" x2="0" y2="-10" stroke="black" />
<line x1="0" y1="-10" x2="-3" y2="-6" stroke="black" />
<line x1="0" y1="-10" x2="3" y2="-6" stroke="black" />
`,zekering_empty:`
<g transform="rotate(-20)">
<line x1="0" y1="-30" x2="0" y2="0"  stroke="black" />
</g>
`,zekeringscheider:`
<g transform="rotate(-20)">
<line x1="0" y1="-30" x2="0" y2="0"  stroke="black" />
<rect x="-4" y="-23" width="8" height="18" style="fill:none;stroke:black" />
</g>
`,arrow:`
<line x1="0" y1="0" x2="8" y2="0" stroke="black" />
<line x1="8" y1="0" x2="5" y2="-1" stroke="black" />
<line x1="8" y1="0" x2="5" y2="1" stroke="black" />
`,gas_ventilator:`
<polygon points="-6,5.2 0,-5.2 6,5.2" fill="black" stroke="black" />
`,gas_atmosferisch:`
<polygon points="-6,5.2 0,-5.2 6,5.2" fill="white" stroke="black" />
`,bliksem:`
<line x1="0" y1="-5.2" x2="-3" y2="0" stroke="black"/>
<line x1="-3" y1="0" x2="3" y2="0" stroke="black"/>
<line x1="3" y1="0" x2="0" y2="5.2" stroke="black"/>
<line x1="0" y1="5.2" x2="0" y2="2.2" stroke="black"/>
<line x1="0" y1="5.2" x2="2.6" y2="3.7" stroke="black"/>
`,moving_man:`
<g transform="matrix(0.0152987,0,0,0.01530866,0,0)">
<path d="M 710.7,10.1 C 904.8,5.2 908.6,261.4 730.9,278.4 637.5,287.3 566.3,181.5 603.8,90.8 623.4,43.4 668.7,12.9 711.4,10.1 c 1.1,-0.1 2.8,26.1 1.7,26.2 -31.4,2 -74.8,32.1 -89.1,74.7 -26.8,79.9 47,156.6 125.1,139.2 123.9,-27.6 114.1,-218.5 -36.3,-214 -0.7,0 -3.2,-26 -2.1,-26.1 z" id="path4" stroke="black" stroke-width="10" />
<path d="m 545.3,225.9 c -67.8,-5 -133.2,0 -199.7,0 -20.7,13.6 -115,100.7 -121.1,121.1 -5.7,19.1 6.2,31.9 12.1,40.4 60.1,18.3 96.7,-60.4 133.2,-88.8 29.6,0 59.2,0 88.8,0 -59.2,78.9 -190.7,169.9 -58.5,264.3 -27.6,31.6 -55.1,63.2 -82.7,94.8 -46.9,-14.7 -165.6,-41.3 -199.7,-18.2 -7,21 -4.8,32.1 6.1,48.4 34.1,10.3 205.5,53.2 232,36.3 34.3,-37.7 68.6,-75.3 102.9,-113 32.3,27.6 64.6,55.2 96.9,82.7 -1,62.6 -14.6,249.9 24.2,266.3 10.2,3 19.1,0.5 28.2,-2 5.4,-7.4 10.8,-14.8 16.1,-22.2 6.9,-27 0.3,-272.6 -6.1,-282.5 -37.7,-32.9 -75.3,-65.9 -113,-98.9 1.3,-1.3 2.7,-2.7 4,-4 45.7,-48.4 91.5,-96.9 137.2,-145.3 20.2,19.5 40.4,39 60.5,58.5 16.7,35.8 152.2,25.4 179.6,6.1 2,-8.1 4,-16.1 6.1,-24.2 -16,-40.1 -71.7,-31.8 -127.1,-30.3 C 741.8,384.3 590.6,253 545.5,225.7 c -1.7,-1 14.9,-23.3 15.4,-22.4 -2.2,-3.5 126,97.7 134.4,107.4 9.4,9.1 55.2,51.5 82.1,78.4 68.5,-2 122,-6.5 137.2,46.4 4.9,17.1 1.9,37.1 -8.1,50.4 -18.8,25.3 -156,39.1 -197.7,18.2 -20.2,-20.2 -40.4,-40.4 -60.5,-60.5 -18.8,18.2 -37.7,36.3 -56.5,54.5 -16.8,18.2 -33.6,36.3 -50.4,54.5 32.9,28.9 65.9,57.8 98.9,86.8 11.2,17.9 18.9,272.3 8.1,306.7 -4.8,15.2 -19.9,32.9 -34.3,38.3 C 498.3,1028.1 527.8,798.3 529.4,706 505.9,686.5 482.3,667 458.8,647.5 427.9,676.7 402,732.8 362,750.4 333.5,762.9 140.3,728.4 113.8,712.1 100.1,703.6 89.3,686 85.6,667.7 59.7,543.2 281.5,646 321.3,617.4 334.7,601.3 348.2,585.1 361.7,569 266.4,454.2 335.5,414.9 402.1,326.9 c 0,-0.7 0,-1.3 0,-2 -8.1,0 -16.1,0 -24.2,0 -26.3,36.3 -124.9,147 -173.5,64.6 -35.9,-60.8 103.6,-172.2 141.1,-189.8 56.7,-3.8 167.5,-11 215.9,4 0.8,0.7 -14.9,22.6 -16.1,22.2 z" id="path6" stroke="black" stroke-width="10" />
</g>
`};let H=bt;const yt=class yt{constructor(){this.kind="default",this.electroItemId=null,this.boxref=null,this.svg="",this.boxlabelref=null,this.adrestype=null,this.adres=null,this.adreslocation="rechts",this.page=1,this.posx=0,this.posy=0,this.sizex=0,this.sizey=0,this.heightCm=null,this.rotate=0,this.scale=globalThis.SITPLANVIEW_DEFAULT_SCALE,this.labelposx=0,this.labelposy=0,this.labelfontsize=11,this.needsViewUpdate=!1,this.visible=!0,this.movable=!0,this.berekenAfbeeldingsRotatieEnSpiegeling=()=>{if(globalThis.structure.properties.legacySchakelaars==!1&&this.isEendraadschemaSymbool()){let s=globalThis.structure.getElectroItemById(this.electroItemId);if(s!=null&&s.props.type=="Schakelaars"&&(s.props.aantal_schakelaars==1||s.props.aantal_schakelaars==null)&&["enkelpolig","dubbelpolig","driepolig","dubbelaansteking","wissel_enkel","wissel_dubbel","kruis_enkel","dimschakelaar","dimschakelaar wissel","rolluikschakelaar"].includes(s.props.type_schakelaar))return[this.rotate,!1]}let e=this.rotate;for(;e<0;)e=e+360;e=e%360;let t=!1;return e>=90&&e<270&&(this.isEDSSymbolAndRotates360degrees()&&(t=!0),this.isEendraadschemaSymbool()&&(e=e+180)),[e,t]},this.id=Ci("SP_")}setscale(e){this.scale=e,this.needsViewUpdate=!0}getscale(){return this.scale}isEendraadschemaSymbool(){return this.electroItemId!=null?globalThis.structure.getElectroItemById(this.electroItemId)!=null:!1}isEDSSymbolAndRotates360degrees(){if(this.isEendraadschemaSymbool()){let e=globalThis.structure.getElectroItemById(this.electroItemId);if(e!=null){let t=e.getType();return yt.ROTATES_360_DEGREES_TYPES.has(t)}return!1}return!1}setAdres(e,t,s){this.adrestype=e,this.adreslocation=s,this.adrestype==="manueel"?this.adres=t:this.adres=null}setAdresLocation(e){this.adreslocation=e}getAdresType(){return this.adrestype}getAdres(){var t;if(!this.isEendraadschemaSymbool()){if(this.kind==="distanceLine"){const s=this.distanceLine,n=(s==null?void 0:s.distanceCm)!=null?s.distanceCm:(s==null?void 0:s.distanceMeters)!=null?s.distanceMeters*100:null;return n==null||!Number.isFinite(n)?"":`${n} cm`}return""}let e=globalThis.structure.getElectroItemById(this.electroItemId);return e==null?"":this.adrestype==="auto"?e.getReadableAdres():(t=this.adres)!=null?t:""}getAdresLocation(){return this.adreslocation}setElectroItemId(e){this.electroItemId=e}getElectroItemId(){return this.isEendraadschemaSymbool()?this.electroItemId:null}updateElectroItemSVG(e,t=void 0,s=void 0){this.isEendraadschemaSymbool()&&this.svg!==e&&(this.needsViewUpdate=!0,this.svg=e,t!=null&&(this.sizex=t),s!=null&&(this.sizey=s),(t==null||s==null)&&this.getSizeFromString())}getUnscaledSVGifNotElectroItem(){const e=()=>{if(this.svg==null)this.svg="";else{const t=this.svg.indexOf("<svg");t!==-1&&(this.svg=this.svg.substring(t))}};return this.isEendraadschemaSymbool()?"":(e(),this.svg)}getScaledSVG(e=!1){var n;if(this.kind==="distanceLine"&&this.distanceLine){const r=this.distanceLine,a=[`<line x1="${r.x1}" y1="${r.y1}" x2="${r.x2}" y2="${r.y2}" stroke="black" stroke-width="2" vector-effect="non-scaling-stroke" />`,`<circle cx="${r.x1}" cy="${r.y1}" r="3" fill="black" />`,`<circle cx="${r.x2}" cy="${r.y2}" r="3" fill="black" />`].join("");this.svg!==a&&(this.svg=a,this.needsViewUpdate=!0)}if(this.kind==="cableRun"&&this.cableRun){const r=(n=this.cableRun.points)!=null?n:[],a=r.map(c=>`${c.x},${c.y}`).join(" "),o=r.map((c,d)=>`<circle class="cable-run-vertex" data-cable-vertex-index="${d}" cx="${c.x}" cy="${c.y}" r="3" fill="black" />`).join(""),l=[`<polyline class="cable-run-line" points="${a}" fill="none" stroke="black" stroke-width="2" vector-effect="non-scaling-stroke" />`,o].join("");this.svg!==l&&(this.svg=l,this.needsViewUpdate=!0)}if(this.kind==="connectionPoint"&&this.connectionPoint){const r=['<circle cx="8" cy="8" r="6" fill="white" stroke="black" stroke-width="2" vector-effect="non-scaling-stroke" />','<line x1="8" y1="3" x2="8" y2="13" stroke="black" stroke-width="2" vector-effect="non-scaling-stroke" />','<line x1="3" y1="8" x2="13" y2="8" stroke="black" stroke-width="2" vector-effect="non-scaling-stroke" />'].join("");this.svg!==r&&(this.svg=r,this.needsViewUpdate=!0)}if(this.isEendraadschemaSymbool()){let r=globalThis.structure.getElectroItemById(this.electroItemId);r!=null&&r.updateSituationPlanElement(this)}let t="",s="";if(e){t=`x="${this.posx-this.sizex/2*this.scale}" y="${this.posy-this.sizey/2*this.scale}"`;const[r,a]=this.berekenAfbeeldingsRotatieEnSpiegeling();return s=`transform="rotate(${r} ${this.posx} ${this.posy})${a?` scale(-1,1) translate(${-this.posx*2} 0)`:""}"`,`<g ${s}>
                    <svg ${t} width="${this.sizex*this.scale}px" height="${this.sizey*this.scale}px" viewBox="0 0 ${this.sizex} ${this.sizey}">${this.svg}</svg>
                    </g>`}else return`<svg class="svg-icon${this.kind==="cableRun"?" cable-run-svg":this.kind==="distanceLine"?" distance-line-svg":""}" width="${this.sizex*this.scale}px" height="${this.sizey*this.scale}px" viewBox="0 0 ${this.sizex} ${this.sizey}">${this.svg}</svg>`}changePage(e){this.page=e}getSizeFromString(){const s=new DOMParser().parseFromString(this.svg,"image/svg+xml").querySelector("svg");s?(this.sizey=parseInt(s.getAttribute("height")),this.sizex=parseInt(s.getAttribute("width"))):console.error("Invalid SVG string")}scaleSelectedBoxToPaperIfNeeded(e,t,s=1){const n=this.sizex,r=this.sizey,a=Math.min(s,e/n,t/r);this.scale=Math.floor(a*1e4)/1e4}importFromFile(e,t){const n=e.target.files[0];if(n){const r=new FileReader;n.name.toLowerCase(),n.type,r.onload=a=>{const o=a.target.result,l=new Image;l.src=o,l.onload=()=>{this.sizex=l.width,this.sizey=l.height,this.svg=`<svg width="${l.width}" height="${l.height}"><image href="${o}" width="${l.width}" height="${l.height}"/></svg>`,t()},l.onerror=()=>{alert("Het formaat van deze file wordt niet ondersteund.")}},r.readAsDataURL(n)}else alert("Geen bestand geselecteerd")}setVars(e){Object.assign(this,e)}toJsonObject(){return{kind:this.kind,distanceLine:this.distanceLine,cableRun:this.cableRun,connectionPoint:this.connectionPoint,visible:this.visible,page:this.page,heightCm:this.heightCm,posx:this.posx,posy:this.posy,sizex:this.sizex,sizey:this.sizey,labelposx:this.labelposx,labelposy:this.labelposy,labelfontsize:this.labelfontsize,adrestype:this.adrestype,adres:this.adres,adreslocation:this.adreslocation,rotate:this.rotate,scale:this.scale,movable:this.movable,svg:this.isEendraadschemaSymbool()?"":this.svg,electroItemId:this.electroItemId}}fromJsonObject(e){var t;if(this.kind=e.kind!=null?e.kind:"default",this.distanceLine=e.distanceLine,this.cableRun=e.cableRun,this.connectionPoint=e.connectionPoint,this.visible=e.visible!=null?!!e.visible:!0,this.kind==="distanceLine"&&this.distanceLine){const s=this.distanceLine;s.distanceCm==null&&s.distanceMeters!=null&&Number.isFinite(s.distanceMeters)&&(s.distanceCm=s.distanceMeters*100)}if(this.kind==="cableRun"&&this.cableRun){const s=this.cableRun;Array.isArray(s.points)||(s.points=[]),s.points=s.points.filter(n=>n&&Number.isFinite(Number(n.x))&&Number.isFinite(Number(n.y))).map(n=>({x:Number(n.x),y:Number(n.y)})),s.kring=s.kring==null?null:String(s.kring),s.cableSpec=s.cableSpec==null?null:String(s.cableSpec),typeof s.cableSpec=="string"&&s.cableSpec.trim()===""&&(s.cableSpec=null)}if(this.kind==="connectionPoint"&&this.connectionPoint){const s=this.connectionPoint;s.connectionId=String((t=s.connectionId)!=null?t:"").trim(),s.connectionId===""&&(s.connectionId="CP")}this.page=e.page,this.heightCm=e.heightCm!=null&&Number.isFinite(Number(e.heightCm))?Number(e.heightCm):null,this.posx=e.posx,this.posy=e.posy,this.sizex=e.sizex,this.sizey=e.sizey,this.labelposx=e.labelposx!=null?e.labelposx:this.posx+20,this.labelposy=e.labelposy!=null?e.labelposy:this.posy,this.labelfontsize=e.labelfontsize!=null?e.labelfontsize:11,this.adrestype=e.adrestype!=null?e.adrestype:"manueel",this.adres=e.adres,this.adreslocation=e.adreslocation!=null?e.adreslocation:"rechts",this.rotate=e.rotate!=null?e.rotate:0,this.scale=e.scale!=null?e.scale:globalThis.SITPLANVIEW_DEFAULT_SCALE,this.svg=e.svg,this.electroItemId=e.electroItemId,this.needsViewUpdate=!0,this.movable=e.movable!=null?e.movable:!0}setConnectionPointAbsolute(e,t){const s=String(t!=null?t:"").trim()||"CP";this.kind="connectionPoint",this.rotate=0,this.setscale(1),this.sizex=16,this.sizey=16,this.posx=e.x,this.posy=e.y,this.connectionPoint={connectionId:s},this.needsViewUpdate=!0}setDistanceLineAbsolute(e,t,s=null){var d;const n=Math.min(e.x,t.x),r=Math.min(e.y,t.y),a=Math.max(e.x,t.x),o=Math.max(e.y,t.y),l=Math.max(1,a-n),c=Math.max(1,o-r);this.kind="distanceLine",this.rotate=0,this.setscale(1),this.sizex=l,this.sizey=c,this.posx=n+l/2,this.posy=r+c/2,this.labelfontsize=(d=this.labelfontsize)!=null?d:11,this.setAdresLocation("boven"),this.distanceLine={x1:e.x-n,y1:e.y-r,x2:t.x-n,y2:t.y-r,distanceCm:s},this.needsViewUpdate=!0}setCableRunAbsolute(e,t,s=null){const n=(e!=null?e:[]).filter(h=>h&&Number.isFinite(h.x)&&Number.isFinite(h.y));if(n.length<2)return;const r=Math.min(...n.map(h=>h.x)),a=Math.min(...n.map(h=>h.y)),o=Math.max(...n.map(h=>h.x)),l=Math.max(...n.map(h=>h.y)),c=Math.max(1,o-r),d=Math.max(1,l-a);this.kind="cableRun",this.rotate=0,this.setscale(1),this.sizex=c,this.sizey=d,this.posx=r+c/2,this.posy=a+d/2,this.cableRun={points:n.map(h=>({x:h.x-r,y:h.y-a})),kring:t,cableSpec:s==null?null:String(s)},typeof this.cableRun.cableSpec=="string"&&this.cableRun.cableSpec.trim()===""&&(this.cableRun.cableSpec=null),this.needsViewUpdate=!0}};yt.ROTATES_360_DEGREES_TYPES=new Set(["Contactdoos","Lichtpunt","Drukknop","Media","Schakelaars","Lichtcircuit","Bord","Bel"]);let we=yt;class X extends Pt{constructor(e){super(e),this.resetProps()}getLegacyKey(e,t){return typeof e!="undefined"&&e.length>t?e[t][2]:null}convertLegacyKeys(e){}resetProps(){super.resetProps()}getParent(){return super.getParent()}allowedChilds(){return["","Aansluiting","Domotica","Domotica module (verticaal)","Domotica gestuurde verbruiker","Leiding","Meerdere verbruikers","Splitsing","---","Batterij","Bel","Boiler","Contactdoos","Diepvriezer","Droogkast","Drukknop","Elektriciteitsmeter","Elektrische oven","EV lader","Ketel","Koelkast","Kookfornuis","Lichtcircuit","Lichtpunt","Media","Microgolfoven","Motor","Omvormer","Overspanningsbeveiliging","Schakelaars","Stoomoven","Transformator","USB lader","Vaatwasmachine","Ventilator","Verlenging","Verwarmingstoestel","Verbruiker","Vrije tekst","Warmtepomp/airco","Wasmachine","Zekering/differentieel","Zonnepaneel","---","Aansluitpunt","Aftakdoos","Zeldzame symbolen"]}getNumChildsWithKnownType(){let e=0;if(this.sourcelist!=null)for(let t=0;t<this.sourcelist.data.length;++t)this.sourcelist.data[t].parent===this.id&&this.sourcelist.active[t]&&this.sourcelist.data[t].getType()!=""&&!this.props.isAttribuut&&e++;return e}heeftKindMetGekendType(){return this.getNumChildsWithKnownType()>0}isVrijeTekstZonderKader(){return this.getType()=="Vrije tekst"?this.props.vrije_tekst_type=="zonder kader":!1}isChildOf(e){return this.parent!=0?this.getParent().getType()==e:!1}isAttribuut(){return this.props.isAttribuut}heeftVerbruikerAlsKind(){let e=this.getParent();if(e!=null&&e.getType()=="Meerdere verbruikers"){let t=this.sourcelist.getOrdinalById(this.id);if(t===null)return!1;let s=0;for(let n=0;n<this.sourcelist.data.length;++n)this.sourcelist.active[n]&&!this.sourcelist.data[n].isVrijeTekstZonderKader()&&this.sourcelist.data[n].parent==this.parent&&(s=n);return s>t}else if(this.sourcelist!=null){for(let t=0;t<this.sourcelist.data.length;++t)if(this.sourcelist.data[t].parent===this.id&&this.sourcelist.active[t]&&!this.sourcelist.data[t].isVrijeTekstZonderKader()&&this.sourcelist.data[t].getType()!=""&&this.sourcelist.data[t].getType()!=null)return!0}return!1}clone(e){this.parent=e.parent,this.indent=e.indent,this.collapsed=e.collapsed,this.sourcelist=e.sourcelist,this.props=De(e.props)}getType(){return this.props.type}clearProps(){let e="auto",t="auto",s="";typeof this.props.autonr!="undefined"&&(e=this.props.autonr),typeof this.props.autoKringNaam!="undefined"&&(t=this.props.autoKringNaam),typeof this.props.nr!="undefined"&&(s=this.props.nr),this.props={},this.props.nr=s,e!==null&&(this.props.autonr=e),t!==null&&(this.props.autoKringNaam=t)}getMaxNumChilds(){let e=this.getParent();if(e==null)return 256;switch(e.getType()){case"Meerdere verbruikers":return 0;default:return 1}}getNumChilds(){let e=0;for(let t=0;t<this.sourcelist.data.length;++t)this.sourcelist.data[t].parent===this.id&&this.sourcelist.active[t]&&!this.sourcelist.data[t].isAttribuut()&&e++;return e}checkInsertChild(){return this.getMaxNumChilds()>this.getNumChilds()}checkInsertSibling(){let e=this.getParent();return e==null?!0:e.getMaxNumChilds()>e.getNumChilds()}toHTMLHeader(e){let t="";e=="move"?(t+="<b>ID: "+this.id+"</b>, ",t+='Moeder: <input id="id_parent_change_'+this.id+'" type="text" size="2" value="'+this.parent+'" onchange="HL_changeparent('+this.id+')"> ',t+=`<button class="button-lightblue" onclick="HLMoveUp(${this.id})">&#9650;</button>`,t+=`<button class="button-lightblue" onclick="HLMoveDown(${this.id})">&#9660;</button>`,this.checkInsertSibling()&&(t+=`<button class="button-lightblue" onclick="HLClone(${this.id})">Clone</button>`)):(this.checkInsertSibling()&&(t+=`<button class="button-insertBefore" onclick="HLInsertBefore(${this.id})"></button>`,t+=`<button class="button-insertAfter" onclick="HLInsertAfter(${this.id})"></button>`),this.checkInsertChild()&&(t+=`<button class="button-insertChild" onclick="HLInsertChild(${this.id})"></button>`)),t+=`<button class="button-delete-garbage-can" onclick="HLDelete(${this.id})"></button>`,t+="&nbsp;";let s=this.getParent(),n;return s==null?n=["","Aansluiting","Zekering/differentieel","Kring"]:n=this.getParent().allowedChilds(),t+=this.selectPropToHTML("type",n,175),t}toHTMLFooter(){return this.isExpandable()?` <button title="Meerdere elementen (bvb schakelaars) omzetten in indivuele elementen" style="background-color:lightblue;" onclick="HLExpand(${this.id})">Uitpakken</button>`:""}toHTML(e){return this.toHTMLHeader(e)}getnr(){let e=this.getParent();if(e!=null)switch(e.getType()){case"Kring":case"Domotica module (verticaal)":return this.props.nr?this.props.nr:"";default:return e.getnr()}else return""}getReadableAdres(){if(this.getType()=="Bord"){let e=this.props.naam;return e==null&&(e=""),e}else{let e=F(this.sourcelist.findKringName(this.id)),t=F(this.getnr());return e==""?t:t==""?e:e+"."+t}}nrToHtml(){var s;typeof this.props.autonr==null&&(this.props.autonr="manueel");let e="",t=this.getParent();return t!=null&&(t.getType()=="Kring"||t.getType()=="Domotica module (verticaal)"?e+=`Nr: ${this.selectPropToHTML("autonr",["auto","manueel"])}`+(this.props.autonr==="auto"?`<input type="text" id="HL_edit_${this.id}_nr" size="2" value="${(s=this.props.nr)!=null?s:""}" disabled />`:this.stringPropToHTML("nr",2))+", ":this.props.nr=""),e}addAddressToSVG(e,t=60,s=15,n=0){let r="";return/^\s*$/.test(this.props.adres)||(r='<text x="'+((e.xright-20)/2+21+n)+'" y="'+t+'" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10" font-style="italic">'+E(this.props.adres)+"</text>",e.ydown=e.ydown+s),r}toSVG(e=!1,t=!1){return new J}toSituationPlanElement(){return new we}isExpandable(){return!1}expand(){this.isExpandable()}maxSituationPlanElements(){return 1}getSitPlanBoundaries(){return{clipleft:12,addright:0,cliptop:0,addbottom:0}}updateSituationPlanElement(e){let t=!1,s=e.rotate%360;s>=90&&s<270&&(t=!0),this.props.type=="Schakelaars"&&this.sourcelist.properties.legacySchakelaars==!1&&(this.props.aantal_schakelaars==1||this.props.aantal_schakelaars==null)&&(t=!1),H.clearSymbols();let n=this.toSVG(!0,t),r=n.xright+n.xleft+10,a=n.yup+n.ydown,o=this.getSitPlanBoundaries(),l=r-o.clipleft+o.addright,c=a-o.cliptop+o.addbottom;e.updateElectroItemSVG(`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" transform="scale(1,1)" viewBox="${o.clipleft} ${o.cliptop} ${r-o.clipleft+o.addright} ${a-o.cliptop+o.addbottom}" width="${l}" height="${c}">`+H.getNeededSymbols()+n.data+"</svg>",l,c)}}class Ni extends X{convertLegacyKeys(e){switch(this.props.type=this.getLegacyKey(e,0),this.props.aantal_polen=this.getLegacyKey(e,4),this.props.bescherming=this.getLegacyKey(e,7),this.props.amperage=this.getLegacyKey(e,8),this.props.type_kabel_na_teller=this.getLegacyKey(e,9),this.props.nr=this.getLegacyKey(e,10),this.props.differentieel_delta_amperage=this.getLegacyKey(e,11),this.props.adres=this.getLegacyKey(e,15),this.props.differentieel_is_selectief=this.getLegacyKey(e,20),this.props.kortsluitvermogen=this.getLegacyKey(e,22),this.props.naam=this.getLegacyKey(e,23),this.props.type_kabel_voor_teller=this.getLegacyKey(e,24),this.props.huishoudelijk=!0,this.props.fase="",this.props.bescherming){case"differentieel":this.props.type_differentieel=this.getLegacyKey(e,17);break;case"automatisch":this.props.curve_automaat=this.getLegacyKey(e,17);break;case"differentieelautomaat":this.props.type_differentieel=this.getLegacyKey(e,17),this.props.curve_automaat=this.getLegacyKey(e,18);break}}resetProps(){this.clearProps(),this.props.type="Aansluiting",this.props.aantal_polen="2",this.props.bescherming="differentieel",this.props.amperage="40",this.props.type_kabel_na_teller="2x16",this.props.differentieel_delta_amperage="300",this.props.adres="",this.props.type_differentieel="",this.props.curve_automaat="",this.props.differentieel_is_selectief=!1,this.props.kortsluitvermogen="",this.props.naam="",this.props.type_kabel_voor_teller="",this.props.huishoudelijk=!0,this.props.fase="",this.props.normaalGesloten=!1,this.props.newPage=!1}allowedChilds(){return["","Bord","Kring","Splitsing"]}getMaxNumChilds(){return 256}overrideKeys(){if(this.props.curve_automaat==="E"&&(this.props.curve_automaat="U"),this.props.normaalGesloten==null&&(this.props.normaalGesloten=!1),this.props.newPage==null&&(this.props.newPage=!1),this.props.bescherming=="schakelaar"&&(this.props.bescherming="contact"),this.props.aantal_polen!==""&&(this.props.aantal_polen<1||this.props.aantal_polen>4)&&(this.props.aantal_polen="2"),this.props.normaalGesloten===!0&&!["contact","zekeringscheider"].includes(this.props.bescherming)&&(this.props.normaalGesloten=!1),this.getParent()!==null)this.props.newPage=!1;else{let e=this.sourcelist.getFirstChildId(0);e!==null&&this.id===e&&(this.props.newPage=!1)}typeof this.props.huishoudelijk=="undefined"&&(this.props.huishoudelijk=!0),["automatisch","differentieel","differentieelautomaat","smelt"].includes(this.props.bescherming)||(this.props.fase=""),["automatisch","differentieel","differentieelautomaat"].includes(this.props.bescherming)||(this.props.kortsluitvermogen="")}toHTML(e){this.overrideKeys();let t=this.toHTMLHeader(e);if(t+="&nbsp;Naam: "+this.stringPropToHTML("naam",5)+"<br>",this.getParent()!=null){const s=this.nrToHtml();t+=typeof s=="string"?s.substring(2):s}switch(t+="Bescherming: "+this.selectPropToHTML("bescherming",["automatisch","differentieel","differentieelautomaat","smelt","geen","---","contact","zekeringscheider","schemer"]),this.props.bescherming!="geen"&&(t+=this.selectPropToHTML("aantal_polen",["2","3","4","-","1",""])+this.stringPropToHTML("amperage",2)+"A"),this.props.bescherming){case"differentieel":t+=", Δ "+this.stringPropToHTML("differentieel_delta_amperage",3)+"mA, Type:"+this.selectPropToHTML("type_differentieel",["","A","B"])+", Kortsluitstroom: "+this.stringPropToHTML("kortsluitvermogen",3)+"kA, Selectief: "+this.checkboxPropToHTML("differentieel_is_selectief")+", Fase: "+this.selectPropToHTML("fase",["","L1","L2","L3"]);break;case"automatisch":t+=", Curve:"+this.selectPropToHTML("curve_automaat",["","B","C","D","U"])+", Kortsluitstroom: "+this.stringPropToHTML("kortsluitvermogen",3)+"kA, Fase: "+this.selectPropToHTML("fase",["","L1","L2","L3"]);break;case"differentieelautomaat":t+=", Δ "+this.stringPropToHTML("differentieel_delta_amperage",3)+"mA, Curve:"+this.selectPropToHTML("curve_automaat",["","B","C","D","U"])+", Type:"+this.selectPropToHTML("type_differentieel",["","A","B"])+", Kortsluitstroom: "+this.stringPropToHTML("kortsluitvermogen",3)+"kA, Selectief: "+this.checkboxPropToHTML("differentieel_is_selectief")+", Fase: "+this.selectPropToHTML("fase",["","L1","L2","L3"]);break;case"smelt":t+=", Fase: "+this.selectPropToHTML("fase",["","L1","L2","L3"]);break;case"contact":case"zekeringscheider":t+=", Normaal Gesloten: "+this.checkboxPropToHTML("normaalGesloten");break}if(t+=", Kabeltype na teller: "+this.stringPropToHTML("type_kabel_na_teller",10)+", Kabeltype v&oacute;&oacute;r teller: "+this.stringPropToHTML("type_kabel_voor_teller",10),this.props.kortsluitvermogen!=""&&["differentieel","automatisch","differentieelautomaat"].includes(this.props.bescherming)&&(t+=", Huishoudelijke installatie: "+this.checkboxPropToHTML("huishoudelijk")),this.getParent()==null){let s=this.sourcelist.getFirstChildId(0);s!==null&&this.id!==s&&(t+=", Start op nieuwe pagina: "+this.checkboxPropToHTML("newPage"))}return t+=", Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=(c,d)=>{let h=c;return["L1","L2","L3"].includes(this.props.fase)&&(h=h+(this.props.huishoudelijk&&this.props.kortsluitvermogen!=""?1.3:1),d.data+='<text x="'+(d.xleft+15+11*(h-1))+'" y="'+(d.yup-10)+'" transform="rotate(-90 '+(d.xleft+15+11*(h-1))+","+(d.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(this.props.fase)+"</text>"),h};if(e){let c=new J;return H.addSymbol("elektriciteitsmeter"),c.xleft=1,c.xright=59,c.yup=25,c.ydown=25,c.data='<use xlink:href="#elektriciteitsmeter" x="21" y="25"></use>',c}let s=new J;H.addSymbol("zekering_automatisch"),H.addSymbol("zekering_empty"),H.addSymbol("zekering_smelt"),H.addSymbol("zekeringscheider"),H.addSymbol("arrow"),H.addSymbol("elektriciteitsmeter");let n="";this.props.aantal_polen!==""&&(n=`${E(this.props.aantal_polen)}P`);let r="";F(this.props.amperage)!==""&&(r=`${E(this.props.amperage)}A`);let a="";n!==""&&r!==""?a=`${n} - ${r}`:n!==""?a=n:r!==""&&(a=r);let o=0;this.props.type_kabel_voor_teller!=""&&(o+=50),s=this.sourcelist.toSVG(this.id,"vertical",150+o),s.data+='<line x1="'+s.xleft+'" x2="'+s.xleft+'" y1="'+s.yup+'" y2="'+(s.yup+20)+'" stroke="black" />',s.yup+=20;let l=1;switch(this.props.bescherming){case"automatisch":if(l=F(a)!==""?1:0,s.yup+=30,s.data+='<use xlink:href="#zekering_automatisch" x="'+s.xleft+'" y="'+s.yup+'" /><text x="'+(s.xleft+15)+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15)+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+a+"</text>",(this.props.curve_automaat=="B"||this.props.curve_automaat=="C"||this.props.curve_automaat=="D"||this.props.curve_automaat=="U")&&(++l,s.data+='<text x="'+(s.xleft+15+11*(l-1))+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15+11*(l-1))+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E("Curve "+this.props.curve_automaat)+"</text>"),this.props.kortsluitvermogen!="")if(this.props.huishoudelijk){l=l+1.3,s.data+='<text x="'+(s.xleft+15+11*(l-1))+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15+11*(l-1))+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(""+ce(this.props.kortsluitvermogen)*1e3)+"</text>";let c=oe(E(""+ce(this.props.kortsluitvermogen)*1e3))+6;s.data+='<rect x="'+(s.xleft+15+11*(l-2)+1)+'" y="'+(s.yup-10-c/2)+'" width="'+11*1.2+'" height="'+c+'" fill="none" stroke="black" />'}else l=l+1,s.data+='<text x="'+(s.xleft+15+11*(l-1))+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15+11*(l-1))+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(""+this.props.kortsluitvermogen)+"kA</text>";l=t.bind(this)(l,s),s.xright=Math.max(s.xright,20+11*(l-1));break;case"differentieel":if(this.props.differentieel_is_selectief&&(s.data+='<line x1="'+s.xleft+'" x2="'+s.xleft+'" y1="'+s.yup+'" y2="'+(s.yup+30)+'" stroke="black" /><rect x="'+(s.xleft+7)+'" y="'+s.yup+'" width="16" height="16" stroke="black" fill="white" /><text x="'+(s.xleft+19)+'" y="'+(s.yup+8)+'" transform="rotate(-90 '+(s.xleft+19)+","+(s.yup+8)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">S</text>',s.yup+=23),l=1+(F(a)!==""?1:0),s.yup+=30,s.data+='<use xlink:href="#zekering_automatisch" x="'+s.xleft+'" y="'+s.yup+'" /><text x="'+(s.xleft+15)+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15)+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">Δ'+E(this.props.differentieel_delta_amperage+"mA")+'</text><text x="'+(s.xleft+26)+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+26)+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+a+"</text>",(this.props.type_differentieel=="A"||this.props.type_differentieel=="B")&&(++l,s.data+='<text x="'+(s.xleft+15+11*(l-1))+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15+11*(l-1))+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E("Type "+this.props.type_differentieel)+"</text>"),this.props.kortsluitvermogen!="")if(this.props.huishoudelijk){l=l+1.3,s.data+='<text x="'+(s.xleft+15+11*(l-1))+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15+11*(l-1))+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(""+ce(this.props.kortsluitvermogen)*1e3)+"</text>";let c=oe(E(""+ce(this.props.kortsluitvermogen)*1e3))+6;s.data+='<rect x="'+(s.xleft+15+11*(l-2)+1)+'" y="'+(s.yup-10-c/2)+'" width="'+11*1.2+'" height="'+c+'" fill="none" stroke="black" />'}else l=l+1,s.data+='<text x="'+(s.xleft+15+11*(l-1))+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15+11*(l-1))+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(""+this.props.kortsluitvermogen)+"kA</text>";l=t.bind(this)(l,s),s.xright=Math.max(s.xright,20+11*(l-1));break;case"differentieelautomaat":if(this.props.differentieel_is_selectief&&(s.data+='<line x1="'+s.xleft+'" x2="'+s.xleft+'" y1="'+s.yup+'" y2="'+(s.yup+30)+'" stroke="black" /><rect x="'+(s.xleft+7)+'" y="'+s.yup+'" width="16" height="16" stroke="black" fill="white" /><text x="'+(s.xleft+19)+'" y="'+(s.yup+8)+'" transform="rotate(-90 '+(s.xleft+19)+","+(s.yup+8)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">S</text>',s.yup+=23),l=1+(F(a)!==""?1:0),s.yup+=30,s.data+='<use xlink:href="#zekering_automatisch" x="'+s.xleft+'" y="'+s.yup+'" /><text x="'+(s.xleft+15)+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15)+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">Δ'+E(this.props.differentieel_delta_amperage+"mA")+'</text><text x="'+(s.xleft+26)+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+26)+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+a+"</text>",(this.props.curve_automaat=="B"||this.props.curve_automaat=="C"||this.props.curve_automaat=="D"||this.props.curve_automaat=="U")&&(++l,s.data+='<text x="'+(s.xleft+15+11*(l-1))+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15+11*(l-1))+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E("Curve "+this.props.curve_automaat)+"</text>"),(this.props.type_differentieel=="A"||this.props.type_differentieel=="B")&&(++l,s.data+='<text x="'+(s.xleft+15+11*(l-1))+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15+11*(l-1))+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E("Type "+this.props.type_differentieel)+"</text>"),this.props.kortsluitvermogen!="")if(this.props.huishoudelijk){l=l+1.3,s.data+='<text x="'+(s.xleft+15+11*(l-1))+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15+11*(l-1))+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(""+ce(this.props.kortsluitvermogen)*1e3)+"</text>";let c=oe(E(""+ce(this.props.kortsluitvermogen)*1e3))+6;s.data+='<rect x="'+(s.xleft+15+11*(l-2)+1)+'" y="'+(s.yup-10-c/2)+'" width="'+11*1.2+'" height="'+c+'" fill="none" stroke="black" />'}else l=l+1,s.data+='<text x="'+(s.xleft+15+11*(l-1))+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15+11*(l-1))+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(""+this.props.kortsluitvermogen)+"kA</text>";l=t.bind(this)(l,s),s.xright=Math.max(s.xright,20+11*(l-1));break;case"contact":case"zekeringscheider":s.yup+=30,s.data+=`<use xlink:href="${this.props.bescherming=="contact"?"#zekering_empty":"#zekeringscheider"}" x="${s.xleft}" y="${s.yup}" /><text x="${s.xleft+15}" y="${s.yup-10}" transform="rotate(-90 ${s.xleft+15},${s.yup-10})" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">${a}</text>`,this.props.normaalGesloten&&(s.data+=`<line x1="${s.xleft}" x2="${s.xleft}" y1="${s.yup-25.5}" y2="${s.yup-30}" stroke="black" /><line x1="${s.xleft-12}" x2="${s.xleft+.5}" y1="${s.yup-25}" y2="${s.yup-25}" stroke="black" />`);break;case"schemer":s.yup+=30,s.data+='<use xlink:href="#zekering_empty" x="'+s.xleft+'" y="'+s.yup+'" /><text x="'+(s.xleft+15)+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15)+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+a+'</text><use xlink:href="#arrow" x="'+(s.xleft-18)+'" y="'+(s.yup-15)+'" /><use xlink:href="#arrow" x="'+(s.xleft-18)+'" y="'+(s.yup-12)+'" />';break;case"smelt":l=F(a)!==""?1:0,s.yup+=30,s.data+='<use xlink:href="#zekering_smelt" x="'+s.xleft+'" y="'+s.yup+'" /><text x="'+(s.xleft+15)+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15)+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+a+"</text>",l=t.bind(this)(l,s),s.xright=Math.max(s.xright,20+11*(l-1));break;case"geen":s.yup+=0;break}return s.data+='<line x1="1" y1="'+(s.yup+25)+'" x2="'+(21+o)+'" y2="'+(s.yup+25)+'" stroke="black"></line>',this.props.type_kabel_voor_teller!=""&&(s.data+='<text x="55" y="'+(s.yup+40)+'" style="text-anchor:end" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(this.props.type_kabel_voor_teller)+"</text>"),s.data+='<use xlink:href="#elektriciteitsmeter" x="'+(21+o)+'" y="'+(s.yup+25)+'"></use>',s.data+='<line x1="'+(61+o)+'" y1="'+(s.yup+25)+'" x2="'+s.xleft+'" y2="'+(s.yup+25)+'" stroke="black"></line><line x1="'+s.xleft+'" y1="'+s.yup+'" x2="'+s.xleft+'" y2="'+(s.yup+25)+'" stroke="black"></line>',s.data+='<text x="'+(85+o)+'" y="'+(s.yup+40)+'" style="text-anchor:left" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(this.props.type_kabel_na_teller)+"</text>",s.yup+=25,s.ydown=25,/^\s*$/.test(this.props.adres)||(s.data+='<text x="'+(41+o)+'" y="'+(s.yup+s.ydown+10)+'" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10" font-style="italic">'+E(this.props.adres)+"</text>",s.ydown+=15),s.data+='<text x="'+(s.xleft+-6)+'" y="'+(s.yup-10)+'" style="text-anchor:end" font-family="Arial, Helvetica, sans-serif" font-weight="bold" font-size="12">'+E(this.props.naam)+"</text>",s.xright=s.xright+s.xleft-1,s.xleft=1,this.props.newPage&&(s.data=`<svg newPage="true" x="0" y="0" width="${s.xleft+s.xright}" height="${s.yup+s.ydown}">`+s.data+"</svg>"),s}}class zi extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Aansluitpunt",this.props.adres=""}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml(),t+="Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;return H.addSymbol("aansluitpunt"),t.xleft=1,t.xright=29,t.yup=25,t.ydown=25,t.data+=(e?"":'<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line>')+'<use xlink:href="#aansluitpunt" x="21" y="25"></use>',t.data+=e?"":this.addAddressToSVG(t,45,0),t}}class Ki extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Aardingsonderbreker",this.props.adres=""}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml(),t+="Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;return H.addSymbol("aardingsonderbreker"),t.xleft=1,t.xright=59,t.yup=10,t.ydown=10,t.data='<use xlink:href="#aardingsonderbreker" x="21" y="10"></use>',t.data+=e?"":this.addAddressToSVG(t,60,15),t}}class ss extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Aftakdoos",this.props.adres=""}allowedChilds(){return["","Aansluiting","Domotica","Domotica module (verticaal)","Domotica gestuurde verbruiker","Leiding","Meerdere verbruikers","Splitsing","---","Batterij","Bel","Boiler","Contactdoos","Diepvriezer","Droogkast","Drukknop","Elektriciteitsmeter","Elektrische oven","EV lader","Ketel","Koelkast","Kookfornuis","Lichtcircuit","Lichtpunt","Media","Microgolfoven","Motor","Omvormer","Overspanningsbeveiliging","Schakelaars","Stoomoven","Transformator","USB lader","Vaatwasmachine","Ventilator","Verlenging","Verwarmingstoestel","Verbruiker","Vrije tekst","Warmtepomp/airco","Wasmachine","Zekering/differentieel","Zonnepaneel","---","Aansluitpunt","Aftakdoos","Zeldzame symbolen"]}getMaxNumChilds(){return 256}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml(),t+="Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;if(e)return H.addSymbol("aftakdoos"),t.yup=25,t.ydown=25,t.xleft=1,t.xright=49,t.data+='<use xlink:href="#aftakdoos" x="21" y="25"></use>',t;H.addSymbol("aftakdoos"),t=this.sourcelist.toSVG(this.id,"vertical");let s=Math.max(t.yup+t.ydown,50);t.yup=s/2,t.ydown=t.yup,t.firstChildydown=null,t.lastChildyup=null;let n=0;this.getNumChilds(),s>150?n=20:s>100&&(n=10),t.data=`<svg x="${50+n}" y="0">${t.data}</svg>`,t.xleft=1,t.xright+=50+n;for(let r=0;r<t.connectorPos.length;r++){if(t.connectorPos[r]==null)continue;let a={x:36,y:t.yup},o={x:51+n,y:s-t.connectorPos[r]},c=15/Math.sqrt(Math.pow(o.x-a.x,2)+Math.pow(o.y-a.y,2));t.data+=`<line x1="${a.x+c*(o.x-a.x)}" y1="${a.y+c*(o.y-a.y)}" x2="${o.x}" y2="${o.y}" stroke="black" stroke-linecap="round"></line>`}if(t.data+=`<line x1="1" y1="${t.yup}" x2="21" y2="${t.yup}" stroke="black"></line><use xlink:href="#aftakdoos" x="21" y="${t.yup}"></use>`,!/^\s*$/.test(this.props.adres)){const a=s/2+30,o=10,l=2,d=oe(E(this.props.adres),o,"")+l*2,h=o+l*2;t.data+=`<rect x="${35-d/2}" y="${a-h/2-4}" width="${d}" height="${h}" fill="white" />`,t.data+='<text x="35" y="'+a+'" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+this.props.adres+"</text>",t.ydown=Math.max(t.ydown,40)}return t}}class $i extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Batterij",this.props.adres="",this.props.symbool="standaard"}overrideKeys(){this.props.symbool==null&&(this.props.symbool="standaard")}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml(),t+="Symbool: "+this.selectPropToHTML("symbool",["standaard","blokbatterij"]),t+=", Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;switch(t.xleft=1,t.yup=25,t.ydown=25,this.props.symbool){case"standaard":H.addSymbol("batterij_nieuw"),t.xright=49,t.data=(e?"":'<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line>')+'<use xlink:href="#batterij_nieuw" x="21" y="25"></use>';break;default:H.addSymbol("batterij"),t.xright=59,t.data=(e?"":'<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line>')+'<use xlink:href="#batterij" x="21" y="25"></use>'}return t.data+=e?"":this.addAddressToSVG(t,55,10),t}}class Ri extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Bel",this.props.adres=""}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml(),t+="Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(){let e=new J;return H.addSymbol("bel"),e.xleft=1,e.xright=40,e.yup=25,e.ydown=25,e.data='<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line><use xlink:href="#bel" x="21" y="25"></use>',e.data+=this.addAddressToSVG(e,60,15),e}getSitPlanBoundaries(){return{clipleft:0,addright:0,cliptop:0,addbottom:0}}}class Di extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.heeft_accumulatie=this.getLegacyKey(e,3),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Boiler",this.props.heeft_accumulatie=!1,this.props.adres=""}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml(),t+="Accumulatie: "+this.checkboxPropToHTML("heeft_accumulatie"),t+=", Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;switch(t.xleft=1,t.xright=59,t.yup=25,t.ydown=25,t.data=e?"":'<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line>',this.props.heeft_accumulatie){case!1:H.addSymbol("VerticalStripe"),H.addSymbol("boiler"),t.data+='<use xlink:href="#boiler" x="21" y="25"></use>';break;case!0:H.addSymbol("VerticalStripe"),H.addSymbol("boiler_accu"),t.data+='<use xlink:href="#boiler_accu" x="21" y="25"></use>';break}return t.data+=e?"":this.addAddressToSVG(t,60),t}}class It extends X{erBestaatEenBordUpstream(){let e=this.getParent();for(;e!=null&&e.id!=0;){if(e.props.type==="Bord")return!0;e=e.getParent()}return!1}convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.is_geaard=this.getLegacyKey(e,1),this.props.naam=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Bord",this.erBestaatEenBordUpstream()?this.props.is_geaard=!1:this.props.is_geaard=!0,this.props.naam="",this.props.adres=""}allowedChilds(){return["","Kring","Vrije ruimte"]}getMaxNumChilds(){return 256}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;Naam: "+this.stringPropToHTML("naam",5)+", Geaard: "+this.checkboxPropToHTML("is_geaard"),t}toSitPlanSVG(e=!1){let t=60,s=(t-60)/2,n=new J;n.xleft=0,n.xright=31,n.yup=0,n.ydown=t,n.data+=`<rect y="5" x="8" height="${t-10}" width="24" stroke="black" stroke-width="1" fill="none" />`,n.data+=`<line y1="${t/2}" x1="0" y2="${t/2}" x2="8" stroke="black" stroke-width="1" />`;for(let r=0;r<5;r++)n.data+=`<line y1="${10+s+r*10}" x1="32" y2="${10+s+r*10}" x2="40" stroke="black" stroke-width="1" />`;return n}toSVG(e=!1,t=!1){let s;if(e)return this.toSitPlanSVG(t);s=this.sourcelist.toSVG(this.id,"horizontal"),s.yup==0&&(s.yup=2),s.xright+=10;let n=Math.max(30,oe(E(this.props.naam),10,'font-weight="bold"')+13),r=n+(this.props.is_geaard?70:0);if(this.isChildOf("Aansluiting")){let a=145;this.getParent().props.type_kabel_voor_teller!=""&&(a=a+50);let o=Math.max(0,a-r);n=n+o,r=r+o}if(s.xleft<=r&&(s.xright=s.xleft+s.xright-r,s.xleft=r),s.xright<=10&&(s.xright=10),s.ydown=Math.max(s.ydown,1),s.data+='<line x1="4" x2="'+(s.xleft+s.xright-6)+'" y1="'+s.yup+'" y2="'+s.yup+'" stroke="black" stroke-width="3" />',this.isChildOf("Kring")){const a=this.getParent();a!==null&&a.getNumChilds()>1&&(s.ydown+=10,s.data+=`<line x1="${s.xleft}" x2="${s.xleft}" y1="${s.yup+1}" y2="${s.yup+11}" stroke="black" stroke-width="1" />`)}return this.props.naam!==""&&(s.data+='<text x="5" y="'+(s.yup+13)+'" style="text-anchor:start" font-family="Arial, Helvetica, sans-serif" font-weight="bold" font-size="10">'+E(this.props.naam)+"</text>"),this.props.is_geaard&&(s.data+='<line x1="'+(n+10)+'" y1="'+(s.yup+0)+'" x2="'+(n+10)+'" y2="'+(s.yup+10)+'" stroke="black" /><line x1="'+(n+10)+'" y1="'+(s.yup+15)+'" x2="'+(n+10)+'" y2="'+(s.yup+25)+'" stroke="black" /><line x1="'+(n+10)+'" y1="'+(s.yup+30)+'" x2="'+(n+10)+'" y2="'+(s.yup+40)+'" stroke="black" /><line x1="'+(n+5)+'" y1="'+(s.yup+10)+'" x2="'+(n+15)+'" y2="'+(s.yup+10)+'" stroke="black" /><line x1="'+(n+5)+'" y1="'+(s.yup+15)+'" x2="'+(n+15)+'" y2="'+(s.yup+15)+'" stroke="black" /><line x1="'+(n+5)+'" y1="'+(s.yup+25)+'" x2="'+(n+15)+'" y2="'+(s.yup+25)+'" stroke="black" /><line x1="'+(n+5)+'" y1="'+(s.yup+30)+'" x2="'+(n+15)+'" y2="'+(s.yup+30)+'" stroke="black" /><line x1="'+(n+0)+'" y1="'+(s.yup+40)+'" x2="'+(n+20)+'" y2="'+(s.yup+40)+'" stroke="black" /><line x1="'+(n+2.5)+'" y1="'+(s.yup+43)+'" x2="'+(n+17.5)+'" y2="'+(s.yup+43)+'" stroke="black" /><line x1="'+(n+5)+'" y1="'+(s.yup+46)+'" x2="'+(n+15)+'" y2="'+(s.yup+46)+'" stroke="black" />'),s}getSitPlanBoundaries(){return{clipleft:0,addright:0,cliptop:0,addbottom:0}}}class Vi extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.is_geaard=this.getLegacyKey(e,1),this.props.is_kinderveilig=this.getLegacyKey(e,2),this.props.aantal=this.getLegacyKey(e,4),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15),this.props.aantal_fases_indien_meerfasig=this.getLegacyKey(e,16),this.props.heeft_ingebouwde_schakelaar=this.getLegacyKey(e,19),this.props.is_halfwaterdicht=this.getLegacyKey(e,20),this.props.is_meerfasig=this.getLegacyKey(e,21),this.props.heeft_nul_indien_meerfasig=this.getLegacyKey(e,25),this.props.in_verdeelbord=this.getLegacyKey(e,26)}resetProps(){this.clearProps(),this.props.type="Contactdoos",this.props.is_geaard=!0,this.props.is_kinderveilig=!0,this.props.aantal="1",this.props.adres="",this.props.aantal_fases_indien_meerfasig="3",this.props.heeft_ingebouwde_schakelaar=!1,this.props.is_halfwaterdicht=!1,this.props.is_meerfasig=!1,this.props.heeft_nul_indien_meerfasig=!1,this.props.in_verdeelbord=!1}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml()+"Geaard: "+this.checkboxPropToHTML("is_geaard")+", Kinderveiligheid: "+this.checkboxPropToHTML("is_kinderveilig")+" Halfwaterdicht: "+this.checkboxPropToHTML("is_halfwaterdicht")+", Meerfasig: "+this.checkboxPropToHTML("is_meerfasig")+", ",this.props.is_meerfasig&&(t+="Aantal fasen: "+this.selectPropToHTML("aantal_fases_indien_meerfasig",["1","2","3"])+", Met nul: "+this.checkboxPropToHTML("heeft_nul_indien_meerfasig")+", "),t+="Ingebouwde schakelaar: "+this.checkboxPropToHTML("heeft_ingebouwde_schakelaar")+", Aantal: "+this.selectPropToHTML("aantal",["1","2","3","4","5","6"])+", In verdeelbord: "+this.checkboxPropToHTML("in_verdeelbord")+", Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1,t=!1){let s=new J;H.addSymbol("contactdoos"),H.addSymbol("contactdoos_aarding"),H.addSymbol("contactdoos_kinderveilig"),s.xleft=1,s.xright=20,s.yup=25,s.ydown=25;var n=1;if(this.props.is_meerfasig){switch(s.data+='<line x1="1" y1="25" x2="35" y2="25" stroke="black" />',this.props.aantal_fases_indien_meerfasig){case"1":s.data+='<line x1="21" y1="35" x2="27" y2="15" stroke="black" />';break;case"2":s.data+='<line x1="16.5" y1="35" x2="22.5" y2="15" stroke="black" /><line x1="22.5" y1="35" x2="28.5" y2="15" stroke="black" />';break;case"3":s.data+='<line x1="15" y1="35" x2="21" y2="15" stroke="black" /><line x1="21" y1="35" x2="27" y2="15" stroke="black" /><line x1="27" y1="35" x2="33" y2="15" stroke="black" />';break;default:s.data+='<line x1="21" y1="35" x2="27" y2="15" stroke="black" />';break}this.props.heeft_nul_indien_meerfasig&&(s.data+='<line x1="39" y1="35" x2="45" y2="15" stroke="black" /><circle cx="39" cy="35" r="2" fill="black" stroke="black" />'),n+=34,s.xright+=34}this.props.heeft_ingebouwde_schakelaar&&(s.data+='<line x1="'+(n+0)+'" y1="25" x2="'+(n+11)+'" y2="25" stroke="black" /><line x1="'+(n+30)+'" y1="25" x2="'+(n+20)+'" y2="5" stroke="black" /><line x1="'+(n+20)+'" y1="5" x2="'+(n+15)+'" y2="7.5" stroke="black" /><line x1="'+(n+22)+'" y1="9" x2="'+(n+17)+'" y2="11.5" stroke="black" />',n+=10,s.xright+=10);for(let r=0;r<this.props.aantal;++r)s.data+='<use xlink:href="#contactdoos" x="'+n+'" y="25"></use>',this.props.is_geaard&&(s.data+='<use xlink:href="#contactdoos_aarding" x="'+n+'" y="25"></use>'),this.props.is_kinderveilig&&(s.data+='<use xlink:href="#contactdoos_kinderveilig" x="'+n+'" y="25"></use>'),n+=20,s.xright+=20;if(this.props.is_halfwaterdicht){let r=25+this.props.heeft_ingebouwde_schakelaar*10+this.props.is_meerfasig*34,a='text-anchor:middle" font-family="Arial, Helvetica, sans-serif';if(t==!1?s.data+='<text x="'+ +r+'" y="8" style="'+a+'" font-size="10">h</text>':s.data+='<text transform="scale(-1,1) translate('+-r*2+',0)" x="'+ +r+'" y="8" style="'+a+'" font-size="10">h</text>',this.props.in_verdeelbord){let o={x:s.xright-this.props.aantal*20-3-this.props.heeft_ingebouwde_schakelaar*12,y:3},l={width:this.props.aantal*20+6+this.props.heeft_ingebouwde_schakelaar*12,height:44};s.data+=`<line x1="${o.x}" y1="${o.y}" x2="${o.x}" y2="${o.y+l.height}" style="stroke:black" /><line x1="${o.x}" y1="${o.y+l.height}" x2="${o.x+l.width}" y2="${o.y+l.height}" style="stroke:black" /><line x1="${o.x+l.width}" y1="${o.y}" x2="${o.x+l.width}" y2="${o.y+l.height}" style="stroke:black" /><line x1="${o.x}" y1="${o.y}" x2="${r-3}" y2="${o.y}" style="stroke:black" /><line x1="${r+3}" y1="${o.y}" x2="${o.x+l.width}" y2="${o.y}" style="stroke:black" /><line x1="${17+(s.xright-20+3)}" y1="3" x2="${17+(s.xright-20+3)}" y2="47" fill="none" style="stroke:black" />`}}else this.props.in_verdeelbord&&(s.data+='<rect x="'+(s.xright-this.props.aantal*20-3-this.props.heeft_ingebouwde_schakelaar*12)+'" y="3" width="'+(this.props.aantal*20+6+this.props.heeft_ingebouwde_schakelaar*12)+'" height="44" fill="none" style="stroke:black" /><line x1="'+(17+(s.xright-20+3))+'" y1="3" x2="'+(17+(s.xright-20+3))+'" y2="47" fill="none" style="stroke:black" />');return this.heeftVerbruikerAlsKind()&&!e&&(s.data+='<line x1="'+n+'" y1="25" x2="'+(n+21)+'" y2="25" stroke="black" />'),s.data+=e?"":this.addAddressToSVG(s,60,15),s}getSitPlanBoundaries(){return{clipleft:0,addright:0,cliptop:0,addbottom:0}}}class ht extends X{convertLegacyKeys(e){}resetProps(){this.clearProps(),this.props.type="Container"}toHTML(e){return""}toSVG(e=!1){let t=new J;return t.xleft=0,t.xright=0,t.yup=0,t.ydown=0,t.data="",t}}class Oi extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Diepvriezer",this.props.adres=""}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml(),t+="Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;return H.addSymbol("ster"),H.addSymbol("diepvriezer"),t.xleft=1,t.xright=60,t.yup=25,t.ydown=25,t.data=(e?"":'<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line>')+'<use xlink:href="#diepvriezer" x="21" y="25"></use>',t.data+=e?"":this.addAddressToSVG(t,60,15),t}}class ji extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.tekst=this.getLegacyKey(e,15),this.props.adres=this.getLegacyKey(e,23)}resetProps(){this.clearProps(),this.props.type="Domotica",this.props.tekst="Domotica",this.props.adres="",this.props.nr=""}allowedChilds(){return["","Kring"]}getMaxNumChilds(){return 256}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml()+'Tekst (nieuwe lijn = "|"): '+this.stringPropToHTML("tekst",30)+", Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(){let e;var t=E(this.props.tekst).split("|");e=this.sourcelist.toSVG(this.id,"horizontal");let s=80;for(let o of t)s=Math.max(s,oe(E(o),10,'font-weight="bold"')+15);s+=20,e.xright+e.xleft<=s&&(e.xright=s-e.xleft);let n=15*Math.max(t.length-2,0);e.yup=Math.max(e.yup+20,25)+n/2,e.ydown=Math.max(e.ydown,25)+n/2;let r=e.xleft+e.xright-20;e.data+='<rect x="20" width="'+r+'" y="'+(e.yup-20-n/2)+'" height="'+(40+n)+'" stroke="black" stroke-width="2" fill="white" />',e.data+='<line x1="1" x2="20" y1="'+e.yup+'" y2="'+e.yup+'" stroke="black" />';let a='<text style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10" font-weight="bold" ';for(let o=0;o<t.length;o++){let l=e.yup+3-n/2-(t.length>1?7.5:0)+15*o;e.data+=a+' x="'+(21+r/2)+'" y="'+l+'">'+t[o]+"</text>"}return e.xright=e.xleft+e.xright-1,e.xleft=1,/^\s*$/.test(this.props.adres)||(e.data+='<text x="'+((e.xright-20)/2+21)+'" y="'+(e.yup+e.ydown+10)+'" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10" font-style="italic">'+E(this.props.adres)+"</text>",e.ydown+=15),e}}class Fi extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.type_externe_sturing=this.getLegacyKey(e,5),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15),this.props.is_draadloos=this.getLegacyKey(e,19),this.props.heeft_lokale_drukknop=this.getLegacyKey(e,20),this.props.is_geprogrammeerd=this.getLegacyKey(e,21),this.props.heeft_detectie=this.getLegacyKey(e,25),this.props.heeft_externe_sturing=this.getLegacyKey(e,26)}resetProps(){this.clearProps(),this.props.type="Domotica gestuurde verbruiker",this.props.type_externe_sturing="drukknop",this.props.adres="",this.props.is_draadloos=!0,this.props.heeft_lokale_drukknop=!0,this.props.is_geprogrammeerd=!0,this.props.heeft_detectie=!1,this.props.heeft_externe_sturing=!1}allowedChilds(){return["","Batterij","Bel","Boiler","Contactdoos","Diepvriezer","Droogkast","Drukknop","Elektrische oven","EV lader","Ketel","Koelkast","Kookfornuis","Lichtcircuit","Lichtpunt","Media","Microgolfoven","Motor","Omvormer","Overspanningsbeveiliging","Schakelaars","Stoomoven","Transformator","USB lader","Vaatwasmachine","Ventilator","Verlenging","Verwarmingstoestel","Verbruiker","Vrije tekst","Warmtepomp/airco","Wasmachine","Zonnepaneel","---","Aansluitpunt","Aftakdoos","Zeldzame symbolen"]}getMaxNumChilds(){return 1}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml()+"Draadloos: "+this.checkboxPropToHTML("is_draadloos")+", Lokale Drukknop: "+this.checkboxPropToHTML("heeft_lokale_drukknop")+", Geprogrammeerd: "+this.checkboxPropToHTML("is_geprogrammeerd")+", Detectie: "+this.checkboxPropToHTML("heeft_detectie")+", Externe sturing: "+this.checkboxPropToHTML("heeft_externe_sturing"),this.props.heeft_externe_sturing&&(t+=", Externe sturing: "+this.selectPropToHTML("type_externe_sturing",["drukknop","schakelaar"])),t+=", Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;H.addSymbol("draadloos_klein"),H.addSymbol("drukknop_klein"),H.addSymbol("tijdschakelaar_klein"),H.addSymbol("detectie_klein"),H.addSymbol("schakelaar_klein");let s=0;for(let n=0;n<this.sourcelist.length;n++)if(this.isActief()&&this.sourcelist.data[n].parent==this.id&&!this.sourcelist.data[n].isAttribuut())switch(s++,s){case 1:t=this.sourcelist.toSVG(this.sourcelist.data[n].id,"horizontal",35,!0);break}if(t.yup+t.ydown<50&&(t.yup=25,t.ydown=25),t.xleft+t.xright<56&&(t.xleft=1,t.xright=55),t.data='<svg x="26" y="25">'+t.data+"</svg>",t.data+='<rect x="21" y="5" width="'+(t.xleft+t.xright+12)+'" height="'+(t.yup+t.ydown+20)+'" stroke="black" fill="none" />',t.data+='<line x1="21" x2="'+(21+t.xleft+t.xright+12)+'" y1="25" y2="25" stroke="black" />',t.xright+=33,t.yup+=25,t.ydown+=5,t.data+='<line x1="'+t.xleft+'" x2="'+(t.xleft+20)+'" y1="'+t.yup+'" y2="'+t.yup+'" stroke="black" />',this.props.is_draadloos&&(t.data+='<use xlink:href="#draadloos_klein" x="22" y="15"></use>'),this.props.heeft_lokale_drukknop&&(t.data+='<use xlink:href="#drukknop_klein" x="38" y="15"></use>'),this.props.is_geprogrammeerd&&(t.data+='<use xlink:href="#tijdschakelaar_klein" x="54" y="15"></use>'),this.props.heeft_detectie&&(t.data+='<use xlink:href="#detectie_klein" x="70" y="15"></use>'),this.props.heeft_externe_sturing)switch(this.props.type_externe_sturing){case"schakelaar":t.data='<svg x="0" y="20">'+t.data+'</svg><use xlink:href="#schakelaar_klein" x="78" y="18"></use><line x1="78" y1="21" x2="78" y2="25" stroke="black" />',t.yup+=20;break;case"drukknop":default:t.data='<svg x="0" y="20">'+t.data+'</svg><use xlink:href="#drukknop_klein" x="70" y="14"></use><line x1="78" y1="21" x2="78" y2="25" stroke="black" />',t.yup+=20}return e==!1&&(/^\s*$/.test(this.props.adres)||(t.data+='<text x="'+((t.xright-20)/2+21+0)+'" y="'+(t.ydown+t.yup+10)+'" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10" font-style="italic">'+E(this.props.adres)+"</text>",t.ydown+=15)),t}}class Ui extends X{convertLegacyKeys(e){}resetProps(){this.clearProps(),this.props.type="Domotica module (verticaal)",this.props.nr="",this.props.tekst="Domotica"}allowedChilds(){return["","Aansluiting","Domotica","Domotica module (verticaal)","Domotica gestuurde verbruiker","Leiding","Meerdere verbruikers","Splitsing","---","Batterij","Bel","Boiler","Contactdoos","Diepvriezer","Droogkast","Drukknop","Elektriciteitsmeter","Elektrische oven","EV lader","Ketel","Koelkast","Kookfornuis","Lichtcircuit","Lichtpunt","Media","Microgolfoven","Motor","Omvormer","Overspanningsbeveiliging","Schakelaars","Stoomoven","Transformator","USB lader","Vaatwasmachine","Ventilator","Verlenging","Verwarmingstoestel","Verbruiker","Vrije tekst","Warmtepomp/airco","Wasmachine","Zekering/differentieel","Zonnepaneel","---","Aansluitpunt","Aftakdoos","Zeldzame symbolen"]}getMaxNumChilds(){return 256}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml()+"Tekst: "+this.stringPropToHTML("tekst",10),t}toSVG(){let e=new J;e=this.sourcelist.toSVG(this.id,"vertical");let t=e.yup+e.ydown,s=t;return s<50&&(s=50),s=Math.max(s,oe(E(this.props.tekst),10,'font-weight="bold"')+25),e.yup=s/2,e.ydown=e.yup,e.data='<svg x="60" y="'+(s-t)+'">'+e.data+"</svg>",e.xleft=1,e.xright+=60,e.data+='<rect x="21" width="40" y="5" height="'+(s-10)+'" stroke="black" stroke-width="2" fill="white" />',e.data+='<line x1="1" x2="21" y1="'+e.yup+'" y2="'+e.yup+'" stroke="black" />',e.data+='<text x="44" y="'+e.yup+'" transform="rotate(90 44,'+e.yup+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-weight="bold" font-size="10">'+E(this.props.tekst)+"</text>",e}}class Gi extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Droogkast",this.props.adres=""}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml(),t+="Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;return H.addSymbol("droogkast"),t.xleft=1,t.xright=59,t.yup=25,t.ydown=25,t.data=(e?"":'<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line>')+'<use xlink:href="#droogkast" x="21" y="25"></use>',t.data+=e?"":this.addAddressToSVG(t,60,15),t}}class is extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.aantal=this.getLegacyKey(e,4),this.props.nr=this.getLegacyKey(e,10),this.props.aantal_knoppen_per_armatuur=this.getLegacyKey(e,13),this.props.adres=this.getLegacyKey(e,15),this.props.type_knop=this.getLegacyKey(e,16),this.props.is_afgeschermd=this.getLegacyKey(e,19),this.props.is_halfwaterdicht=this.getLegacyKey(e,20),this.props.heeft_verklikkerlampje=this.getLegacyKey(e,21)}resetProps(){this.clearProps(),this.props.type="Drukknop",this.props.aantal="1",this.props.aantal_knoppen_per_armatuur="1",this.props.adres="",this.props.type_knop="standaard",this.props.is_afgeschermd=!1,this.props.is_halfwaterdicht=!1,this.props.heeft_verklikkerlampje=!1}maxSituationPlanElements(){return this.props.aantal}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml()+"Type: "+this.selectPropToHTML("type_knop",["standaard","dimmer","rolluik"])+", Verklikkerlampje: "+this.checkboxPropToHTML("heeft_verklikkerlampje")+", Halfwaterdicht: "+this.checkboxPropToHTML("is_halfwaterdicht")+", Afgeschermd: "+this.checkboxPropToHTML("is_afgeschermd")+", Aantal armaturen: "+this.selectPropToHTML("aantal",["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"])+", Aantal knoppen per armatuur: "+this.selectPropToHTML("aantal_knoppen_per_armatuur",["1","2","3","4","5","6","7","8"])+", Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1,t=!1){let s=new J;H.addSymbol("drukknop"),s.xleft=1,s.xright=43,s.yup=25,s.ydown=25;var n=this.props.aantal;s.data+=(e?"":'<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line>')+'<use xlink:href="#drukknop" x="21" y="25"></use>',this.props.heeft_verklikkerlampje&&(s.data+='<line x1="28" y1="20" x2="38" y2="30" stroke="black"></line><line x1="28" y1="30" x2="38" y2="20" stroke="black"></line>'),this.props.is_afgeschermd&&(s.data+='<line x1="26" y1="10" x2="40" y2="10" stroke="black"></line><line x1="26" y1="10" x2="26" y2="15" stroke="black"></line><line x1="40" y1="10" x2="40" y2="15" stroke="black"></line><line x1="22" y1="15" x2="26" y2="15" stroke="black"></line><line x1="40" y1="15" x2="44" y2="15" stroke="black"></line>');var r="";if(this.props.is_halfwaterdicht&&(r+="h"),n>1&&!e&&(r!=""&&(r+=", "),r+="x"+n),r!=""){let a='style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10"';t==!1?s.data+='<text x="33" y="49" '+a+">"+E(r)+"</text>":s.data+='<text transform="scale(-1,1) translate(-66,0)" x="33" y="49" '+a+">"+E(r)+"</text>"}if(this.props.aantal_knoppen_per_armatuur>1){let a='style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10"';t==!1?s.data+='<text x="44" y="13" '+a+">"+E(this.props.aantal_knoppen_per_armatuur)+"</text>":s.data+='<text transform="scale(-1,1) translate(-88,0)" x="44" y="13" '+a+">"+E(this.props.aantal_knoppen_per_armatuur)+"</text>",s.data+='<line x1="39" y1="19" x2="44" y2="14" stroke="black" />'}switch(this.props.type_knop){case"dimmer":s.data+='<polygon points="18,20 18,13 28,20" fill="black" stroke="black" />';break;case"rolluik":s.data+='<polygon points="18,12 22,12 20,9" fill="black" stroke="black" /><polygon points="18,15 22,15 20,18" fill="black" stroke="black" />';break}return r!=""?s.data+=e?"":this.addAddressToSVG(s,65,20):s.data+=e?"":this.addAddressToSVG(s,49,5),s}}class qi extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Elektriciteitsmeter",this.props.adres=""}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml(),t+="Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;return H.addSymbol("elektriciteitsmeter"),t.xleft=1,t.xright=59,t.yup=25,t.ydown=25,t.data=(e?"":'<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line>')+'<use xlink:href="#elektriciteitsmeter" x="21" y="25"></use>',t.data+=e?"":this.addAddressToSVG(t,60,15),t}}class Wi extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Elektrische oven",this.props.adres=""}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml(),t+="Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;return H.addSymbol("oven"),t.xleft=1,t.xright=59,t.yup=25,t.ydown=25,t.data=(e?"":'<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line>')+'<use xlink:href="#oven" x="21" y="25"></use>',t.data+=e?"":this.addAddressToSVG(t,60,15),t}}class Ji extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="EV lader",this.props.adres=""}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml(),t+="Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;return H.addSymbol("EVlader"),t.xleft=1,t.xright=60,t.yup=25,t.ydown=25,t.data=(e?"":'<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line>')+'<use xlink:href="#EVlader" x="21" y="25"></use>',t.data+=e?"":this.addAddressToSVG(t,60,15),t}}class Xi extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.aantal=this.getLegacyKey(e,4),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15),this.props.keteltype=this.getLegacyKey(e,16),this.props.energiebron=this.getLegacyKey(e,17),this.props.warmtefunctie=this.getLegacyKey(e,18)}resetProps(){this.clearProps(),this.props.type="Ketel",this.props.aantal="1",this.props.adres="",this.props.keteltype="",this.props.energiebron="",this.props.warmtefunctie=""}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml(),t+="Type: "+this.selectPropToHTML("keteltype",["","Met boiler","Met tapspiraal","Warmtekrachtkoppeling","Warmtewisselaar"]),t+=", Energiebron: "+this.selectPropToHTML("energiebron",["","Elektriciteit","Gas (atmosferisch)","Gas (ventilator)","Vaste brandstof","Vloeibare brandstof"]),t+=", Warmte functie: "+this.selectPropToHTML("warmtefunctie",["","Koelend","Verwarmend","Verwarmend en koelend"]),t+=", Aantal: "+this.selectPropToHTML("aantal",["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"]),t+=", Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;H.addSymbol("verbruiker"),H.addSymbol("gas_ventilator"),H.addSymbol("gas_atmosferisch"),H.addSymbol("bliksem");var s=0;switch(this.props.aantal>1&&(s=15,t.data+='<text x="41" y="12" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">x'+E(this.props.aantal)+"</text>"),t.xleft=1,t.xright=59,t.yup=25+s,t.ydown=25,t.data+=(e?"":'<line x1="1" y1="'+(s+25)+'" x2="21" y2="'+(s+25)+'" stroke="black"></line>')+'<use xlink:href="#verbruiker" x="21" y="'+(s+25)+'"></use>',this.props.keteltype){case"Met tapspiraal":t.data+='<line x1="21" y1="'+(s+15)+'" x2="61" y2="'+(s+7)+'" stroke="black" /><line x1="21" y1="'+(s+15)+'" x2="61" y2="'+(s+23)+'" stroke="black" />';break;case"Met boiler":t.data+='<rect x="31" y="'+(s+10)+'" width="20" height="10" stroke="black" fill="white" />';break;case"Warmtewisselaar":t.data+='<line x1="26" y1="'+(s+0)+'" x2="26" y2="'+(s+5)+'" stroke="black" /><line x1="56" y1="'+(s+0)+'" x2="56" y2="'+(s+5)+'" stroke="black" /><line x1="26" y1="'+(s+5)+'" x2="33.5" y2="'+(s+23)+'" stroke="black" /><line x1="56" y1="'+(s+5)+'" x2="48.5" y2="'+(s+23)+'" stroke="black" /><line x1="33.5" y1="'+(s+23)+'" x2="41" y2="'+(s+14)+'" stroke="black" /><line x1="48.5" y1="'+(s+23)+'" x2="41" y2="'+(s+14)+'" stroke="black" />';break;case"Warmtekrachtkoppeling":t.data+='<circle cx="41" cy="'+(s+16)+'" r="7" style="stroke:black;fill:none" /><text x="41" y="'+(s+17)+'" style="text-anchor:middle;dominant-baseline:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">G</text>';break}var n=41,r=41;if(this.props.energiebron!=""&&this.props.warmtefunctie!="")var n=31,r=51;switch(this.props.energiebron){case"Gas (ventilator)":t.data+='<use xlink:href="#gas_ventilator" x="'+n+'" y="'+(s+35)+'"/>';break;case"Gas (atmosferisch)":t.data+='<use xlink:href="#gas_atmosferisch" x="'+n+'" y="'+(s+35)+'"/>';break;case"Elektriciteit":t.data+='<use xlink:href="#bliksem" x="'+n+'" y="'+(s+35)+'"/>';break;case"Vaste brandstof":t.data+='<rect x="'+(n-6)+'" y="'+(s+29)+'" width="12" height="12" style="stroke:black;fill:black" />';break;case"Vloeibare brandstof":t.data+='<circle cx="'+n+'" cy="'+(s+35)+'" r="6" style="stroke:black;fill:black" />';break}switch(this.props.warmtefunctie){case"Verwarmend":t.data+='<text x="'+(r-1)+'" y="'+(s+36)+'" style="text-anchor:middle;dominant-baseline:middle" font-family="Arial, Helvetica, sans-serif" font-size="12">+</text>';break;case"Koelend":t.data+='<text x="'+(r-1)+'" y="'+(s+36)+'" style="text-anchor:middle;dominant-baseline:middle" font-family="Arial, Helvetica, sans-serif" font-size="12">-</text>';break;case"Verwarmend en koelend":t.data+='<text x="'+(r-1)+'" y="'+(s+36)+'" style="text-anchor:middle;dominant-baseline:middle" font-family="Arial, Helvetica, sans-serif" font-size="12">+/-</text>';break}return t.data+=e?"":this.addAddressToSVG(t,60+s,15),t}}class Zi extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Koelkast",this.props.adres=""}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml(),t+="Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;return H.addSymbol("ster"),H.addSymbol("koelkast"),t.xleft=1,t.xright=59,t.yup=25,t.ydown=25,t.data=(e?"":'<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line>')+'<use xlink:href="#koelkast" x="21" y="25"></use>',t.data+=this.addAddressToSVG(t,60,15),t}}class Yi extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Kookfornuis",this.props.adres=""}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml(),t+="Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;return H.addSymbol("kookfornuis"),t.xleft=1,t.xright=59,t.yup=25,t.ydown=25,t.data=(e?"":'<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line>')+'<use xlink:href="#kookfornuis" x="21" y="25"></use>',t.data+=e?"":this.addAddressToSVG(t,60,15),t}}class Ls extends X{convertLegacyKeys(e){switch(this.props.type=this.getLegacyKey(e,0),this.props.aantal_polen=this.getLegacyKey(e,4),this.props.bescherming=this.getLegacyKey(e,7),this.props.amperage=this.getLegacyKey(e,8),this.props.type_kabel=this.getLegacyKey(e,9),this.props.naam=this.getLegacyKey(e,10),this.props.differentieel_delta_amperage=this.getLegacyKey(e,11),this.props.kabel_is_aanwezig=this.getLegacyKey(e,12),this.props.tekst=this.getLegacyKey(e,15),this.props.kabel_locatie=this.getLegacyKey(e,16),this.props.kabel_is_in_buis=this.getLegacyKey(e,19),this.props.differentieel_is_selectief=this.getLegacyKey(e,20),this.props.kortsluitvermogen=this.getLegacyKey(e,22),this.props.huishoudelijk=!0,this.props.fase="",this.props.bescherming){case"differentieel":this.props.type_differentieel=this.getLegacyKey(e,17);break;case"automatisch":this.props.curve_automaat=this.getLegacyKey(e,17);break;case"differentieelautomaat":this.props.type_differentieel=this.getLegacyKey(e,17),this.props.curve_automaat=this.getLegacyKey(e,18);break}}resetProps(){this.clearProps(),this.props.type="Kring",this.props.nr="",this.props.aantal_polen="2",this.props.bescherming="automatisch",this.props.amperage="20",this.props.type_kabel="XVB Cca 3G2,5",this.props.differentieel_delta_amperage="300",this.props.tekst="",this.props.kabel_locatie="N/A",this.props.type_differentieel="",this.props.curve_automaat="",this.props.kabel_is_in_buis=!1,this.props.differentieel_is_selectief=!1,this.props.kortsluitvermogen="",this.props.huishoudelijk=!0,this.props.fase="",this.props.normaalGesloten=!1,this.props.sturing="",this.props.adres="",this.props.newPage=!1;let e=this.getParent();if(e==null)this.props.kabel_is_aanwezig=!0,this.props.naam="";else switch(e.getType()){case"Bord":this.props.bescherming="automatisch",this.props.naam="---",this.props.kabel_is_aanwezig=!0;break;case"Splitsing":this.props.bescherming="geen",this.props.naam="",this.props.kabel_is_aanwezig=!1;break;case"Kring":this.props.type_kabel="",this.props.naam="",this.props.kabel_is_aanwezig=!0;break;case"Domotica":this.props.bescherming="geen",this.props.naam="",this.props.kabel_is_aanwezig=!0;break;default:this.props.bescherming="automatisch",this.props.naam="",this.props.kabel_is_aanwezig=!0;break}}allowedChilds(){return["","Aansluiting","Bord","Domotica","Domotica module (verticaal)","Domotica gestuurde verbruiker","Kring","Meerdere verbruikers","Splitsing","---","Batterij","Bel","Boiler","Contactdoos","Diepvriezer","Droogkast","Drukknop","Elektriciteitsmeter","Elektrische oven","EV lader","Ketel","Koelkast","Kookfornuis","Lichtcircuit","Lichtpunt","Media","Microgolfoven","Motor","Omvormer","Overspanningsbeveiliging","Schakelaars","Stoomoven","Transformator","USB lader","Vaatwasmachine","Ventilator","Verlenging","Verwarmingstoestel","Verbruiker","Vrije tekst","Warmtepomp/airco","Wasmachine","Zekering/differentieel","Zonnepaneel","---","Aansluitpunt","Aftakdoos","Zeldzame symbolen"]}getMaxNumChilds(){return 256}overrideKeys(){if(this.props.curve_automaat==="E"&&(this.props.curve_automaat="U"),this.props.sturing==null&&(this.props.sturing=""),this.props.normaalGesloten==null&&(this.props.normaalGesloten=!1),this.props.newPage==null&&(this.props.newPage=!1),this.props.bescherming=="schakelaar"&&(this.props.bescherming="contact"),this.props.aantal_polen!==""&&(this.props.aantal_polen<1||this.props.aantal_polen>4)&&(this.props.aantal_polen="2"),this.props.normaalGesloten===!0&&!["contact","zekeringscheider"].includes(this.props.bescherming)&&(this.props.normaalGesloten=!1),this.props.bescherming!=="contact"&&(this.props.sturing=""),this.getParent()!==null)this.props.newPage=!1;else{let e=this.sourcelist.getFirstChildId(0);e!==null&&this.id===e&&(this.props.newPage=!1)}this.props.kabel_locatie=="Luchtleiding"&&(this.props.kabel_is_in_buis=!1),this.props.bescherming!="differentieel"&&this.props.bescherming!="differentieelautomaat"&&(this.props.differentieel_is_selectief=!1),typeof this.props.huishoudelijk=="undefined"&&(this.props.huishoudelijk=!0),["automatisch","differentieel","differentieelautomaat","smelt"].includes(this.props.bescherming)||(this.props.fase=""),["automatisch","differentieel","differentieelautomaat"].includes(this.props.bescherming)||(this.props.kortsluitvermogen="")}toHTML(e){var s;this.overrideKeys();let t=this.toHTMLHeader(e);switch(t+=`&nbsp;Naam: ${this.selectPropToHTML("autoKringNaam",["auto","manueel"])}`+(this.props.autoKringNaam==="auto"?`<input type="text" id="HL_edit_${this.id}_naam" size="5" style="font-weight: bold; background-color:#FFFFE0;" value="${(s=this.props.naam)!=null?s:""}" disabled /><br>`:`${this.stringPropToHTML("naam",5)}<br>`),t+="Bescherming: "+this.selectPropToHTML("bescherming",["automatisch","differentieel","differentieelautomaat","smelt","geen","---","contact","zekeringscheider","relais","schemer","overspanningsbeveiliging"]),this.props.bescherming!="geen"&&this.props.bescherming!="relais"&&(t+=this.selectPropToHTML("aantal_polen",["2","3","4","-","1",""])+this.stringPropToHTML("amperage",2)+"A"),this.props.bescherming){case"differentieel":t+=", Δ "+this.stringPropToHTML("differentieel_delta_amperage",3)+"mA, Type:"+this.selectPropToHTML("type_differentieel",["","A","B"])+", Kortsluitstroom: "+this.stringPropToHTML("kortsluitvermogen",3)+"kA, Selectief: "+this.checkboxPropToHTML("differentieel_is_selectief")+", Fase: "+this.selectPropToHTML("fase",["","L1","L2","L3"]);break;case"automatisch":t+=", Curve:"+this.selectPropToHTML("curve_automaat",["","B","C","D","U"])+", Kortsluitstroom: "+this.stringPropToHTML("kortsluitvermogen",3)+"kA, Fase: "+this.selectPropToHTML("fase",["","L1","L2","L3"]);break;case"differentieelautomaat":t+=", Δ "+this.stringPropToHTML("differentieel_delta_amperage",3)+"mA, Curve:"+this.selectPropToHTML("curve_automaat",["","B","C","D","U"])+", Type:"+this.selectPropToHTML("type_differentieel",["","A","B"])+", Kortsluitstroom: "+this.stringPropToHTML("kortsluitvermogen",3)+"kA, Selectief: "+this.checkboxPropToHTML("differentieel_is_selectief")+", Fase: "+this.selectPropToHTML("fase",["","L1","L2","L3"]);break;case"smelt":t+=", Fase: "+this.selectPropToHTML("fase",["","L1","L2","L3"]);break;case"contact":t+=", Normaal Gesloten: "+this.checkboxPropToHTML("normaalGesloten"),t+=", Sturing: "+this.selectPropToHTML("sturing",["","spoel"]);break;case"zekeringscheider":t+=", Normaal Gesloten: "+this.checkboxPropToHTML("normaalGesloten");break}if(t+=", Kabel: "+this.checkboxPropToHTML("kabel_is_aanwezig"),this.props.kabel_is_aanwezig&&(t+=", Type: "+this.stringPropToHTML("type_kabel",10)+", Plaatsing: "+this.selectPropToHTML("kabel_locatie",["N/A","Ondergronds","Luchtleiding","In wand","Op wand"]),this.props.kabel_locatie!="Luchtleiding"&&(t+=", In buis: "+this.checkboxPropToHTML("kabel_is_in_buis"))),this.props.kortsluitvermogen!=""&&["differentieel","automatisch","differentieelautomaat"].includes(this.props.bescherming)&&(t+=", Huishoudelijke installatie: "+this.checkboxPropToHTML("huishoudelijk")),t+=", Tekst: "+this.stringPropToHTML("tekst",10),this.getParent()==null){let n=this.sourcelist.getFirstChildId(0);n!==null&&this.id!==n&&(t+=", Start op nieuwe pagina: "+this.checkboxPropToHTML("newPage"))}return t+=", Adres: "+this.stringPropToHTML("adres",5),t}toSVG(){let e=(p,g)=>{let m=p;return["L1","L2","L3"].includes(this.props.fase)&&(m++,g.data+='<text x="'+(g.xleft+15+11*(m-1))+'" y="'+(g.yup-10)+'" transform="rotate(-90 '+(g.xleft+15+11*(m-1))+","+(g.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(this.props.fase)+"</text>"),m},t=(p,g)=>{let m=p;return this.props.adres&&F(this.props.adres)!=""&&(m++,g.data+='<text x="'+(g.xleft+15+11*(m-1))+'" y="'+(g.yup-10)+'" transform="rotate(-90 '+(g.xleft+15+11*(m-1))+","+(g.yup-10)+')" style="text-anchor:middle;font-style:italic;" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(this.props.adres)+"</text>"),m},s=new J;H.addSymbol("zekering_automatisch"),H.addSymbol("zekering_empty"),H.addSymbol("zekering_smelt"),H.addSymbol("zekeringscheider"),H.addSymbol("overspanningsbeveiliging_inline"),H.addSymbol("arrow"),H.addSymbol("relais_kring");let n=0;this.props.kabel_is_aanwezig&&(this.props.kabel_is_in_buis||Et(["Ondergronds","In wand","Op wand"],this.props.kabel_locatie))&&(n=1);let r=25+20*n;this.props.naam.length>2&&(r=Math.max(r,oe(E(this.props.naam),12,'font-weight="bold"')+20)),this.props.bescherming==="contact"&&this.props.sturing==="spoel"&&(r+=25);let a="";this.props.aantal_polen!==""&&(a=`${E(this.props.aantal_polen)}P`);let o="";F(this.props.amperage)!==""&&(o=`${E(this.props.amperage)}A`);let l="";if(a!==""&&o!==""?l=`${a} - ${o}`:a!==""?l=a:o!==""&&(l=o),s=this.sourcelist.toSVG(this.id,"vertical",r),this.props.kabel_is_aanwezig){if(s.data+='<line x1="'+s.xleft+'" x2="'+s.xleft+'" y1="'+s.yup+'" y2="'+(s.yup+100)+'" stroke="black" /><text x="'+(s.xleft+15)+'" y="'+(s.yup+80)+'" transform="rotate(-90 '+(s.xleft+15)+","+(s.yup+80)+')" style="text-anchor:start" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(this.props.type_kabel)+"</text>",this.props.kabel_locatie=="Luchtleiding"&&(s.data+='<circle cx="'+s.xleft+'" cy="'+(s.yup+20)+'" r="4" style="stroke:black;fill:none" />'),n)switch(this.props.kabel_is_in_buis&&this.props.kabel_locatie!="Luchtleiding"&&(s.data+='<circle cx="'+(s.xleft-10)+'" cy="'+(s.yup+40)+'" r="4" style="stroke:black;fill:none" />'),this.props.kabel_locatie){case"Ondergronds":s.data+='<line x1="'+(s.xleft-13)+'" x2="'+(s.xleft-13)+'" y1="'+(s.yup+60)+'" y2="'+(s.yup+80)+'" style="stroke:black" /><line x1="'+(s.xleft-10)+'" x2="'+(s.xleft-10)+'" y1="'+(s.yup+62)+'" y2="'+(s.yup+78)+'" style="stroke:black" /><line x1="'+(s.xleft-7)+'" x2="'+(s.xleft-7)+'" y1="'+(s.yup+64)+'" y2="'+(s.yup+76)+'" style="stroke:black" />';break;case"In wand":s.data+='<line x1="'+(s.xleft-15)+'" x2="'+(s.xleft-15)+'" y1="'+(s.yup+10)+'" y2="'+(s.yup+30)+'" style="stroke:black" /><line x1="'+(s.xleft-15)+'" x2="'+(s.xleft-5)+'" y1="'+(s.yup+10)+'" y2="'+(s.yup+10)+'" style="stroke:black" /><line x1="'+(s.xleft-15)+'" x2="'+(s.xleft-5)+'" y1="'+(s.yup+20)+'" y2="'+(s.yup+20)+'" style="stroke:black" /><line x1="'+(s.xleft-15)+'" x2="'+(s.xleft-5)+'" y1="'+(s.yup+30)+'" y2="'+(s.yup+30)+'" style="stroke:black" /><line x1="'+(s.xleft-15)+'" x2="'+(s.xleft-15)+'" y1="'+(s.yup+65)+'" y2="'+(s.yup+85)+'" style="stroke:black" /><line x1="'+(s.xleft-15)+'" x2="'+(s.xleft-5)+'" y1="'+(s.yup+85)+'" y2="'+(s.yup+85)+'" style="stroke:black" /><line x1="'+(s.xleft-15)+'" x2="'+(s.xleft-5)+'" y1="'+(s.yup+65)+'" y2="'+(s.yup+65)+'" style="stroke:black" /><line x1="'+(s.xleft-15)+'" x2="'+(s.xleft-5)+'" y1="'+(s.yup+75)+'" y2="'+(s.yup+75)+'" style="stroke:black" />';break;case"Op wand":s.data+='<line x1="'+(s.xleft-5)+'" x2="'+(s.xleft-5)+'" y1="'+(s.yup+10)+'" y2="'+(s.yup+30)+'" style="stroke:black" /><line x1="'+(s.xleft-15)+'" x2="'+(s.xleft-5)+'" y1="'+(s.yup+10)+'" y2="'+(s.yup+10)+'" style="stroke:black" /><line x1="'+(s.xleft-15)+'" x2="'+(s.xleft-5)+'" y1="'+(s.yup+20)+'" y2="'+(s.yup+20)+'" style="stroke:black" /><line x1="'+(s.xleft-15)+'" x2="'+(s.xleft-5)+'" y1="'+(s.yup+30)+'" y2="'+(s.yup+30)+'" style="stroke:black" /><line x1="'+(s.xleft-5)+'" x2="'+(s.xleft-5)+'" y1="'+(s.yup+65)+'" y2="'+(s.yup+85)+'" style="stroke:black" /><line x1="'+(s.xleft-15)+'" x2="'+(s.xleft-5)+'" y1="'+(s.yup+85)+'" y2="'+(s.yup+85)+'" style="stroke:black" /><line x1="'+(s.xleft-15)+'" x2="'+(s.xleft-5)+'" y1="'+(s.yup+65)+'" y2="'+(s.yup+65)+'" style="stroke:black" /><line x1="'+(s.xleft-15)+'" x2="'+(s.xleft-5)+'" y1="'+(s.yup+75)+'" y2="'+(s.yup+75)+'" style="stroke:black" />';break}s.yup+=100}else s.data+='<line x1="'+s.xleft+'" x2="'+s.xleft+'" y1="'+s.yup+'" y2="'+(s.yup+20)+'" stroke="black" />',s.yup+=20;this.props.differentieel_is_selectief&&(s.data+='<line x1="'+s.xleft+'" x2="'+s.xleft+'" y1="'+s.yup+'" y2="'+(s.yup+30)+'" stroke="black" /><rect x="'+(s.xleft+7)+'" y="'+s.yup+'" width="16" height="16" stroke="black" fill="white" /><text x="'+(s.xleft+19)+'" y="'+(s.yup+8)+'" transform="rotate(-90 '+(s.xleft+19)+","+(s.yup+8)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">S</text>',s.yup+=23);let c=-6,d=1;switch(this.props.bescherming){case"automatisch":if(d=F(l)!==""?1:0,s.yup+=30,s.data+='<use xlink:href="#zekering_automatisch" x="'+s.xleft+'" y="'+s.yup+'" /><text x="'+(s.xleft+15)+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15)+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+l+"</text>",(this.props.curve_automaat=="B"||this.props.curve_automaat=="C"||this.props.curve_automaat=="D"||this.props.curve_automaat=="U")&&(++d,s.data+='<text x="'+(s.xleft+15+11*(d-1))+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15+11*(d-1))+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E("Curve "+this.props.curve_automaat)+"</text>"),this.props.kortsluitvermogen!="")if(this.props.huishoudelijk){d=d+1.3,s.data+='<text x="'+(s.xleft+15+11*(d-1))+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15+11*(d-1))+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(""+ce(this.props.kortsluitvermogen)*1e3)+"</text>";let p=oe(E(""+ce(this.props.kortsluitvermogen)*1e3))+6;s.data+='<rect x="'+(s.xleft+15+11*(d-2)+1)+'" y="'+(s.yup-10-p/2)+'" width="'+11*1.2+'" height="'+p+'" fill="none" stroke="black" />',d=d+.3}else d=d+1,s.data+='<text x="'+(s.xleft+15+11*(d-1))+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15+11*(d-1))+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(""+this.props.kortsluitvermogen)+"kA</text>";d=t.bind(this)(d,s),d=e.bind(this)(d,s),s.xright=Math.max(s.xright,20+11*(d-1));break;case"differentieel":if(d=1+(F(l)!==""?1:0),s.yup+=30,s.data+='<use xlink:href="#zekering_automatisch" x="'+s.xleft+'" y="'+s.yup+'" /><text x="'+(s.xleft+15)+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15)+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">Δ'+E(this.props.differentieel_delta_amperage+"mA")+'</text><text x="'+(s.xleft+26)+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+26)+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+l+"</text>",(this.props.type_differentieel=="A"||this.props.type_differentieel=="B")&&(++d,s.data+='<text x="'+(s.xleft+15+11*(d-1))+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15+11*(d-1))+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E("Type "+this.props.type_differentieel)+"</text>"),this.props.kortsluitvermogen!="")if(this.props.huishoudelijk){d=d+1.3,s.data+='<text x="'+(s.xleft+15+11*(d-1))+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15+11*(d-1))+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(""+ce(this.props.kortsluitvermogen)*1e3)+"</text>";let p=oe(E(""+ce(this.props.kortsluitvermogen)*1e3))+6;s.data+='<rect x="'+(s.xleft+15+11*(d-2)+1)+'" y="'+(s.yup-10-p/2)+'" width="'+11*1.2+'" height="'+p+'" fill="none" stroke="black" />',d=d+.3}else d=d+1,s.data+='<text x="'+(s.xleft+15+11*(d-1))+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15+11*(d-1))+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(""+this.props.kortsluitvermogen)+"kA</text>";d=t.bind(this)(d,s),d=e.bind(this)(d,s),s.xright=Math.max(s.xright,20+11*(d-1));break;case"differentieelautomaat":if(d=1+(F(l)!==""?1:0),s.yup+=30,s.data+='<use xlink:href="#zekering_automatisch" x="'+s.xleft+'" y="'+s.yup+'" /><text x="'+(s.xleft+15)+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15)+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">Δ'+E(this.props.differentieel_delta_amperage+"mA")+'</text><text x="'+(s.xleft+26)+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+26)+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+l+"</text>",(this.props.curve_automaat=="B"||this.props.curve_automaat=="C"||this.props.curve_automaat=="D"||this.props.curve_automaat=="U")&&(++d,s.data+='<text x="'+(s.xleft+15+11*(d-1))+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15+11*(d-1))+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E("Curve "+this.props.curve_automaat)+"</text>"),(this.props.type_differentieel=="A"||this.props.type_differentieel=="B")&&(++d,s.data+='<text x="'+(s.xleft+15+11*(d-1))+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15+11*(d-1))+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E("Type "+this.props.type_differentieel)+"</text>"),this.props.kortsluitvermogen!="")if(this.props.huishoudelijk){d=d+1.3,s.data+='<text x="'+(s.xleft+15+11*(d-1))+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15+11*(d-1))+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(""+ce(this.props.kortsluitvermogen)*1e3)+"</text>";let p=oe(E(""+ce(this.props.kortsluitvermogen)*1e3))+6;s.data+='<rect x="'+(s.xleft+15+11*(d-2)+1)+'" y="'+(s.yup-10-p/2)+'" width="'+11*1.2+'" height="'+p+'" fill="none" stroke="black" />',d=d+.3}else d=d+1,s.data+='<text x="'+(s.xleft+15+11*(d-1))+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15+11*(d-1))+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(""+this.props.kortsluitvermogen)+"kA</text>";d=t.bind(this)(d,s),d=e.bind(this)(d,s),s.xright=Math.max(s.xright,20+11*(d-1));break;case"contact":case"zekeringscheider":d=0+(F(l)!==""?1:0),s.yup+=30,this.props.sturing==="spoel"&&(s.data+=`<rect x="${s.xleft-25}" y="${s.yup-25}" width="10" height="24" stroke="black" fill="none" />`,s.data+=`<line x1="${s.xleft-25}" x2="${s.xleft-15}" y1="${s.yup-9}" y2="${s.yup-17}" stroke="black" />`,s.data+=`<line x1="${s.xleft-15}" x2="${s.xleft-5}" y1="${s.yup-13}" y2="${s.yup-13}" stroke="black" stroke-dasharray="1,1" />`,c=-30),s.data+=`<use xlink:href="${this.props.bescherming=="contact"?"#zekering_empty":"#zekeringscheider"}" x="${s.xleft}" y="${s.yup}" /><text x="${s.xleft+15}" y="${s.yup-10}" transform="rotate(-90 ${s.xleft+15},${s.yup-10})" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">${l}</text>`,this.props.normaalGesloten&&(s.data+=`<line x1="${s.xleft}" x2="${s.xleft}" y1="${s.yup-25.5}" y2="${s.yup-30}" stroke="black" /><line x1="${s.xleft-12}" x2="${s.xleft+.5}" y1="${s.yup-25}" y2="${s.yup-25}" stroke="black" />`),d=t.bind(this)(d,s),s.xright=Math.max(s.xright,20+11*(d-1));break;case"overspanningsbeveiliging":d=5/11+(F(l)!==""?1:0),s.yup+=30,s.data+='<use xlink:href="#overspanningsbeveiliging_inline" x="'+s.xleft+'" y="'+s.yup+'" /><text x="'+(s.xleft+20)+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+20)+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+l+"</text>",d=t.bind(this)(d,s),s.xright=Math.max(s.xright,20+11*(d-1)),c=-11;break;case"schemer":d=0+(F(l)!==""?1:0),s.yup+=30,s.data+='<use xlink:href="#zekering_empty" x="'+s.xleft+'" y="'+s.yup+'" /><text x="'+(s.xleft+15)+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15)+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+l+'</text><use xlink:href="#arrow" x="'+(s.xleft-18)+'" y="'+(s.yup-15)+'" /><use xlink:href="#arrow" x="'+(s.xleft-18)+'" y="'+(s.yup-12)+'" />',d=t.bind(this)(d,s),s.xright=Math.max(s.xright,20+11*(d-1));break;case"relais":d=.6,s.yup+=30,s.data+='<use xlink:href="#relais_kring" x="'+s.xleft+'" y="'+s.yup+'" />',c=-11,d=t.bind(this)(d,s),s.xright=Math.max(s.xright,20+11*(d-1));break;case"smelt":d=2/11+(F(l)!==""?1:0),s.yup+=30,s.data+='<use xlink:href="#zekering_smelt" x="'+s.xleft+'" y="'+s.yup+'" /><text x="'+(s.xleft+15+2)+'" y="'+(s.yup-10)+'" transform="rotate(-90 '+(s.xleft+15+2)+","+(s.yup-10)+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+l+"</text>",d=e.bind(this)(d,s),d=t.bind(this)(d,s),s.xright=Math.max(s.xright,20+11*(d-1));break;case"geen":s.yup+=0;break}let h=s.yup-40;return this.props.bescherming=="geen"&&(h+=25),s.data+='<text x="'+(s.xleft-6-20*n)+'" y="'+h+'" transform="rotate(-90 '+(s.xleft-6-20*n)+","+h+')" style="text-anchor:start" font-family="Arial, Helvetica, sans-serif" font-weight="bold" font-size="12">'+E(this.props.tekst)+"</text>",s.data+='<text x="'+(s.xleft+c)+'" y="'+(s.yup+3)+'" style="text-anchor:end" font-family="Arial, Helvetica, sans-serif" font-weight="bold" font-size="12">'+E(this.props.naam)+"</text>",s.data+='<line x1="'+s.xleft+'" x2="'+s.xleft+'" y1="'+s.yup+'" y2="'+(s.yup+15)+'" stroke="black" />',s.yup+=15,s.yup<=0&&(s.xleft=20,s.xright=20,s.yup=50,s.ydown=0),this.props.newPage&&(s.data=`<svg newPage="true" x="0" y="0" width="${s.xleft+s.xright}" height="${s.yup+s.ydown}">`+s.data+"</svg>"),s}}class Qi extends X{convertLegacyKeys(e){}resetProps(){this.clearProps(),this.props.type="Leiding",this.props.type_kabel="XVB Cca 3G2,5",this.props.kabel_locatie="N/A",this.props.kabel_is_in_buis=!1,this.props.adres=""}overrideKeys(){this.props.kabel_locatie=="Luchtleiding"&&(this.props.kabel_is_in_buis=!1)}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml()+"Type: "+this.stringPropToHTML("type_kabel",10)+", Plaatsing: "+this.selectPropToHTML("kabel_locatie",["N/A","Ondergronds","Luchtleiding","In wand","Op wand"]),this.props.kabel_locatie!="Luchtleiding"&&(t+=", In buis: "+this.checkboxPropToHTML("kabel_is_in_buis")),t}toSVG(){this.overrideKeys();let e=new J,t=100;switch(e.xleft=1,e.xright=t-1,e.yup=25,e.ydown=25,e.data+='<line x1="1" y1="25" x2="'+(t+1)+'" y2="25" stroke="black" />',this.props.kabel_locatie=="Luchtleiding"&&(e.data+='<circle cx="80" cy="25" r="4" style="stroke:black;fill:none" />'),this.props.kabel_is_in_buis&&this.props.kabel_locatie!="Luchtleiding"&&(e.data+='<circle cx="65" cy="15" r="4" style="stroke:black;fill:none" />'),this.props.kabel_locatie){case"Ondergronds":e.data+='<line y1="12" y2="12" x1="45" x2="25" style="stroke:black" /><line y1="15" y2="15" x1="43" x2="27" style="stroke:black" /><line y1="18" y2="18" x1="41" x2="29" style="stroke:black" />';break;case"In wand":e.data+='<line y1="10" y2="10" x1="95" x2="75" style="stroke:black" /><line y1="10" y2="20" x1="95" x2="95" style="stroke:black" /><line y1="10" y2="20" x1="85" x2="85" style="stroke:black" /><line y1="10" y2="20" x1="75" x2="75" style="stroke:black" /><line y1="10" y2="10" x1="40" x2="20" style="stroke:black" /><line y1="10" y2="20" x1="20" x2="20" style="stroke:black" /><line y1="10" y2="20" x1="40" x2="40" style="stroke:black" /><line y1="10" y2="20" x1="30" x2="30" style="stroke:black" />';break;case"Op wand":e.data+='<line y1="20" y2="20" x1="95" x2="75" style="stroke:black" /><line y1="10" y2="20" x1="95" x2="95" style="stroke:black" /><line y1="10" y2="20" x1="85" x2="85" style="stroke:black" /><line y1="10" y2="20" x1="75" x2="75" style="stroke:black" /><line y1="20" y2="20" x1="40" x2="20" style="stroke:black" /><line y1="10" y2="20" x1="20" x2="20" style="stroke:black" /><line y1="10" y2="20" x1="40" x2="40" style="stroke:black" /><line y1="10" y2="20" x1="30" x2="30" style="stroke:black" />';break}return e.data+='<text x="15" y="39" style="text-anchor:start" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(this.props.type_kabel)+"</text>",e.data+=`
`,e}}class Ps extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.aantal=this.getLegacyKey(e,4),this.props.nr=this.getLegacyKey(e,10),this.props.aantal_buizen_indien_TL=this.getLegacyKey(e,13),this.props.adres=this.getLegacyKey(e,15),this.props.type_lamp=this.getLegacyKey(e,16),this.props.type_noodverlichting=this.getLegacyKey(e,17),this.props.is_wandlamp=this.getLegacyKey(e,19),this.props.is_halfwaterdicht=this.getLegacyKey(e,20),this.props.heeft_ingebouwde_schakelaar=this.getLegacyKey(e,21)}overrideKeys(){this.props.type_lamp==null&&this.props.type_lamp==""&&(this.props.type_lamp="standaard")}resetProps(){this.clearProps(),this.props.type="Lichtpunt",this.props.aantal="1",this.props.aantal_buizen_indien_TL="1",this.props.adres="",this.props.type_lamp="standaard",this.props.type_noodverlichting="Geen",this.props.is_wandlamp=!1,this.props.is_halfwaterdicht=!1,this.props.heeft_ingebouwde_schakelaar=!1}maxSituationPlanElements(){return this.props.aantal}toHTML(e){this.overrideKeys();let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml()+"Type: "+this.selectPropToHTML("type_lamp",["standaard","TL","spot","led"])+", ",this.props.type_lamp=="TL"&&(t+="Aantal buizen: "+this.selectPropToHTML("aantal_buizen_indien_TL",["1","2","3","4"])+", "),t+="Aantal lampen: "+this.selectPropToHTML("aantal",["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"])+", Wandlamp: "+this.checkboxPropToHTML("is_wandlamp")+", Halfwaterdicht: "+this.checkboxPropToHTML("is_halfwaterdicht")+", Ingebouwde schakelaar: "+this.checkboxPropToHTML("heeft_ingebouwde_schakelaar")+", Noodverlichting: "+this.selectPropToHTML("type_noodverlichting",["Geen","Centraal","Decentraal"])+", Adres/tekst: "+this.stringPropToHTML("adres",5),t}getSitPlanBoundaries(){let e=0,t=0,s=0,n=0;switch(this.props.type_lamp){case"led":e=14;break;case"TL":e=20,+this.props.aantal_buizen_indien_TL>3&&(s=-1,n=1);break;case"spot":e=17;break;case"standaard":default:e=10;break}return{clipleft:e,addright:t,cliptop:s,addbottom:n}}toSVG(e=!1,t=!1){let s=new J;s.xleft=1,s.xright=20,s.yup=25,s.ydown=25,s.data=e?"":'<line x1="1" x2="30" y1="25" y2="25" stroke="black" />';let n="";switch(this.props.is_halfwaterdicht?(n="h",parseInt(this.props.aantal)>1&&!e&&(n+=", x"+this.props.aantal)):parseInt(this.props.aantal)>1&&!e&&(n="x"+this.props.aantal),this.props.type_lamp){case"led":H.addSymbol("led"),s.data+='<use xlink:href="#led" x="30" y="25" />',this.props.is_wandlamp&&(s.data+='<line x1="30" y1="35" x2="42" y2="35" stroke="black" />'),this.props.heeft_ingebouwde_schakelaar&&(s.data+='<line x1="42" y1="25" x2="45.75" y2="17.5" stroke="black" /><line x1="45.75" y1="17.5" x2="48.25" y2="18.75" stroke="black" />');var c,r,d=6.5;if(n==""?(c=36,r=36):(c=20,n.length>2&&(this.props.type_noodverlichting=="Centraal"||this.props.type_noodverlichting=="Decentraal")?r=40:r=36),n!=""){let h='style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="7"';t==!1?s.data+=`<text x="${r}" y="10" ${h}>${E(n)}</text>`:s.data+=`<text transform="scale(-1,1) translate(${-2*r},0)" x="${r}" y="10" ${h}>${E(n)}</text>`}switch(this.props.type_noodverlichting){case"Centraal":s.data+='<circle cx="'+c+'" cy="'+d+'" r="2.5" style="stroke:black;fill:black" /><line x1="'+(c-5.6)+'" y1="'+(d-5.6)+'" x2="'+(c+5.6)+'" y2="'+(d+5.6)+'" style="stroke:black;fill:black" /><line x1="'+(c+5.6)+'" y1="'+(d-5.6)+'" x2="'+(c-5.6)+'" y2="'+(d+5.6)+'" style="stroke:black;fill:black" />';break;case"Decentraal":s.data+='<rect x="'+(c-5.6)+'" y="'+(d-5.6)+'" width="11.2" height="11.2" fill="white" stroke="black" /><circle cx="'+c+'" cy="'+d+'" r="2.5" style="stroke:black;fill:black" />';break}s.xright=42,s.data+=e?"":this.addAddressToSVG(s,50,5,2);break;case"spot":H.addSymbol("spot"),s.data+='<use xlink:href="#spot" x="30" y="25" />',this.props.is_wandlamp&&(s.data+='<line x1="30" y1="38" x2="46" y2="38" stroke="black" />'),this.props.heeft_ingebouwde_schakelaar&&(s.data+='<line x1="46" y1="25" x2="49.75" y2="17.5" stroke="black" /><line x1="49.75" y1="17.5" x2="52.25" y2="18.75" stroke="black" />');var c,r,d=6.5;if(n==""?(c=40,r=40):(c=24,n.length>2&&(this.props.type_noodverlichting=="Centraal"||this.props.type_noodverlichting=="Decentraal")?r=44:r=40),n!=""){let h='style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="7"';t==!1?s.data+=`<text x="${r}" y="10" ${h}>${E(n)}</text>`:s.data+=`<text transform="scale(-1,1) translate(${-2*r},0)" x="${r}" y="10" ${h}>${E(n)}</text>`}switch(this.props.type_noodverlichting){case"Centraal":s.data+='<circle cx="'+c+'" cy="'+d+'" r="2.5" style="stroke:black;fill:black" /><line x1="'+(c-5.6)+'" y1="'+(d-5.6)+'" x2="'+(c+5.6)+'" y2="'+(d+5.6)+'" style="stroke:black;fill:black" /><line x1="'+(c+5.6)+'" y1="'+(d-5.6)+'" x2="'+(c-5.6)+'" y2="'+(d+5.6)+'" style="stroke:black;fill:black" />';break;case"Decentraal":s.data+='<rect x="'+(c-5.6)+'" y="'+(d-5.6)+'" width="11.2" height="11.2" fill="white" stroke="black" /><circle cx="'+c+'" cy="'+d+'" r="2.5" style="stroke:black;fill:black" /><line x1="'+(c-5.6)+'" y1="'+(d-5.6)+'" x2="'+(c+5.6)+'" y2="'+(d+5.6)+'" style="stroke:black;fill:black" /><line x1="'+(c+5.6)+'" y1="'+(d-5.6)+'" x2="'+(c-5.6)+'" y2="'+(d+5.6)+'" style="stroke:black;fill:black" />';break}s.xright=45,s.data+=e?"":this.addAddressToSVG(s,52,7,4);break;case"TL":var a=this.props.aantal_buizen_indien_TL,o=25-a*3.5,l=25+a*3.5;s.data+='<line x1="30" y1="'+o+'" x2="30" y2="'+l+'" stroke="black" stroke-width="2" /><line x1="90" y1="'+o+'" x2="90" y2="'+l+'" stroke="black" stroke-width="2" />';for(let h=0;h<a;h++)s.data+='<line x1="30" y1="'+(o+h*7+3.5)+'" x2="90" y2="'+(o+h*7+3.5)+'" stroke="black" stroke-width="2" />';if(this.props.is_wandlamp&&(s.data+='<line x1="50" y1="'+(27+a*3.5)+'" x2="70" y2="'+(27+a*3.5)+'" stroke="black" />'),n!=""){let h='style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10"';t==!1?s.data+=`<text x="60" y="${25-a*3.5}" ${h}>${E(n)}</text>`:s.data+=`<text transform="scale(-1,1) translate(-120,0)" x="60" y="${25-a*3.5}" ${h}>${E(n)}</text>`}this.props.heeft_ingebouwde_schakelaar&&(s.data+='<line x1="77.5" y1="'+(29-a*3.5)+'" x2="85" y2="'+(14-a*3.5)+'" stroke="black" /><line x1="85" y1="'+(14-a*3.5)+'" x2="90" y2="'+(16.5-a*3.5)+'" stroke="black" />');var c,d=25-a*3.5-5;switch(n==""?c=60:c=39,this.props.type_noodverlichting){case"Centraal":s.data+='<circle cx="'+c+'" cy="'+d+'" r="2.5" style="stroke:black;fill:black" /><line x1="'+(c-5.6)+'" y1="'+(d-5.6)+'" x2="'+(c+5.6)+'" y2="'+(d+5.6)+'" style="stroke:black;fill:black" /><line x1="'+(c+5.6)+'" y1="'+(d-5.6)+'" x2="'+(c-5.6)+'" y2="'+(d+5.6)+'" style="stroke:black;fill:black" />';break;case"Decentraal":s.data+='<rect x="'+(c-5.6)+'" y="'+(d-5.6)+'" width="11.2" height="11.2" fill="white" stroke="black" /><circle cx="'+c+'" cy="'+d+'" r="2.5" style="stroke:black;fill:black" /><line x1="'+(c-5.6)+'" y1="'+(d-5.6)+'" x2="'+(c+5.6)+'" y2="'+(d+5.6)+'" style="stroke:black;fill:black" /><line x1="'+(c+5.6)+'" y1="'+(d-5.6)+'" x2="'+(c-5.6)+'" y2="'+(d+5.6)+'" style="stroke:black;fill:black" />';break}s.xright=90,s.data+=e?"":this.addAddressToSVG(s,l+13,Math.max(0,l-25-5),2);break;default:switch(this.props.type_noodverlichting){case"Centraal":H.addSymbol("lamp"),s.data+='<use xlink:href="#lamp" x="30" y="25" /><circle cx="30" cy="25" r="5" style="stroke:black;fill:black" />',this.heeftVerbruikerAlsKind()&&!e&&(s.data+='<line x1="30" y1="25" x2="41" y2="25" stroke="black" />');break;case"Decentraal":H.addSymbol("noodlamp_decentraal"),s.data+='<use xlink:href="#noodlamp_decentraal" x="30" y="25" />',this.props.heeft_ingebouwde_schakelaar&&(s.data+='<line x1="37" y1="18" x2="40" y2="15" stroke="black" stroke-width="2" />');break;default:H.addSymbol("lamp"),s.data+='<use xlink:href="#lamp" x="30" y="25" />',this.heeftVerbruikerAlsKind()&&!e&&(s.data+='<line x1="30" y1="25" x2="41" y2="25" stroke="black" />');break}if(n!=""){let h='style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10"';t==!1?s.data+=`<text x="30" y="10" ${h}>${E(n)}</text>`:s.data+=`<text transform="scale(-1,1) translate(-60,0)" x="30" y="10" ${h}>${E(n)}</text>`}this.props.is_wandlamp&&(s.data+='<line x1="20" y1="40" x2="40" y2="40" stroke="black" />'),this.props.heeft_ingebouwde_schakelaar&&(s.data+='<line x1="40" y1="15" x2="45" y2="20" stroke="black" stroke-width="2" />'),s.xright=39,s.data+=e?"":this.addAddressToSVG(s,54,10,-1);break}return s.data+=`
`,s}}class en extends X{convertLegacyKeys(e){}resetProps(){this.clearProps(),this.props.type="Media",this.props.adres="",this.props.aantal=1,this.props.symbool=""}overrideKeys(){["luidspreker","intercom"].includes(this.props.symbool)?(this.props.aantal<1&&(this.props.aantal=1),this.props.aantal>20&&(this.props.aantal=20)):this.props.aantal=1}toHTML(e){this.overrideKeys();let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml()+"Symbool: "+this.selectPropToHTML("symbool",["","luidspreker","intercom"]),["luidspreker","intercom"].includes(this.props.symbool)&&(t+=", Aantal: "+this.selectPropToHTML("aantal",["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"])),t+=", Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;H.addSymbol("luidspreker");let s=0;if(this.props.aantal>1&&!e&&["luidspreker","intercom"].includes(this.props.symbool))switch(this.props.symbool){case"luidspreker":s=15,t.data+='<text x="31" y="12" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">x'+E(this.props.aantal)+"</text>";break;case"intercom":s=5,t.data+='<text x="36" y="12" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">x'+E(this.props.aantal)+"</text>";break}switch(t.xleft=1,t.xright=59,t.yup=25+s,t.ydown=25,this.props.symbool){case"luidspreker":t.data+=e?"":'<line x1="1" y1="'+(25+s)+'" x2="21" y2="'+(25+s)+'" stroke="black" />',t.data+='<use xlink:href="#luidspreker" x="21" y="'+(25+s)+'" />',t.xright=36,t.data+=e?"":this.addAddressToSVG(t,60+s,15,0);break;case"intercom":t.data+=e?"":'<line x1="1" y1="'+(25+s)+'" x2="21" y2="'+(25+s)+'" stroke="black" />',t.data+=`<rect x="21" y="${15+s}" width="30" height="20" stroke="black" fill="none" />`,t.data+=`<rect x="36" y="${20+s}" width="4" height="10" stroke="black" fill="none" />`,t.data+=`<line x1="40" y1="${20+s}" x2="51" y2="${15+s}" stroke="black" />`,t.data+=`<line x1="40" y1="${30+s}" x2="51" y2="${35+s}" stroke="black" />`,t.data+=`<line x1="46" y1="${25+s}" x2="56" y2="${25+s}" stroke="black" stroke-width="2" />`,t.data+=`<line x1="46" y1="${25+s}" x2="48" y2="${23+s}" stroke="black" stroke-width="1" stroke-linecap="round" />`,t.data+=`<line x1="46" y1="${25+s}" x2="48" y2="${27+s}" stroke="black" stroke-width="1" stroke-linecap="round" />`,t.data+=`<line x1="56" y1="${25+s}" x2="54" y2="${23+s}" stroke="black" stroke-width="1" stroke-linecap="round" />`,t.data+=`<line x1="56" y1="${25+s}" x2="54" y2="${27+s}" stroke="black" stroke-width="1" stroke-linecap="round" />`,t.xright=54,t.data+=e?"":this.addAddressToSVG(t,50+s,5,-3);break;default:t.data+=e?"":'<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line>',t.xright=19;break}return t}getSitPlanBoundaries(){let e=12,t=0,s=0,n=0;switch(this.props.symbool){case"luidspreker":break;case"intercom":t=-5,s=5,n=-5;break}return{clipleft:e,addright:t,cliptop:s,addbottom:n}}}class tn extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Meerdere verbruikers",this.props.adres=""}allowedChilds(){return["","Domotica","Domotica gestuurde verbruiker","Splitsing","---","Batterij","Bel","Boiler","Contactdoos","Diepvriezer","Droogkast","Drukknop","Elektriciteitsmeter","Elektrische oven","EV lader","Ketel","Koelkast","Kookfornuis","Lichtcircuit","Lichtpunt","Omvormer","Overspanningsbeveiliging","Media","Microgolfoven","Motor","Schakelaars","Stoomoven","Transformator","USB lader","Vaatwasmachine","Ventilator","Verlenging","Verwarmingstoestel","Verbruiker","Vrije tekst","Warmtepomp/airco","Wasmachine","Zekering/differentieel","Zonnepaneel","---","Aansluitpunt","Aftakdoos","Zeldzame symbolen"]}getMaxNumChilds(){return 256}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml()+"Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(){let e;return e=this.sourcelist.toSVG(this.id,"horizontal"),e.ydown=Math.max(e.ydown,25),e.yup=Math.max(e.yup,25),e.xleft=Math.max(e.xleft,1),!/^\s*$/.test(this.props.adres)&&this.heeftKindMetGekendType()&&(e.data+='<text x="'+((e.xright-20)/2+21)+'" y="'+(e.yup+e.ydown+10)+'" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10" font-style="italic">'+E(this.props.adres)+"</text>",e.ydown+=15),e}}class sn extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Microgolfoven",this.props.adres=""}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml()+"Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;return H.addSymbol("sinus"),H.addSymbol("microgolf"),t.xleft=1,t.xright=59,t.yup=25,t.ydown=25,t.data=(e?"":'<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line>')+'<use xlink:href="#microgolf" x="21" y="25"></use>',t.data+=this.addAddressToSVG(t,60,15),t}}class nn extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Motor",this.props.adres=""}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml()+"Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;return H.addSymbol("motor"),t.xleft=1,t.xright=59,t.yup=25,t.ydown=25,t.data=(e?"":'<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line>')+'<use xlink:href="#motor" x="21" y="25"></use>',t.data+=this.addAddressToSVG(t,60,15),t}}class ns extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Omvormer",this.props.adres="",this.props.inkring=!1,this.props.micro=!1}allowedChilds(){return["","Aansluiting","Domotica","Domotica module (verticaal)","Domotica gestuurde verbruiker","Leiding","Meerdere verbruikers","Splitsing","---","Batterij","Bel","Boiler","Contactdoos","Diepvriezer","Droogkast","Drukknop","Elektriciteitsmeter","Elektrische oven","EV lader","Ketel","Koelkast","Kookfornuis","Lichtcircuit","Lichtpunt","Media","Microgolfoven","Motor","Omvormer","Overspanningsbeveiliging","Schakelaars","Stoomoven","Transformator","USB lader","Vaatwasmachine","Ventilator","Verlenging","Verwarmingstoestel","Verbruiker","Vrije tekst","Warmtepomp/airco","Wasmachine","Zekering/differentieel","Zonnepaneel","---","Aansluitpunt","Aftakdoos","Zeldzame symbolen"]}getMaxNumChilds(){return 256}overrideKeys(){let e;this.props.tekst==null&&(this.props.tekst=""),this.props.inkring==null&&(this.props.inkring=!1),this.props.micro==null&&(this.props.micro=!1),(e=this.getParent())!=null&&e.getType()!="Kring"&&(this.props.inkring=!1),this.props.micro&&this.getNumChilds()>1&&(this.props.micro=!1)}toHTML(e){this.overrideKeys();let t=this.toHTMLHeader(e),s;return t+="&nbsp;"+this.nrToHtml(),(s=this.getParent())!=null&&s.getType()=="Kring"&&(t+="In kring: "+this.checkboxPropToHTML("inkring")+", "),this.getNumChilds()<=1&&(t+="Micro: "+this.checkboxPropToHTML("micro")+", "),t+="Tekst: "+this.stringPropToHTML("tekst",10)+", ",t+="Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;if(e)return H.addSymbol("sinus"),H.addSymbol("omvormer"),t.yup=25,t.ydown=25,t.xleft=1,t.xright=59,t.data+='<use xlink:href="#omvormer" x="21" y="25"></use>',t;const s=E(this.props.tekst);H.addSymbol("sinusVerticaal"),t=this.sourcelist.toSVG(this.id,"vertical");let n=t.yup+t.ydown,r=n;r<60&&(r=60),r=Math.max(r,oe(E(s),10,"")+25);let a=Math.max(0,n/2-t.firstChildydown),o=Math.max(0,n/2-t.lastChildyup),l=r;this.getNumChilds()<=1&&a<20&&o<20&&(l=Math.max(60,oe(E(s),10,"")+25)),t.yup=r/2,t.ydown=t.yup,t.firstChildydown=null,t.lastChildyup=null,t.data='<svg x="70" y="'+(r-n)/2+'">'+t.data+"</svg>",t.xleft=1,t.xright+=70;const c=this.props.micro?"1":"2";if(t.data+='<rect x="21" width="50" y="'+(5+(r-l)/2)+'" height="'+(l-10)+'" stroke="black" stroke-width="'+c+'" fill="white" />',t.data+=`<line x1="21" y1="${5+(r-l)/2}" x2="71" y2="${5+(r-l)/2+(l-10)}" stroke="black" />`,this.props.inkring?t.data+=`<line x1="1" x2="21" y1="${t.yup-5}" y2="${t.yup-5}" stroke="black" /><line x1="1" x2="21" y1="${t.yup+5}" y2="${t.yup+5}" stroke="black" />`:t.data+=`<line x1="1" x2="21" y1="${t.yup}" y2="${t.yup}" stroke="black" />`,F(s)!==""){const h=t.yup,p=10,g=2,v=oe(E(s),p,"")+g*2,S=p+g*2;t.data+=`<rect x="${45-S/2}" y="${h-v/2}" width="${S}" height="${v}" fill="white" />`,t.data+='<text x="49" y="'+h+'" transform="rotate(90 49,'+h+')" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+s+"</text>"}return t.data+=`<use xlink:href="#sinusVerticaal" x="30" y="${5+r/2+l/2-10-10}" /><line x1="66" y1="${12+(r-l)/2}" x2="66" y2="${27+(r-l)/2}" stroke="black" stroke-dasharray="3" /><line x1="62" y1="${12+(r-l)/2}" x2="62" y2="${27+(r-l)/2}" stroke="black" />`,t.data+=this.addAddressToSVG(t,r+10,15,(70-t.xright)/2-1),t}}class rn extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Overspanningsbeveiliging",this.props.adres=""}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml()+"Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;return H.addSymbol("overspanningsbeveiliging"),t.xleft=1,t.xright=34,t.yup=25,t.ydown=25,t.data=(e?"":'<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line>')+'<use xlink:href="#overspanningsbeveiliging" x="21" y="25"></use>',t.data+=e?"":this.addAddressToSVG(t,55,10),t}}class ne{constructor(e,t=!1,s=!1,n=!1,r=!1,a=!1,o="",l=1){this.sitplan=!1,this.mirrortext=!1,this.type=e,this.halfwaterdicht=t,this.verklikkerlamp=s,this.signalisatielamp=n,this.trekschakelaar=r,this.normaalGesloten=a,this.sturing=o,this.aantal=l}schakelaarAttributentoSVGString(e,t=!1){H.addSymbol("signalisatielamp");let s="";if(this.signalisatielamp&&(s+='<use xlink:href="#signalisatielamp" x="'+(e-10)+'" y="25" />'),this.halfwaterdicht){let n='style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10"';this.mirrortext==!1?s+=`<text x="${e}" y="10" ${n}>h</text>`:s+=`<text transform="scale(-1,1) translate(${-2*e},0)" x="${e}" y="10" ${n}>h</text>`}if(this.verklikkerlamp&&(s+='<line x1="'+(e-3)+'" x2="'+(e+3)+'" y1="22" y2="28" stroke="black" /><line x1="'+(e-3)+'" x2="'+(e+3)+'" y1="28" y2="22" stroke="black" />'),this.trekschakelaar)switch(t){case!1:s+='<line x1="'+(e+10.5)+'" x2="'+(e+10.5)+'" y1="5" y2="15" stroke="black" /><line x1="'+(e+10.5)+'" x2="'+(e+8.5)+'" y1="15" y2="11" stroke="black" /><line x1="'+(e+10.5)+'" x2="'+(e+12.5)+'" y1="15" y2="11" stroke="black" />';break;case!0:s+='<line x1="'+(e+8.5)+'" x2="'+(e+8.5)+'" y1="9" y2="19" stroke="black" /><line x1="'+(e+8.5)+'" x2="'+(e+6.5)+'" y1="19" y2="15" stroke="black" /><line x1="'+(e+8.5)+'" x2="'+(e+10.5)+'" y1="19" y2="15" stroke="black" />';break}return s}enkeltoDrawReturnObj(e){let t="",s=e+30;return H.addSymbol("schakelaar_enkel"),t+='<line x1="'+e+'" x2="'+s+'" y1="25" y2="25" stroke="black" /><use xlink:href="#schakelaar_enkel" x="'+s+'" y="25" />'+this.schakelaarAttributentoSVGString(s),{endx:s,str:t,lowerbound:null}}dubbeltoDrawReturnObj(e){let t="",s=e+30;return H.addSymbol("schakelaar_dubbel"),t+='<line x1="'+e+'" x2="'+s+'" y1="25" y2="25" stroke="black" /><use xlink:href="#schakelaar_dubbel" x="'+s+'" y="25" />'+this.schakelaarAttributentoSVGString(s,!0),{endx:s,str:t,lowerbound:null}}driepoligtoDrawReturnObj(e){let t="",s=e+30;return H.addSymbol("schakelaar_trippel"),t+='<line x1="'+e+'" x2="'+s+'" y1="25" y2="25" stroke="black" /><use xlink:href="#schakelaar_trippel" x="'+s+'" y="25" />'+this.schakelaarAttributentoSVGString(s,!0),{endx:s,str:t,lowerbound:null}}dubbelaanstekingtoDrawReturnObj(e){let t="",s=e+30;return H.addSymbol("schakelaar_dubbelaansteking"),t+='<line x1="'+e+'" x2="'+s+'" y1="25" y2="25" stroke="black" /><use xlink:href="#schakelaar_dubbelaansteking" x="'+s+'" y="25" />'+this.schakelaarAttributentoSVGString(s),{endx:s,str:t,lowerbound:null}}wissel_enkeltoDrawReturnObj(e){let t="",s=e+30;return H.addSymbol("schakelaar_wissel_enkel"),t+='<line x1="'+e+'" x2="'+s+'" y1="25" y2="25" stroke="black" /><use xlink:href="#schakelaar_wissel_enkel" x="'+s+'" y="25" />'+this.schakelaarAttributentoSVGString(s),{endx:s,str:t,lowerbound:null}}wissel_dubbeltoDrawReturnObj(e){let t="",s=e+30;return H.addSymbol("schakelaar_wissel_dubbel"),t+='<line x1="'+e+'" x2="'+s+'" y1="25" y2="25" stroke="black" /><use xlink:href="#schakelaar_wissel_dubbel" x="'+s+'" y="25" />'+this.schakelaarAttributentoSVGString(s,!0),{endx:s,str:t,lowerbound:null}}kruis_enkeltoDrawReturnObj(e){let t="",s=e+30;return H.addSymbol("schakelaar_kruis_enkel"),t+='<line x1="'+e+'" x2="'+s+'" y1="25" y2="25" stroke="black" /><use xlink:href="#schakelaar_kruis_enkel" x="'+s+'" y="25" />'+this.schakelaarAttributentoSVGString(s),{endx:s,str:t,lowerbound:null}}dimschakelaartoDrawReturnObj(e){let t="",s=e+30;return H.addSymbol("schakelaar_enkel_dim"),t+='<line x1="'+e+'" x2="'+s+'" y1="25" y2="25" stroke="black" /><use xlink:href="#schakelaar_enkel_dim" x="'+s+'" y="25" />'+this.schakelaarAttributentoSVGString(s),{endx:s,str:t,lowerbound:null}}dimschakelaarWisseltoDrawReturnObj(e){let t="",s=e+30;return H.addSymbol("schakelaar_wissel_dim"),t+='<line x1="'+e+'" x2="'+s+'" y1="25" y2="25" stroke="black" /><use xlink:href="#schakelaar_wissel_dim" x="'+s+'" y="25" />'+this.schakelaarAttributentoSVGString(s),{endx:s,str:t,lowerbound:null}}bewegingsschakelaartoDrawReturnObj(e){let t="",s=e+20;return H.addSymbol("relais"),H.addSymbol("moving_man"),H.addSymbol("detectie_klein"),t+='<line x1="'+e+'" x2="'+s+'" y1="25" y2="25" stroke="black" /><use xlink:href="#relais" x="'+s+'" y="16" /><use xlink:href="#moving_man" x="'+(s+1.5)+'" y="11" /><use xlink:href="#detectie_klein" x="'+(s+23)+'" y="13"></use><line x1="'+s+'" x2="'+s+'" y1="29" y2="43" fill="none" style="stroke:black" /><line x1="'+(s+40)+'" x2="'+(s+40)+'" y1="29" y2="43" fill="none" style="stroke:black" /><line x1="'+s+'" x2="'+(s+40)+'" y1="43" y2="43" fill="none" style="stroke:black" />',{endx:s,str:t,lowerbound:null}}rolluikschakelaartoDrawReturnObj(e){let t="",s=e+30;if(H.addSymbol("schakelaar_rolluik"),t+='<line x1="'+e+'" x2="'+s+'" y1="25" y2="25" stroke="black" /><use xlink:href="#schakelaar_rolluik" x="'+s+'" y="25" />',this.halfwaterdicht){let n='style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10"';this.mirrortext==!1?t+=`<text x="${s}" y="10" ${n}>h</text>`:t+=`<text transform="scale(-1,1) translate(${-2*s},0)" x="${s}" y="10" ${n}>h</text>`}return{endx:s,str:t,lowerbound:null}}magneetcontacttoDrawReturnObj(e){let t="",s=e+20;if(H.addSymbol("magneetcontact"),this.aantal>1){let n='style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10"';this.mirrortext==!1?t+=`<text x="31" y="10" ${n}>x${E(this.aantal)}</text>`:t+=`<text transform="scale(-1,1) translate(-62,0)" x="31" y="10" ${n}>x${E(this.aantal)}</text>`}return t+='<line x1="'+e+'" x2="'+s+'" y1="25" y2="25" stroke="black" /><use xlink:href="#magneetcontact" x="'+s+'" y="25" />',{endx:s,str:t,lowerbound:null}}contacttoDrawReturnObj(e){let t="",s=e+20;return H.addSymbol("schakelaar"),t+='<line x1="'+e+'" x2="'+s+'" y1="25" y2="25" stroke="black" /><use xlink:href="#schakelaar" x="'+s+'" y="25" />',this.normaalGesloten&&(t+='<line x1="'+(s+32.5)+'" x2="'+(s+35)+'" y1="25" y2="25" stroke="black" /><line x1="'+(s+32)+'" x2="'+(s+32)+'" y1="13" y2="25.5" stroke="black" />'),this.sturing==="spoel"&&(t+='<rect x="'+(s+8)+'" y="1" width="24" height="10" stroke="black" fill="none" />',t+='<line x1="'+(s+16)+'" x2="'+(s+24)+'" y1="1" y2="11" stroke="black" />',t+='<line x1="'+(s+20)+'" x2="'+(s+20)+'" y1="11" y2="20" stroke="black" stroke-dasharray="1,1" />'),{endx:s,str:t,lowerbound:null}}defaulttoDrawReturnObj(e,t){let s="",n=e+20;return H.addSymbol(t.substring(1)),s+='<line x1="'+e+'" x2="'+n+'" y1="25" y2="25" stroke="black" /><use xlink:href="'+t+'" x="'+n+'" y="25" />',{endx:n,str:s,lowerbound:null}}extraPlaatsRechts(){return this.type=="enkel"||this.type=="dubbel"||this.type=="driepolig"||this.type=="dubbelaansteking"||this.type=="wissel_enkel"||this.type=="wissel_dubbel"||this.type=="kruis_enkel"||this.type=="dimschakelaar"||this.type=="dimschakelaar_wissel"?10:this.type=="rolluikschakelaar"?7:0}toSVGString(e,t,s=!1,n=!1){let r="",a,o=20;switch(this.sitplan=s,this.mirrortext=n,this.type){case"enkel":({endx:a,str:r}=this.enkeltoDrawReturnObj(e)),a+=5;break;case"dubbel":({endx:a,str:r}=this.dubbeltoDrawReturnObj(e)),a+=5;break;case"driepolig":({endx:a,str:r}=this.driepoligtoDrawReturnObj(e)),a+=5;break;case"dubbelaansteking":({endx:a,str:r}=this.dubbelaanstekingtoDrawReturnObj(e)),a+=5;break;case"wissel_enkel":({endx:a,str:r}=this.wissel_enkeltoDrawReturnObj(e)),a+=5,o=Math.max(o,35);break;case"wissel_dubbel":({endx:a,str:r}=this.wissel_dubbeltoDrawReturnObj(e)),a+=5,o=Math.max(o,35);break;case"kruis_enkel":({endx:a,str:r}=this.kruis_enkeltoDrawReturnObj(e)),a+=5,o=Math.max(o,35);break;case"dimschakelaar":({endx:a,str:r}=this.dimschakelaartoDrawReturnObj(e)),a+=5;break;case"dimschakelaar_wissel":({endx:a,str:r}=this.dimschakelaarWisseltoDrawReturnObj(e)),a+=5,o=Math.max(o,35);break;case"bewegingsschakelaar":({endx:a,str:r}=this.bewegingsschakelaartoDrawReturnObj(e)),a+=40,o=Math.max(o,30);break;case"rolluikschakelaar":({endx:a,str:r}=this.rolluikschakelaartoDrawReturnObj(e)),a+=8,o=Math.max(o,25);break;case"magneetcontact":({endx:a,str:r}=this.magneetcontacttoDrawReturnObj(e)),a+=20,o=Math.max(o,25);break;case"contact":({endx:a,str:r}=this.contacttoDrawReturnObj(e)),a+=40;break;case"schemerschakelaar":H.addSymbol("arrow"),{endx:a,str:r}=this.defaulttoDrawReturnObj(e,"#schemerschakelaar"),a+=40;break;case"teleruptor":({endx:a,str:r}=this.defaulttoDrawReturnObj(e,"#teleruptor")),a+=40,o=Math.max(o,30);break;case"dimmer":({endx:a,str:r}=this.defaulttoDrawReturnObj(e,"#dimmer")),a+=40,o=Math.max(o,30);break;case"relais":({endx:a,str:r}=this.defaulttoDrawReturnObj(e,"#relais")),a+=40,o=Math.max(o,30);break;case"minuterie":({endx:a,str:r}=this.defaulttoDrawReturnObj(e,"#minuterie")),a+=40,o=Math.max(o,30);break;case"thermostaat":({endx:a,str:r}=this.defaulttoDrawReturnObj(e,"#thermostaat")),a+=40,o=Math.max(o,30);break;case"tijdschakelaar":({endx:a,str:r}=this.defaulttoDrawReturnObj(e,"#tijdschakelaar")),a+=40,o=Math.max(o,30);break;default:a=30}return{endx:a,str:r,lowerbound:o}}}class Ie extends X{constructor(e){super(e)}convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.aantal_schakelaars=this.getLegacyKey(e,4),this.props.type_schakelaar=this.getLegacyKey(e,5),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15),this.props.heeft_signalisatielampje=this.getLegacyKey(e,19),this.props.is_halfwaterdicht=this.getLegacyKey(e,20),this.props.heeft_verklikkerlampje=this.getLegacyKey(e,21),this.props.is_trekschakelaar=this.getLegacyKey(e,25)}resetProps(){this.clearProps(),this.props.type="Schakelaars",this.props.aantal_schakelaars="1",this.props.type_schakelaar="enkelpolig",this.props.adres="",this.props.heeft_signalisatielampje=!1,this.props.is_halfwaterdicht=!1,this.props.heeft_verklikkerlampje=!1,this.props.is_trekschakelaar=!1,this.props.normaalGesloten=!1,this.props.sturing=""}kanHalfwaterdichtZijn(){return this.props.type_schakelaar=="enkelpolig"||this.props.type_schakelaar=="dubbelpolig"||this.props.type_schakelaar=="driepolig"||this.props.type_schakelaar=="kruis_enkel"||this.props.type_schakelaar=="dubbelaansteking"||this.props.type_schakelaar=="wissel_enkel"||this.props.type_schakelaar=="wissel_dubbel"||this.props.type_schakelaar=="dubbel"||this.props.type_schakelaar=="dimschakelaar"||this.props.type_schakelaar=="dimschakelaar wissel"||this.props.type_schakelaar=="rolluikschakelaar"}kanVerklikkerlampjeHebben(){return this.props.type_schakelaar=="enkelpolig"||this.props.type_schakelaar=="dubbelpolig"||this.props.type_schakelaar=="driepolig"||this.props.type_schakelaar=="kruis_enkel"||this.props.type_schakelaar=="dubbelaansteking"||this.props.type_schakelaar=="wissel_enkel"||this.props.type_schakelaar=="wissel_dubbel"||this.props.type_schakelaar=="dubbel"||this.props.type_schakelaar=="dimschakelaar"||this.props.type_schakelaar=="dimschakelaar wissel"}kanSignalisatielampjeHebben(){return this.kanVerklikkerlampjeHebben()}kanTrekschakelaarHebben(){return this.props.type_schakelaar=="enkelpolig"||this.props.type_schakelaar=="dubbelpolig"||this.props.type_schakelaar=="driepolig"||this.props.type_schakelaar=="kruis_enkel"||this.props.type_schakelaar=="dubbelaansteking"||this.props.type_schakelaar=="wissel_enkel"||this.props.type_schakelaar=="wissel_dubbel"||this.props.type_schakelaar=="dubbel"}overrideKeys(){switch(this.props.sturing==null&&(this.props.sturing=""),this.props.normaalGesloten==null&&(this.props.normaalGesloten=!1),this.props.type_schakelaar=="schakelaar"&&(this.props.type_schakelaar="contact"),this.props.type_schakelaar){case"enkelpolig":this.props.aantal_schakelaars=String(Math.min(Number(this.props.aantal_schakelaars),5));break;case"dubbelpolig":this.props.aantal_schakelaars=String(Math.min(Number(this.props.aantal_schakelaars),2));break;case"magneetcontact":this.props.aantal_schakelaars=String(Math.min(Number(this.props.aantal_schakelaars),20));break;default:this.props.aantal_schakelaars="1";break}this.kanHalfwaterdichtZijn||(this.props.is_halfwaterdicht=!1),this.kanVerklikkerlampjeHebben||(this.props.heeft_verklikkerlampje=!1),this.kanSignalisatielampjeHebben||(this.props.heeft_signalisatielampje=!1),this.kanTrekschakelaarHebben||(this.props.is_trekschakelaar=!1),this.props.normaalGesloten===!0&&this.props.type_schakelaar!=="contact"&&(this.props.normaalGesloten=!1),this.props.type_schakelaar!=="contact"&&(this.props.sturing="")}toHTML(e){this.overrideKeys();let t=this.toHTMLHeader(e);switch(t+="&nbsp;"+this.nrToHtml(),t+=this.selectPropToHTML("type_schakelaar",["enkelpolig","dubbelpolig","driepolig","dubbelaansteking","wissel_enkel","wissel_dubbel","kruis_enkel","---","contact","dimschakelaar","dimschakelaar wissel","bewegingsschakelaar","schemerschakelaar","---","teleruptor","relais","dimmer","tijdschakelaar","minuterie","thermostaat","rolluikschakelaar","---","magneetcontact"]),this.kanHalfwaterdichtZijn()&&(t+=", Halfwaterdicht: "+this.checkboxPropToHTML("is_halfwaterdicht")),this.kanVerklikkerlampjeHebben()&&(t+=", Verklikkerlampje: "+this.checkboxPropToHTML("heeft_verklikkerlampje")),this.kanSignalisatielampjeHebben()&&(t+=", Signalisatielampje: "+this.checkboxPropToHTML("heeft_signalisatielampje")),this.kanTrekschakelaarHebben()&&(t+=", Trekschakelaar: "+this.checkboxPropToHTML("is_trekschakelaar")),this.props.type_schakelaar){case"enkelpolig":t+=", Aantal schakelaars: "+this.selectPropToHTML("aantal_schakelaars",["1","2","3","4","5"]);break;case"dubbelpolig":t+=", Aantal schakelaars: "+this.selectPropToHTML("aantal_schakelaars",["1","2"]);break;case"magneetcontact":t+=", Aantal schakelaars: "+this.selectPropToHTML("aantal_schakelaars",["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"]);break;case"contact":t+=", Normaal Gesloten: "+this.checkboxPropToHTML("normaalGesloten"),t+=", Sturing: "+this.selectPropToHTML("sturing",["","spoel"]);break}return t+=", Adres/tekst: "+this.stringPropToHTML("adres",5),t+=this.toHTMLFooter(),t}bouwSchakelaarKeten(e){switch(this.props.type_schakelaar){case"wissel_enkel":e.push(new ne("wissel_enkel",this.props.is_halfwaterdicht,this.props.heeft_verklikkerlampje,this.props.heeft_signalisatielampje,this.props.is_trekschakelaar));break;case"wissel_dubbel":e.push(new ne("wissel_dubbel",this.props.is_halfwaterdicht,this.props.heeft_verklikkerlampje,this.props.heeft_signalisatielampje,this.props.is_trekschakelaar));break;case"kruis_enkel":e.push(new ne("kruis_enkel",this.props.is_halfwaterdicht,this.props.heeft_verklikkerlampje,this.props.heeft_signalisatielampje,this.props.is_trekschakelaar));break;case"teleruptor":e.push(new ne("teleruptor"));break;case"bewegingsschakelaar":e.push(new ne("bewegingsschakelaar"));break;case"schemerschakelaar":e.push(new ne("schemerschakelaar"));break;case"contact":e.push(new ne("contact",!1,!1,!1,!1,this.props.normaalGesloten,this.props.sturing));break;case"dimmer":e.push(new ne("dimmer"));break;case"relais":e.push(new ne("relais"));break;case"minuterie":e.push(new ne("minuterie"));break;case"thermostaat":e.push(new ne("thermostaat"));break;case"tijdschakelaar":e.push(new ne("tijdschakelaar"));break;case"magneetcontact":e.push(new ne("magneetcontact",!1,!1,!1,!1,this.props.aantal_schakelaars));break;case"rolluikschakelaar":e.push(new ne("rolluikschakelaar",this.props.is_halfwaterdicht));break;case"dubbelaansteking":e.push(new ne("dubbelaansteking",this.props.is_halfwaterdicht,this.props.heeft_verklikkerlampje,this.props.heeft_signalisatielampje,this.props.is_trekschakelaar));break;case"dimschakelaar":e.push(new ne("dimschakelaar",this.props.is_halfwaterdicht,this.props.heeft_verklikkerlampje,this.props.heeft_signalisatielampje,!1));break;case"dimschakelaar wissel":e.push(new ne("dimschakelaar_wissel",this.props.is_halfwaterdicht,this.props.heeft_verklikkerlampje,this.props.heeft_signalisatielampje,!1));break;case"enkelpolig":if(Number(this.props.aantal_schakelaars)==1&&e.push(new ne("enkel",this.props.is_halfwaterdicht,this.props.heeft_verklikkerlampje,this.props.heeft_signalisatielampje,this.props.is_trekschakelaar)),Number(this.props.aantal_schakelaars)>1){e.push(new ne("wissel_enkel",this.props.is_halfwaterdicht,this.props.heeft_verklikkerlampje,this.props.heeft_signalisatielampje,this.props.is_trekschakelaar));for(let t=2;t<Number(this.props.aantal_schakelaars);++t)e.push(new ne("kruis_enkel",this.props.is_halfwaterdicht,this.props.heeft_verklikkerlampje,this.props.heeft_signalisatielampje,this.props.is_trekschakelaar));e.push(new ne("wissel_enkel",this.props.is_halfwaterdicht,this.props.heeft_verklikkerlampje,this.props.heeft_signalisatielampje,this.props.is_trekschakelaar))}break;case"dubbelpolig":Number(this.props.aantal_schakelaars)==1&&e.push(new ne("dubbel",this.props.is_halfwaterdicht,this.props.heeft_verklikkerlampje,this.props.heeft_signalisatielampje,this.props.is_trekschakelaar)),Number(this.props.aantal_schakelaars)>1&&(e.push(new ne("wissel_dubbel",this.props.is_halfwaterdicht,this.props.heeft_verklikkerlampje,this.props.heeft_signalisatielampje,this.props.is_trekschakelaar)),e.push(new ne("wissel_dubbel",this.props.is_halfwaterdicht,this.props.heeft_verklikkerlampje,this.props.heeft_signalisatielampje,this.props.is_trekschakelaar)));break;case"driepolig":e.push(new ne("driepolig",this.props.is_halfwaterdicht,this.props.heeft_verklikkerlampje,this.props.heeft_signalisatielampje,this.props.is_trekschakelaar));break}}isExpandable(){switch(this.props.type_schakelaar){case"enkelpolig":case"dubbelpolig":return Number(this.props.aantal_schakelaars)>1;default:return!1}}expand(){switch(this.props.type_schakelaar){case"enkelpolig":if(Number(this.props.aantal_schakelaars)>1){let e=Math.floor(this.props.aantal_schakelaars/2),t=new Ie(this.sourcelist);Object.assign(t.props,this.props),t.props.aantal_schakelaars=1,t.props.type_schakelaar="wissel_enkel",t.props.adres="",this.sourcelist.insertItemBeforeId(t,this.id);let s=t;for(let n=0;n<Number(this.props.aantal_schakelaars)-2;++n){let r=new Ie(this.sourcelist);Object.assign(r.props,this.props),r.props.aantal_schakelaars=1,r.props.type_schakelaar="kruis_enkel",e==n+1?r.props.adres=this.props.adres:r.props.adres="",this.getParent().props.type==="Meerdere verbruikers"?this.sourcelist.insertItemBeforeId(r,this.id):(this.sourcelist.insertChildAfterId(r,s.id),s=r)}e==Number(this.props.aantal_schakelaars)-1?this.props.adres=this.props.adres:this.props.adres="",this.props.aantal_schakelaars=1,this.props.type_schakelaar="wissel_enkel",this.getParent().props.type==="Meerdere verbruikers"?this.parent=this.getParent().id:this.parent=s.id}break;case"dubbelpolig":if(Number(this.props.aantal_schakelaars)>1){let e=new Ie(this.sourcelist);Object.assign(e.props,this.props),e.props.aantal_schakelaars=1,e.props.type_schakelaar="wissel_dubbel",e.props.adres="",this.sourcelist.insertItemBeforeId(e,this.id),this.props.aantal_schakelaars=1,this.props.type_schakelaar="wissel_dubbel",this.getParent().props.type=="Meerdere verbruikers"?this.parent=this.getParent().id:this.parent=e.id}break}}toSVG(e=!1,t=!1){let s=new J,n=[];this.bouwSchakelaarKeten(n);var r=20,a=1;for(let o=0;o<n.length;o++){let l=o==n.length-1&&!this.heeftVerbruikerAlsKind(),c;if({endx:a,str:c,lowerbound:r}=n[o].toSVGString(a,l,e,t),e&&this.sourcelist.properties.legacySchakelaars==!1&&o==0&&n.length==1&&c.startsWith("<line")){let d=c.indexOf(">");c=c.substring(d+1)}s.data+=c}if(!this.heeftVerbruikerAlsKind()||e){let o=n[n.length-1].extraPlaatsRechts();e&&(o=Math.max(0,o-5)),a+=o}return s.xleft=1,s.xright=a-2,s.yup=25,s.ydown=25,this.props.type_schakelaar==="contact"&&this.props.sturing==="spoel"&&(s.data=`<svg xmlns="http://www.w3.org/2000/svg" x="0" y="5" width="${s.xleft+s.xright}" height="${s.yup+s.ydown}" >`+s.data+"</svg>",s.yup+=5,r+=5),s.data+=e?"":this.addAddressToSVG(s,25+r,Math.max(0,r-20)),s}}class an extends Ie{resetProps(){super.resetProps(),this.props.type="Lichtcircuit",this.props.aantal_lichtpunten="1"}convertLegacyKeys(e){super.convertLegacyKeys(e),this.props.aantal_lichtpunten=this.getLegacyKey(e,13)}toHTML(e){this.overrideKeys();let t=this.toHTMLHeader(e);switch(t+="&nbsp;"+this.nrToHtml(),t+=this.selectPropToHTML("type_schakelaar",["enkelpolig","dubbelpolig","driepolig","dubbelaansteking","wissel_enkel","wissel_dubbel","kruis_enkel","---","contact","dimschakelaar","dimschakelaar wissel","bewegingsschakelaar","schemerschakelaar","---","teleruptor","relais","dimmer","tijdschakelaar","minuterie","thermostaat","rolluikschakelaar"]),this.kanHalfwaterdichtZijn()&&(t+=", Halfwaterdicht: "+this.checkboxPropToHTML("is_halfwaterdicht")),this.kanVerklikkerlampjeHebben()&&(t+=", Verklikkerlampje: "+this.checkboxPropToHTML("heeft_verklikkerlampje")),this.kanSignalisatielampjeHebben()&&(t+=", Signalisatielampje: "+this.checkboxPropToHTML("heeft_signalisatielampje")),this.kanTrekschakelaarHebben()&&(t+=", Trekschakelaar: "+this.checkboxPropToHTML("is_trekschakelaar")),this.props.type_schakelaar){case"enkelpolig":this.props.aantal_schakelaars==0?t+=", Aantal schakelaars: "+this.selectPropToHTML("aantal_schakelaars",["0","1","2","3","4","5"])+'<span style="color: red;"> Compatibiliteitsmodus, kies aantal schakelaars verschillend van 0 of gebruik element lichtpunt</span>':t+=", Aantal schakelaars: "+this.selectPropToHTML("aantal_schakelaars",["1","2","3","4","5"]);break;case"dubbelpolig":this.props.aantal_schakelaars==0?t+=", Aantal schakelaars: "+this.selectPropToHTML("aantal_schakelaars",["0","1","2"])+'<span style="color: red;"> Compatibiliteitsmodus, kies aantal schakelaars verschillend van 0 of gebruik element lichtpunt</span>':t+=", Aantal schakelaars: "+this.selectPropToHTML("aantal_schakelaars",["1","2"]);break;case"contact":t+=", Normaal Gesloten: "+this.checkboxPropToHTML("normaalGesloten"),t+=", Sturing: "+this.selectPropToHTML("sturing",["","spoel"]);break}return t+=", Aantal lichtpunten: "+this.selectPropToHTML("aantal_lichtpunten",["0","1","2","3","4","5","6","7","8","9","10"]),t+=", Adres/tekst: "+this.stringPropToHTML("adres",5),t+=this.toHTMLFooter(),t}countExpandableElements(){let e=this.props.aantal_lichtpunten=="0"?0:1;switch(this.props.type_schakelaar){case"enkelpolig":case"dubbelpolig":e+=+this.props.aantal_schakelaars;break;default:e+=1}return e}isExpandable(){return this.countExpandableElements()>1}expand(){let e=new Ie(this.sourcelist);const r=this.props,{type:t,aantal_lichtpunten:s}=r,n=de(r,["type","aantal_lichtpunten"]);if(Object.assign(e.props,n),e.props.adres=this.props.adres,+this.props.aantal_lichtpunten>0){this.sourcelist.insertItemBeforeId(e,this.id);let a=new Ps(this.sourcelist);a.props.aantal=this.props.aantal_lichtpunten,a.props.is_halfwaterdicht=this.props.is_halfwaterdicht,a.id=this.id,this.getParent().props.type=="Meerdere verbruikers"?a.parent=this.getParent().id:a.parent=e.id;let o=this.sourcelist.getOrdinalById(this.id);o!==null&&(this.sourcelist.data[o]=a)}else{e.id=this.id,e.parent=this.getParent().id;let a=this.sourcelist.getOrdinalById(this.id);a!==null&&(this.sourcelist.data[a]=e)}e.expand()}toSVG(e=!1,t=!1){let s=new J,n=[];this.bouwSchakelaarKeten(n);var r=20,a=1,o;for(let l=0;l<n.length;l++){let c=l==n.length-1&&!this.heeftVerbruikerAlsKind(),d;({endx:a,str:d,lowerbound:r}=n[l].toSVGString(a,c,e,t)),s.data+=d}if(this.props.aantal_lichtpunten>=1){o=a+29,H.addSymbol("lamp"),s.data+='<line x1="'+a+'" x2="'+o+'" y1="25" y2="25" stroke="black" /><use xlink:href="#lamp" x="'+o+'" y="25" />';let l="";if(this.props.is_halfwaterdicht?(l="h",parseInt(this.props.aantal_lichtpunten)>1&&(l+=", x"+this.props.aantal_lichtpunten)):parseInt(this.props.aantal_lichtpunten)>1&&(l="x"+this.props.aantal_lichtpunten),l!=""){let c='style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10"';t==!1?s.data+=`<text x="${o}" y="10" ${c}>${E(l)}</text>`:s.data+=`<text transform="scale(-1,1) translate(${-2*o},0)" x="${o}" y="10" ${c}>${E(l)}</text>`}o++,this.heeftVerbruikerAlsKind()&&(s.data+='<line x1="'+o+'" y1="25" x2="'+(o+10)+'" y2="25" stroke="black" />'),a=o+10,r=Math.max(r,29)}else if((!this.heeftVerbruikerAlsKind()||e)&&n.length>0){let l=n[n.length-1].extraPlaatsRechts();e&&(l=Math.max(0,l-5)),a+=l}return s.xleft=1,s.xright=a-2,s.yup=25,s.ydown=25,this.props.type_schakelaar==="contact"&&this.props.sturing==="spoel"&&(s.data=`<svg xmlns="http://www.w3.org/2000/svg" x="0" y="5" width="${s.xleft+s.xright}" height="${s.yup+s.ydown}" >`+s.data+"</svg>",s.yup+=5,r+=5),s.data+=e?"":this.addAddressToSVG(s,25+r,Math.max(0,r-20)),s}}class on extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Splitsing",this.props.adres=""}allowedChilds(){return["","Kring"]}getMaxNumChilds(){return 256}toHTML(e,t){return this.toHTMLHeader(e)}toSVG(){let e;e=this.sourcelist.toSVG(this.id,"horizontal");let t=this.getParent();if(t.getType()=="Aansluiting"||t.getType()=="Kring"){if(e.data+='<line x1="'+e.xleft+'" x2="'+(e.xleft+e.xrightmin)+'" y1="'+e.yup+'" y2="'+e.yup+'" stroke="black" />',this.isChildOf("Kring")){const s=this.getParent();s!==null&&s.getNumChilds()>1&&(e.ydown+=10,e.data+=`<line x1="${e.xleft}" x2="${e.xleft}" y1="${e.yup+0}" y2="${e.yup+10}" stroke="black" stroke-width="1" />`)}}else e.xleft+e.xright<=0&&(e.xrightmin=15),e.yup<25&&(e.yup=25),e.ydown<25&&(e.ydown=25),e.data+='<line x1="1" x2="'+(e.xleft+e.xrightmin)+'" y1="'+e.yup+'" y2="'+e.yup+'" stroke="black" />',e.xright=e.xright+e.xleft,e.xleft=1;return e}}class ln extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Stoomoven",this.props.adres=""}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml()+"Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;return H.addSymbol("stoomoven"),t.xleft=1,t.xright=59,t.yup=25,t.ydown=25,t.data=(e?"":'<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line>')+'<use xlink:href="#stoomoven" x="21" y="25"></use>',t.data+=e?"":this.addAddressToSVG(t,60,15),t}}class cn extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.voltage=this.getLegacyKey(e,14),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Transformator",this.props.voltage="230V/24V",this.props.adres=""}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml()+"Voltage: "+this.stringPropToHTML("voltage",8)+", Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;return H.addSymbol("transformator"),t.xleft=1,t.xright=47,t.yup=25,t.ydown=25,t.data=(e?"":'<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line>')+'<use xlink:href="#transformator" x="21" y="25"></use><text x="35" y="44" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(this.props.voltage)+"</text>",t.data+=e?"":this.addAddressToSVG(t,58,15),t}}class dn extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.aantal=this.getLegacyKey(e,4),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="USB lader",this.props.aantal="1",this.props.adres=""}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml(),t+="Aantal: "+this.selectPropToHTML("aantal",["1","2","3","4","5","6","7","8","9","10"]),t+=", Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;H.addSymbol("usblader");var s=0;return this.props.aantal>1&&(s=12,t.data+='<text x="51" y="14" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">x'+E(this.props.aantal)+"</text>"),t.xleft=1,t.xright=79,t.yup=25+s,t.ydown=25,t.data+=(e?"":'<line x1="1" y1="'+(s+25)+'" x2="21" y2="'+(s+25)+'" stroke="black"></line>')+'<use xlink:href="#usblader" x="21" y="'+(s+25)+'"></use>',t.data+=e?"":this.addAddressToSVG(t,55+s,10),t}}class hn extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Vaatwasmachine",this.props.adres=""}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml(),t+="Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;return H.addSymbol("vaatwasmachine"),t.xleft=1,t.xright=59,t.yup=25,t.ydown=25,t.data=(e?"":'<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line>')+'<use xlink:href="#vaatwasmachine" x="21" y="25"></use>',t.data+=e?"":this.addAddressToSVG(t,60,15),t}}class pn extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Ventilator",this.props.adres="",this.props.ventilatortype="ventilator"}overrideKeys(){this.props.ventilatortype||(this.props.ventilatortype="ventilator")}toHTML(e){this.overrideKeys();let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml(),t+=this.selectPropToHTML("ventilatortype",["ventilator","afzuigkap"]),t+=", Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;return H.addSymbol("ventilator"),t.xleft=1,t.xright=49,t.yup=25,t.ydown=25,t.data=(e?"":'<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line>')+'<use xlink:href="#ventilator" x="21" y="25"></use>',this.props.ventilatortype==="afzuigkap"&&(t.data+='<line x1="21" y1="7" x2="36" y2="5" stroke="black" stroke-linecap="round"></line>',t.data+='<line x1="51" y1="7" x2="36" y2="5" stroke="black" stroke-linecap="round"></line>'),t.data+=e?"":this.addAddressToSVG(t,55,10),t}}class un extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.tekst=this.getLegacyKey(e,15),this.props.horizontale_uitlijning=this.getLegacyKey(e,17),this.props.heeft_automatische_breedte=this.getLegacyKey(e,18),this.props.is_vet=this.getLegacyKey(e,19),this.props.is_cursief=this.getLegacyKey(e,20),this.props.breedte=this.getLegacyKey(e,22),this.props.adres=this.getLegacyKey(e,23)}resetProps(){this.clearProps(),this.props.type="Verbruiker",this.props.tekst="",this.props.horizontale_uitlijning="centreer",this.props.heeft_automatische_breedte="automatisch",this.props.breedte="",this.props.is_vet=!1,this.props.is_cursief=!1,this.props.adres=""}overrideKeys(){this.props.heeft_automatische_breedte!="automatisch"&&(this.props.heeft_automatische_breedte="handmatig"),this.adjustTextWidthIfAuto()}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml()+'Tekst (nieuwe lijn = "|"): '+this.stringPropToHTML("tekst",30)+", Breedte: "+this.selectPropToHTML("heeft_automatische_breedte",["automatisch","handmatig"]),this.props.heeft_automatische_breedte!="automatisch"&&(t+=" "+this.stringPropToHTML("breedte",3)),t+=", Vet: "+this.checkboxPropToHTML("is_vet")+", Cursief: "+this.checkboxPropToHTML("is_cursief")+", Horizontale alignering: "+this.selectPropToHTML("horizontale_uitlijning",["links","centreer","rechts"])+", Adres/tekst: "+this.stringPropToHTML("adres",2),t}adjustTextWidthIfAuto(){if(this.props.heeft_automatische_breedte==="automatisch"){var e="";this.props.is_vet&&(e+=' font-weight="bold"'),this.props.is_cursief&&(e+=' font-style="italic"');var t=E(this.props.tekst).split("|"),s=40;for(let n=0;n<t.length;n++)s=Math.round(Math.max(s,oe(t[n],10,e)+10));this.props.breedte=String(s)}}toSVG(e=!1){let t=new J;var s=E(this.props.tekst).split("|");this.adjustTextWidthIfAuto();var n=isNaN(Number(this.props.breedte))||this.props.breedte===""?40:Math.max(Number(this.props.breedte)*1,1),r=15*Math.max(s.length-2,0);t.xleft=1,t.xright=20+n,t.yup=25+r/2,t.ydown=25+r/2;var a="";this.props.is_vet&&(a+=' font-weight="bold"'),this.props.is_cursief&&(a+=' font-style="italic"');var o;switch(this.props.horizontale_uitlijning){case"links":o='<text style="text-anchor:start" font-family="Arial, Helvetica, sans-serif" font-size="10" x="25" ';break;case"rechts":o='<text style="text-anchor:end" font-family="Arial, Helvetica, sans-serif" font-size="10" x="'+(20+n-4)+'" ';break;default:o='<text style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10" x="'+(21+n/2)+'" ';break}for(let c=0;c<s.length;c++){var l=28-7.5*Math.min(1,s.length-1)+15*c;t.data+=o+' y="'+l+'"'+a+">"+s[c]+"</text>"}return t.data+=(e?"":'<line x1="1" y1="'+(25+r/2)+'" x2="21" y2="'+(25+r/2)+'" stroke="black" />')+'<rect x="21" y="5" width="'+n+'" height="'+(40+r)+'" fill="none" style="stroke:black" />'+this.addAddressToSVG(t,60+r,15,n/2-(t.xright-20)/2),t}}class gn extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.breedte=this.getLegacyKey(e,22),this.props.adres=this.getLegacyKey(e,23)}resetProps(){this.clearProps(),this.props.type="Verlenging",this.props.breedte="40",this.props.adres=""}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml()+"Breedte: "+this.stringPropToHTML("breedte",3)+", Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(){let e=new J;var t;return isNaN(Number(this.props.breedte))||+(this.props.breedte=="")?t=40:t=Math.max(Number(this.props.breedte)*1,0),e.xleft=1,e.xright=t-1,e.yup=25,e.ydown=25,e.data+='<line x1="1" y1="25" x2="'+(t+1)+'" y2="25" stroke="black" />',e.data+=this.addAddressToSVG(e,40,0,t/2-e.xright/2-10),e.data+=`
`,e}}class fn extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.heeft_accumulatie=this.getLegacyKey(e,3),this.props.heeft_ventilator=this.getLegacyKey(e,6),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Verwarmingstoestel",this.props.heeft_accumulatie=!1,this.props.heeft_ventilator=!1,this.props.adres=""}overrideKeys(){this.props.heeft_accumulatie||(this.props.heeft_ventilator=!1)}toHTML(e){this.overrideKeys;let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml()+"Accumulatie: "+this.checkboxPropToHTML("heeft_accumulatie")+(this.props.heeft_accumulatie?", Ventilator: "+this.checkboxPropToHTML("heeft_ventilator"):"")+", Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;switch(t.xleft=1,t.xright=69,t.yup=25,t.ydown=25,t.data=e?"":'<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line>',this.props.heeft_accumulatie){case!1:H.addSymbol("VerticalStripe"),H.addSymbol("verwarmingstoestel"),t.data+='<use xlink:href="#verwarmingstoestel" x="21" y="25"></use>';break;case!0:switch(this.props.heeft_ventilator){case!1:H.addSymbol("VerticalStripe"),H.addSymbol("verwarmingstoestel_accu"),t.data+='<use xlink:href="#verwarmingstoestel_accu" x="21" y="25"></use>';break;case!0:H.addSymbol("VerticalStripe"),H.addSymbol("verwarmingstoestel_accu_ventilator"),t.data+='<use xlink:href="#verwarmingstoestel_accu_ventilator" x="21" y="25"></use>',t.xright=89;break}break}return t.data+=e?"":this.addAddressToSVG(t,55,10),t}}class mn extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.breedte=this.getLegacyKey(e,22)}resetProps(){this.clearProps(),this.props.type="Vrije ruimte",this.props.breedte=25}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;Breedte: "+this.stringPropToHTML("breedte",3),t}getMaxNumChilds(){return 0}toSVG(){let e=new J,t=Number(this.props.breedte);return isNaN(t)&&(t=25),e.yup=0,e.ydown=0,e.xleft=0,e.xright=t,e.data="",e}}class bn extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.tekst=this.getLegacyKey(e,15),this.props.vrije_tekst_type=this.getLegacyKey(e,16),this.props.horizontale_uitlijning=this.getLegacyKey(e,17),this.props.heeft_automatische_breedte=this.getLegacyKey(e,18),this.props.is_vet=this.getLegacyKey(e,19),this.props.is_cursief=this.getLegacyKey(e,20),this.props.breedte=this.getLegacyKey(e,22),this.props.adres=this.getLegacyKey(e,23)}resetProps(){this.clearProps(),this.props.type="Vrije tekst",this.props.tekst="",this.props.vrije_tekst_type="zonder kader",this.props.horizontale_uitlijning="links",this.props.heeft_automatische_breedte="automatisch",this.props.breedte="",this.props.is_vet=!1,this.props.is_cursief=!1,this.props.adres=""}overrideKeys(){this.props.vrije_tekst_type!="verbruiker"&&(this.props.vrije_tekst_type="zonder kader"),this.props.heeft_automatische_breedte!="automatisch"&&(this.props.heeft_automatische_breedte="handmatig"),this.heeftVerbruikerAlsKind()&&(this.props.vrije_tekst_type="verbruiker"),this.adjustTextWidthIfAuto()}toHTML(e){this.overrideKeys();let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml()+'Tekst (nieuwe lijn = "|"): '+this.stringPropToHTML("tekst",30)+", Breedte: "+this.selectPropToHTML("heeft_automatische_breedte",["automatisch","handmatig"]),this.props.heeft_automatische_breedte!="automatisch"&&(t+=" "+this.stringPropToHTML("breedte",3)),t+=", Vet: "+this.checkboxPropToHTML("is_vet")+", Cursief: "+this.checkboxPropToHTML("is_cursief")+", Horizontale alignering: "+this.selectPropToHTML("horizontale_uitlijning",["links","centreer","rechts"])+", Type: "+this.selectPropToHTML("vrije_tekst_type",this.heeftVerbruikerAlsKind()?["verbruiker"]:["verbruiker","zonder kader"]),this.props.vrije_tekst_type!="zonder kader"&&(t+=", Adres/tekst: "+this.stringPropToHTML("adres",5)),t}adjustTextWidthIfAuto(){if(this.props.heeft_automatische_breedte==="automatisch"){var e="";this.props.is_vet&&(e+=' font-weight="bold"'),this.props.is_cursief&&(e+=' font-style="italic"');var t=E(this.props.tekst).split("|"),s=40;for(let n=0;n<t.length;n++)s=Math.round(Math.max(s,oe(t[n],10,e)+10));this.props.breedte=String(s)}}toSVG(e=!1){let t=new J;var s=E(this.props.tekst).split("|");this.adjustTextWidthIfAuto();var n=isNaN(Number(this.props.breedte))||this.props.breedte===""?40:Math.max(Number(this.props.breedte)*1,1),r=15*Math.max(s.length-2,0),a;this.props.vrije_tekst_type==="zonder kader"?this.getParent().getType()==="Kring"?a=10:this.getParent().getType()==="Contactdoos"?a=0:a=5:a=20,t.xleft=1,t.xright=a+n,t.yup=25+r/2,t.ydown=25+r/2;var o="";this.props.is_vet&&(o+=' font-weight="bold"'),this.props.is_cursief&&(o+=' font-style="italic"');var l;switch(this.props.horizontale_uitlijning){case"links":l='<text style="text-anchor:start" font-family="Arial, Helvetica, sans-serif" font-size="10" x="'+(a+5)+'" ';break;case"rechts":l='<text style="text-anchor:end" font-family="Arial, Helvetica, sans-serif" font-size="10" x="'+(a+n-4)+'" ';break;default:l='<text style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10" x="'+(a+1+n/2)+'" ';break}for(let c=0;c<s.length;c++){let d=28-7.5*Math.min(1,s.length-1)+15*c;t.data+=l+' y="'+d+'"'+o+">"+s[c]+"</text>"}switch(this.props.vrije_tekst_type){case"zonder kader":break;default:t.data+=(e?"":'<line x1="1" y1="'+(25+r/2)+'" x2="21" y2="'+(25+r/2)+'" stroke="black" />')+'<rect x="21" y="5" width="'+n+'" height="'+(40+r)+'" fill="none" style="stroke:black" />'+this.addAddressToSVG(t,60+r,15,n/2-(t.xright-20)/2);break}return t}getSitPlanBoundaries(){switch(this.props.vrije_tekst_type){case"zonder kader":return{clipleft:0,addright:-8,cliptop:10,addbottom:-10};default:return{clipleft:12,addright:0,cliptop:0,addbottom:0}}}}class yn extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.aantal=this.getLegacyKey(e,4),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15),this.props.warmtefunctie=this.getLegacyKey(e,18)}resetProps(){this.clearProps(),this.props.type="Warmtepomp/airco",this.props.aantal="1",this.props.adres="",this.props.warmtefunctie="Koelend"}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml()+"Warmte functie: "+this.selectPropToHTML("warmtefunctie",["","Koelend","Verwarmend","Verwarmend en koelend"])+", Aantal: "+this.selectPropToHTML("aantal",["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"])+", Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;H.addSymbol("verbruiker"),H.addSymbol("bliksem");var s=0;this.props.aantal>1&&(s=15,t.data+='<text x="41" y="12" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">x'+E(this.props.aantal)+"</text>"),t.xleft=1,t.xright=59,t.yup=25+s,t.ydown=25,t.data+=(e?"":'<line x1="1" y1="'+(s+25)+'" x2="21" y2="'+(s+25)+'" stroke="black"></line>')+'<use xlink:href="#verbruiker" x="21" y="'+(s+25)+'"></use><line x1="26" y1="'+(s+0)+'" x2="26" y2="'+(s+5)+'" stroke="black" /><line x1="56" y1="'+(s+0)+'" x2="56" y2="'+(s+5)+'" stroke="black" /><line x1="26" y1="'+(s+5)+'" x2="33.5" y2="'+(s+23)+'" stroke="black" /><line x1="56" y1="'+(s+5)+'" x2="48.5" y2="'+(s+23)+'" stroke="black" /><line x1="33.5" y1="'+(s+23)+'" x2="41" y2="'+(s+14)+'" stroke="black" /><line x1="48.5" y1="'+(s+23)+'" x2="41" y2="'+(s+14)+'" stroke="black" />';var n=41,r=41;if(this.props.warmtefunctie!="")var n=31,r=51;switch(t.data+='<use xlink:href="#bliksem" x="'+n+'" y="'+(s+35)+'"/>',this.props.warmtefunctie){case"Verwarmend":t.data+='<text x="'+(r-1)+'" y="'+(s+36)+'" style="text-anchor:middle;dominant-baseline:middle" font-family="Arial, Helvetica, sans-serif" font-size="12">+</text>';break;case"Koelend":t.data+='<text x="'+(r-1)+'" y="'+(s+36)+'" style="text-anchor:middle;dominant-baseline:middle" font-family="Arial, Helvetica, sans-serif" font-size="12">-</text>';break;case"Verwarmend en koelend":t.data+='<text x="'+(r-1)+'" y="'+(s+36)+'" style="text-anchor:middle;dominant-baseline:middle" font-family="Arial, Helvetica, sans-serif" font-size="12">+/-</text>';break}return t.data+=e?"":this.addAddressToSVG(t,60+s,15),t}}class kn extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Wasmachine",this.props.adres=""}toHTML(e){let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml()+"Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;return H.addSymbol("wasmachine"),t.xleft=1,t.xright=59,t.yup=25,t.ydown=25,t.data=(e?"":'<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line>')+'<use xlink:href="#wasmachine" x="21" y="25"></use>',t.data+=this.addAddressToSVG(t,60,15),t}}class xn extends X{convertLegacyKeys(e){}resetProps(){this.clearProps(),this.props.type="Zekering/differentieel",this.props.nr="",this.props.aantal_polen="2",this.props.bescherming="automatisch",this.props.amperage="20",this.props.differentieel_delta_amperage="300",this.props.type_differentieel="",this.props.curve_automaat="",this.props.differentieel_is_selectief=!1,this.props.kortsluitvermogen="",this.props.huishoudelijk=!0,this.props.fase="",this.props.newPage=!1}overrideKeys(){if(this.props.curve_automaat==="E"&&(this.props.curve_automaat="U"),this.props.newPage==null&&(this.props.newPage=!1),(this.props.aantal_polen<1||this.props.aantal_polen>4)&&(this.props.aantal_polen="2"),this.props.bescherming!="differentieel"&&this.props.bescherming!="differentieelautomaat"&&(this.props.differentieel_is_selectief=!1),this.isChildOf("Kring")||(this.props.nr=""),this.getParent()!==null)this.props.newPage=!1;else{let e=this.sourcelist.getFirstChildId(0);e!==null&&this.id===e&&(this.props.newPage=!1)}typeof this.props.huishoudelijk=="undefined"&&(this.props.huishoudelijk=!0),["automatisch","differentieel","differentieelautomaat","smelt"].includes(this.props.bescherming)||(this.props.fase=""),["automatisch","differentieel","differentieelautomaat"].includes(this.props.bescherming)||(this.props.kortsluitvermogen="")}toHTML(e){this.overrideKeys();let t=this.toHTMLHeader(e);switch(t+="&nbsp;",this.isChildOf("Kring")&&(t=t+this.nrToHtml()),t=t+this.selectPropToHTML("bescherming",["automatisch","differentieel","differentieelautomaat","smelt"]),this.props.bescherming!="geen"&&(t+=this.selectPropToHTML("aantal_polen",["2","3","4","-","1"])+this.stringPropToHTML("amperage",2)+"A"),this.props.bescherming){case"differentieel":t+=", Δ "+this.stringPropToHTML("differentieel_delta_amperage",3)+"mA, Type:"+this.selectPropToHTML("type_differentieel",["","A","B"])+", Kortsluitstroom: "+this.stringPropToHTML("kortsluitvermogen",3)+"kA, Selectief: "+this.checkboxPropToHTML("differentieel_is_selectief")+", Fase: "+this.selectPropToHTML("fase",["","L1","L2","L3"]);break;case"automatisch":t+=", Curve:"+this.selectPropToHTML("curve_automaat",["","B","C","D","U"])+", Kortsluitstroom: "+this.stringPropToHTML("kortsluitvermogen",3)+"kA, Fase: "+this.selectPropToHTML("fase",["","L1","L2","L3"]);break;case"differentieelautomaat":t+=", Δ "+this.stringPropToHTML("differentieel_delta_amperage",3)+"mA, Curve:"+this.selectPropToHTML("curve_automaat",["","B","C","D","U"])+", Type:"+this.selectPropToHTML("type_differentieel",["","A","B"])+", Kortsluitstroom: "+this.stringPropToHTML("kortsluitvermogen",3)+"kA, Selectief: "+this.checkboxPropToHTML("differentieel_is_selectief")+", Fase: "+this.selectPropToHTML("fase",["","L1","L2","L3"]);break;case"smelt":t+=", Fase: "+this.selectPropToHTML("fase",["","L1","L2","L3"]);break}if(this.props.kortsluitvermogen!=""&&["differentieel","automatisch","differentieelautomaat"].includes(this.props.bescherming)&&(t+=", Huishoudelijke installatie: "+this.checkboxPropToHTML("huishoudelijk")),this.getParent()==null){let s=this.sourcelist.getFirstChildId(0);s!==null&&this.id!==s&&(t+=", Start op nieuwe pagina: "+this.checkboxPropToHTML("newPage"))}return t}toSVG(){let e=(n,r)=>{let a=n;return["L1","L2","L3"].includes(this.props.fase)&&(a=a+(this.props.huishoudelijk&&this.props.kortsluitvermogen!=""?1.3:1),r.data+='<text x="'+(31+(this.props.bescherming=="smelt"?4:0))+'" y="'+(40+(a-1)*11)+'" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(this.props.fase)+"</text>"),a},t=new J;H.addSymbol("zekering_automatisch_horizontaal"),H.addSymbol("zekering_smelt_horizontaal"),t.xleft=1,t.xright=50,t.yup=25,t.ydown=25,t.data+='<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line>';let s=1;switch(this.props.bescherming){case"automatisch":if(s=1,t.data+='<use xlink:href="#zekering_automatisch_horizontaal" x="21" y="25" /><text x="31" y="40" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(this.props.aantal_polen+"P - "+this.props.amperage+"A")+"</text>",(this.props.curve_automaat=="B"||this.props.curve_automaat=="C"||this.props.curve_automaat=="D"||this.props.curve_automaat=="U")&&(++s,t.data+='<text x="31" y="'+(40+(s-1)*11)+'" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E("Curve "+this.props.curve_automaat)+"</text>"),this.props.kortsluitvermogen!="")if(this.props.huishoudelijk){s=s+1.3,t.data+='<text x="31" y="'+(40+(s-1)*11)+'" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(""+ce(this.props.kortsluitvermogen)*1e3)+"</text>";let n=oe(E(""+ce(this.props.kortsluitvermogen)*1e3))+6;t.data+='<rect x="'+(31-n/2)+'" y="'+(40+(s-1)*11-10)+'" width="'+n+'" height="'+11*1.2+'" fill="none" stroke="black" />'}else s=s+1,t.data+='<text x="31" y="'+(40+(s-1)*11)+'" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(""+this.props.kortsluitvermogen)+"kA</text>";s=e.bind(this)(s,t);break;case"differentieel":if(s=2,t.data+='<use xlink:href="#zekering_automatisch_horizontaal" x="21" y="25" /><text x="31" y="40" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">Δ'+E(this.props.differentieel_delta_amperage+"mA")+'</text><text x="31" y="51" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(this.props.aantal_polen+"P - "+this.props.amperage+"A")+"</text>",(this.props.type_differentieel=="A"||this.props.type_differentieel=="B")&&(++s,t.data+='<text x="31" y="'+(40+(s-1)*11)+'" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E("Type "+this.props.type_differentieel)+"</text>"),this.props.kortsluitvermogen!="")if(this.props.huishoudelijk){s=s+1.3,t.data+='<text x="31" y="'+(40+(s-1)*11)+'" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(""+ce(this.props.kortsluitvermogen)*1e3)+"</text>";let n=oe(E(""+ce(this.props.kortsluitvermogen)*1e3))+6;t.data+='<rect x="'+(31-n/2)+'" y="'+(40+(s-1)*11-10)+'" width="'+n+'" height="'+11*1.2+'" fill="none" stroke="black" />'}else s=s+1,t.data+='<text x="31" y="'+(40+(s-1)*11)+'" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(""+this.props.kortsluitvermogen)+"kA</text>";s=e.bind(this)(s,t);break;case"differentieelautomaat":if(s=2,t.data+='<use xlink:href="#zekering_automatisch_horizontaal" x="21" y="25" /><text x="31" y="40" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">Δ'+E(this.props.differentieel_delta_amperage+"mA")+'</text><text x="31" y="51" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(this.props.aantal_polen+"P - "+this.props.amperage+"A")+"</text>",(this.props.curve_automaat=="B"||this.props.curve_automaat=="C"||this.props.curve_automaat=="D"||this.props.curve_automaat=="U")&&(++s,t.data+='<text x="31" y="'+(40+(s-1)*11)+'" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E("Curve "+this.props.curve_automaat)+"</text>"),(this.props.type_differentieel=="A"||this.props.type_differentieel=="B")&&(++s,t.data+='<text x="31" y="'+(40+(s-1)*11)+'" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E("Type "+this.props.type_differentieel)+"</text>"),this.props.kortsluitvermogen!="")if(this.props.huishoudelijk){s=s+1.3,t.data+='<text x="31" y="'+(40+(s-1)*11)+'" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(""+ce(this.props.kortsluitvermogen)*1e3)+"</text>";let n=oe(E(""+ce(this.props.kortsluitvermogen)*1e3))+6;t.data+='<rect x="'+(31-n/2)+'" y="'+(40+(s-1)*11-10)+'" width="'+n+'" height="'+11*1.2+'" fill="none" stroke="black" />'}else s=s+1,t.data+='<text x="31" y="'+(40+(s-1)*11)+'" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(""+this.props.kortsluitvermogen)+"kA</text>";s=e.bind(this)(s,t);break;case"smelt":s=1.4,t.data+='<use xlink:href="#zekering_smelt_horizontaal" x="21" y="25" /><text x="35" y="45" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(this.props.aantal_polen+"P - "+this.props.amperage+"A")+"</text>",s=e.bind(this)(s,t);break}return t.ydown=t.ydown+11*(s-1),this.props.differentieel_is_selectief&&(t.data+='<line x1="'+(t.xright+2)+'" x2="'+(t.xright+2+30)+'" y1="25" y2="25" stroke="black" /><rect x="'+(t.xright+8)+'" y="32" width="16" height="16" stroke="black" fill="white" /><text x="'+(t.xright+16)+'" y="44" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">S</text>',t.xright=t.xright+30),this.props.newPage&&(t.data=`<svg newPage="true" x="0" y="0" width="${t.xleft+t.xright}" height="${t.yup+t.ydown}">`+t.data+"</svg>"),t}}class vn extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15),this.props.symbool=this.getLegacyKey(e,16)}resetProps(){this.clearProps(),this.props.type="Zeldzame symbolen",this.props.adres="",this.props.symbool=""}overrideKeys(){this.props.symbool!=="deurslot"&&(this.props.adres="")}toHTML(e){this.overrideKeys();let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml()+"Symbool: "+this.selectPropToHTML("symbool",["","aarding","deurslot"]),this.props.symbool==="deurslot"&&(t+=", Adres/tekst: "+this.stringPropToHTML("adres",5)),t}toSVG(e=!1){let t=new J;switch(H.addSymbol("deurslot"),t.xleft=1,t.xright=59,t.yup=25,t.ydown=25,this.props.symbool){case"aarding":let s=20;t.data+=`<line x1="1" y1="25" x2="${s+.5}" y2="25" stroke="black"></line><line x1="`+s+'" y1="'+t.yup+'" x2="'+s+'" y2="'+(t.yup+10)+'" stroke="black" /><line x1="'+(s-10)+'" y1="'+(t.yup+10)+'" x2="'+(s+10)+'" y2="'+(t.yup+10)+'" stroke="black" /><line x1="'+(s-7.5)+'" y1="'+(t.yup+13)+'" x2="'+(s+7.5)+'" y2="'+(t.yup+13)+'" stroke="black" /><line x1="'+(s-5)+'" y1="'+(t.yup+16)+'" x2="'+(s+5)+'" y2="'+(t.yup+16)+'" stroke="black" />',this.heeftVerbruikerAlsKind()&&!e&&(t.data+=`<line x1="${s+.5}" y1="25" x2="${s+10}" y2="25" stroke="black" />`),t.xright=28;break;case"deurslot":t.data+=(e?"":'<line x1="1" y1="25" x2="21.5" y2="25" stroke="black"></line>')+'<use xlink:href="#deurslot" x="21" y="25"></use>',t.xright=58,t.data+=this.addAddressToSVG(t,55,10,2);break;default:t.data+=e?"":'<line x1="1" y1="25" x2="21" y2="25" stroke="black"></line>',t.xright=-1;break}return t}}class wn extends X{convertLegacyKeys(e){this.props.type=this.getLegacyKey(e,0),this.props.aantal=this.getLegacyKey(e,4),this.props.nr=this.getLegacyKey(e,10),this.props.adres=this.getLegacyKey(e,15)}resetProps(){this.clearProps(),this.props.type="Zonnepaneel",this.props.aantal="1",this.props.adres="",this.props.symbool="driehoek"}overrideKeys(){this.props.symbool==null&&(this.props.symbool="driehoek")}toHTML(e){this.overrideKeys();let t=this.toHTMLHeader(e);return t+="&nbsp;"+this.nrToHtml()+" Aantal: "+this.selectPropToHTML("aantal",["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40"])+", Symbool: "+this.selectPropToHTML("symbool",["driehoek","pijltjes"])+", Adres/tekst: "+this.stringPropToHTML("adres",5),t}toSVG(e=!1){let t=new J;switch(t.xleft=1,t.xright=69,t.yup=35,t.ydown=25,t.data+=e?"":'<line x1="1" y1="35" x2="21" y2="35" stroke="black"></line>',this.props.symbool){case"driehoek":t.data+='<use xlink:href="#zonnepaneel_driehoek" x="21" y="35"></use>',H.addSymbol("zonnepaneel_driehoek");break;case"pijltjes":default:t.data+='<use xlink:href="#zonnepaneel" x="21" y="35"></use>',H.addSymbol("arrow"),H.addSymbol("zonnepaneel");break}return t.data+='<text x="45" y="9" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(this.props.aantal)+"x</text>",t.data+=e?"":this.addAddressToSVG(t,70,15),t}}class _n{constructor(){this.filename="eendraadschema.eds",this.owner="Voornaam Achternaam<br>Straat 0<br>0000 gemeente<br>Tel: +32 00 00 00 00<br>GSM: +32 000 00 00 00<br>e-mail: voornaam.achternaam@domein.be",this.installer="idem",this.control="",this.dpi=300,this.info="1 x 230V + N ~50 Hz",this.currentView="config",this.legacySchakelaars=null}setFilename(e){this.filename=e}}class rs{constructor(){var e,t;this.height=0,this.start=0,this.stop=0,this.info=((t=(e=globalThis.structure)==null?void 0:e.properties)==null?void 0:t.info)!=null?globalThis.structure.properties.info:""}}class Tn{constructor(){this.markers=[]}clear(){this.markers=[]}addMarker(e,t,s=!1){this.markers.some(r=>r.depth===e&&r.xpos===t)||this.markers.push({depth:e,xpos:t,forceNewPage:s})}sort(){this.markers.sort((e,t)=>e.xpos-t.xpos)}findMinDepth(e,t){const s=this.markers.filter(n=>n.xpos>e&&n.xpos<=t);return s.length===0?{depth:null,xpos:t}:s.reduce((n,r)=>r.depth<n.depth||r.depth===n.depth&&r.xpos>n.xpos?r:n,s[0])}findForceNewPage(e,t){const s=this.markers.find(n=>n.xpos>e&&n.xpos<=t&&n.forceNewPage);return s?{depth:s.depth,xpos:s.xpos}:null}}class pt{constructor(){this.height=0,this.maxwidth=0,this.displaypage=0,this.enableAutopage=!0,this.printPageMode="all",this.printPageRange="",this.pages=new Array,this.pages.push(new rs),this.pagemarkers=new Tn}setPaperSize(e){this.papersize=e==="A3"?"A3":"A4"}getPaperSize(){return this.papersize||(this.papersize="A4"),this.papersize}setHeight(e){this.height=e,this.pages.forEach(t=>{t.height=e})}getHeight(){return this.height}setModeVertical(e){this.modevertical=e==="kies"?"kies":"alles",this.forceCorrectFigures()}getModeVertical(){return this.forceCorrectFigures(),this.modevertical}forceCorrectFigures(){switch(this.modevertical||(this.modevertical="alles"),this.modevertical){case"kies":this.starty=Math.min(Math.max(0,this.starty),this.height),this.stopy=Math.min(Math.max(this.starty,this.stopy),this.height);break;default:this.starty=0,this.stopy=this.height}this.pages[this.pages.length-1].stop=this.maxwidth,this.pages.forEach((e,t)=>{e.stop<0&&(e.stop=0),e.start<0&&(e.start=0),t>0&&(e.start=this.pages[t-1].stop),e.stop>this.maxwidth&&(this.pages[this.pages.length-1].stop=this.maxwidth),e.start>e.stop&&(e.start=e.stop)})}setMaxWidth(e){this.maxwidth=e,this.forceCorrectFigures()}getMaxWidth(){return this.maxwidth}getstarty(){return this.forceCorrectFigures(),this.starty}getstopy(){return this.forceCorrectFigures(),this.stopy}setstarty(e){this.starty=e,this.forceCorrectFigures}setstopy(e){this.stopy=e,this.forceCorrectFigures}setStop(e,t){e>0&&t<this.pages[e-1].stop&&(t=this.pages[e-1].stop),e<this.pages.length-1&&t>this.pages[e+1].stop&&(t=this.pages[e+1].stop),t>this.maxwidth&&(t=this.maxwidth),this.pages[e].stop=t,this.forceCorrectFigures()}autopage(){this.pages.forEach((o,l)=>{o.stop=this.maxwidth});let t=(this.getstopy()-this.getstarty())*(this.getPaperSize()=="A3"?1.6878:1.8467),s=3/4*t,n=0,r=0,a=null;if(t>0)for(;(a=this.pagemarkers.findForceNewPage(r,r+t))!=null||this.maxwidth-r>t;){for(a?r=a.xpos:r=this.pagemarkers.findMinDepth(r+s,r+t).xpos;this.pages.length<n+2;)this.addPage();this.setStop(n,r),n++}this.setStop(n,this.maxwidth);for(let o=this.pages.length-1;o>n;o--)this.deletePage(o)}addPage(){var e;e=new rs,e.height=this.height,e.start=this.pages[this.pages.length-1].stop,e.stop=this.maxwidth,this.pages.push(e)}deletePage(e){e==0?this.pages[1].start=0:this.pages[e-1].stop=this.pages[e].stop,this.pages.splice(e,1)}insertHTMLselectPaperSize(e,t){var s=document.createElement("select");s.id="select_papersize_input";var n=document.createElement("option");n.value="A4",n.textContent="A4";var r=document.createElement("option");r.value="A3",r.textContent="A3",this.papersize=="A3"?r.selected=!0:n.selected=!0,s.appendChild(n),s.appendChild(r),s.onchange=a=>{this.setPaperSize(a.target.value),t()},e.appendChild(s)}insertHTMLselectdpi(e,t){var s=document.createElement("select");s.id="select_dpi_input";var n=document.createElement("option");n.value="300",n.textContent="300dpi (standaard)";var r=document.createElement("option");r.value="600",r.textContent="600dpi (beter maar trager)",typeof globalThis.structure.properties.dpi=="undefined"&&(globalThis.structure.properties.dpi=300),globalThis.structure.properties.dpi==600?r.selected=!0:n.selected=!0,s.appendChild(n),s.appendChild(r),s.onchange=a=>{globalThis.structure.properties.dpi=parseInt(a.target.value,0)},e.appendChild(s)}insertHTMLselectPageRange(e,t){var d,h;const s=document.createElement("div");s.style.margin="1em 0",s.innerHTML=`<label for="print_page_mode"><b>Pagina's:</b></label><select id="print_page_mode" style="margin-left:0.5em;"><option value="all">Alles</option><option value="custom">Aangepast</option></select><input type="text" id="print_page_range" style="margin-left:0.5em;width:120px;" placeholder="bijv. 1-2, 4"><span id="print_range_error" style="color:red;display:none;margin-left:0.5em;">Ongeldige invoer!</span>`;const n=s.querySelector("#print_page_mode"),r=s.querySelector("#print_page_range"),a=s.querySelector("#print_range_error"),o=(d=this.printPageMode)!=null?d:"all",l=(h=this.printPageRange)!=null?h:"";n.value=o,r.value=l,r.style.display=o==="custom"?"":"none";const c=()=>{const p=globalThis.structure.print_table.pages.length+(globalThis.structure.sitplan?globalThis.structure.sitplan.getNumPages():0),[g,m]=pt.isValidPageRange(r.value,p);g?(a.style.display="none",a.textContent=""):(a.style.display="",a.textContent=m)};n.addEventListener("change",()=>{this.printPageMode=n.value,n.value==="custom"?r.style.display="":(r.style.display="none",r.value="",a.style.display="none",this.printPageRange=""),c()}),r.addEventListener("input",()=>{this.printPageRange=r.value,c()}),c(),e.appendChild(s)}static isValidPageRange(e,t){if(e.trim()==="")return[!0,""];if(!/^[\d\s,\-]*$/.test(e))return[!1,"Ongeldige invoer: alleen cijfers, spaties, komma's en streepjes toegestaan."];const s=e.split(",").map(r=>r.trim());let n=0;for(const r of s)if(r!=="")if(r.includes("-")){const[a,o]=r.split("-").map(d=>d.trim());if(!/^\d+$/.test(a)||!/^\d+$/.test(o))return[!1,`Ongeldige invoer: niet-geheel getal in bereik (${r})`];const l=Number(a),c=Number(o);if(!Number.isInteger(l)||!Number.isInteger(c))return[!1,`Ongeldige invoer: niet-geheel getal in bereik (${r})`];if(l<1||c>t)return[!1,`Ongeldige invoer: pagina buiten bereik (${r}), toegestaan: 1-${t}`];if(l>c)return[!1,`Ongeldige invoer: startpagina groter dan eindpagina (${r})`];if(l<=n)return[!1,`Ongeldige invoer: overlappende of niet-oplopende pagina's (${r})`];n=c}else{if(!/^\d+$/.test(r))return[!1,`Ongeldige invoer: niet-geheel getal (${r})`];const a=Number(r);if(!Number.isInteger(a))return[!1,`Ongeldige invoer: niet-geheel getal (${r})`];if(a<1||a>t)return[!1,`Ongeldige invoer: pagina buiten bereik (${r}), toegestaan: 1-${t}`];if(a<=n)return[!1,`Ongeldige invoer: overlappende of niet-oplopende pagina's (${r})`];n=a}return[!0,""]}canPrint(){var n;const e=globalThis.structure.print_table.pages.length+(globalThis.structure.sitplan?globalThis.structure.sitplan.getNumPages():0),[t,s]=pt.isValidPageRange((n=this.printPageRange)!=null?n:"",e);return t}insertHTMLcheckAutopage(e,t){var s=document.createElement("input");s.type="checkbox",s.id="autopage",s.name="autopage";var n=document.createElement("label");n.htmlFor="autopage",n.textContent="Eéndraadschema handmatig over pagina's verdelen",this.enableAutopage?(this.setModeVertical("alles"),this.autopage()):s.checked=!0,e.append(s),e.append(n),s.onchange=r=>{this.enableAutopage=!r.target.checked,this.enableAutopage||this.pages.forEach(a=>{a.info=globalThis.structure.properties.info}),t()}}insertHTMLchooseVerticals(e,t){let s="";switch(this.modevertical){case"kies":s+='Hoogte <select id="select_modeVertical"><option value="alles">Alles (standaard)</option><option value="kies" selected="Selected">Kies (expert)</option></select>',s+="&nbsp;&nbsp;StartY ",s+='<input size="4" id="input_starty" type="number" min="0" step="1" max="'+this.getHeight()+'" value="'+this.getstarty()+'">',s+="&nbsp;&nbsp;StopY ",s+='<input size="4" id="input_stopy" type="number" min="0" step="1" max="'+this.getHeight()+'" value="'+this.getstopy()+'">';break;case"alles":default:s+='Hoogte <select id="select_modeVertical"><option value="alles">Alles (standaard)</option><option value="kies">Kies (expert)</option></select>'}e.insertAdjacentHTML("beforeend",s),document.getElementById("select_modeVertical").onchange=n=>{this.setModeVertical(n.target.value),t()},this.modevertical=="kies"&&(document.getElementById("input_starty").onchange=n=>{let r=parseInt(n.target.value);isNaN(r)&&(r=0),this.setstarty(r),this.forceCorrectFigures(),t()},document.getElementById("input_stopy").onchange=n=>{let r=parseInt(n.target.value);isNaN(r)&&(r=this.getHeight()),this.setstopy(r),this.forceCorrectFigures(),t()})}insertHTMLsuggestXposButton(e,t){var s=document.createElement("button");s.innerText="Suggereer X-posities",e.append(s),s.onclick=()=>{this.autopage(),t()}}insertHTMLposxTable(e,t){globalThis.structure.print_table.enableAutopage&&this.autopage();let s="",n;for(s+='<table border="1" cellpadding="3">',s+='<tr><th align="center">Pagina</th><th align="center">Startx</th><th align="center">Stopx</th><th align="left">Info</th><th align="left">Acties</th></tr>',n=0;n<this.pages.length;n++)s+="<tr><td align=center>"+(n+1)+"</td><td align=center>"+this.pages[n].start+"</td><td align=center>",n!=this.pages.length-1?s+='<input size="5" id="input_stop_'+n+'" type="number" min="'+this.pages[n].start+'" step="1" max="'+this.maxwidth+'" value="'+this.pages[n].stop+'">':s+=this.pages[n].stop.toString(),s+='</td><td><div style="width:200px; border-style:solid; border-width:thin; cursor:text; padding: 2px; border-color:darkgray; font-size: small;" align=left contenteditable="true" id="input_info_'+n+'">',s+=this.pages[n].info,s+="</div></td><td align=left>",n==this.pages.length-1&&(s+='<button style="background-color:green;" id="Btn_Addpage">&#9660;</button>'),this.pages.length>1&&(s+='<button style="background-color:red;" id="Btn_Deletepage_'+n+'">&#9851;</button>'),s+="</td></tr>";s+="</table>",e.insertAdjacentHTML("beforeend",s),document.getElementById("Btn_Addpage").onclick=()=>{this.addPage(),t()},document.querySelectorAll('button[id^="Btn_Deletepage_"]').forEach(r=>{const a=r.id.match(/Btn_Deletepage_(\d+)/);if(a){const o=parseInt(a[1]);r.onclick=()=>{this.deletePage(o),t()}}}),document.querySelectorAll('input[id^="input_stop_"]').forEach(r=>{r.addEventListener("change",a=>{const o=a.target.id.match(/input_stop_(\d+)/);if(o){const l=parseInt(o[1]),c=parseInt(a.target.value);this.setStop(l,c),t()}})}),document.querySelectorAll('div[id^="input_info_"]').forEach(r=>{r.addEventListener("blur",a=>{const o=a.target.id.match(/input_info_(\d+)/);if(o){const l=parseInt(o[1]),c=a.target.innerHTML;this.pages[l].info=c}})})}}function Sn(i,e,t){const s=t*Math.PI/180,n=Math.cos(s),r=Math.sin(s),a=Math.abs(i*n)+Math.abs(e*r),o=Math.abs(i*r)+Math.abs(e*n);return{width:a,height:o}}function Ln(i,e,t){t=Math.abs(t)%180,t>90&&(t=180-t);const s=t*Math.PI/180,n=Math.cos(s),r=Math.sin(s);return{width:Math.min(i/n,e/r),height:Math.min(i/r,e/n)}}let xt=null;function as(){if(xt===null){const i=document.createElement("div");i.style.width="10mm",i.style.position="absolute",document.body.appendChild(i);const e=i.offsetWidth;document.body.removeChild(i),xt=e/10}return xt}class Ve{constructor(){this.activePage=1,this.numPages=1,this.elements=[],this.floors=[],this.pageFloorIds=[],this.pageMetersPerUnit=[],this.defaults={fontsize:11,scale:globalThis.SITPLANVIEW_DEFAULT_SCALE,rotate:0,defaultDeviceHeightCm:30}}dispose(){this.elements=[],this.numPages=1,this.activePage=1,this.floors=[],this.pageFloorIds=[],this.pageMetersPerUnit=[],this.defaults={fontsize:11,scale:globalThis.SITPLANVIEW_DEFAULT_SCALE,rotate:0,defaultDeviceHeightCm:30}}static generateFloorId(){return"fl_"+Math.random().toString(36).slice(2,10)+Date.now().toString(36)}ensureFloorsInitialized(){Array.isArray(this.floors)&&this.floors.length>0||(this.floors=[{id:Ve.generateFloorId(),name:"Gelijkvloers",elevationCm:0,cablePlaneOffsetCm:-10}])}ensurePageFloorIdsLength(){this.ensureFloorsInitialized();const e=this.floors.length>0?this.floors[0].id:null;for(;this.pageFloorIds.length<this.numPages;)this.pageFloorIds.push(e);this.pageFloorIds.length>this.numPages&&(this.pageFloorIds.length=this.numPages)}ensurePageMetersPerUnitLength(){for(;this.pageMetersPerUnit.length<this.numPages;)this.pageMetersPerUnit.push(null);this.pageMetersPerUnit.length>this.numPages&&(this.pageMetersPerUnit.length=this.numPages)}getMetersPerUnitForPage(e){if(!Number.isFinite(e)||e<1)return null;this.ensurePageMetersPerUnitLength();const t=this.pageMetersPerUnit[e-1];return t!=null&&Number.isFinite(t)&&t>0?t:null}setMetersPerUnitForPage(e,t){if(!Number.isFinite(e)||e<1)return;if(this.ensurePageMetersPerUnitLength(),t==null){this.pageMetersPerUnit[e-1]=null;return}const s=Number(t);this.pageMetersPerUnit[e-1]=Number.isFinite(s)&&s>0?s:null}getFloorIdForPage(e){var t;return!Number.isFinite(e)||e<1?null:(this.ensurePageFloorIdsLength(),(t=this.pageFloorIds[e-1])!=null?t:null)}setFloorIdForPage(e,t){!Number.isFinite(e)||e<1||(this.ensurePageFloorIdsLength(),this.pageFloorIds[e-1]=t)}addFloor(e,t=null,s=-10){this.ensureFloorsInitialized();const n=Ve.generateFloorId(),r=s==null?null:Number(s);return this.floors.push({id:n,name:e,elevationCm:t,cablePlaneOffsetCm:r==null||!Number.isFinite(r)?-10:r}),n}getElements(){return this.elements}getNumPages(){return this.elements.length>0?this.numPages:0}heeftEenzameSchakelaars(){var e=this.elements.filter(function(t){if(t.isEendraadschemaSymbool()){let s=globalThis.structure.getElectroItemById(t.getElectroItemId());if(s!=null&&s.props.type=="Schakelaars"&&(s.props.aantal_schakelaars==1||s.props.aantal_schakelaars==null))return!0}});return e.length>1}dropLegacySchakelaars(){for(let e of this.elements)if(e.isEendraadschemaSymbool()){let t=globalThis.structure.getElectroItemById(e.getElectroItemId());t!=null&&t.props.type=="Schakelaars"&&(t.props.aantal_schakelaars==1||t.props.aantal_schakelaars==null)&&(e.rotate=0)}}addElement(e){this.elements.push(e)}addElementFromFile(e,t,s,n,r){let a=new we;return a.setVars({page:t,posx:s,posy:n,labelfontsize:this.defaults.fontsize,scale:this.defaults.scale,rotate:this.defaults.rotate}),a.importFromFile(e,r),this.elements.push(a),a}addElementFromElectroItem(e,t,s,n,r,a,o,l,c,d){const h=globalThis.structure.getElectroItemById(e);if(!h)return null;const p=h.toSituationPlanElement();return Object.assign(p,{page:t,posx:s,posy:n,labelfontsize:l,scale:c,rotate:d}),p.setElectroItemId(e),p.setAdres(r,a,o),this.elements.push(p),p}removeElement(e){if(e.isEendraadschemaSymbool()){const s=e.getElectroItemId(),n=globalThis.structure.getElectroItemById(s);n!=null&&n.getParent()instanceof ht&&globalThis.structure.deleteById(n.id)}const t=this.elements.indexOf(e);t!==-1&&(this.elements.splice(t,1),e.boxref!=null&&e.boxref.remove(),e.boxlabelref!=null&&e.boxlabelref.remove(),this.removeElement(e))}syncToEendraadSchema(){for(let e of this.elements)if(e.electroItemId!=null&&globalThis.structure.getElectroItemById(e.getElectroItemId())==null){this.removeElement(e),this.syncToEendraadSchema();return}}orderByZIndex(){this.elements.sort((e,t)=>{let s=e.boxref==null||e.boxref.style.zIndex===""?0:parseInt(e.boxref.style.zIndex),n=t.boxref==null||t.boxref.style.zIndex===""?0:parseInt(t.boxref.style.zIndex);return s-n})}fromJsonObject(e){this.dispose(),e.numPages!==void 0?this.numPages=e.numPages:this.numPages=1,e.activePage!==void 0?this.activePage=e.activePage:this.activePage=1,e.defaults!==void 0&&Object.assign(this.defaults,e.defaults),Array.isArray(e.floors)?this.floors=e.floors.filter(t=>t&&typeof t.id=="string"&&typeof t.name=="string").map(t=>({id:String(t.id),name:String(t.name),elevationCm:t.elevationCm!=null&&Number.isFinite(Number(t.elevationCm))?Number(t.elevationCm):null,cablePlaneOffsetCm:t.cablePlaneOffsetCm!=null&&Number.isFinite(Number(t.cablePlaneOffsetCm))?Number(t.cablePlaneOffsetCm):-10})):this.floors=[],Array.isArray(e.pageFloorIds)?this.pageFloorIds=e.pageFloorIds.map(t=>t==null?null:String(t)):this.pageFloorIds=[],this.ensurePageFloorIdsLength(),Array.isArray(e.pageMetersPerUnit)?this.pageMetersPerUnit=e.pageMetersPerUnit.map(t=>{if(t==null)return null;const s=Number(t);return Number.isFinite(s)&&s>0?s:null}):this.pageMetersPerUnit=[],this.ensurePageMetersPerUnitLength(),Array.isArray(e.elements)?this.elements=e.elements.map(t=>{const s=new we;return s.fromJsonObject(t),s}):this.elements=[]}toJsonObject(){this.orderByZIndex(),this.ensurePageFloorIdsLength(),this.ensurePageMetersPerUnitLength();let e=[];for(let t of this.elements)e.push(t.toJsonObject());return{numPages:this.numPages,activePage:this.activePage,defaults:this.defaults,floors:this.floors,pageFloorIds:this.pageFloorIds,pageMetersPerUnit:this.pageMetersPerUnit,elements:e}}countByElectroItemId(e){return this.elements.filter(t=>t.getElectroItemId()===e).length}toSitPlanPrint(e=!1){this.syncToEendraadSchema(),this.orderByZIndex();let t={};t.numpages=this.elements.length>0?globalThis.structure.sitplan.numPages:0,t.pages=[];for(let s=0;s<t.numpages;s++){let n="",r=as()*277,a=as()*150,o=0,l=0;for(let c of this.elements)if(c.page==s+1&&c.visible!==!1){let d=c.labelfontsize!=null?c.labelfontsize:11;if(n+=c.getScaledSVG(!0),e){let p=Sn(c.sizex*c.getscale(),c.sizey*c.getscale(),c.rotate);r=Math.max(r,c.posx+p.width/2),a=Math.max(a,c.posy+p.height/2),o=Math.min(o,c.posx-p.width/2),l=Math.min(l,c.posy-p.height/2)}let h=c.getAdres();n+=`<text x="${c.labelposx}" y="${c.labelposy}" font-size="${d}" fill="black" text-anchor="middle" dominant-baseline="middle">${E(h)}</text>`}n=`<svg xmlns="http://www.w3.org/2000/svg" width="${r-o}px" height="${a-l}px" viewBox="${o} ${l} ${r-o} ${a-l}">${n}</svg>`,t.pages.push({sizex:r-o,sizey:a-l,svg:n})}return t}}class Es{constructor(){this.currentView="",this.idToOrdinalMap=null,this.length=0,this.data=new Array,this.active=new Array,this.id=new Array,this.print_table=new pt,this.properties=new _n,this.curid=1,this.mode="edit",this.sitplan=new Ve}dispose(){this.sitplanview!=null&&this.sitplanview.dispose()}reSort(){let e=()=>{if(this.length<=1)return!0;let o=[],l=0;for(let c=0;c<this.length;c++)if(this.active[c]){let d=this.data[c].parent;if(d==l)o.push(l),l=this.id[c];else{for(;o.length>0&&o[o.length-1]!==d;)o.pop();if(o.length===0)return!1;l=this.id[c]}}else return!1;return!0},t=(o=0,l=[])=>{for(let c=0;c<this.length;c++)this.active[c]&&this.data[c].parent==o&&(l.push(c),t(this.id[c],l));return l};if(e())return;let s=t(),n=[],r=[],a=[];for(let o=0;o<s.length;o++)n.push(this.data[s[o]]),r.push(this.active[s[o]]),a.push(this.id[s[o]]);this.data=n,this.active=r,this.id=a,this.length=s.length,this.idToOrdinalMap=null}buildIdToOrdinalMap(){this.idToOrdinalMap=new Map;for(let e=0;e<this.length;e++)this.active[e]&&this.idToOrdinalMap.set(this.id[e],e)}getOrdinalById(e){function t(n){return n==null||n>=this.length||!this.active[n]||this.id[n]!==e}if(e===0)return null;this.idToOrdinalMap===null&&this.buildIdToOrdinalMap();let s=this.idToOrdinalMap.get(e);return t.call(this,s)&&(this.buildIdToOrdinalMap(),s=this.idToOrdinalMap.get(e),t.call(this,s))?null:s}getElectroItemById(e){if(e===null||e===0)return null;let t=this.getOrdinalById(e);return t!==null?this.data[t]:null}getNumChilds(e){let t=0;for(let s=0;s<this.length;s++)this.data[s].parent==e&&this.active[s]&&!this.data[s].isAttribuut()&&t++;return t}getFirstChildId(e){for(let t=0;t<this.length;t++)if(this.active[t]&&this.data[t].parent==e&&!this.data[t].isAttribuut())return this.id[t];return null}getMaxNumChilds(e){let t=this.getOrdinalById(e);return t===null?0:this.data[t].getMaxNumChilds()}createContainerIfNotExists(){for(let t=0;t<this.length;t++)if(this.active[t]&&this.data[t].parent===0&&this.data[t]instanceof ht)return this.data[t];let e=this.addItem("Container");return e.parent=0,e}createItem(e){let t;switch(e){case"Aansluiting":t=new Ni(this);break;case"Aansluitpunt":case"Leeg":t=new zi(this);break;case"Aardingsonderbreker":t=new Ki(this);break;case"Aftakdoos":t=new ss(this);break;case"Batterij":t=new $i(this);break;case"Bel":t=new Ri(this);break;case"Boiler":t=new Di(this);break;case"Bord":t=new It(this);break;case"Container":t=new ht(this);break;case"Diepvriezer":t=new Oi(this);break;case"Domotica":t=new ji(this);break;case"Domotica module (verticaal)":t=new Ui(this);break;case"Domotica gestuurde verbruiker":t=new Fi(this);break;case"Droogkast":t=new Gi(this);break;case"Drukknop":t=new is(this);break;case"Elektriciteitsmeter":t=new qi(this);break;case"Elektrische oven":t=new Wi(this);break;case"EV lader":t=new Ji(this);break;case"Ketel":t=new Xi(this);break;case"Koelkast":t=new Zi(this);break;case"Kookfornuis":t=new Yi(this);break;case"Kring":t=new Ls(this);break;case"Leiding":t=new Qi(this);break;case"Lichtcircuit":t=new an(this);break;case"Lichtpunt":t=new Ps(this);break;case"Meerdere verbruikers":t=new tn(this);break;case"Media":t=new en(this);break;case"Microgolfoven":t=new sn(this);break;case"Motor":t=new nn(this);break;case"Omvormer":t=new ns(this);break;case"Overspanningsbeveiliging":t=new rn(this);break;case"Schakelaars":t=new Ie(this);break;case"Splitsing":t=new on(this);break;case"Stoomoven":t=new ln(this);break;case"Contactdoos":t=new Vi(this);break;case"Transformator":t=new cn(this);break;case"USB lader":t=new dn(this);break;case"Vaatwasmachine":t=new hn(this);break;case"Ventilator":t=new pn(this);break;case"Verbruiker":t=new un(this);break;case"Verlenging":t=new gn(this);break;case"Verwarmingstoestel":t=new fn(this);break;case"Vrije ruimte":t=new mn(this);break;case"Vrije tekst":t=new bn(this);break;case"Warmtepomp/airco":t=new yn(this);break;case"Wasmachine":t=new kn(this);break;case"Zeldzame symbolen":t=new vn(this);break;case"Zekering/differentieel":t=new xn(this);break;case"Zonnepaneel":t=new wn(this);break;default:t=new X(this)}return t.id=this.curid,t.parent=0,t.indent=0,t}addItem(e){let t=this.createItem(e);return this.data.push(t),this.active.push(!0),this.id.push(this.curid),this.curid+=1,this.length+=1,this.idToOrdinalMap=null,t}insertItemBeforeId(e,t){for(let s=0;s<this.length;s++)if(this.id[s]==t){e.id=this.curid,e.parent=this.data[s].parent,e.indent=this.data[s].indent,e.collapsed=!1,this.data.splice(s,0,e),this.active.splice(s,0,!0),this.id.splice(s,0,this.curid),this.curid+=1,this.length+=1;break}this.reSort()}insertItemAfterId(e,t){for(let s=0;s<this.length;s++)if(this.id[s]==t)return e.id=this.curid,e.parent=this.data[s].parent,e.indent=this.data[s].indent,e.collapsed=!1,this.data.splice(s+1,0,e),this.active.splice(s+1,0,!0),this.id.splice(s+1,0,this.curid),this.curid+=1,this.length+=1,s+1;this.reSort()}insertChildAfterId(e,t){let s=this.getNumChilds(t),n=this.getMaxNumChilds(t);if(s<n||e.isAttribuut()){let r=this.insertItemAfterId(e,t);this.data[r].parent=t,this.data[r].indent=this.data[r-1].indent+1}else alert("Het maximum aantal kinderen van dit element is "+n);this.reSort()}moveUp(e){let t=this.getOrdinalById(e);if(t===null)return;let s=t,n=this.data[t].parent;for(let o=t-1;o>=0;o--)if(this.data[o].parent==n&&this.active[o]&&!this.data[o].isAttribuut()){s=o;break}let r=new Pt(this);r=this.data[t],this.data[t]=this.data[s],this.data[s]=r;let a=this.id[t];this.id[t]=this.id[s],this.id[s]=a,this.reSort()}moveDown(e){let t=this.getOrdinalById(e);if(t===null)return;let s=t,n=this.data[t].parent;for(let o=t+1;o<this.length;o++)if(this.data[o].parent==n&&this.active[o]&&!this.data[o].isAttribuut()){s=o;break}let r=new Pt(this);r=this.data[t],this.data[t]=this.data[s],this.data[s]=r;let a=this.id[t];this.id[t]=this.id[s],this.id[s]=a,this.reSort()}clone(e,t){let s=this.getOrdinalById(e);if(s===null)return;arguments.length<2&&(t=this.data[s].parent);let n=this.createItem(this.data[s].getType());n.clone(this.data[s]),arguments.length<2?this.insertItemAfterId(n,e):this.insertChildAfterId(n,t);let r=this.curid-1,a=this.getOrdinalById(r);if(s=this.getOrdinalById(e),s===null||a===null)return;this.data[a].collapsed=this.data[s].collapsed;let o=new Array;for(let l=0;l<this.length;l++)if(this.id[l]==e)for(let c=this.length-1;c>=0;c--)this.data[c].parent==e&&o.push(this.id[c]);for(let l=0;l<o.length;l++)this.clone(o[l],r);this.reSort()}cloneRelativeToId(e,t,s){const n=this.getOrdinalById(e),r=this.getOrdinalById(t);if(n===null||r===null)return null;const a=this.data[n];if(a==null)return null;const o=this.createItem(a.getType());o.clone(this.data[n]),s==="before"?this.insertItemBeforeId(o,t):this.insertItemAfterId(o,t);const l=this.curid-1,c=this.getOrdinalById(l);c!==null&&(this.data[c].collapsed=this.data[n].collapsed);let d=[];for(let h=this.length-1;h>=0;h--)this.data[h].parent===e&&d.push(this.id[h]);for(let h=0;h<d.length;h++)this.clone(d[h],l);return this.reSort(),l}moveSubtreeRelativeToId(e,t,s,n=!1){var C,N,G,w,M,u,f,k,x,T,_,P,$,K,b,y,I,z,O,B,R;if(e===t)return!1;this.idToOrdinalMap=null;const r=this.getOrdinalById(e),a=this.getOrdinalById(t);if(r===null||a===null)return!1;const o=(N=(C=this.data[r])==null?void 0:C.indent)!=null?N:0;let l=r+1;for(;l<this.length&&!(((w=(G=this.data[l])==null?void 0:G.indent)!=null?w:0)<=o);)l++;for(let U=r;U<l;U++)if(this.id[U]===t)return!1;const c=this.data.splice(r,l-r),d=this.active.splice(r,l-r),h=this.id.splice(r,l-r);this.idToOrdinalMap=null;const p=this.getOrdinalById(t);if(p===null)return this.data.splice(r,0,...c),this.active.splice(r,0,...d),this.id.splice(r,0,...h),this.idToOrdinalMap=null,!1;const g=(u=(M=this.data[p])==null?void 0:M.indent)!=null?u:0;let m=p+1;for(;m<this.length&&!(((k=(f=this.data[m])==null?void 0:f.indent)!=null?k:0)<=g);)m++;const v=s==="before"?p:m,S=(T=(x=c[0])==null?void 0:x.indent)!=null?T:0;let L=S,A=(P=(_=c[0])==null?void 0:_.parent)!=null?P:0;if(n){if(A=t,L=((K=($=this.data[p])==null?void 0:$.indent)!=null?K:0)+1,((y=(b=c[0])==null?void 0:b.parent)!=null?y:0)!==A){const D=this.getElectroItemById(A);if(D&&typeof D.checkInsertChild=="function"&&!D.checkInsertChild())return this.data.splice(r,0,...c),this.active.splice(r,0,...d),this.id.splice(r,0,...h),this.idToOrdinalMap=null,!1}}else A=(z=(I=this.data[p])==null?void 0:I.parent)!=null?z:0,L=(B=(O=this.data[p])==null?void 0:O.indent)!=null?B:0;const V=L-S;for(let U=0;U<c.length;U++)c[U].indent=((R=c[U].indent)!=null?R:0)+V;return c[0].parent=A,this.data.splice(v,0,...c),this.active.splice(v,0,...d),this.id.splice(v,0,...h),this.idToOrdinalMap=null,this.reSort(),!0}deleteById(e){for(let t=0;t<this.length;t++)if(this.id[t]==e){this.active[t]=!1;for(let s=0;s<this.length;s++)this.data[s].parent==e&&this.deleteById(this.id[s])}this.reSort()}adjustTypeByOrdinal(e,t){let s=this.createItem(t);Object.assign(s,this.data[e]),s.props.type=t,s.resetProps(),this.data[e]=s}adjustTypeById(e,t){let s=this.getOrdinalById(e);s!==null&&this.adjustTypeByOrdinal(s,t)}tekenVerticaleLijnIndienKindVanKring(e,t){let s=e.getParent();if(s!=null){if(s.getType()=="Kring"){let n=0,r=this.getOrdinalById(e.id);if(r===null)return;for(let a=0;a<e.sourcelist.length;a++)this.active[a]&&this.data[a].parent==s.id&&(n=a);if(e.getType()=="Omvormer"&&e.props.inkring)t.data+='<line x1="'+t.xleft+'" x2="'+t.xleft+'" y1="0" y2="'+(t.yup-5+.5)+'" stroke="black" />',t.data+='<line x1="'+t.xleft+'" x2="'+t.xleft+'" y1="'+(t.yup+5-.5)+'" y2="'+(t.yup+t.ydown)+'" stroke="black" />';else{let a,o;r<n?(a=0,o=t.yup+t.ydown):(a=t.yup,o=t.yup+t.ydown),t.data+='<line x1="'+t.xleft+'" x2="'+t.xleft+'" y1="'+a+'" y2="'+o+'" stroke="black" />'}}if(s.getType()=="Kring"||["Domotica module (verticaal)"].includes(s.getType())){let n;n=e.props.nr;let r=t.xleft+9,a=t.yup-5;e.getType()=="Omvormer"&&e.props.inkring&&(a-=5),t.data+='<text x="'+r+'" y="'+a+'" style="text-anchor:middle" font-family="Arial, Helvetica, sans-serif" font-size="10">'+E(n)+"</text>"}}}updateRibbon(){if(this.properties.currentView!="2col")return;let e="";switch(e+=`
            <div class="icon" ${globalThis.undostruct.undoStackSize()>0?'onclick="undoClicked()"':'style="filter: opacity(45%)"'}>
                <img src="gif/undo.png" alt="Ongedaan maken" class="icon-image">
                <span class="icon-text">Ongedaan maken</span>
            </div>
            <div class="icon" ${globalThis.undostruct.redoStackSize()>0?'onclick="redoClicked()"':'style="filter: opacity(45%)"'}>
                <img src="gif/redo.png" alt="Opnieuw" class="icon-image">
                <span class="icon-text">Opnieuw</span>
            </div>
            <span style="display: inline-block; width: 30px;"></span>
        `,e+='<p style="margin-top: 5px;margin-bottom: 5px;">',this.mode){case"edit":e+=`
                        <div>
                            Werkmodus<br>
                            <select id="edit_mode" onchange="HL_editmode()">
                                <option value="edit" selected>Invoegen</option>
                                <option value="move">Verplaatsen/Clone</option>
                            </select>
                        </div>`;break;case"move":e+=`
                        <div>
                            Werkmodus<br>
                            <select id="edit_mode" onchange="HL_editmode()">
                                <option value="edit">Invoegen</option>
                                <option value="move" selected>Verplaatsen/Clone</option>
                            </select>
                        </div>
                        <span style="display: inline-block; width: 30px;"></span>`,e+=`
                        <div style="color:black;font-size:12px"><i>
                            Gebruik de <b>blauwe</b> pijlen om de volgorde van elementen te wijzigen.<br>
                        U kan ook slepen in de boomstructuur via het <b>⋮⋮</b>-handvat.<br>
                            Gebruik het <u>Moeder</u>-veld om een component elders in het schema te hangen.<br>
                            Kies "<b>clone</b>" om een dubbel te maken van een element.
                        </i></div>`;break}const t=globalThis.treeEditInModal===!0?"checked":"";e+=`
            <span style="display: inline-block; width: 30px;"></span>
            <div>
                Boom
                <div style="font-size:12px">
                    <label style="cursor:pointer">
                        <input id="hl_tree_edit_in_modal" type="checkbox" ${t} onchange="HL_toggleTreeEditModal()">
                        Bewerk in venster
                    </label>
                </div>
            </div>
        `,e+="</p>",globalThis.autoSaver&&globalThis.autoSaver.hasChangesSinceLastManualSave()?(e+='<span style="display: inline-block; width: 30px;"></span>',e+=`<div style="margin-top: 5px;margin-bottom: 5px;display: flex; align-items: center; justify-content: center;" class="highlight-warning-big" onclick="saveSchema()"
                           onmouseover="this.style.cursor='pointer'" 
                           onmouseout="this.style.cursor='default'">
                           <div style="display: inline-block; vertical-align: middle;"><span class="icon-image" style="font-size:24px;">💾</span></div>
                           <div style="display: inline-block; vertical-align: middle; margin-left: 10px;">
                               U heeft niet opgeslagen wijzigingen. Klik hier om op te slaan<br>
                               of ga naar het "Bestand"-menu voor meer opties.
                           </div>
                        </div>`):(e+='<span style="display: inline-block; width: 30px;"></span>',e+=`<div style="margin-top: 5px;margin-bottom: 5px;display: flex; align-items: center; justify-content: center;" class="highlight-ok-big" onclick="topMenu.selectMenuItemByName('Bestand')"
                           onmouseover="this.style.cursor='pointer'" 
                           onmouseout="this.style.cursor='default'">
                           <div style="display: inline-block; vertical-align: middle;"><span class="icon-image" style="font-size:24px; filter: grayscale(100%); opacity: 0.5;">💾</span></div>
                           <div style="display: inline-block; vertical-align: middle; margin-left: 10px;">
                               Er zijn geen niet opgeslagen wijzigingen. Ga naar het "Bestand"-menu<br>
                               indien u toch wenst op te slaan.
                           </div>
                        </div>`);const s=document.getElementById("ribbon"),n=`<div id="left-icons">${e}</div>`;s.innerHTML=n}toHTMLinner(e){var d,h,p,g;const t=this.mode==="move"?'<span class="tree-drag-handle" draggable="true" title="Sleep om te verplaatsen">⋮⋮</span>':"",s=globalThis.treeEditInModal===!0,n=this.data[e],r=F((h=(d=n==null?void 0:n.getType)==null?void 0:d.call(n))!=null?h:""),o=E((()=>{var C,N,G,w,M,u,f,k,x,T,_,P,$,K,b;const m=(C=n==null?void 0:n.props)!=null?C:{},v=r!==""?r:"Element",S=F((G=(N=n==null?void 0:n.getReadableAdres)==null?void 0:N.call(n))!=null?G:""),L=F((w=m.naam)!=null?w:""),A=F((M=m.adres)!=null?M:"");if(v==="Bord")return L!==""?`Bord ${L}`:"Bord";if(v==="Kring"){const y=L==="---"?"":L,I=F((u=m.bescherming)!=null?u:""),z=F((f=m.amperage)!=null?f:""),O=F((k=m.aantal_polen)!=null?k:""),B=F((x=m.curve_automaat)!=null?x:""),R=F((T=m.differentieel_delta_amperage)!=null?T:"");let U=y!==""?`Kring ${y}`:"Kring",D="";return I!==""&&I!=="geen"?(D=I,I==="automatisch"&&B!==""&&(D+=` ${B}`),O!==""&&(D=`${O}P ${D}`),z!==""&&(D+=` ${z}A`),(I==="differentieel"||I==="differentieelautomaat")&&R!==""&&(D+=` Δ${R}mA`)):I==="geen"&&(D="geen beveiliging"),D!==""&&(U+=` — ${D}`),A!==""&&(U+=` — @ ${A}`),U}if(v==="Zekering/differentieel"){const y=F((_=m.bescherming)!=null?_:""),I=F((P=m.amperage)!=null?P:""),z=F(($=m.aantal_polen)!=null?$:""),O=F((K=m.curve_automaat)!=null?K:""),B=F((b=m.differentieel_delta_amperage)!=null?b:"");let R=S!==""?`Zekering ${S}`:"Zekering",U="";return y!==""&&(U=y,y==="automatisch"&&O!==""&&(U+=` ${O}`),z!==""&&(U=`${z}P ${U}`),I!==""&&(U+=` ${I}A`),(y==="differentieel"||y==="differentieelautomaat")&&B!==""&&(U+=` Δ${B}mA`)),U!==""&&(R+=` — ${U}`),R}let V=S!==""?`${v} ${S}`:v;return L!==""&&(V+=` — ${L}`),A!==""&&(V+=` — @ ${A}`),V})());let l="";if(s){const m=this.data[e].id;let v="";this.mode!=="move"&&((p=n==null?void 0:n.checkInsertSibling)!=null&&p.call(n)&&(v+=`<button class="button-insertBefore" onclick="HLInsertBefore(${m})"></button>`,v+=`<button class="button-insertAfter" onclick="HLInsertAfter(${m})"></button>`),(g=n==null?void 0:n.checkInsertChild)!=null&&g.call(n)&&(v+=`<button class="button-insertChild" onclick="HLInsertChild(${m})"></button>`)),v+=`<button class="button-delete-garbage-can" onclick="HLDelete(${m})"></button>`,v+="&nbsp;",l=`<span class="hl-quick-actions">${v}</span>`}const c=s?`${l}<span class="hl-open-modal-label" data-hl-open-id="${this.data[e].id}" title="Klik om te bewerken">${o}</span>`:`${this.data[e].toHTML(this.mode)}`;return this.data[e].collapsed?`<tr>
                        <td class="hl-collapse-cell" bgcolor="#8AB2E4" onclick="HLCollapseExpand(${this.data[e].id})" valign= "top"><span class="hl-collapse-icon">&#x229E;</span></td>
                        <td width="100%">${t}${c}<br></td>
                    </tr>`:`<tr>
                       <td class="hl-collapse-cell" bgcolor="C0C0C0" onclick="HLCollapseExpand(${this.data[e].id})" valign= "top"><span class="hl-collapse-icon">&#x229F;</span></td>
                       <td width="100%">${t}${c}<br>${this.toHTML(this.id[e])}</td>
                    </tr>`}updateHTMLinner(e){let t=this.getOrdinalById(e);if(t===null)return;let s=document.getElementById("id_elem_"+e);s.innerHTML=this.toHTMLinner(t)}voegAttributenToeAlsNodigEnReSort(){for(let e=0;e<this.length;e++)if(this.data[e].props!=null&&this.data[e].isAttribuut()){let t=this.data[e].getParent();if(t==null||t.getType()!="Domotica gestuurde verbruiker")continue;if(t.props.heeft_externe_sturing==!0)switch(t.props.type_externe_sturing){case"schakelaar":if(this.data[e].props.type=="Schakelaars")continue;Object.setPrototypeOf(this.data[e],Ie.prototype),this.data[e].resetProps(),this.data[e].props.isAttribuut=!0;continue;case"drukknop":if(this.data[e].props.type=="Drukknop")continue;Object.setPrototypeOf(this.data[e],is.prototype),this.data[e].resetProps(),this.data[e].props.isAttribuut=!0;continue;default:continue}this.active[e]=!1}for(let e=0;e<this.length;e++)if(this.active[e]&&this.data[e].getType()=="Domotica gestuurde verbruiker"&&this.data[e].props.heeft_externe_sturing==!0){let t=!1;for(let s=0;s<this.length;s++)this.active[s]&&this.data[s].parent==this.id[e]&&this.data[s].isAttribuut()&&(t=!0);if(!t){let s=null;switch(this.data[e].props.type_externe_sturing){case"schakelaar":s=this.createItem("Schakelaars"),s.props.type_schakelaar="enkelpolig";break;case"drukknop":default:s=this.createItem("Drukknop");break}if(s!=null){s.props.isAttribuut=!0,this.insertChildAfterId(s,this.id[e]),this.voegAttributenToeAlsNodigEnReSort();return}}}this.reSort()}toHTML(e){e==0&&(this.updateRibbon(),this.reNumber());let t=this.getElectroItemById(e),s="",n=0,r=0;for(let a=0;a<this.length;a++)if(this.active[a]&&this.data[a].parent==e&&!this.data[a].isAttribuut()&&this.data[a].getType()!="Container"){n++;const o=this.data[a].getType();if(o=="Container")continue;o!=null&&o=="Kring"&&r++,s+='<table class="html_edit_table" id="id_elem_'+this.id[a]+'" data-hl-id="'+this.id[a]+'" draggable="'+(this.mode==="move"?"true":"false")+'">',s+=this.toHTMLinner(a),s+="</table>"}if(e==0&&n<1&&(s+='<button onclick="HLAdd()">Voeg eerste object toe of kies bovenaan "Nieuw"</button><br>'),t!=null&&t.getType()=="Kring"&&r>1){const a=F(getComputedStyle(document.documentElement).getPropertyValue("--EDStekenFoutKleur")),o=ts(a);s=`<div class="EDS-tekenfout"><b>Tekenfout:</b> U heeft meer dan 1 kring achter deze kring gehangen, Kring ${o} {Kring, Kring, &#8230;}. Dat is niet gebruikelijk.<br>Als u hier een vertakking wilt, gebruik dan eerst het "Splitsing"-element: Kring ${o} Splitsing ${o} {Kring, Kring, &#8230;}.<br>Als u daadwerkelijk verticaal gestapelde kringen in het schema wilt, is het correcter ze hiërarchisch onder elkaar te hangen: Kring ${o} Kring ${o} Kring.<br></div>`+s}if(t!=null&&t.getType()=="Aansluiting"&&n>1){const a=F(getComputedStyle(document.documentElement).getPropertyValue("--EDStekenFoutKleur")),o=ts(a);s=`<div class="EDS-tekenfout"><b>Tekenfout:</b> U heeft meer dan 1 element achter een aansluiting gehangen, Aansluiting ${o} {Element1, Element2, &#8230;}. Dat is niet gebruikelijk.<br>Het is correcter om elementen achter een aansluiting als volgt te stapelen: Aansluiting ${o} Element1 ${o} Element2 ${o} &#8230;.<br>Verwijder het teveel aan elementen of gebruik de werkmodus "Verplaatsen/Clone" bovenaan om ze onder elkaar te hangen.</div>`+s}return s}findKringName(e){let t=this.getOrdinalById(e);if(t==null)return"";let s=this.data[t].parent;if(s==0)return"";{let n=this.getOrdinalById(s);return n==null?"":this.data[n].getType()=="Kring"?F(this.data[n].props.naam)!=""?this.data[n].props.naam:this.findKringName(s):this.findKringName(s)}}updateKringNamen(){function e(r,a){let o=document.getElementById(`HL_edit_${r}_naam`);o&&o.value!=a&&(o.value=a)}function t(r){let a="ABCDEFGHIJKLMNOPQRSTUVWXYZ",o="",l=!1;for(let c=0;c<a.length;c++)if(o=a[c],!r[o]){l=!0;break}if(!l)for(let c=0;c<a.length;c++){for(let d=0;d<a.length;d++)if(o=a[c]+a[d],!r[o]){l=!0;break}if(l)break}if(!l)for(let c=0;c<a.length;c++){for(let d=0;d<a.length;d++){for(let h=0;h<a.length;h++)if(o=a[c]+a[d]+a[h],!r[o]){l=!0;break}if(l)break}if(l)break}return o}function s(){let r={};for(let a=0;a<this.length;a++){if(!this.active[a])continue;let o=this.data[a];if(o==null)continue;let l=o.getType();if(l!=null&&l=="Kring"&&o.props.autoKringNaam!=="auto"){let c=F(o.props.naam);c!=""&&(r[c]=!0)}}return r}let n=s.call(this);for(let r=0;r<this.length;r++){if(!this.active[r])continue;let a=this.data[r];if(a==null||a.isAttribuut())continue;let o=a.getType();if(o!=null&&o=="Kring"&&a.props.autoKringNaam==="auto"){let l="";Et(["automatisch","differentieel","differentieelautomaat","smelt"],a.props.bescherming)&&(l=t(n)),n[l]=!0,a.props.naam!=l&&(a.props.naam=l,e(a.id,l))}}}reNumber(){function e(n,r){let a=document.getElementById(`HL_edit_${n}_nr`);a&&a.value!=r&&(a.value=r)}this.reSort(),this.updateKringNamen();let t={},s=["","Bord","Kring","Splitsing"];for(let n=0;n<this.length;n++){if(!this.active[n])continue;let r=this.data[n];if(r==null||r.isAttribuut())continue;let a=r.getType();if(a==null)continue;let o=r.getParent();if(o==null)continue;let l=this.findKringName(r.id);if(a=="Bord")for(let c in t)t[c]=0;else if(a=="Kring"){if(o.getType()==="Bord"){let c=F(r.props.naam);t[c]=0}}else if(!Et(s,this.data[n].getType())){let c=this.data[n];if(c==null)continue;let d=c.getParent();if(d==null)continue;if(d.getType()=="Kring"||d.getType()=="Domotica module (verticaal)")if(c.props.autonr==="auto"){t[l]=(t[l]||0)+1;let h=t[l].toString();c.props.nr!=h&&(c.props.nr=h,e(c.id,h))}else c.props.nr!=null&&!isNaN(Number(c.props.nr))&&(t[l]=Number(c.props.nr))}}}toSVG(e,t,s=0,n=!1){var h,p;let r=new Array,a=new Array,o=0;for(let g=0;g<this.length;g++)if(this.active[g]&&!this.data[g].isAttribuut()&&(this.data[g].parent==e||n==!0&&this.id[g]==e)){let m=this.data[g].getType();switch(m=this.data[g].props.type,m){case"":r[o]=new J;break;case"Bord":r[o]=this.data[g].toSVG();break;case"Splitsing":r[o]=this.data[g].toSVG();break;case"Domotica":r[o]=this.data[g].toSVG(),this.tekenVerticaleLijnIndienKindVanKring(this.data[g],r[o]);break;case"Meerdere verbruikers":r[o]=this.data[g].toSVG(),this.tekenVerticaleLijnIndienKindVanKring(this.data[g],r[o]);break;case"Vrije ruimte":r[o]=this.data[g].toSVG();break;case"Domotica module (verticaal)":r[o]=this.data[g].toSVG(),this.tekenVerticaleLijnIndienKindVanKring(this.data[g],r[o]);break;case"Omvormer":r[o]=this.data[g].toSVG(),this.tekenVerticaleLijnIndienKindVanKring(this.data[g],r[o]);break;case"Aftakdoos":r[o]=this.data[g].toSVG(),this.tekenVerticaleLijnIndienKindVanKring(this.data[g],r[o]);break;case"Domotica gestuurde verbruiker":r[o]=this.data[g].toSVG(),this.tekenVerticaleLijnIndienKindVanKring(this.data[g],r[o]);break;case"Kring":r[o]=this.data[g].toSVG();break;case"Aansluiting":r[o]=this.data[g].toSVG(),this.tekenVerticaleLijnIndienKindVanKring(this.data[g],r[o]);break;case"Container":break;default:const v=this.getElectroItemById(e);e!=0&&v!=null&&v.getType()=="Meerdere verbruikers"?r[o]=this.data[g].toSVG():t=="vertical"?r[o]=this.toSVG(this.id[g],"horizontal",0,!0):this.id[g]==e?r[o]=this.data[g].toSVG():r[o]=this.toSVG(this.id[g],"horizontal",0,!0),this.tekenVerticaleLijnIndienKindVanKring(this.data[g],r[o]);break}m!=="Container"&&(a[o]=this.id[g],o++)}o==0&&(r[0]=new J,a[0]=0);let l=new J;l.xleft=0,l.xright=0,l.yup=0,l.ydown=0,l.data="";let c=0,d=0;switch(t){case"horizontal":let g=0,m=0;for(let C=0;C<o;C++)c=c+r[C].xleft+r[C].xright,g=Math.max(g,r[C].yup),m=Math.max(m,r[C].ydown);d=g+m,o>0?(l.xleft=r[0].xleft,l.xright=c-l.xleft,l.xrightmin=l.xright-r[o-1].xright):(l.xleft=0,l.xright=0,l.xrightmin=0),l.yup=g,l.ydown=m;let v=0;for(let C=0;C<o;C++)l.data+='<svg data-eds-id="'+((h=a[C])!=null?h:0)+'" x="'+v+'" y="'+(g-r[C].yup)+'">',l.data+=r[C].data,l.data+="</svg>",v+=r[C].xleft+r[C].xright;break;case"vertical":let S=0,L=0;for(let C=0;C<o;C++)d=d+r[C].yup+r[C].ydown,S=Math.max(S,r[C].xleft),L=Math.max(L,r[C].xright),r[C].yup+r[C].ydown>0?l.connectorPos.push(d-r[C].yup):l.connectorPos.push(null);S=Math.max(s,S),c=S+L,l.yup=d,l.ydown=0,l.xleft=S,o>0&&(l.firstChildydown=r[0].ydown,l.lastChildyup=r[o-1].yup);let A=this.getElectroItemById(e);A!=null&&A.getType()=="Kring"&&(L+=10),!(this.getElectroItemById(e)instanceof ns)&&!(this.getElectroItemById(e)instanceof ss)?l.xright=Math.max(L,25):l.xright=Math.max(L,0);let V=0;for(let C=o-1;C>=0;C--)l.data+='<svg data-eds-id="'+((p=a[C])!=null?p:0)+'" x="'+(l.xleft-r[C].xleft)+'" y="'+V+'">',l.data+=r[C].data,l.data+="</svg>",V+=r[C].yup+r[C].ydown;break}if(e==0){let g='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" transform="scale(1,1)" width="'+(c+20)+'" height="'+(d+5)+'">';g+=H.outputSVGSymbols();let m="</svg>";l.data=g+l.data+m}return l}toJsonObject(e=!0){for(let o of this.data)o.sourcelist=null;let t=this.print_table.pagemarkers,s=this.sitplan,n=this.sitplanview,r=this.properties.currentView;this.print_table.pagemarkers=null,this.sitplan!=null&&(this.sitplanjson=this.sitplan.toJsonObject()),this.sitplan=null,this.sitplanview=null,e&&(this.properties.currentView=null);var a=JSON.stringify(this);for(let o of this.data)o.sourcelist=this;return this.print_table.pagemarkers=t,this.sitplan=s,this.sitplanview=n,this.properties.currentView=r,this.sitplanjson=null,a}}class Ue extends Error{}Ue.prototype.name="InvalidTokenError";function Pn(i){return decodeURIComponent(atob(i).replace(/(.)/g,(e,t)=>{let s=t.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}function En(i){let e=i.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return Pn(e)}catch(t){return atob(e)}}function In(i,e){if(typeof i!="string")throw new Ue("Invalid token specified: must be a string");e||(e={});const t=e.header===!0?0:1,s=i.split(".")[t];if(typeof s!="string")throw new Ue(`Invalid token specified: missing part #${t+1}`);let n;try{n=En(s)}catch(r){throw new Ue(`Invalid token specified: invalid base64 for part #${t+1} (${r.message})`)}try{return JSON.parse(n)}catch(r){throw new Ue(`Invalid token specified: invalid json for part #${t+1} (${r.message})`)}}var An={debug:()=>{},info:()=>{},warn:()=>{},error:()=>{}},ke,xe,ut=(i=>(i[i.NONE=0]="NONE",i[i.ERROR=1]="ERROR",i[i.WARN=2]="WARN",i[i.INFO=3]="INFO",i[i.DEBUG=4]="DEBUG",i))(ut||{});(i=>{function e(){ke=3,xe=An}i.reset=e;function t(n){if(!(0<=n&&n<=4))throw new Error("Invalid log level");ke=n}i.setLevel=t;function s(n){xe=n}i.setLogger=s})(ut||(ut={}));var se=class ye{constructor(e){this._name=e}debug(...e){ke>=4&&xe.debug(ye._format(this._name,this._method),...e)}info(...e){ke>=3&&xe.info(ye._format(this._name,this._method),...e)}warn(...e){ke>=2&&xe.warn(ye._format(this._name,this._method),...e)}error(...e){ke>=1&&xe.error(ye._format(this._name,this._method),...e)}throw(e){throw this.error(e),e}create(e){const t=Object.create(this);return t._method=e,t.debug("begin"),t}static createStatic(e,t){const s=new ye(`${e}.${t}`);return s.debug("begin"),s}static _format(e,t){const s=`[${e}]`;return t?`${s} ${t}:`:s}static debug(e,...t){ke>=4&&xe.debug(ye._format(e),...t)}static info(e,...t){ke>=3&&xe.info(ye._format(e),...t)}static warn(e,...t){ke>=2&&xe.warn(ye._format(e),...t)}static error(e,...t){ke>=1&&xe.error(ye._format(e),...t)}};ut.reset();var We=class{static decode(i){try{return In(i)}catch(e){throw se.error("JwtUtils.decode",e),e}}static async generateSignedJwt(i,e,t){const s=re.encodeBase64Url(new TextEncoder().encode(JSON.stringify(i))),n=re.encodeBase64Url(new TextEncoder().encode(JSON.stringify(e))),r=`${s}.${n}`,a=await window.crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},t,new TextEncoder().encode(r)),o=re.encodeBase64Url(new Uint8Array(a));return`${r}.${o}`}static async generateSignedJwtWithHmac(i,e,t){const s=re.encodeBase64Url(new TextEncoder().encode(JSON.stringify(i))),n=re.encodeBase64Url(new TextEncoder().encode(JSON.stringify(e))),r=`${s}.${n}`,a=await window.crypto.subtle.sign("HMAC",t,new TextEncoder().encode(r)),o=re.encodeBase64Url(new Uint8Array(a));return`${r}.${o}`}},Cn="10000000-1000-4000-8000-100000000000",At=i=>btoa([...new Uint8Array(i)].map(e=>String.fromCharCode(e)).join("")),Is=class me{static _randomWord(){const e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}static generateUUIDv4(){return Cn.replace(/[018]/g,t=>(+t^me._randomWord()&15>>+t/4).toString(16)).replace(/-/g,"")}static generateCodeVerifier(){return me.generateUUIDv4()+me.generateUUIDv4()+me.generateUUIDv4()}static async generateCodeChallenge(e){if(!crypto.subtle)throw new Error("Crypto.subtle is available only in secure contexts (HTTPS).");try{const s=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",s);return At(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}catch(t){throw se.error("CryptoUtils.generateCodeChallenge",t),t}}static generateBasicAuth(e,t){const n=new TextEncoder().encode([e,t].join(":"));return At(n)}static async hash(e,t){const s=new TextEncoder().encode(t),n=await crypto.subtle.digest(e,s);return new Uint8Array(n)}static async customCalculateJwkThumbprint(e){let t;switch(e.kty){case"RSA":t={e:e.e,kty:e.kty,n:e.n};break;case"EC":t={crv:e.crv,kty:e.kty,x:e.x,y:e.y};break;case"OKP":t={crv:e.crv,kty:e.kty,x:e.x};break;case"oct":t={crv:e.k,kty:e.kty};break;default:throw new Error("Unknown jwk type")}const s=await me.hash("SHA-256",JSON.stringify(t));return me.encodeBase64Url(s)}static async generateDPoPProof({url:e,accessToken:t,httpMethod:s,keyPair:n,nonce:r}){let a,o;const l={jti:window.crypto.randomUUID(),htm:s!=null?s:"GET",htu:e,iat:Math.floor(Date.now()/1e3)};t&&(a=await me.hash("SHA-256",t),o=me.encodeBase64Url(a),l.ath=o),r&&(l.nonce=r);try{const c=await crypto.subtle.exportKey("jwk",n.publicKey),d={alg:"ES256",typ:"dpop+jwt",jwk:{crv:c.crv,kty:c.kty,x:c.x,y:c.y}};return await We.generateSignedJwt(d,l,n.privateKey)}catch(c){throw c instanceof TypeError?new Error(`Error exporting dpop public key: ${c.message}`):c}}static async generateDPoPJkt(e){try{const t=await crypto.subtle.exportKey("jwk",e.publicKey);return await me.customCalculateJwkThumbprint(t)}catch(t){throw t instanceof TypeError?new Error(`Could not retrieve dpop keys from storage: ${t.message}`):t}}static async generateDPoPKeys(){return await window.crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!1,["sign","verify"])}static async generateClientAssertionJwt(e,t,s,n="HS256"){const r=Math.floor(Date.now()/1e3),a={alg:n,typ:"JWT"},o={iss:e,sub:e,aud:s,jti:me.generateUUIDv4(),exp:r+300,iat:r},c={HS256:"SHA-256",HS384:"SHA-384",HS512:"SHA-512"}[n];if(!c)throw new Error(`Unsupported algorithm: ${n}. Supported algorithms are: HS256, HS384, HS512`);const d=new TextEncoder,h=await crypto.subtle.importKey("raw",d.encode(t),{name:"HMAC",hash:c},!1,["sign"]);return await We.generateSignedJwtWithHmac(a,o,h)}};Is.encodeBase64Url=i=>At(i).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");var re=Is,Pe=class{constructor(i){this._name=i,this._callbacks=[],this._logger=new se(`Event('${this._name}')`)}addHandler(i){return this._callbacks.push(i),()=>this.removeHandler(i)}removeHandler(i){const e=this._callbacks.lastIndexOf(i);e>=0&&this._callbacks.splice(e,1)}async raise(...i){this._logger.debug("raise:",...i);for(const e of this._callbacks)await e(...i)}},os=class{static center(e){var i=de(e,[]);var t,s,n;return i.width==null&&(i.width=(t=[800,720,600,480].find(r=>r<=window.outerWidth/1.618))!=null?t:360),(s=i.left)!=null||(i.left=Math.max(0,Math.round(window.screenX+(window.outerWidth-i.width)/2))),i.height!=null&&((n=i.top)!=null||(i.top=Math.max(0,Math.round(window.screenY+(window.outerHeight-i.height)/2)))),i}static serialize(i){return Object.entries(i).filter(([,e])=>e!=null).map(([e,t])=>`${e}=${typeof t!="boolean"?t:t?"yes":"no"}`).join(",")}},Le=class at extends Pe{constructor(){super(...arguments),this._logger=new se(`Timer('${this._name}')`),this._timerHandle=null,this._expiration=0,this._callback=()=>{const e=this._expiration-at.getEpochTime();this._logger.debug("timer completes in",e),this._expiration<=at.getEpochTime()&&(this.cancel(),super.raise())}}static getEpochTime(){return Math.floor(Date.now()/1e3)}init(e){const t=this._logger.create("init");e=Math.max(Math.floor(e),1);const s=at.getEpochTime()+e;if(this.expiration===s&&this._timerHandle){t.debug("skipping since already initialized for expiration at",this.expiration);return}this.cancel(),t.debug("using duration",e),this._expiration=s;const n=Math.min(e,5);this._timerHandle=setInterval(this._callback,n*1e3)}get expiration(){return this._expiration}cancel(){this._logger.create("cancel"),this._timerHandle&&(clearInterval(this._timerHandle),this._timerHandle=null)}},Ct=class{static readParams(i,e="query"){if(!i)throw new TypeError("Invalid URL");const s=new URL(i,"http://127.0.0.1")[e==="fragment"?"hash":"search"];return new URLSearchParams(s.slice(1))}},Oe=";",Me=class extends Error{constructor(i,e){var t,s,n;if(super(i.error_description||i.error||""),this.form=e,this.name="ErrorResponse",!i.error)throw se.error("ErrorResponse","No error passed"),new Error("No error passed");this.error=i.error,this.error_description=(t=i.error_description)!=null?t:null,this.error_uri=(s=i.error_uri)!=null?s:null,this.state=i.userState,this.session_state=(n=i.session_state)!=null?n:null,this.url_state=i.url_state}},jt=class extends Error{constructor(i){super(i),this.name="ErrorTimeout"}},Mn=class{constructor(i){this._logger=new se("AccessTokenEvents"),this._expiringTimer=new Le("Access token expiring"),this._expiredTimer=new Le("Access token expired"),this._expiringNotificationTimeInSeconds=i.expiringNotificationTimeInSeconds}async load(i){const e=this._logger.create("load");if(i.access_token&&i.expires_in!==void 0){const t=i.expires_in;if(e.debug("access token present, remaining duration:",t),t>0){let n=t-this._expiringNotificationTimeInSeconds;n<=0&&(n=1),e.debug("registering expiring timer, raising in",n,"seconds"),this._expiringTimer.init(n)}else e.debug("canceling existing expiring timer because we're past expiration."),this._expiringTimer.cancel();const s=t+1;e.debug("registering expired timer, raising in",s,"seconds"),this._expiredTimer.init(s)}else this._expiringTimer.cancel(),this._expiredTimer.cancel()}async unload(){this._logger.debug("unload: canceling existing access token timers"),this._expiringTimer.cancel(),this._expiredTimer.cancel()}addAccessTokenExpiring(i){return this._expiringTimer.addHandler(i)}removeAccessTokenExpiring(i){this._expiringTimer.removeHandler(i)}addAccessTokenExpired(i){return this._expiredTimer.addHandler(i)}removeAccessTokenExpired(i){this._expiredTimer.removeHandler(i)}},Hn=class{constructor(i,e,t,s,n){this._callback=i,this._client_id=e,this._intervalInSeconds=s,this._stopOnError=n,this._logger=new se("CheckSessionIFrame"),this._timer=null,this._session_state=null,this._message=a=>{a.origin===this._frame_origin&&a.source===this._frame.contentWindow&&(a.data==="error"?(this._logger.error("error message from check session op iframe"),this._stopOnError&&this.stop()):a.data==="changed"?(this._logger.debug("changed message from check session op iframe"),this.stop(),this._callback()):this._logger.debug(a.data+" message from check session op iframe"))};const r=new URL(t);this._frame_origin=r.origin,this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="fixed",this._frame.style.left="-1000px",this._frame.style.top="0",this._frame.width="0",this._frame.height="0",this._frame.src=r.href}load(){return new Promise(i=>{this._frame.onload=()=>{i()},window.document.body.appendChild(this._frame),window.addEventListener("message",this._message,!1)})}start(i){if(this._session_state===i)return;this._logger.create("start"),this.stop(),this._session_state=i;const e=()=>{!this._frame.contentWindow||!this._session_state||this._frame.contentWindow.postMessage(this._client_id+" "+this._session_state,this._frame_origin)};e(),this._timer=setInterval(e,this._intervalInSeconds*1e3)}stop(){this._logger.create("stop"),this._session_state=null,this._timer&&(clearInterval(this._timer),this._timer=null)}},As=class{constructor(){this._logger=new se("InMemoryWebStorage"),this._data={}}clear(){this._logger.create("clear"),this._data={}}getItem(i){return this._logger.create(`getItem('${i}')`),this._data[i]}setItem(i,e){this._logger.create(`setItem('${i}')`),this._data[i]=e}removeItem(i){this._logger.create(`removeItem('${i}')`),delete this._data[i]}get length(){return Object.getOwnPropertyNames(this._data).length}key(i){return Object.getOwnPropertyNames(this._data)[i]}},Mt=class extends Error{constructor(i,e){super(e),this.name="ErrorDPoPNonce",this.nonce=i}},Ft=class{constructor(i=[],e=null,t={}){this._jwtHandler=e,this._extraHeaders=t,this._logger=new se("JsonService"),this._contentTypes=[],this._contentTypes.push(...i,"application/json"),e&&this._contentTypes.push("application/jwt")}async fetchWithTimeout(i,e={}){const a=e,{timeoutInSeconds:t}=a,s=de(a,["timeoutInSeconds"]);if(!t)return await fetch(i,s);const n=new AbortController,r=setTimeout(()=>n.abort(),t*1e3);try{return await fetch(i,_e(Q({},e),{signal:n.signal}))}catch(o){throw o instanceof DOMException&&o.name==="AbortError"?new jt("Network timed out"):o}finally{clearTimeout(r)}}async getJson(i,{token:e,credentials:t,timeoutInSeconds:s}={}){const n=this._logger.create("getJson"),r={Accept:this._contentTypes.join(", ")};e&&(n.debug("token passed, setting Authorization header"),r.Authorization="Bearer "+e),this._appendExtraHeaders(r);let a;try{n.debug("url:",i),a=await this.fetchWithTimeout(i,{method:"GET",headers:r,timeoutInSeconds:s,credentials:t})}catch(c){throw n.error("Network Error"),c}n.debug("HTTP response received, status",a.status);const o=a.headers.get("Content-Type");if(o&&!this._contentTypes.find(c=>o.startsWith(c))&&n.throw(new Error(`Invalid response Content-Type: ${o!=null?o:"undefined"}, from URL: ${i}`)),a.ok&&this._jwtHandler&&(o!=null&&o.startsWith("application/jwt")))return await this._jwtHandler(await a.text());let l;try{l=await a.json()}catch(c){throw n.error("Error parsing JSON response",c),a.ok?c:new Error(`${a.statusText} (${a.status})`)}if(!a.ok)throw n.error("Error from server:",l),l.error?new Me(l):new Error(`${a.statusText} (${a.status}): ${JSON.stringify(l)}`);return l}async postForm(i,{body:e,basicAuth:t,timeoutInSeconds:s,initCredentials:n,extraHeaders:r}){const a=this._logger.create("postForm"),o=Q({Accept:this._contentTypes.join(", "),"Content-Type":"application/x-www-form-urlencoded"},r);t!==void 0&&(o.Authorization="Basic "+t),this._appendExtraHeaders(o);let l;try{a.debug("url:",i),l=await this.fetchWithTimeout(i,{method:"POST",headers:o,body:e,timeoutInSeconds:s,credentials:n})}catch(p){throw a.error("Network error"),p}a.debug("HTTP response received, status",l.status);const c=l.headers.get("Content-Type");if(c&&!this._contentTypes.find(p=>c.startsWith(p)))throw new Error(`Invalid response Content-Type: ${c!=null?c:"undefined"}, from URL: ${i}`);const d=await l.text();let h={};if(d)try{h=JSON.parse(d)}catch(p){throw a.error("Error parsing JSON response",p),l.ok?p:new Error(`${l.statusText} (${l.status})`)}if(!l.ok){if(a.error("Error from server:",h),l.headers.has("dpop-nonce")){const p=l.headers.get("dpop-nonce");throw new Mt(p,`${JSON.stringify(h)}`)}throw h.error?new Me(h,e):new Error(`${l.statusText} (${l.status}): ${JSON.stringify(h)}`)}return h}_appendExtraHeaders(i){const e=this._logger.create("appendExtraHeaders"),t=Object.keys(this._extraHeaders),s=["accept","content-type"],n=["authorization"];t.length!==0&&t.forEach(r=>{if(s.includes(r.toLocaleLowerCase())){e.warn("Protected header could not be set",r,s);return}if(n.includes(r.toLocaleLowerCase())&&Object.keys(i).includes(r)){e.warn("Header could not be overridden",r,n);return}const a=typeof this._extraHeaders[r]=="function"?this._extraHeaders[r]():this._extraHeaders[r];a&&a!==""&&(i[r]=a)})}},Bn=class{constructor(i){this._settings=i,this._logger=new se("MetadataService"),this._signingKeys=null,this._metadata=null,this._metadataUrl=this._settings.metadataUrl,this._jsonService=new Ft(["application/jwk-set+json"],null,this._settings.extraHeaders),this._settings.signingKeys&&(this._logger.debug("using signingKeys from settings"),this._signingKeys=this._settings.signingKeys),this._settings.metadata&&(this._logger.debug("using metadata from settings"),this._metadata=this._settings.metadata),this._settings.fetchRequestCredentials&&(this._logger.debug("using fetchRequestCredentials from settings"),this._fetchRequestCredentials=this._settings.fetchRequestCredentials)}resetSigningKeys(){this._signingKeys=null}async getMetadata(){const i=this._logger.create("getMetadata");if(this._metadata)return i.debug("using cached values"),this._metadata;if(!this._metadataUrl)throw i.throw(new Error("No authority or metadataUrl configured on settings")),null;i.debug("getting metadata from",this._metadataUrl);const e=await this._jsonService.getJson(this._metadataUrl,{credentials:this._fetchRequestCredentials,timeoutInSeconds:this._settings.requestTimeoutInSeconds});return i.debug("merging remote JSON with seed metadata"),this._metadata=Object.assign({},e,this._settings.metadataSeed),this._metadata}getIssuer(){return this._getMetadataProperty("issuer")}getAuthorizationEndpoint(){return this._getMetadataProperty("authorization_endpoint")}getUserInfoEndpoint(){return this._getMetadataProperty("userinfo_endpoint")}getTokenEndpoint(i=!0){return this._getMetadataProperty("token_endpoint",i)}getCheckSessionIframe(){return this._getMetadataProperty("check_session_iframe",!0)}getEndSessionEndpoint(){return this._getMetadataProperty("end_session_endpoint",!0)}getRevocationEndpoint(i=!0){return this._getMetadataProperty("revocation_endpoint",i)}getKeysEndpoint(i=!0){return this._getMetadataProperty("jwks_uri",i)}async _getMetadataProperty(i,e=!1){const t=this._logger.create(`_getMetadataProperty('${i}')`),s=await this.getMetadata();if(t.debug("resolved"),s[i]===void 0){if(e===!0){t.warn("Metadata does not contain optional property");return}t.throw(new Error("Metadata does not contain property "+i))}return s[i]}async getSigningKeys(){const i=this._logger.create("getSigningKeys");if(this._signingKeys)return i.debug("returning signingKeys from cache"),this._signingKeys;const e=await this.getKeysEndpoint(!1);i.debug("got jwks_uri",e);const t=await this._jsonService.getJson(e,{timeoutInSeconds:this._settings.requestTimeoutInSeconds});if(i.debug("got key set",t),!Array.isArray(t.keys))throw i.throw(new Error("Missing keys on keyset")),null;return this._signingKeys=t.keys,this._signingKeys}},Ut=class{constructor({prefix:i="oidc.",store:e=localStorage}={}){this._logger=new se("WebStorageStateStore"),this._store=e,this._prefix=i}async set(i,e){this._logger.create(`set('${i}')`),i=this._prefix+i,await this._store.setItem(i,e)}async get(i){return this._logger.create(`get('${i}')`),i=this._prefix+i,await this._store.getItem(i)}async remove(i){this._logger.create(`remove('${i}')`),i=this._prefix+i;const e=await this._store.getItem(i);return await this._store.removeItem(i),e}async getAllKeys(){this._logger.create("getAllKeys");const i=await this._store.length,e=[];for(let t=0;t<i;t++){const s=await this._store.key(t);s&&s.indexOf(this._prefix)===0&&e.push(s.substr(this._prefix.length))}return e}},Nn="code",zn="openid",Kn="client_secret_post",$n=900,Ht=class{constructor({authority:i,metadataUrl:e,metadata:t,signingKeys:s,metadataSeed:n,client_id:r,client_secret:a,response_type:o=Nn,scope:l=zn,redirect_uri:c,post_logout_redirect_uri:d,client_authentication:h=Kn,token_endpoint_auth_signing_alg:p="HS256",prompt:g,display:m,max_age:v,ui_locales:S,acr_values:L,resource:A,response_mode:V,filterProtocolClaims:C=!0,loadUserInfo:N=!1,requestTimeoutInSeconds:G,staleStateAgeInSeconds:w=$n,mergeClaimsStrategy:M={array:"replace"},disablePKCE:u=!1,stateStore:f,revokeTokenAdditionalContentTypes:k,fetchRequestCredentials:x,refreshTokenAllowedScope:T,extraQueryParams:_={},extraTokenParams:P={},extraHeaders:$={},dpop:K,omitScopeWhenRequesting:b=!1}){var y;if(this.authority=i,e?this.metadataUrl=e:(this.metadataUrl=i,i&&(this.metadataUrl.endsWith("/")||(this.metadataUrl+="/"),this.metadataUrl+=".well-known/openid-configuration")),this.metadata=t,this.metadataSeed=n,this.signingKeys=s,this.client_id=r,this.client_secret=a,this.response_type=o,this.scope=l,this.redirect_uri=c,this.post_logout_redirect_uri=d,this.client_authentication=h,this.token_endpoint_auth_signing_alg=p,this.prompt=g,this.display=m,this.max_age=v,this.ui_locales=S,this.acr_values=L,this.resource=A,this.response_mode=V,this.filterProtocolClaims=C!=null?C:!0,this.loadUserInfo=!!N,this.staleStateAgeInSeconds=w,this.mergeClaimsStrategy=M,this.omitScopeWhenRequesting=b,this.disablePKCE=!!u,this.revokeTokenAdditionalContentTypes=k,this.fetchRequestCredentials=x||"same-origin",this.requestTimeoutInSeconds=G,f)this.stateStore=f;else{const I=typeof window!="undefined"?window.localStorage:new As;this.stateStore=new Ut({store:I})}if(this.refreshTokenAllowedScope=T,this.extraQueryParams=_,this.extraTokenParams=P,this.extraHeaders=$,this.dpop=K,this.dpop&&!((y=this.dpop)!=null&&y.store))throw new Error("A DPoPStore is required when dpop is enabled")}},Rn=class{constructor(i,e){this._settings=i,this._metadataService=e,this._logger=new se("UserInfoService"),this._getClaimsFromJwt=async t=>{const s=this._logger.create("_getClaimsFromJwt");try{const n=We.decode(t);return s.debug("JWT decoding successful"),n}catch(n){throw s.error("Error parsing JWT response"),n}},this._jsonService=new Ft(void 0,this._getClaimsFromJwt,this._settings.extraHeaders)}async getClaims(i){const e=this._logger.create("getClaims");i||this._logger.throw(new Error("No token passed"));const t=await this._metadataService.getUserInfoEndpoint();e.debug("got userinfo url",t);const s=await this._jsonService.getJson(t,{token:i,credentials:this._settings.fetchRequestCredentials,timeoutInSeconds:this._settings.requestTimeoutInSeconds});return e.debug("got claims",s),s}},Cs=class{constructor(i,e){this._settings=i,this._metadataService=e,this._logger=new se("TokenClient"),this._jsonService=new Ft(this._settings.revokeTokenAdditionalContentTypes,null,this._settings.extraHeaders)}async exchangeCode(a){var o=a,{grant_type:i="authorization_code",redirect_uri:e=this._settings.redirect_uri,client_id:t=this._settings.client_id,client_secret:s=this._settings.client_secret,extraHeaders:n}=o,r=de(o,["grant_type","redirect_uri","client_id","client_secret","extraHeaders"]);const l=this._logger.create("exchangeCode");t||l.throw(new Error("A client_id is required")),e||l.throw(new Error("A redirect_uri is required")),r.code||l.throw(new Error("A code is required"));const c=new URLSearchParams({grant_type:i,redirect_uri:e});for(const[g,m]of Object.entries(r))m!=null&&c.set(g,m);if((this._settings.client_authentication==="client_secret_basic"||this._settings.client_authentication==="client_secret_jwt")&&s==null)throw l.throw(new Error("A client_secret is required")),null;let d;const h=await this._metadataService.getTokenEndpoint(!1);switch(this._settings.client_authentication){case"client_secret_basic":d=re.generateBasicAuth(t,s);break;case"client_secret_post":c.append("client_id",t),s&&c.append("client_secret",s);break;case"client_secret_jwt":{const g=await re.generateClientAssertionJwt(t,s,h,this._settings.token_endpoint_auth_signing_alg);c.append("client_id",t),c.append("client_assertion_type","urn:ietf:params:oauth:client-assertion-type:jwt-bearer"),c.append("client_assertion",g);break}}l.debug("got token endpoint");const p=await this._jsonService.postForm(h,{body:c,basicAuth:d,timeoutInSeconds:this._settings.requestTimeoutInSeconds,initCredentials:this._settings.fetchRequestCredentials,extraHeaders:n});return l.debug("got response"),p}async exchangeCredentials(r){var a=r,{grant_type:i="password",client_id:e=this._settings.client_id,client_secret:t=this._settings.client_secret,scope:s=this._settings.scope}=a,n=de(a,["grant_type","client_id","client_secret","scope"]);const o=this._logger.create("exchangeCredentials");e||o.throw(new Error("A client_id is required"));const l=new URLSearchParams({grant_type:i});this._settings.omitScopeWhenRequesting||l.set("scope",s);for(const[p,g]of Object.entries(n))g!=null&&l.set(p,g);if((this._settings.client_authentication==="client_secret_basic"||this._settings.client_authentication==="client_secret_jwt")&&t==null)throw o.throw(new Error("A client_secret is required")),null;let c;const d=await this._metadataService.getTokenEndpoint(!1);switch(this._settings.client_authentication){case"client_secret_basic":c=re.generateBasicAuth(e,t);break;case"client_secret_post":l.append("client_id",e),t&&l.append("client_secret",t);break;case"client_secret_jwt":{const p=await re.generateClientAssertionJwt(e,t,d,this._settings.token_endpoint_auth_signing_alg);l.append("client_id",e),l.append("client_assertion_type","urn:ietf:params:oauth:client-assertion-type:jwt-bearer"),l.append("client_assertion",p);break}}o.debug("got token endpoint");const h=await this._jsonService.postForm(d,{body:l,basicAuth:c,timeoutInSeconds:this._settings.requestTimeoutInSeconds,initCredentials:this._settings.fetchRequestCredentials});return o.debug("got response"),h}async exchangeRefreshToken(a){var o=a,{grant_type:i="refresh_token",client_id:e=this._settings.client_id,client_secret:t=this._settings.client_secret,timeoutInSeconds:s,extraHeaders:n}=o,r=de(o,["grant_type","client_id","client_secret","timeoutInSeconds","extraHeaders"]);const l=this._logger.create("exchangeRefreshToken");e||l.throw(new Error("A client_id is required")),r.refresh_token||l.throw(new Error("A refresh_token is required"));const c=new URLSearchParams({grant_type:i});for(const[g,m]of Object.entries(r))Array.isArray(m)?m.forEach(v=>c.append(g,v)):m!=null&&c.set(g,m);if((this._settings.client_authentication==="client_secret_basic"||this._settings.client_authentication==="client_secret_jwt")&&t==null)throw l.throw(new Error("A client_secret is required")),null;let d;const h=await this._metadataService.getTokenEndpoint(!1);switch(this._settings.client_authentication){case"client_secret_basic":d=re.generateBasicAuth(e,t);break;case"client_secret_post":c.append("client_id",e),t&&c.append("client_secret",t);break;case"client_secret_jwt":{const g=await re.generateClientAssertionJwt(e,t,h,this._settings.token_endpoint_auth_signing_alg);c.append("client_id",e),c.append("client_assertion_type","urn:ietf:params:oauth:client-assertion-type:jwt-bearer"),c.append("client_assertion",g);break}}l.debug("got token endpoint");const p=await this._jsonService.postForm(h,{body:c,basicAuth:d,timeoutInSeconds:s,initCredentials:this._settings.fetchRequestCredentials,extraHeaders:n});return l.debug("got response"),p}async revoke(i){var e;const t=this._logger.create("revoke");i.token||t.throw(new Error("A token is required"));const s=await this._metadataService.getRevocationEndpoint(!1);t.debug(`got revocation endpoint, revoking ${(e=i.token_type_hint)!=null?e:"default token type"}`);const n=new URLSearchParams;for(const[r,a]of Object.entries(i))a!=null&&n.set(r,a);n.set("client_id",this._settings.client_id),this._settings.client_secret&&n.set("client_secret",this._settings.client_secret),await this._jsonService.postForm(s,{body:n,timeoutInSeconds:this._settings.requestTimeoutInSeconds}),t.debug("got response")}},Dn=class{constructor(i,e,t){this._settings=i,this._metadataService=e,this._claimsService=t,this._logger=new se("ResponseValidator"),this._userInfoService=new Rn(this._settings,this._metadataService),this._tokenClient=new Cs(this._settings,this._metadataService)}async validateSigninResponse(i,e,t){const s=this._logger.create("validateSigninResponse");this._processSigninState(i,e),s.debug("state processed"),await this._processCode(i,e,t),s.debug("code processed"),i.isOpenId&&this._validateIdTokenAttributes(i),s.debug("tokens validated"),await this._processClaims(i,e==null?void 0:e.skipUserInfo,i.isOpenId),s.debug("claims processed")}async validateCredentialsResponse(i,e){const t=this._logger.create("validateCredentialsResponse"),s=i.isOpenId&&!!i.id_token;s&&this._validateIdTokenAttributes(i),t.debug("tokens validated"),await this._processClaims(i,e,s),t.debug("claims processed")}async validateRefreshResponse(i,e){var t,s;const n=this._logger.create("validateRefreshResponse");i.userState=e.data,(t=i.session_state)!=null||(i.session_state=e.session_state),(s=i.scope)!=null||(i.scope=e.scope),i.isOpenId&&i.id_token&&(this._validateIdTokenAttributes(i,e.id_token),n.debug("ID Token validated")),i.id_token||(i.id_token=e.id_token,i.profile=e.profile);const r=i.isOpenId&&!!i.id_token;await this._processClaims(i,!1,r),n.debug("claims processed")}validateSignoutResponse(i,e){const t=this._logger.create("validateSignoutResponse");if(e.id!==i.state&&t.throw(new Error("State does not match")),t.debug("state validated"),i.userState=e.data,i.error)throw t.warn("Response was error",i.error),new Me(i)}_processSigninState(i,e){var t;const s=this._logger.create("_processSigninState");if(e.id!==i.state&&s.throw(new Error("State does not match")),e.client_id||s.throw(new Error("No client_id on state")),e.authority||s.throw(new Error("No authority on state")),this._settings.authority!==e.authority&&s.throw(new Error("authority mismatch on settings vs. signin state")),this._settings.client_id&&this._settings.client_id!==e.client_id&&s.throw(new Error("client_id mismatch on settings vs. signin state")),s.debug("state validated"),i.userState=e.data,i.url_state=e.url_state,(t=i.scope)!=null||(i.scope=e.scope),i.error)throw s.warn("Response was error",i.error),new Me(i);e.code_verifier&&!i.code&&s.throw(new Error("Expected code in response"))}async _processClaims(i,e=!1,t=!0){const s=this._logger.create("_processClaims");if(i.profile=this._claimsService.filterProtocolClaims(i.profile),e||!this._settings.loadUserInfo||!i.access_token){s.debug("not loading user info");return}s.debug("loading user info");const n=await this._userInfoService.getClaims(i.access_token);s.debug("user info claims received from user info endpoint"),t&&n.sub!==i.profile.sub&&s.throw(new Error("subject from UserInfo response does not match subject in ID Token")),i.profile=this._claimsService.mergeClaims(i.profile,this._claimsService.filterProtocolClaims(n)),s.debug("user info claims received, updated profile:",i.profile)}async _processCode(i,e,t){const s=this._logger.create("_processCode");if(i.code){s.debug("Validating code");const n=await this._tokenClient.exchangeCode(Q({client_id:e.client_id,client_secret:e.client_secret,code:i.code,redirect_uri:e.redirect_uri,code_verifier:e.code_verifier,extraHeaders:t},e.extraTokenParams));Object.assign(i,n)}else s.debug("No code to process")}_validateIdTokenAttributes(i,e){var t;const s=this._logger.create("_validateIdTokenAttributes");s.debug("decoding ID Token JWT");const n=We.decode((t=i.id_token)!=null?t:"");if(n.sub||s.throw(new Error("ID Token is missing a subject claim")),e){const r=We.decode(e);n.sub!==r.sub&&s.throw(new Error("sub in id_token does not match current sub")),n.auth_time&&n.auth_time!==r.auth_time&&s.throw(new Error("auth_time in id_token does not match original auth_time")),n.azp&&n.azp!==r.azp&&s.throw(new Error("azp in id_token does not match original azp")),!n.azp&&r.azp&&s.throw(new Error("azp not in id_token, but present in original id_token"))}i.profile=n}},gt=class Bt{constructor(e){this.id=e.id||re.generateUUIDv4(),this.data=e.data,e.created&&e.created>0?this.created=e.created:this.created=Le.getEpochTime(),this.request_type=e.request_type,this.url_state=e.url_state}toStorageString(){return new se("State").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,url_state:this.url_state})}static fromStorageString(e){return se.createStatic("State","fromStorageString"),Promise.resolve(new Bt(JSON.parse(e)))}static async clearStaleState(e,t){const s=se.createStatic("State","clearStaleState"),n=Le.getEpochTime()-t,r=await e.getAllKeys();s.debug("got keys",r);for(let a=0;a<r.length;a++){const o=r[a],l=await e.get(o);let c=!1;if(l)try{const d=await Bt.fromStorageString(l);s.debug("got item from key:",o,d.created),d.created<=n&&(c=!0)}catch(d){s.error("Error parsing state for key:",o,d),c=!0}else s.debug("no item in storage for key:",o),c=!0;c&&(s.debug("removed item for key:",o),e.remove(o))}}},Ms=class Nt extends gt{constructor(e){super(e),this.code_verifier=e.code_verifier,this.code_challenge=e.code_challenge,this.authority=e.authority,this.client_id=e.client_id,this.redirect_uri=e.redirect_uri,this.scope=e.scope,this.client_secret=e.client_secret,this.extraTokenParams=e.extraTokenParams,this.response_mode=e.response_mode,this.skipUserInfo=e.skipUserInfo}static async create(e){const t=e.code_verifier===!0?re.generateCodeVerifier():e.code_verifier||void 0,s=t?await re.generateCodeChallenge(t):void 0;return new Nt(_e(Q({},e),{code_verifier:t,code_challenge:s}))}toStorageString(){return new se("SigninState").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,url_state:this.url_state,code_verifier:this.code_verifier,authority:this.authority,client_id:this.client_id,redirect_uri:this.redirect_uri,scope:this.scope,client_secret:this.client_secret,extraTokenParams:this.extraTokenParams,response_mode:this.response_mode,skipUserInfo:this.skipUserInfo})}static fromStorageString(e){se.createStatic("SigninState","fromStorageString");const t=JSON.parse(e);return Nt.create(t)}},Hs=class Bs{constructor(e){this.url=e.url,this.state=e.state}static async create(N){var G=N,{url:e,authority:t,client_id:s,redirect_uri:n,response_type:r,scope:a,state_data:o,response_mode:l,request_type:c,client_secret:d,nonce:h,url_state:p,resource:g,skipUserInfo:m,extraQueryParams:v,extraTokenParams:S,disablePKCE:L,dpopJkt:A,omitScopeWhenRequesting:V}=G,C=de(G,["url","authority","client_id","redirect_uri","response_type","scope","state_data","response_mode","request_type","client_secret","nonce","url_state","resource","skipUserInfo","extraQueryParams","extraTokenParams","disablePKCE","dpopJkt","omitScopeWhenRequesting"]);if(!e)throw this._logger.error("create: No url passed"),new Error("url");if(!s)throw this._logger.error("create: No client_id passed"),new Error("client_id");if(!n)throw this._logger.error("create: No redirect_uri passed"),new Error("redirect_uri");if(!r)throw this._logger.error("create: No response_type passed"),new Error("response_type");if(!a)throw this._logger.error("create: No scope passed"),new Error("scope");if(!t)throw this._logger.error("create: No authority passed"),new Error("authority");const w=await Ms.create({data:o,request_type:c,url_state:p,code_verifier:!L,client_id:s,authority:t,redirect_uri:n,response_mode:l,client_secret:d,scope:a,extraTokenParams:S,skipUserInfo:m}),M=new URL(e);M.searchParams.append("client_id",s),M.searchParams.append("redirect_uri",n),M.searchParams.append("response_type",r),V||M.searchParams.append("scope",a),h&&M.searchParams.append("nonce",h),A&&M.searchParams.append("dpop_jkt",A);let u=w.id;p&&(u=`${u}${Oe}${p}`),M.searchParams.append("state",u),w.code_challenge&&(M.searchParams.append("code_challenge",w.code_challenge),M.searchParams.append("code_challenge_method","S256")),g&&(Array.isArray(g)?g:[g]).forEach(k=>M.searchParams.append("resource",k));for(const[f,k]of Object.entries(Q(Q({response_mode:l},C),v)))k!=null&&M.searchParams.append(f,k.toString());return new Bs({url:M.href,state:w})}};Hs._logger=new se("SigninRequest");var Vn=Hs,On="openid",vt=class{constructor(i){if(this.access_token="",this.token_type="",this.profile={},this.state=i.get("state"),this.session_state=i.get("session_state"),this.state){const e=decodeURIComponent(this.state).split(Oe);this.state=e[0],e.length>1&&(this.url_state=e.slice(1).join(Oe))}this.error=i.get("error"),this.error_description=i.get("error_description"),this.error_uri=i.get("error_uri"),this.code=i.get("code")}get expires_in(){if(this.expires_at!==void 0)return this.expires_at-Le.getEpochTime()}set expires_in(i){typeof i=="string"&&(i=Number(i)),i!==void 0&&i>=0&&(this.expires_at=Math.floor(i)+Le.getEpochTime())}get isOpenId(){var i;return((i=this.scope)==null?void 0:i.split(" ").includes(On))||!!this.id_token}},jn=class{constructor({url:i,state_data:e,id_token_hint:t,post_logout_redirect_uri:s,extraQueryParams:n,request_type:r,client_id:a,url_state:o}){if(this._logger=new se("SignoutRequest"),!i)throw this._logger.error("ctor: No url passed"),new Error("url");const l=new URL(i);if(t&&l.searchParams.append("id_token_hint",t),a&&l.searchParams.append("client_id",a),s&&(l.searchParams.append("post_logout_redirect_uri",s),e||o)){this.state=new gt({data:e,request_type:r,url_state:o});let c=this.state.id;o&&(c=`${c}${Oe}${o}`),l.searchParams.append("state",c)}for(const[c,d]of Object.entries(Q({},n)))d!=null&&l.searchParams.append(c,d.toString());this.url=l.href}},Fn=class{constructor(i){if(this.state=i.get("state"),this.state){const e=decodeURIComponent(this.state).split(Oe);this.state=e[0],e.length>1&&(this.url_state=e.slice(1).join(Oe))}this.error=i.get("error"),this.error_description=i.get("error_description"),this.error_uri=i.get("error_uri")}},Un=["nbf","jti","auth_time","nonce","acr","amr","azp","at_hash"],Gn=["sub","iss","aud","exp","iat"],qn=class{constructor(i){this._settings=i,this._logger=new se("ClaimsService")}filterProtocolClaims(i){const e=Q({},i);if(this._settings.filterProtocolClaims){let t;Array.isArray(this._settings.filterProtocolClaims)?t=this._settings.filterProtocolClaims:t=Un;for(const s of t)Gn.includes(s)||delete e[s]}return e}mergeClaims(i,e){const t=Q({},i);for(const[s,n]of Object.entries(e))if(t[s]!==n)if(Array.isArray(t[s])||Array.isArray(n))if(this._settings.mergeClaimsStrategy.array=="replace")t[s]=n;else{const r=Array.isArray(t[s])?t[s]:[t[s]];for(const a of Array.isArray(n)?n:[n])r.includes(a)||r.push(a);t[s]=r}else typeof t[s]=="object"&&typeof n=="object"?t[s]=this.mergeClaims(t[s],n):t[s]=n;return t}},Ns=class{constructor(i,e){this.keys=i,this.nonce=e}},Wn=class{constructor(i,e){this._logger=new se("OidcClient"),this.settings=i instanceof Ht?i:new Ht(i),this.metadataService=e!=null?e:new Bn(this.settings),this._claimsService=new qn(this.settings),this._validator=new Dn(this.settings,this.metadataService,this._claimsService),this._tokenClient=new Cs(this.settings,this.metadataService)}async createSigninRequest({state:i,request:e,request_uri:t,request_type:s,id_token_hint:n,login_hint:r,skipUserInfo:a,nonce:o,url_state:l,response_type:c=this.settings.response_type,scope:d=this.settings.scope,redirect_uri:h=this.settings.redirect_uri,prompt:p=this.settings.prompt,display:g=this.settings.display,max_age:m=this.settings.max_age,ui_locales:v=this.settings.ui_locales,acr_values:S=this.settings.acr_values,resource:L=this.settings.resource,response_mode:A=this.settings.response_mode,extraQueryParams:V=this.settings.extraQueryParams,extraTokenParams:C=this.settings.extraTokenParams,dpopJkt:N,omitScopeWhenRequesting:G=this.settings.omitScopeWhenRequesting}){const w=this._logger.create("createSigninRequest");if(c!=="code")throw new Error("Only the Authorization Code flow (with PKCE) is supported");const M=await this.metadataService.getAuthorizationEndpoint();w.debug("Received authorization endpoint",M);const u=await Vn.create({url:M,authority:this.settings.authority,client_id:this.settings.client_id,redirect_uri:h,response_type:c,scope:d,state_data:i,url_state:l,prompt:p,display:g,max_age:m,ui_locales:v,id_token_hint:n,login_hint:r,acr_values:S,dpopJkt:N,resource:L,request:e,request_uri:t,extraQueryParams:V,extraTokenParams:C,request_type:s,response_mode:A,client_secret:this.settings.client_secret,skipUserInfo:a,nonce:o,disablePKCE:this.settings.disablePKCE,omitScopeWhenRequesting:G});await this.clearStaleState();const f=u.state;return await this.settings.stateStore.set(f.id,f.toStorageString()),u}async readSigninResponseState(i,e=!1){const t=this._logger.create("readSigninResponseState"),s=new vt(Ct.readParams(i,this.settings.response_mode));if(!s.state)throw t.throw(new Error("No state in response")),null;const n=await this.settings.stateStore[e?"remove":"get"](s.state);if(!n)throw t.throw(new Error("No matching state found in storage")),null;return{state:await Ms.fromStorageString(n),response:s}}async processSigninResponse(i,e,t=!0){const s=this._logger.create("processSigninResponse"),{state:n,response:r}=await this.readSigninResponseState(i,t);if(s.debug("received state from storage; validating response"),this.settings.dpop&&this.settings.dpop.store){const a=await this.getDpopProof(this.settings.dpop.store);e=_e(Q({},e),{DPoP:a})}try{await this._validator.validateSigninResponse(r,n,e)}catch(a){if(a instanceof Mt&&this.settings.dpop){const o=await this.getDpopProof(this.settings.dpop.store,a.nonce);e.DPoP=o,await this._validator.validateSigninResponse(r,n,e)}else throw a}return r}async getDpopProof(i,e){let t,s;return(await i.getAllKeys()).includes(this.settings.client_id)?(s=await i.get(this.settings.client_id),s.nonce!==e&&e&&(s.nonce=e,await i.set(this.settings.client_id,s))):(t=await re.generateDPoPKeys(),s=new Ns(t,e),await i.set(this.settings.client_id,s)),await re.generateDPoPProof({url:await this.metadataService.getTokenEndpoint(!1),httpMethod:"POST",keyPair:s.keys,nonce:s.nonce})}async processResourceOwnerPasswordCredentials({username:i,password:e,skipUserInfo:t=!1,extraTokenParams:s={}}){const n=await this._tokenClient.exchangeCredentials(Q({username:i,password:e},s)),r=new vt(new URLSearchParams);return Object.assign(r,n),await this._validator.validateCredentialsResponse(r,t),r}async useRefreshToken({state:i,redirect_uri:e,resource:t,timeoutInSeconds:s,extraHeaders:n,extraTokenParams:r}){var a;const o=this._logger.create("useRefreshToken");let l;if(this.settings.refreshTokenAllowedScope===void 0)l=i.scope;else{const h=this.settings.refreshTokenAllowedScope.split(" ");l=(((a=i.scope)==null?void 0:a.split(" "))||[]).filter(g=>h.includes(g)).join(" ")}if(this.settings.dpop&&this.settings.dpop.store){const h=await this.getDpopProof(this.settings.dpop.store);n=_e(Q({},n),{DPoP:h})}let c;try{c=await this._tokenClient.exchangeRefreshToken(Q({refresh_token:i.refresh_token,scope:l,redirect_uri:e,resource:t,timeoutInSeconds:s,extraHeaders:n},r))}catch(h){if(h instanceof Mt&&this.settings.dpop)n.DPoP=await this.getDpopProof(this.settings.dpop.store,h.nonce),c=await this._tokenClient.exchangeRefreshToken(Q({refresh_token:i.refresh_token,scope:l,redirect_uri:e,resource:t,timeoutInSeconds:s,extraHeaders:n},r));else throw h}const d=new vt(new URLSearchParams);return Object.assign(d,c),o.debug("validating response",d),await this._validator.validateRefreshResponse(d,_e(Q({},i),{scope:l})),d}async createSignoutRequest({state:i,id_token_hint:e,client_id:t,request_type:s,url_state:n,post_logout_redirect_uri:r=this.settings.post_logout_redirect_uri,extraQueryParams:a=this.settings.extraQueryParams}={}){const o=this._logger.create("createSignoutRequest"),l=await this.metadataService.getEndSessionEndpoint();if(!l)throw o.throw(new Error("No end session endpoint")),null;o.debug("Received end session endpoint",l),!t&&r&&!e&&(t=this.settings.client_id);const c=new jn({url:l,id_token_hint:e,client_id:t,post_logout_redirect_uri:r,state_data:i,extraQueryParams:a,request_type:s,url_state:n});await this.clearStaleState();const d=c.state;return d&&(o.debug("Signout request has state to persist"),await this.settings.stateStore.set(d.id,d.toStorageString())),c}async readSignoutResponseState(i,e=!1){const t=this._logger.create("readSignoutResponseState"),s=new Fn(Ct.readParams(i,this.settings.response_mode));if(!s.state){if(t.debug("No state in response"),s.error)throw t.warn("Response was error:",s.error),new Me(s);return{state:void 0,response:s}}const n=await this.settings.stateStore[e?"remove":"get"](s.state);if(!n)throw t.throw(new Error("No matching state found in storage")),null;return{state:await gt.fromStorageString(n),response:s}}async processSignoutResponse(i){const e=this._logger.create("processSignoutResponse"),{state:t,response:s}=await this.readSignoutResponseState(i,!0);return t?(e.debug("Received state from storage; validating response"),this._validator.validateSignoutResponse(s,t)):e.debug("No state from storage; skipping response validation"),s}clearStaleState(){return this._logger.create("clearStaleState"),gt.clearStaleState(this.settings.stateStore,this.settings.staleStateAgeInSeconds)}async revokeToken(i,e){return this._logger.create("revokeToken"),await this._tokenClient.revoke({token:i,token_type_hint:e})}},Jn=class{constructor(i){this._userManager=i,this._logger=new se("SessionMonitor"),this._start=async e=>{const t=e.session_state;if(!t)return;const s=this._logger.create("_start");if(e.profile?(this._sub=e.profile.sub,s.debug("session_state",t,", sub",this._sub)):(this._sub=void 0,s.debug("session_state",t,", anonymous user")),this._checkSessionIFrame){this._checkSessionIFrame.start(t);return}try{const n=await this._userManager.metadataService.getCheckSessionIframe();if(n){s.debug("initializing check session iframe");const r=this._userManager.settings.client_id,a=this._userManager.settings.checkSessionIntervalInSeconds,o=this._userManager.settings.stopCheckSessionOnError,l=new Hn(this._callback,r,n,a,o);await l.load(),this._checkSessionIFrame=l,l.start(t)}else s.warn("no check session iframe found in the metadata")}catch(n){s.error("Error from getCheckSessionIframe:",n instanceof Error?n.message:n)}},this._stop=()=>{const e=this._logger.create("_stop");if(this._sub=void 0,this._checkSessionIFrame&&this._checkSessionIFrame.stop(),this._userManager.settings.monitorAnonymousSession){const t=setInterval(async()=>{clearInterval(t);try{const s=await this._userManager.querySessionStatus();if(s){const n={session_state:s.session_state,profile:s.sub?{sub:s.sub}:null};this._start(n)}}catch(s){e.error("error from querySessionStatus",s instanceof Error?s.message:s)}},1e3)}},this._callback=async()=>{const e=this._logger.create("_callback");try{const t=await this._userManager.querySessionStatus();let s=!0;t&&this._checkSessionIFrame?t.sub===this._sub?(s=!1,this._checkSessionIFrame.start(t.session_state),e.debug("same sub still logged in at OP, session state has changed, restarting check session iframe; session_state",t.session_state),await this._userManager.events._raiseUserSessionChanged()):e.debug("different subject signed into OP",t.sub):e.debug("subject no longer signed into OP"),s?this._sub?await this._userManager.events._raiseUserSignedOut():await this._userManager.events._raiseUserSignedIn():e.debug("no change in session detected, no event to raise")}catch(t){this._sub&&(e.debug("Error calling queryCurrentSigninSession; raising signed out event",t),await this._userManager.events._raiseUserSignedOut())}},i||this._logger.throw(new Error("No user manager passed")),this._userManager.events.addUserLoaded(this._start),this._userManager.events.addUserUnloaded(this._stop),this._init().catch(e=>{this._logger.error(e)})}async _init(){this._logger.create("_init");const i=await this._userManager.getUser();if(i)this._start(i);else if(this._userManager.settings.monitorAnonymousSession){const e=await this._userManager.querySessionStatus();if(e){const t={session_state:e.session_state,profile:e.sub?{sub:e.sub}:null};this._start(t)}}}},wt=class zs{constructor(e){var t;this.id_token=e.id_token,this.session_state=(t=e.session_state)!=null?t:null,this.access_token=e.access_token,this.refresh_token=e.refresh_token,this.token_type=e.token_type,this.scope=e.scope,this.profile=e.profile,this.expires_at=e.expires_at,this.state=e.userState,this.url_state=e.url_state}get expires_in(){if(this.expires_at!==void 0)return this.expires_at-Le.getEpochTime()}set expires_in(e){e!==void 0&&(this.expires_at=Math.floor(e)+Le.getEpochTime())}get expired(){const e=this.expires_in;if(e!==void 0)return e<=0}get scopes(){var e,t;return(t=(e=this.scope)==null?void 0:e.split(" "))!=null?t:[]}toStorageString(){return new se("User").create("toStorageString"),JSON.stringify({id_token:this.id_token,session_state:this.session_state,access_token:this.access_token,refresh_token:this.refresh_token,token_type:this.token_type,scope:this.scope,profile:this.profile,expires_at:this.expires_at})}static fromStorageString(e){return se.createStatic("User","fromStorageString"),new zs(JSON.parse(e))}},ls="oidc-client",Ks=class{constructor(){this._abort=new Pe("Window navigation aborted"),this._disposeHandlers=new Set,this._window=null}async navigate(i){const e=this._logger.create("navigate");if(!this._window)throw new Error("Attempted to navigate on a disposed window");e.debug("setting URL in window"),this._window.location.replace(i.url);const{url:t,keepOpen:s}=await new Promise((n,r)=>{const a=l=>{var c;const d=l.data,h=(c=i.scriptOrigin)!=null?c:window.location.origin;if(!(l.origin!==h||(d==null?void 0:d.source)!==ls)){try{const p=Ct.readParams(d.url,i.response_mode).get("state");if(p||e.warn("no state found in response url"),l.source!==this._window&&p!==i.state)return}catch(p){this._dispose(),r(new Error("Invalid response from window"))}n(d)}};window.addEventListener("message",a,!1),this._disposeHandlers.add(()=>window.removeEventListener("message",a,!1));const o=new BroadcastChannel(`oidc-client-popup-${i.state}`);o.addEventListener("message",a,!1),this._disposeHandlers.add(()=>o.close()),this._disposeHandlers.add(this._abort.addHandler(l=>{this._dispose(),r(l)}))});return e.debug("got response from window"),this._dispose(),s||this.close(),{url:t}}_dispose(){this._logger.create("_dispose");for(const i of this._disposeHandlers)i();this._disposeHandlers.clear()}static _notifyParent(i,e,t=!1,s=window.location.origin){const n={source:ls,url:e,keepOpen:t},r=new se("_notifyParent");if(i)r.debug("With parent. Using parent.postMessage."),i.postMessage(n,s);else{r.debug("No parent. Using BroadcastChannel.");const a=new URL(e).searchParams.get("state");if(!a)throw new Error("No parent and no state in URL. Can't complete notification.");const o=new BroadcastChannel(`oidc-client-popup-${a}`);o.postMessage(n),o.close()}}},$s={location:!1,toolbar:!1,height:640,closePopupWindowAfterInSeconds:-1},Rs="_blank",Xn=60,Zn=2,Ds=10,Yn=class extends Ht{constructor(i){const{popup_redirect_uri:e=i.redirect_uri,popup_post_logout_redirect_uri:t=i.post_logout_redirect_uri,popupWindowFeatures:s=$s,popupWindowTarget:n=Rs,redirectMethod:r="assign",redirectTarget:a="self",iframeNotifyParentOrigin:o=i.iframeNotifyParentOrigin,iframeScriptOrigin:l=i.iframeScriptOrigin,requestTimeoutInSeconds:c,silent_redirect_uri:d=i.redirect_uri,silentRequestTimeoutInSeconds:h,automaticSilentRenew:p=!0,validateSubOnSilentRenew:g=!0,includeIdTokenInSilentRenew:m=!1,monitorSession:v=!1,monitorAnonymousSession:S=!1,checkSessionIntervalInSeconds:L=Zn,query_status_response_type:A="code",stopCheckSessionOnError:V=!0,revokeTokenTypes:C=["access_token","refresh_token"],revokeTokensOnSignout:N=!1,includeIdTokenInSilentSignout:G=!1,accessTokenExpiringNotificationTimeInSeconds:w=Xn,userStore:M}=i;if(super(i),this.popup_redirect_uri=e,this.popup_post_logout_redirect_uri=t,this.popupWindowFeatures=s,this.popupWindowTarget=n,this.redirectMethod=r,this.redirectTarget=a,this.iframeNotifyParentOrigin=o,this.iframeScriptOrigin=l,this.silent_redirect_uri=d,this.silentRequestTimeoutInSeconds=h||c||Ds,this.automaticSilentRenew=p,this.validateSubOnSilentRenew=g,this.includeIdTokenInSilentRenew=m,this.monitorSession=v,this.monitorAnonymousSession=S,this.checkSessionIntervalInSeconds=L,this.stopCheckSessionOnError=V,this.query_status_response_type=A,this.revokeTokenTypes=C,this.revokeTokensOnSignout=N,this.includeIdTokenInSilentSignout=G,this.accessTokenExpiringNotificationTimeInSeconds=w,M)this.userStore=M;else{const u=typeof window!="undefined"?window.sessionStorage:new As;this.userStore=new Ut({store:u})}}},cs=class Vs extends Ks{constructor({silentRequestTimeoutInSeconds:e=Ds}){super(),this._logger=new se("IFrameWindow"),this._timeoutInSeconds=e,this._frame=Vs.createHiddenIframe(),this._window=this._frame.contentWindow}static createHiddenIframe(){const e=window.document.createElement("iframe");return e.style.visibility="hidden",e.style.position="fixed",e.style.left="-1000px",e.style.top="0",e.width="0",e.height="0",window.document.body.appendChild(e),e}async navigate(e){this._logger.debug("navigate: Using timeout of:",this._timeoutInSeconds);const t=setTimeout(()=>void this._abort.raise(new jt("IFrame timed out without a response")),this._timeoutInSeconds*1e3);return this._disposeHandlers.add(()=>clearTimeout(t)),await super.navigate(e)}close(){var e;this._frame&&(this._frame.parentNode&&(this._frame.addEventListener("load",t=>{var s;const n=t.target;(s=n.parentNode)==null||s.removeChild(n),this._abort.raise(new Error("IFrame removed from DOM"))},!0),(e=this._frame.contentWindow)==null||e.location.replace("about:blank")),this._frame=null),this._window=null}static notifyParent(e,t){return super._notifyParent(window.parent,e,!1,t)}},Qn=class{constructor(i){this._settings=i,this._logger=new se("IFrameNavigator")}async prepare({silentRequestTimeoutInSeconds:i=this._settings.silentRequestTimeoutInSeconds}){return new cs({silentRequestTimeoutInSeconds:i})}async callback(i){this._logger.create("callback"),cs.notifyParent(i,this._settings.iframeNotifyParentOrigin)}},er=500,tr=1e3,ds=class extends Ks{constructor({popupWindowTarget:i=Rs,popupWindowFeatures:e={},popupSignal:t,popupAbortOnClose:s}){super(),this._logger=new se("PopupWindow");const n=os.center(Q(Q({},$s),e));this._window=window.open(void 0,i,os.serialize(n)),this.abortOnClose=!!s,t&&t.addEventListener("abort",()=>{var r;this._abort.raise(new Error((r=t.reason)!=null?r:"Popup aborted"))}),e.closePopupWindowAfterInSeconds&&e.closePopupWindowAfterInSeconds>0&&setTimeout(()=>{if(!this._window||typeof this._window.closed!="boolean"||this._window.closed){this._abort.raise(new Error("Popup blocked by user"));return}this.close()},e.closePopupWindowAfterInSeconds*tr)}async navigate(i){var e;(e=this._window)==null||e.focus();const t=setInterval(()=>{(!this._window||this._window.closed)&&(this._logger.debug("Popup closed by user or isolated by redirect"),s(),this._disposeHandlers.delete(s),this.abortOnClose&&this._abort.raise(new Error("Popup closed by user")))},er),s=()=>clearInterval(t);return this._disposeHandlers.add(s),await super.navigate(i)}close(){this._window&&(this._window.closed||(this._window.close(),this._abort.raise(new Error("Popup closed")))),this._window=null}static notifyOpener(i,e){super._notifyParent(window.opener,i,e),!e&&!window.opener&&window.close()}},sr=class{constructor(i){this._settings=i,this._logger=new se("PopupNavigator")}async prepare({popupWindowFeatures:i=this._settings.popupWindowFeatures,popupWindowTarget:e=this._settings.popupWindowTarget,popupSignal:t,popupAbortOnClose:s}){return new ds({popupWindowFeatures:i,popupWindowTarget:e,popupSignal:t,popupAbortOnClose:s})}async callback(i,{keepOpen:e=!1}){this._logger.create("callback"),ds.notifyOpener(i,e)}},ir=class{constructor(i){this._settings=i,this._logger=new se("RedirectNavigator")}async prepare({redirectMethod:i=this._settings.redirectMethod,redirectTarget:e=this._settings.redirectTarget}){var t;this._logger.create("prepare");let s=window.self;e==="top"&&(s=(t=window.top)!=null?t:window.self);const n=s.location[i].bind(s.location);let r;return{navigate:async a=>(this._logger.create("navigate"),await new Promise((l,c)=>{r=c,window.addEventListener("pageshow",()=>l(window.location.href)),n(a.url)})),close:()=>{this._logger.create("close"),r==null||r(new Error("Redirect aborted")),s.stop()}}}async callback(){}},nr=class extends Mn{constructor(i){super({expiringNotificationTimeInSeconds:i.accessTokenExpiringNotificationTimeInSeconds}),this._logger=new se("UserManagerEvents"),this._userLoaded=new Pe("User loaded"),this._userUnloaded=new Pe("User unloaded"),this._silentRenewError=new Pe("Silent renew error"),this._userSignedIn=new Pe("User signed in"),this._userSignedOut=new Pe("User signed out"),this._userSessionChanged=new Pe("User session changed")}async load(i,e=!0){await super.load(i),e&&await this._userLoaded.raise(i)}async unload(){await super.unload(),await this._userUnloaded.raise()}addUserLoaded(i){return this._userLoaded.addHandler(i)}removeUserLoaded(i){return this._userLoaded.removeHandler(i)}addUserUnloaded(i){return this._userUnloaded.addHandler(i)}removeUserUnloaded(i){return this._userUnloaded.removeHandler(i)}addSilentRenewError(i){return this._silentRenewError.addHandler(i)}removeSilentRenewError(i){return this._silentRenewError.removeHandler(i)}async _raiseSilentRenewError(i){await this._silentRenewError.raise(i)}addUserSignedIn(i){return this._userSignedIn.addHandler(i)}removeUserSignedIn(i){this._userSignedIn.removeHandler(i)}async _raiseUserSignedIn(){await this._userSignedIn.raise()}addUserSignedOut(i){return this._userSignedOut.addHandler(i)}removeUserSignedOut(i){this._userSignedOut.removeHandler(i)}async _raiseUserSignedOut(){await this._userSignedOut.raise()}addUserSessionChanged(i){return this._userSessionChanged.addHandler(i)}removeUserSessionChanged(i){this._userSessionChanged.removeHandler(i)}async _raiseUserSessionChanged(){await this._userSessionChanged.raise()}},rr=class{constructor(i){this._userManager=i,this._logger=new se("SilentRenewService"),this._isStarted=!1,this._retryTimer=new Le("Retry Silent Renew"),this._tokenExpiring=async()=>{const e=this._logger.create("_tokenExpiring");try{await this._userManager.signinSilent(),e.debug("silent token renewal successful")}catch(t){if(t instanceof jt){e.warn("ErrorTimeout from signinSilent:",t,"retry in 5s"),this._retryTimer.init(5);return}e.error("Error from signinSilent:",t),await this._userManager.events._raiseSilentRenewError(t)}}}async start(){const i=this._logger.create("start");if(!this._isStarted){this._isStarted=!0,this._userManager.events.addAccessTokenExpiring(this._tokenExpiring),this._retryTimer.addHandler(this._tokenExpiring);try{await this._userManager.getUser()}catch(e){i.error("getUser error",e)}}}stop(){this._isStarted&&(this._retryTimer.cancel(),this._retryTimer.removeHandler(this._tokenExpiring),this._userManager.events.removeAccessTokenExpiring(this._tokenExpiring),this._isStarted=!1)}},ar=class{constructor(i){this.refresh_token=i.refresh_token,this.id_token=i.id_token,this.session_state=i.session_state,this.scope=i.scope,this.profile=i.profile,this.data=i.state}},or=class{constructor(i,e,t,s){this._logger=new se("UserManager"),this.settings=new Yn(i),this._client=new Wn(i),this._redirectNavigator=e!=null?e:new ir(this.settings),this._popupNavigator=t!=null?t:new sr(this.settings),this._iframeNavigator=s!=null?s:new Qn(this.settings),this._events=new nr(this.settings),this._silentRenewService=new rr(this),this.settings.automaticSilentRenew&&this.startSilentRenew(),this._sessionMonitor=null,this.settings.monitorSession&&(this._sessionMonitor=new Jn(this))}get events(){return this._events}get metadataService(){return this._client.metadataService}async getUser(i=!1){const e=this._logger.create("getUser"),t=await this._loadUser();return t?(e.info("user loaded"),await this._events.load(t,i),t):(e.info("user not found in storage"),null)}async removeUser(){const i=this._logger.create("removeUser");await this.storeUser(null),i.info("user removed from storage"),await this._events.unload()}async signinRedirect(i={}){var e;this._logger.create("signinRedirect");const a=i,{redirectMethod:t}=a,s=de(a,["redirectMethod"]);let n;(e=this.settings.dpop)!=null&&e.bind_authorization_code&&(n=await this.generateDPoPJkt(this.settings.dpop));const r=await this._redirectNavigator.prepare({redirectMethod:t});await this._signinStart(Q({request_type:"si:r",dpopJkt:n},s),r)}async signinRedirectCallback(i=window.location.href){const e=this._logger.create("signinRedirectCallback"),t=await this._signinEnd(i);return t.profile&&t.profile.sub?e.info("success, signed in subject",t.profile.sub):e.info("no subject"),t}async signinResourceOwnerCredentials({username:i,password:e,skipUserInfo:t=!1}){const s=this._logger.create("signinResourceOwnerCredential"),n=await this._client.processResourceOwnerPasswordCredentials({username:i,password:e,skipUserInfo:t,extraTokenParams:this.settings.extraTokenParams});s.debug("got signin response");const r=await this._buildUser(n);return r.profile&&r.profile.sub?s.info("success, signed in subject",r.profile.sub):s.info("no subject"),r}async signinPopup(i={}){var e;const t=this._logger.create("signinPopup");let s;(e=this.settings.dpop)!=null&&e.bind_authorization_code&&(s=await this.generateDPoPJkt(this.settings.dpop));const p=i,{popupWindowFeatures:n,popupWindowTarget:r,popupSignal:a,popupAbortOnClose:o}=p,l=de(p,["popupWindowFeatures","popupWindowTarget","popupSignal","popupAbortOnClose"]),c=this.settings.popup_redirect_uri;c||t.throw(new Error("No popup_redirect_uri configured"));const d=await this._popupNavigator.prepare({popupWindowFeatures:n,popupWindowTarget:r,popupSignal:a,popupAbortOnClose:o}),h=await this._signin(Q({request_type:"si:p",redirect_uri:c,display:"popup",dpopJkt:s},l),d);return h&&(h.profile&&h.profile.sub?t.info("success, signed in subject",h.profile.sub):t.info("no subject")),h}async signinPopupCallback(i=window.location.href,e=!1){const t=this._logger.create("signinPopupCallback");await this._popupNavigator.callback(i,{keepOpen:e}),t.info("success")}async signinSilent(i={}){var e,t;const s=this._logger.create("signinSilent"),h=i,{silentRequestTimeoutInSeconds:n}=h,r=de(h,["silentRequestTimeoutInSeconds"]);let a=await this._loadUser();if(!i.forceIframeAuth&&(a!=null&&a.refresh_token)){s.debug("using refresh token");const p=new ar(a);return await this._useRefreshToken({state:p,redirect_uri:r.redirect_uri,resource:r.resource,extraTokenParams:r.extraTokenParams,timeoutInSeconds:n})}let o;(e=this.settings.dpop)!=null&&e.bind_authorization_code&&(o=await this.generateDPoPJkt(this.settings.dpop));const l=this.settings.silent_redirect_uri;l||s.throw(new Error("No silent_redirect_uri configured"));let c;a&&this.settings.validateSubOnSilentRenew&&(s.debug("subject prior to silent renew:",a.profile.sub),c=a.profile.sub);const d=await this._iframeNavigator.prepare({silentRequestTimeoutInSeconds:n});return a=await this._signin(Q({request_type:"si:s",redirect_uri:l,prompt:"none",id_token_hint:this.settings.includeIdTokenInSilentRenew?a==null?void 0:a.id_token:void 0,dpopJkt:o},r),d,c),a&&((t=a.profile)!=null&&t.sub?s.info("success, signed in subject",a.profile.sub):s.info("no subject")),a}async _useRefreshToken(i){const e=await this._client.useRefreshToken(Q({timeoutInSeconds:this.settings.silentRequestTimeoutInSeconds},i)),t=new wt(Q(Q({},i.state),e));return await this.storeUser(t),await this._events.load(t),t}async signinSilentCallback(i=window.location.href){const e=this._logger.create("signinSilentCallback");await this._iframeNavigator.callback(i),e.info("success")}async signinCallback(i=window.location.href){const{state:e}=await this._client.readSigninResponseState(i);switch(e.request_type){case"si:r":return await this.signinRedirectCallback(i);case"si:p":await this.signinPopupCallback(i);break;case"si:s":await this.signinSilentCallback(i);break;default:throw new Error("invalid response_type in state")}}async signoutCallback(i=window.location.href,e=!1){const{state:t}=await this._client.readSignoutResponseState(i);if(t)switch(t.request_type){case"so:r":return await this.signoutRedirectCallback(i);case"so:p":await this.signoutPopupCallback(i,e);break;case"so:s":await this.signoutSilentCallback(i);break;default:throw new Error("invalid response_type in state")}}async querySessionStatus(i={}){const e=this._logger.create("querySessionStatus"),l=i,{silentRequestTimeoutInSeconds:t}=l,s=de(l,["silentRequestTimeoutInSeconds"]),n=this.settings.silent_redirect_uri;n||e.throw(new Error("No silent_redirect_uri configured"));const r=await this._loadUser(),a=await this._iframeNavigator.prepare({silentRequestTimeoutInSeconds:t}),o=await this._signinStart(Q({request_type:"si:s",redirect_uri:n,prompt:"none",id_token_hint:this.settings.includeIdTokenInSilentRenew?r==null?void 0:r.id_token:void 0,response_type:this.settings.query_status_response_type,scope:"openid",skipUserInfo:!0},s),a);try{const c={},d=await this._client.processSigninResponse(o.url,c);return e.debug("got signin response"),d.session_state&&d.profile.sub?(e.info("success for subject",d.profile.sub),{session_state:d.session_state,sub:d.profile.sub}):(e.info("success, user not authenticated"),null)}catch(c){if(this.settings.monitorAnonymousSession&&c instanceof Me)switch(c.error){case"login_required":case"consent_required":case"interaction_required":case"account_selection_required":return e.info("success for anonymous user"),{session_state:c.session_state}}throw c}}async _signin(i,e,t){const s=await this._signinStart(i,e);return await this._signinEnd(s.url,t)}async _signinStart(i,e){const t=this._logger.create("_signinStart");try{const s=await this._client.createSigninRequest(i);return t.debug("got signin request"),await e.navigate({url:s.url,state:s.state.id,response_mode:s.state.response_mode,scriptOrigin:this.settings.iframeScriptOrigin})}catch(s){throw t.debug("error after preparing navigator, closing navigator window"),e.close(),s}}async _signinEnd(i,e){const t=this._logger.create("_signinEnd"),s={},n=await this._client.processSigninResponse(i,s);return t.debug("got signin response"),await this._buildUser(n,e)}async _buildUser(i,e){const t=this._logger.create("_buildUser"),s=new wt(i);if(e){if(e!==s.profile.sub)throw t.debug("current user does not match user returned from signin. sub from signin:",s.profile.sub),new Me(_e(Q({},i),{error:"login_required"}));t.debug("current user matches user returned from signin")}return await this.storeUser(s),t.debug("user stored"),await this._events.load(s),s}async signoutRedirect(i={}){const e=this._logger.create("signoutRedirect"),r=i,{redirectMethod:t}=r,s=de(r,["redirectMethod"]),n=await this._redirectNavigator.prepare({redirectMethod:t});await this._signoutStart(Q({request_type:"so:r",post_logout_redirect_uri:this.settings.post_logout_redirect_uri},s),n),e.info("success")}async signoutRedirectCallback(i=window.location.href){const e=this._logger.create("signoutRedirectCallback"),t=await this._signoutEnd(i);return e.info("success"),t}async signoutPopup(i={}){const e=this._logger.create("signoutPopup"),l=i,{popupWindowFeatures:t,popupWindowTarget:s,popupSignal:n}=l,r=de(l,["popupWindowFeatures","popupWindowTarget","popupSignal"]),a=this.settings.popup_post_logout_redirect_uri,o=await this._popupNavigator.prepare({popupWindowFeatures:t,popupWindowTarget:s,popupSignal:n});await this._signout(Q({request_type:"so:p",post_logout_redirect_uri:a,state:a==null?void 0:{}},r),o),e.info("success")}async signoutPopupCallback(i=window.location.href,e=!1){const t=this._logger.create("signoutPopupCallback");await this._popupNavigator.callback(i,{keepOpen:e}),t.info("success")}async _signout(i,e){const t=await this._signoutStart(i,e);return await this._signoutEnd(t.url)}async _signoutStart(i={},e){var t;const s=this._logger.create("_signoutStart");try{const n=await this._loadUser();s.debug("loaded current user from storage"),this.settings.revokeTokensOnSignout&&await this._revokeInternal(n);const r=i.id_token_hint||n&&n.id_token;r&&(s.debug("setting id_token_hint in signout request"),i.id_token_hint=r),await this.removeUser(),s.debug("user removed, creating signout request");const a=await this._client.createSignoutRequest(i);return s.debug("got signout request"),await e.navigate({url:a.url,state:(t=a.state)==null?void 0:t.id,scriptOrigin:this.settings.iframeScriptOrigin})}catch(n){throw s.debug("error after preparing navigator, closing navigator window"),e.close(),n}}async _signoutEnd(i){const e=this._logger.create("_signoutEnd"),t=await this._client.processSignoutResponse(i);return e.debug("got signout response"),t}async signoutSilent(i={}){var e;const t=this._logger.create("signoutSilent"),l=i,{silentRequestTimeoutInSeconds:s}=l,n=de(l,["silentRequestTimeoutInSeconds"]),r=this.settings.includeIdTokenInSilentSignout?(e=await this._loadUser())==null?void 0:e.id_token:void 0,a=this.settings.popup_post_logout_redirect_uri,o=await this._iframeNavigator.prepare({silentRequestTimeoutInSeconds:s});await this._signout(Q({request_type:"so:s",post_logout_redirect_uri:a,id_token_hint:r},n),o),t.info("success")}async signoutSilentCallback(i=window.location.href){const e=this._logger.create("signoutSilentCallback");await this._iframeNavigator.callback(i),e.info("success")}async revokeTokens(i){const e=await this._loadUser();await this._revokeInternal(e,i)}async _revokeInternal(i,e=this.settings.revokeTokenTypes){const t=this._logger.create("_revokeInternal");if(!i)return;const s=e.filter(n=>typeof i[n]=="string");if(!s.length){t.debug("no need to revoke due to no token(s)");return}for(const n of s)await this._client.revokeToken(i[n],n),t.info(`${n} revoked successfully`),n!=="access_token"&&(i[n]=null);await this.storeUser(i),t.debug("user stored"),await this._events.load(i)}startSilentRenew(){this._logger.create("startSilentRenew"),this._silentRenewService.start()}stopSilentRenew(){this._silentRenewService.stop()}get _userStoreKey(){return`user:${this.settings.authority}:${this.settings.client_id}`}async _loadUser(){const i=this._logger.create("_loadUser"),e=await this.settings.userStore.get(this._userStoreKey);return e?(i.debug("user storageString loaded"),wt.fromStorageString(e)):(i.debug("no user storageString"),null)}async storeUser(i){const e=this._logger.create("storeUser");if(i){e.debug("storing user");const t=i.toStorageString();await this.settings.userStore.set(this._userStoreKey,t)}else this._logger.debug("removing user"),await this.settings.userStore.remove(this._userStoreKey),this.settings.dpop&&await this.settings.dpop.store.remove(this.settings.client_id)}async clearStaleState(){await this._client.clearStaleState()}async dpopProof(i,e,t,s){var n,r;const a=await((r=(n=this.settings.dpop)==null?void 0:n.store)==null?void 0:r.get(this.settings.client_id));if(a)return await re.generateDPoPProof({url:i,accessToken:e==null?void 0:e.access_token,httpMethod:t,keyPair:a.keys,nonce:s})}async generateDPoPJkt(i){let e=await i.store.get(this.settings.client_id);if(!e){const t=await re.generateDPoPKeys();e=new Ns(t),await i.store.set(this.settings.client_id,e)}return await re.generateDPoPJkt(e.keys)}};function lr(){return{issuerUrl:String("https://auth.h.thyvo.eu/application/o/schema/"),clientId:String("LedPwatI9rCJmOOfRIS6vfnmhWyifsBo5BkRWezv"),audience:void 0,scope:String("openid profile email")}}function cr(){return window.location.origin+window.location.pathname}class dr{constructor(){this.env=lr(),this.manager=this.env?new or({authority:this.env.issuerUrl,client_id:this.env.clientId,redirect_uri:cr(),response_type:"code",scope:this.env.scope,userStore:new Ut({store:window.sessionStorage}),automaticSilentRenew:!1,loadUserInfo:!0}):null}isEnabled(){return!!this.manager}async init(){var s;if(!this.manager)return;const e=new URLSearchParams(window.location.search);if(e.has("code")&&e.has("state"))try{const n=await this.manager.signinRedirectCallback(),r=(s=n==null?void 0:n.state)==null?void 0:s.returnUrl;window.history.replaceState(null,document.title,r||window.location.origin+window.location.pathname+window.location.hash)}catch(n){window.history.replaceState(null,document.title,window.location.origin+window.location.pathname+window.location.hash),console.warn("OIDC callback handling failed",n)}try{await this.manager.getUser()}catch(n){}}async login(){if(!this.manager){alert("Login is niet geconfigureerd op deze site.");return}const e=window.location.href;try{await this.manager.signinRedirect({state:{returnUrl:e}})}catch(t){console.error("signinRedirect failed",t);const s=t!=null&&t.message?String(t.message):String(t),n=s.toLowerCase().includes("failed to fetch")?" (kan CORS/HTTPS of een onbereikbare issuer zijn)":"";throw alert(`Aanmelden mislukt: ${s}${n}`),t}}async logout(){if(this.manager){try{await this.manager.removeUser()}catch(e){}alert("Uitgelogd.")}}async getUser(){if(!this.manager)return null;const e=await this.manager.getUser();return!e||e.expired?null:e}async getAccessToken(){const e=await this.getUser();return(e==null?void 0:e.access_token)||null}async getProfile(){const e=await this.getUser();if(!e)return null;const t=e.profile||{};return t.sub?{sub:String(t.sub),name:t.name?String(t.name):void 0,email:t.email?String(t.email):void 0}:null}}const ee=new dr;class hr{constructor(){this.clear()}clear(){this.saveNeeded=!1,this.fileHandle=null,this.filename=null}updateLastSaved(){var e=new Date;this.lastsaved=e.getHours().toString().padStart(2,"0")+":"+e.getMinutes().toString().padStart(2,"0")+":"+e.getSeconds().toString().padStart(2,"0"),document.getElementById("exportscreen")&&qs()}setSaveNeeded(e){this.saveNeeded,this.saveNeeded=e}async readFile(){[this.fileHandle]=await window.showOpenFilePicker({types:[{description:"Eendraadschema (.eds)",accept:{"application/eds":[".eds"]}}]});const e=await this.fileHandle.getFile(),t=await e.text();return this.filename=e.name,globalThis.structure.properties.filename=e.name,this.setSaveNeeded(!1),this.updateLastSaved(),t}async saveAs(e){const t={suggestedName:globalThis.structure.properties.filename,types:[{description:"Eendraadschema (.eds)",accept:{"application/eds":[".eds"]}}],startIn:"documents"};this.fileHandle=await window.showSaveFilePicker(t),await this.saveFile(e,this.fileHandle)}async saveFile(e,t){const s=await t.createWritable();await s.write(e),await s.close(),this.filename=t.name,globalThis.structure.properties.filename=t.name,this.setSaveNeeded(!1),this.updateLastSaved()}async save(e){await this.saveFile(e,this.fileHandle)}}globalThis.importjson=i=>{var e=i.target,t=new FileReader;t.onload=function(){globalThis.currentShareId=null,he(t.result.toString()),globalThis.structure.sitplan&&(globalThis.structure.sitplan.activePage=1)},t.readAsText(e.files[0])};globalThis.appendjson=function(i){var e=i.target,t=new FileReader;t.onload=function(){gr(t.result.toString())},t.readAsText(e.files[0])};globalThis.loadClicked=async()=>{if(window.showOpenFilePicker){let i=await globalThis.fileAPIobj.readFile();globalThis.currentShareId=null,he(i),globalThis.structure.sitplan&&(globalThis.structure.sitplan.activePage=1)}else document.getElementById("importfile").click(),document.getElementById("importfile").value=""};globalThis.importToAppendClicked=async()=>{document.getElementById("appendfile").click(),document.getElementById("appendfile").value=""};function pr(i,e){if(e==1&&i.length>0&&typeof i.data[0].keys=="undefined"&&typeof i.data[0].props!="undefined"&&(e=3),e<2)for(let t=0;t<i.length;t++)i.data[t].keys[0][2]==="Vrije tekst"&&i.data[t].keys[16][2]!="verbruiker"&&(Number(i.data[t].keys[22][2])>0?i.data[t].keys[22][2]=String(Number(i.data[t].keys[22][2])+30):i.data[t].keys[18][2]="automatisch",i.data[t].keys[16][2]!="zonder kader"&&(i.data[t].keys[16][2]="verbruiker"));if(e<3)for(let t=0;t<i.length;t++)i.data[t].keys[0][2]==="Stopcontact"&&(i.data[t].keys[0][2]="Contactdoos"),i.data[t].keys[0][2]==="Leeg"&&(i.data[t].keys[0][2]="Aansluitpunt");if(e==3)for(let t=0;t<i.length;t++)i.data[t].props.type==="Stopcontact"&&(i.data[t].props.type="Contactdoos");if(e<4)if(e<3)for(let t=0;t<i.length;t++)i.data[t].keys[0][2]==="Bord"&&i.data[t].keys[10][2]!==""&&(i.data[t].keys[10][2]="<"+i.data[t].keys[10][2]+">");else for(let t=0;t<i.length;t++)i.data[t].props.type==="Bord"&&i.data[t].props.naam!==""&&(i.data[t].props.naam="<"+i.data[t].props.naam+">");if(e>=3&&e<=4)for(let t=0;t<i.length;t++)i.data[t].props.type==="Leeg"&&(i.data[t].props.type="Aansluitpunt")}globalThis.exportjson=(i=!0)=>{function e(r){let o="";for(let l=0;l<r.length;l+=32768)o+=String.fromCharCode.apply(null,r.subarray(l,l+32768));return btoa(o)}var t;t=globalThis.structure.properties.filename;let s=globalThis.structure.toJsonObject(!0),n="";try{if(globalThis.structure.properties.disableEDSCompression==!0)throw new Error("Compression is disabled");let r=new TextEncoder,a=new Uint8Array(r.encode(s)),o=new Uint8Array(pako.deflate(a));n="EDS0040000"+e(o)}catch(r){console.log("Terugvallen naar TXT-uitvoer vanwege compressiefout: "+r),n="TXT0040000"+s}finally{window.showOpenFilePicker?(globalThis.fileAPIobj.filename==null&&i==!1&&(i=!0),i?globalThis.fileAPIobj.saveAs(n).then(()=>{globalThis.autoSaver.saveManually("TXT0040000"+s)}):globalThis.fileAPIobj.save(n).then(()=>{globalThis.autoSaver.saveManually("TXT0040000"+s)})):(Gs(n,t,"data:text/eds;charset=utf-8"),globalThis.autoSaver.saveManually("TXT0040000"+s))}globalThis.propUpload(n)};function ur(){function i(t){let n="";for(let r=0;r<t.length;r+=32768)n+=String.fromCharCode.apply(null,t.subarray(r,r+32768));return btoa(n)}const e=globalThis.structure.toJsonObject(!0);try{if(globalThis.structure.properties.disableEDSCompression==!0)throw new Error("Compression is disabled");const t=new TextEncoder,s=new Uint8Array(t.encode(e)),n=new Uint8Array(pako.deflate(s));return{schemaText:"EDS0040000"+i(n),origJson:e}}catch(t){return console.log("Terugvallen naar TXT-save vanwege compressiefout: "+t),{schemaText:"TXT0040000"+e,origJson:e}}}async function Os(i){if(!ee.isEnabled()){alert("Cloud opslaan vereist OIDC, maar OIDC is niet geconfigureerd.");return}const e=await ee.getAccessToken();if(!e){globalThis.exportjson(!!i);return}const t=window.location.href.split("#")[0],{schemaText:s,origJson:n}=ur();let r=i?null:globalThis.currentShareId||null;r||(i=!0);try{if(i){const o=await fetch("/api/shares",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e},credentials:"include",body:JSON.stringify({schema:s,baseUrl:t})});if(!o.ok){alert(`Kon niet opslaan in cloud: ${o.status} ${await o.text()}`);return}const l=await o.json();if(!(l!=null&&l.id)){alert("Kon niet opslaan in cloud (ongeldig antwoord).");return}globalThis.currentShareId=String(l.id),globalThis.autoSaver&&globalThis.autoSaver.saveManually("TXT0040000"+n),alert(`Opgeslagen in cloud. Share ID: ${l.id}`);return}const a=await fetch(`/api/shares/${encodeURIComponent(String(r))}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e},credentials:"include",body:JSON.stringify({schema:s})});if(!a.ok){alert(`Kon niet opslaan in cloud: ${a.status} ${await a.text()}`);return}globalThis.autoSaver&&globalThis.autoSaver.saveManually("TXT0040000"+n);return}catch(a){alert(`Kon niet opslaan in cloud: ${String((a==null?void 0:a.message)||a)}`)}}globalThis.saveSchema=async()=>{await Os(!1)};globalThis.saveSchemaAs=async()=>{await Os(!0)};globalThis.getShareLink=()=>{function i(n){let a="";for(let o=0;o<n.length;o+=32768)a+=String.fromCharCode.apply(null,n.subarray(o,o+32768));return btoa(a)}function e(n){return n.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}const t=window.location.href.split("#")[0],s=globalThis.structure.toJsonObject(!0);try{const n=new TextEncoder,r=new Uint8Array(n.encode(s)),a=new Uint8Array(pako.deflate(r)),o=i(a),l="EDS0040000"+e(o);return t+"#share="+l}catch(n){console.log("Terugvallen naar TXT-share vanwege compressiefout: "+n);const r="TXT0040000"+encodeURIComponent(s);return t+"#share="+r}};globalThis.copyShareLink=async()=>{function i(l){let d="";for(let h=0;h<l.length;h+=32768)d+=String.fromCharCode.apply(null,l.subarray(h,h+32768));return btoa(d)}function e(){const l=globalThis.structure.toJsonObject(!0);try{if(globalThis.structure.properties.disableEDSCompression==!0)throw new Error("Compression is disabled");const c=new TextEncoder,d=new Uint8Array(c.encode(l)),h=new Uint8Array(pako.deflate(d));return"EDS0040000"+i(h)}catch(c){return console.log("Terugvallen naar TXT-share vanwege compressiefout: "+c),"TXT0040000"+l}}const t=window.location.href.split("#")[0],s=e(),n=ee.isEnabled();let r=null,a=null;if(n){if(a=await ee.getAccessToken(),!a){confirm("Aanmelden is vereist om een deel-link aan te maken. Nu aanmelden?")&&await ee.login();return}}else{if(r=prompt("Server-wachtwoord voor delen:",""),r===null)return;if(r.trim().length===0){alert("Server-wachtwoord is verplicht om te kunnen delen.");return}}let o=null;try{const l=await fetch("/api/shares",{method:"POST",headers:Q({"Content-Type":"application/json"},a?{Authorization:"Bearer "+a}:{}),credentials:"include",body:JSON.stringify({schema:s,password:r||void 0,baseUrl:t})});if(!l.ok){const d=await l.text();throw l.status===401&&n&&alert("Niet geautoriseerd. Probeer opnieuw aan te melden."),new Error("Share API error: "+l.status+" "+d)}const c=await l.json();o=c.url||t+"#share="+c.id,c!=null&&c.id&&(globalThis.currentShareId=String(c.id))}catch(l){console.warn("Kon de share-server niet bereiken; val terug op legacy deel-link.",l),o=globalThis.getShareLink(),globalThis.currentShareId=null}try{if(navigator.clipboard&&typeof navigator.clipboard.writeText=="function"){await navigator.clipboard.writeText(o),alert("Deel-link gekopieerd naar het klembord.");return}}catch(l){}prompt("Kopieer deze deel-link:",o)};function js(i,e=null,t=0){e!=null&&e.dispose();let s=JSON.parse(i);t!=0&&pr(s,t);let n=new Es;if(typeof s.properties!="undefined"&&(typeof s.properties.filename!="undefined"&&(n.properties.filename=s.properties.filename),typeof s.properties.owner!="undefined"&&(n.properties.owner=s.properties.owner),typeof s.properties.control!="undefined"&&(n.properties.control=s.properties.control),typeof s.properties.installer!="undefined"&&(n.properties.installer=s.properties.installer),typeof s.properties.info!="undefined"&&(n.properties.info=s.properties.info),typeof s.properties.info!="undefined"&&(n.properties.dpi=s.properties.dpi),typeof s.properties.currentView!="undefined"&&(n.properties.currentView=s.properties.currentView),typeof s.properties.disableEDSCompression!="undefined"&&(n.properties.disableEDSCompression=s.properties.disableEDSCompression),typeof s.properties.legacySchakelaars!="undefined"?n.properties.legacySchakelaars=s.properties.legacySchakelaars:n.properties.legacySchakelaars=null),typeof s.print_table!="undefined"){n.print_table.setHeight(s.print_table.height),n.print_table.setMaxWidth(s.print_table.maxwidth),n.print_table.setPaperSize(s.print_table.papersize),n.print_table.setModeVertical(s.print_table.modevertical),n.print_table.setstarty(s.print_table.starty),n.print_table.setstopy(s.print_table.stopy),typeof s.print_table.enableAutopage!="undefined"?n.print_table.enableAutopage=s.print_table.enableAutopage:n.print_table.enableAutopage=!1;for(let r=0;r<s.print_table.pages.length;r++)r!=0&&n.print_table.addPage(),n.print_table.pages[r].height=s.print_table.pages[r].height,n.print_table.pages[r].start=s.print_table.pages[r].start,n.print_table.pages[r].stop=s.print_table.pages[r].stop,s.print_table.pages[r].info!=null&&(n.print_table.pages[r].info=s.print_table.pages[r].info)}typeof s.sitplanjson!="undefined"&&(n.sitplan=new Ve,n.sitplan.fromJsonObject(s.sitplanjson));for(let r=0;r<s.length;r++)t!=0&&t<3?(n.addItem(s.data[r].keys[0][2]),n.data[r].convertLegacyKeys(s.data[r].keys),n.data[r].props.autoKringNaam="manueel",n.data[r].props.autonr="manueel"):(n.addItem(s.data[r].props.type),Object.assign(n.data[r].props,s.data[r].props),s.data[r].props.type==="Kring"&&!s.data[r].props.autoKringNaam&&(n.data[r].props.autoKringNaam="manueel"),s.data[r].props.nr!==void 0&&s.data[r].props.nr!==null&&!s.data[r].props.autonr&&(n.data[r].props.autonr="manueel"),s.data[r].props.type==="Batterij"&&s.data[r].props.symbool==null&&(n.data[r].props.symbool="blokbatterij")),n.data[r].parent=s.data[r].parent,n.active[r]=s.active[r],n.id[r]=s.id[r],n.data[r].id=s.data[r].id,n.data[r].indent=s.data[r].indent,n.data[r].collapsed=s.data[r].collapsed;return n.curid=s.curid,n.voegAttributenToeAlsNodigEnReSort(),n}function Fs(i,e,t=!0){globalThis.structure=js(i,globalThis.structure,e),t==!0&&globalThis.topMenu.selectMenuItemByName("Eéndraadschema")}function Us(i){let e="",t;if(i.charCodeAt(0)==69&&i.charCodeAt(1)==68&&i.charCodeAt(2)==83){t=Number(i.substring(3,6)),isNaN(t)&&(t=1),i=atob(i.substring(10,i.length));var s=new Uint8Array(i.length);for(let r=0;r<i.length;r++)s[r-0]=i.charCodeAt(r);try{e=new TextDecoder("utf-8").decode(pako.inflate(s))}catch(r){var n=pako.inflate(s);e="";for(let a=0;a<n.length;a++)e+=String.fromCharCode(n[a])}}else i.charCodeAt(0)==84&&i.charCodeAt(1)==88&&i.charCodeAt(2)==84?(t=Number(i.substring(3,6)),isNaN(t)&&(t=3),e=i.substring(10,i.length)):(e=i,t=1);return{text:e,version:t}}function he(i,e=!0,t=!1){globalThis.autoSaver&&globalThis.autoSaver.reset();let s=Us(i);Fs(s.text,s.version,e),globalThis.undostruct.clear(),globalThis.undostruct.store();const n=document.getElementById("left_col");n!=null&&(n.scrollTop=0,n.scrollLeft=0);const r=document.getElementById("right_col");r!=null&&(r.scrollTop=0,r.scrollLeft=0),globalThis.autoSaver&&!t&&globalThis.autoSaver.saveManually(),t&&(globalThis.autoSaver.forceHasChangesSinceLastManualSave(),globalThis.structure.updateRibbon())}function gr(i,e=!0){let t=Us(i),s=js(t.text,null,t.version),n=0;for(let r=0;r<globalThis.structure.id.length;r++)globalThis.structure.id[r]>n&&(n=globalThis.structure.id[r]);for(let r=0;r<s.id.length;r++)s.id[r]+=n,s.data[r].id+=n,s.data[r].parent!=0&&(s.data[r].parent+=n);if(globalThis.structure.curid+=s.curid,globalThis.structure.length=globalThis.structure.length+s.length,globalThis.structure.active=globalThis.structure.active.concat(s.active),globalThis.structure.id=globalThis.structure.id.concat(s.id),globalThis.structure.data=globalThis.structure.data.concat(s.data),globalThis.structure.data.forEach(r=>{r.sourcelist=globalThis.structure}),globalThis.structure.print_table.enableAutopage=!0,globalThis.structure.sitplan!=null&&s.sitplan!=null){globalThis.structure.sitplanview!=null&&globalThis.structure.sitplanview.dispose(),globalThis.structure.sitplanjson=globalThis.structure.sitplan.toJsonObject(),s.sitplanjson=s.sitplan.toJsonObject();for(let r=0;r<s.sitplanjson.elements.length;r++)s.sitplanjson.elements[r].electroItemId!=null&&(s.sitplanjson.elements[r].electroItemId+=n),s.sitplanjson.elements[r].page+=globalThis.structure.sitplanjson.numPages;globalThis.structure.sitplanjson!=null&&s.sitplanjson!=null&&(globalThis.structure.sitplanjson.numPages+=s.sitplanjson.numPages,globalThis.structure.sitplanjson.elements=globalThis.structure.sitplanjson.elements.concat(s.sitplanjson.elements)),globalThis.structure.sitplan.fromJsonObject(globalThis.structure.sitplanjson),globalThis.structure.sitplanjson=null}globalThis.structure.reSort(),s=null,e&&globalThis.topMenu.selectMenuItemByName("Eéndraadschema"),globalThis.undostruct.store()}function Gs(i,e,t){var s=document.createElement("a");if(navigator.msSaveBlob)navigator.msSaveBlob(new Blob([i],{type:t}),e);else if(URL&&"download"in s){let n=URL.createObjectURL(new Blob([i],{type:t}));s.setAttribute("href",n),s.setAttribute("download",e),s.style.display="none",document.body.appendChild(s),s.click(),setTimeout(()=>document.body.removeChild(s),1e3)}else this.location.go(`${t},${encodeURIComponent(i)}`)}function qs(){var i='<span id="exportscreen"></span>';i+=`
    <table border="1px" style="border-collapse:collapse" align="center" width="100%">
      <tr>
        <td width="100%" align="center" bgcolor="LightGrey">
          <b>Openen uit bestand</b>
        </td>
      </tr>
      <tr>
        <td width="100%" align="left">
            <table border=0>
              <tr>
                <td width=350 style="vertical-align:top;padding:5px">
                  <button style="font-size:14px" onclick="loadClicked()">Openen</button>
                </td>
                <td style="vertical-align:top;padding:7px">
                  Click op "openen" en selecteer een eerder opgeslagen EDS bestand.
                </td>
              </tr>
            </table>
        </td>
      </tr>
    </table><br>`,i+=`
    <table border="1px" style="border-collapse:collapse" align="center" width="100%">
      <tr>
        <td width="100%" align="center" bgcolor="LightGrey">
          <b>Opslaan</b>
        </td>
      </tr>
      <tr>
        <td width="100%" align="left">
    `;let e=!1;globalThis.structure&&globalThis.structure.properties&&typeof globalThis.structure.properties.disableEDSCompression!="undefined"&&(e=!!globalThis.structure.properties.disableEDSCompression),window.showOpenFilePicker?(i+='<table border=0><tr><td width=350 style="vertical-align:top;padding:5px">',globalThis.fileAPIobj.filename!=null?(i+='<button style="font-size:14px" onclick="saveSchema()">Opslaan</button>&nbsp;',i+='<button style="font-size:14px" onclick="saveSchemaAs()">Opslaan als</button>&nbsp;',i+='<button style="font-size:14px" onclick="exportjson(saveAs = true)">Export</button>',i+='</td><td style="vertical-align:top;padding:5px">',i+="Laatst geopend of opgeslagen om <b>"+globalThis.fileAPIobj.lastsaved+"</b> met naam <b>"+globalThis.fileAPIobj.filename+'</b><br><br>Klik links op "Opslaan" om bij te werken'):i+='<button style="font-size:14px" onclick="saveSchemaAs()">Opslaan als</button>&nbsp;<button style="font-size:14px" onclick="exportjson(saveAs = true)">Export</button></td><td style="vertical-align:top;padding:7px"><span class="highlight-warning">Uw werk werd nog niet opgeslagen tijdens deze sessie. Klik links op "Opslaan als".</span>',i+='<br><br><label><input type="checkbox" id="saveUncompressedCheckbox" style="vertical-align:middle;margin-right:5px;" '+(e?"checked":"")+">Opslaan zonder compressie (groter bestand)</label>",i+="</td></tr>",i+="</table>"):(i+='<table border=0><tr><td width=350 style="vertical-align:top;padding:7px">',i+='Bestandsnaam: <span id="settings"><code>'+globalThis.structure.properties.filename+'</code><br><button style="font-size:14px" onclick="saveSchema()">Opslaan</button>&nbsp;<button style="font-size:14px" onclick="exportjson()">Export</button>&nbsp;<button style="font-size:14px" onclick="HL_enterSettings()">Naam wijzigen</button></span>',i+='</td><td style="vertical-align:top;padding:5px">',i+='U kan het schema opslaan op uw lokale harde schijf voor later gebruik. De standaard-naam is eendraadschema.eds. U kan deze wijzigen door links op "wijzigen" te klikken. ',i+='Klik vervolgens op "opslaan" en volg de instructies van uw browser. ',i+="In de meeste gevallen zal uw browser het bestand automatisch plaatsen in de Downloads-folder tenzij u uw browser instelde dat die eerst een locatie moet vragen.<br><br>",i+='Eens opgeslagen kan het schema later opnieuw geladen worden door in het menu "openen" te kiezen en vervolgens het bestand op uw harde schijf te selecteren.',i+='<br><br><label><input type="checkbox" id="saveUncompressedCheckbox" style="vertical-align:middle;margin-right:5px;" '+(e?"checked":"")+">Opslaan zonder compressie (groter bestand)</label>",i+="</td></tr>",i+="</table>"),i+=`
        </td>
      </tr>
    </table><br>    
    `,i+=`
        <table border="1px" style="border-collapse:collapse" align="center" width="100%">
            <tr>
                <td width="100%" align="center" bgcolor="LightGrey">
                    <b>Delen</b>
                </td>
            </tr>
            <tr>
                <td width="100%" align="left">
                        <table border=0>
                            <tr>
                                <td width=350 style="vertical-align:top;padding:5px">
                                    <button type="button" style="font-size:14px" onclick="copyShareLink()">Kopieer deel-link</button>
                                </td>
                                <td style="vertical-align:top;padding:7px">
                                    Maakt een link om dit schema te delen. Het schema wordt opgeslagen op de server zodat de link kort blijft.
                                </td>
                            </tr>
                            <tr>
                                <td width=350 style="vertical-align:top;padding:5px">
                                    <button type="button" style="font-size:14px" onclick="authLogin()">Aanmelden</button>&nbsp;
                                    <button type="button" style="font-size:14px" onclick="authLogout()">Afmelden</button>&nbsp;
                                    <button type="button" style="font-size:14px" onclick="authWhoAmI()">Wie ben ik?</button>
                                </td>
                                <td style="vertical-align:top;padding:7px">
                                    Alleen delen/beheer vereist aanmelden. Alle andere functies blijven beschikbaar zonder login.
                                </td>
                            </tr>
                            <tr>
                                <td width=350 style="vertical-align:top;padding:5px">
                                    <button type="button" style="font-size:14px" onclick="openShareManager()">Mijn shares</button>&nbsp;
                                    <button type="button" style="font-size:14px" onclick="openTeamManager()">Teams</button>
                                    &nbsp;<button type="button" style="font-size:14px" onclick="openShareTeamsScreen()">Beheer</button>
                                </td>
                                <td style="vertical-align:top;padding:7px">
                                    Bekijk je shares, maak teams en nodig mensen uit.
                                </td>
                            </tr>
                        </table>
                </td>
            </tr>
        </table><br>`,i+=`
    <table border="1px" style="border-collapse:collapse" align="center" width="100%">
      <tr>
        <td width="100%" align="center" bgcolor="LightGrey">
          <b>Samenvoegen</b>
        </td>
      </tr>
      <tr>
        <td width="100%" align="left">
            <table border=0>
              <tr>
                <td width=350 style="vertical-align:top;padding:5px">
                  <button style="font-size:14px" onclick="importToAppendClicked()">Samenvoegen (Expert!)</button>
                </td>
                <td style="vertical-align:top;padding:7px">
                  Open een tweede EDS bestand en voeg de inhoud toe aan het huidige EDS bestand.<br>
                  Voegt de ééndraadschema's samen en voegt eveneens pagina's toe aan het situatieschema als dat nodig is.<br><br>
                  <span style="color:red;font-weight:bold">Opgelet!</span> Het is aanbevolen uw werk op te slaan alvorens deze functie te gebruiken!
                </td>
              </tr>
            </table>
        </td>
      </tr>
    </table>`,document.getElementById("configsection").innerHTML=i;let t=document.getElementById("saveUncompressedCheckbox");t.onchange=function(){globalThis.structure.properties||(globalThis.structure.properties={}),globalThis.structure.properties.disableEDSCompression=t.checked},globalThis.toggleAppView("config")}class hs{constructor(e,t){this.dbName=e,this.storeName=t}async openDB(){return new Promise((e,t)=>{const s=indexedDB.open(this.dbName,1);s.onupgradeneeded=n=>{const r=n.target.result;r.objectStoreNames.contains(this.storeName)||r.createObjectStore(this.storeName,{keyPath:"key"})},s.onsuccess=()=>e(s.result),s.onerror=()=>e(null)})}async set(e,t){performance.now();try{const s=await this.openDB();return s?new Promise(n=>{const o=s.transaction(this.storeName,"readwrite").objectStore(this.storeName).put({key:e,value:t});o.onsuccess=()=>n(!0),o.onerror=()=>n(!1)}):!1}catch(s){return console.error(`Error in IndexedDBStorage.set: ${s}`),!1}}async get(e){try{const t=await this.openDB();return t?new Promise(s=>{const a=t.transaction(this.storeName,"readonly").objectStore(this.storeName).get(e);a.onsuccess=()=>{a.result?s(a.result.value):s(null)},a.onerror=()=>s(null)}):null}catch(t){return console.error("Error accessing IndexedDB:",t),null}}}const ue=class ue{constructor(e,t){this.timerId=null,this.lastSavedString=null,this.lastSavedType=ue.SavedType.NONE,this.suspendSaving=!0,this.callbackAfterSave=()=>{},this.interval=e*1e3,this.getStructure=t}hasChangesSinceLastManualSave(){return this.lastSavedType===ue.SavedType.AUTOMATIC}forceHasChangesSinceLastManualSave(){this.lastSavedType=ue.SavedType.AUTOMATIC}start(){this.stop(),this.lastSavedString=null,this.timerId=window.setInterval(()=>{this.saveAutomatically()},this.interval),this.suspendSaving=!0}stop(){this.timerId!==null&&window.clearInterval(this.timerId)}reset(e=this.interval/1e3){this.stop(),this.interval=e*1e3,this.lastSavedType=ue.SavedType.NONE,this.start()}haltSuspendingIfUserStartedDrawing(){this.getStructure().properties.currentView!="config"&&(this.suspendSaving=!1)}saveAutomatically(){if(this.haltSuspendingIfUserStartedDrawing(),this.suspendSaving)return;const e="TXT0040000"+this.getStructure().toJsonObject(!0);e!=this.lastSavedString&&(async()=>{try{await this.saveToIndexedDB("TXT0040000"+this.getStructure().toJsonObject(!0),!0),this.lastSavedString=e,this.lastSavedType=ue.SavedType.AUTOMATIC}catch(t){console.error("Error saving to IndexedDB:",t)}finally{this.callbackAfterSave&&this.callbackAfterSave()}})()}saveManually(e=null){this.suspendSaving=!1,(async()=>{try{e==null&&(e="TXT0040000"+this.getStructure().toJsonObject(!0)),await this.saveToIndexedDB(e,!1),this.lastSavedString=e,this.lastSavedType=ue.SavedType.MANUAL}catch(t){console.error("Error saving to IndexedDB:",t)}finally{this.callbackAfterSave&&this.callbackAfterSave()}})(),this.reset()}setCallbackAfterSave(e){this.callbackAfterSave=e}getSavedType(){return this.lastSavedType}async saveToIndexedDB(e,t=!1){const s=new hs("DB_EDS","Store_EDS");if(!s){console.error("Error saving to IndexedDB, kan de database niet openen.");return}let n=new Date;const r={filename:this.getStructure().properties.filename,currentTimeStamp:n.getDate().toString().padStart(2,"0")+"/"+(n.getMonth()+1).toString().padStart(2,"0")+"/"+n.getFullYear().toString()+" "+n.getHours().toString().padStart(2,"0")+":"+n.getMinutes().toString().padStart(2,"0")+":"+n.getSeconds().toString().padStart(2,"0"),recovery:t,shareId:globalThis.currentShareId||null};await Promise.all([s.set("autoSave",e),s.set("autoSaveInfo",JSON.stringify(r))])}async loadLastSaved(){const e=new hs("DB_EDS","Store_EDS");if(!e)return[null,null];try{let t;[this.lastSavedString,t]=await Promise.all([e.get("autoSave"),e.get("autoSaveInfo")]);const s=t?JSON.parse(t):null;return this.lastSavedType=s?s.recovery?ue.SavedType.AUTOMATIC:ue.SavedType.MANUAL:ue.SavedType.NONE,[this.lastSavedString,s]}catch(t){return this.lastSavedString=null,console.error("Error loading from IndexedDB:",t),this.lastSavedType=ue.SavedType.NONE,[null,null]}}};ue.SavedType={AUTOMATIC:"AUTOMATIC",MANUAL:"MANUAL",NONE:"NONE"};let zt=ue;class kt{constructor(){this.excludedTypes=["Bord","Kring","Domotica","Domotica module (verticaal)","Domotica gestuurde verbruiker","Leiding","Splitsing","Verlenging","Vrije ruimte","Meerdere verbruikers"],this.data=[],this.borden=[],this.kringTekstByNaam={},this.reCalculate()}getData(){return this.data}getBorden(){return this.borden}getUniqueKringnaam(){return Array.from(new Set(this.data.map(e=>e.kringnaam)))}getKringLabel(e){var s;const t=F((s=this.kringTekstByNaam[e])!=null?s:"");return t===""||t==="---"?e:`${e} ${t}`}getUniqueKringnaamWithLabels(){return this.getUniqueKringnaam().map(e=>({value:e,label:this.getKringLabel(e)}))}getElectroItemsByKring(e){return this.data.filter(t=>t.kringnaam===e).map(t=>({id:t.id,adres:t.adres,type:t.type}))}reCalculate(){var t,s,n,r;this.data=[];let e=[];this.borden=[],this.kringTekstByNaam={};for(let a=0;a<globalThis.structure.length;a++)if(globalThis.structure.active[a]){let o=globalThis.structure.id[a],l=globalThis.structure.data[a];if(l==null)continue;let c=l.getType();if(c!="Container"){if(c=="Kring"){const d=F((s=(t=l.props)==null?void 0:t.naam)!=null?s:""),h=F((r=(n=l.props)==null?void 0:n.tekst)!=null?r:"");d!==""&&(this.kringTekstByNaam[d]=h)}else if(!(l.getParent()instanceof ht))if(c=="Bord"){let d=l.props.naam;(d==null||F(d)=="")&&(d="Bord"),this.borden.push({id:o,naam:d})}else{let d=F(globalThis.structure.findKringName(o));if(l.isAttribuut()&&(c="Externe sturing"),c!=null&&this.excludedTypes.indexOf(c)===-1){let h=l.getReadableAdres();F(d)!==""?this.data.push({id:o,kringnaam:d,adres:h,type:c}):e.push({id:o,kringnaam:"Zonder naam",adres:h,type:c})}}}}this.data=this.data.concat(e)}}const W=i=>Number(i),ot=i=>Math.round(i*10)/10;function Ws(i){const e=String(i!=null?i:"").trim();return e!==""?e:"Onbekend"}function Js(i){const e=Number(i);return!Number.isFinite(e)||e<=0?null:e}function fr(){const i=new Map,e=s=>{const n=i.get(s);if(!n)return i.set(s,s),s;if(n===s)return s;const r=e(n);return i.set(s,r),r};return{find:e,union:(s,n)=>{const r=e(s),a=e(n);r!==a&&i.set(r,a)},parent:i}}function lt(i,e,t){var s;!Number.isFinite(t)||t<=0||(i[e]=((s=i[e])!=null?s:0)+t)}function Xs(i){for(const e of Object.keys(i)){const t=i[e];!Number.isFinite(t)||t<=0?delete i[e]:i[e]=ot(t)}return i}function Zs(i,e,t){var u,f,k,x,T,_,P,$,K;const s=Array.isArray(e)?e:[],n=s.filter(b=>{var y,I;return(b==null?void 0:b.kind)==="cableRun"&&((I=(y=b==null?void 0:b.cableRun)==null?void 0:y.kring)!=null?I:null)===t});if(n.length===0)return[];const r=b=>{var y;return Js((y=i==null?void 0:i.getMetersPerUnitForPage)==null?void 0:y.call(i,b))},a=()=>{var y;const b=W((y=i==null?void 0:i.defaults)==null?void 0:y.defaultDeviceHeightCm);return Number.isFinite(b)&&b>=0?b:30},o=b=>{var z,O,B;const y=(O=(z=i==null?void 0:i.getFloorIdForPage)==null?void 0:z.call(i,b))!=null?O:null;return y==null?null:(B=(Array.isArray(i==null?void 0:i.floors)?i.floors:[]).find(R=>(R==null?void 0:R.id)===y))!=null?B:null},l=b=>{const y=o(b),I=W(y==null?void 0:y.cablePlaneOffsetCm);return Number.isFinite(I)?I:-10},c=b=>{const y=o(b),I=W(y==null?void 0:y.elevationCm);if(!Number.isFinite(I))return null;const z=l(b);return I+z},d=b=>{var B;const y=Array.isArray((B=b==null?void 0:b.cableRun)==null?void 0:B.points)?b.cableRun.points:[];if(y.length<2)return 0;const I=W(b.posx)-W(b.sizex)/2,z=W(b.posy)-W(b.sizey)/2;let O=0;for(let R=0;R<y.length-1;R++){const U=W(y[R].x)+I,D=W(y[R].y)+z,Z=W(y[R+1].x)+I,j=W(y[R+1].y)+z,Y=Z-U,te=j-D;O+=Math.sqrt(Y*Y+te*te)}return O},h=b=>{var R;const y=Array.isArray((R=b==null?void 0:b.cableRun)==null?void 0:R.points)?b.cableRun.points:[];if(y.length<2)return{a:null,b:null};const I=W(b.posx)-W(b.sizex)/2,z=W(b.posy)-W(b.sizey)/2,O=y[0],B=y[y.length-1];return{a:{x:W(O.x)+I,y:W(O.y)+z},b:{x:W(B.x)+I,y:W(B.y)+z}}},p=s.filter(b=>{var y;return(b==null?void 0:b.kind)==="connectionPoint"&&((y=b==null?void 0:b.connectionPoint)==null?void 0:y.connectionId)!=null}),g=new Map;for(const b of p){const y=W(b.page);if(!Number.isFinite(y))continue;const I=(u=g.get(y))!=null?u:[];I.push(b),g.set(y,I)}const m=(b,y)=>{if(!y)return null;const I=g.get(b);if(!I||I.length===0)return null;const z=14,O=z*z;let B=null,R=1/0;for(const U of I){const D=W(U.posx)-y.x,Z=W(U.posy)-y.y,j=D*D+Z*Z;j<=O&&j<R&&(R=j,B=U)}return B},v=new Map;for(const b of s){if(((f=b==null?void 0:b.getElectroItemId)==null?void 0:f.call(b))==null)continue;const y=W(b.page);if(!Number.isFinite(y))continue;const I=(k=v.get(y))!=null?k:[];I.push(b),v.set(y,I)}const S=(b,y)=>{if(!y)return null;const I=v.get(b);if(!I||I.length===0)return null;const z=18,O=z*z;let B=null,R=1/0;for(const U of I){const D=W(U.posx)-y.x,Z=W(U.posy)-y.y,j=D*D+Z*Z;j<=O&&j<R&&(R=j,B=U)}return B},L=(b,y,I,z)=>{var R,U;const O=m(y,I);if(O){const D=String((U=(R=O==null?void 0:O.connectionPoint)==null?void 0:R.connectionId)!=null?U:"").trim();if(D)return{kind:"connection",key:`cid:${D}`,connectionId:D,page:y}}const B=S(y,I);if(B!=null&&B.id){const D=String(B.id);return{kind:"device",key:`dev:${D}`,deviceElementId:D,page:y}}return{kind:"free",key:`free:${b}:${z}`,page:y}},A=[],V=fr();for(const b of n){const y=W(b.page);if(!Number.isFinite(y))continue;const I=Ws((x=b==null?void 0:b.cableRun)==null?void 0:x.cableSpec),z=String((T=b==null?void 0:b.id)!=null?T:""),O=h(b),B=L(z,y,O.a,"a"),R=L(z,y,O.b,"b");V.find(B.key),V.find(R.key),V.union(B.key,R.key),A.push({el:b,page:y,spec:I,a:B,b:R})}const C=new Map;for(const b of A){const y=V.find(b.a.key),I=(_=C.get(y))!=null?_:[];I.push(b),C.set(y,I)}const N=a(),G=[];let w=1;for(const[b,y]of C.entries()){const I=Array.from(new Set(y.map(j=>{var Y,te;return String((te=(Y=j.el)==null?void 0:Y.id)!=null?te:"")}).filter(j=>j!==""))),z=new Map,O=new Map;for(const j of y)for(const Y of[j.a,j.b]){if(Y.kind!=="connection")continue;const te=(P=z.get(Y.connectionId))!=null?P:new Set;te.add(Y.page),z.set(Y.connectionId,te);const q=($=O.get(Y.connectionId))!=null?$:new Set;q.add(j.spec),O.set(Y.connectionId,q)}const B={};let R=0,U=0,D=0;for(const j of y){const Y=r(j.page);if(Y==null){R++;continue}const te=d(j.el)*Y;lt(B,j.spec,te);const q=h(j.el),ie=l(j.page),ae=[{p:q.a,att:j.a},{p:q.b,att:j.b}];for(const pe of ae){if(pe.att.kind==="connection")continue;const He=S(j.page,pe.p);if(!He){U++;continue}const Si=(He==null?void 0:He.heightCm)!=null&&Number.isFinite(W(He.heightCm))?W(He.heightCm):N,Li=Math.abs(Si-ie)/100;lt(B,j.spec,Li)}}for(const[j,Y]of z.entries()){const te=Array.from(Y).map(pe=>c(pe)).filter(pe=>pe!=null);if(te.length<2||te.length!==Y.size){D++;continue}const q=Math.max(0,(Math.max(...te)-Math.min(...te))/100),ie=(K=O.get(j))!=null?K:new Set,ae=ie.size===1?Array.from(ie)[0]:"Onbekend";lt(B,ae,q)}const Z=Array.from(z.keys()).sort((j,Y)=>j.localeCompare(Y));G.push({id:`comp_${w++}_${b.slice(0,8)}`,runIds:I,connectionIds:Z,metersBySpec:Xs(B),unknownScaleRuns:R,unknownRiserCount:D,unknownEndpointCount:U})}const M=b=>Object.values(b.metersBySpec).reduce((y,I)=>y+I,0);return G.sort((b,y)=>{const I=M(b),z=M(y);return z!==I?z-I:b.id.localeCompare(y.id)}),G}function mr(i,e,t){var A,V,C,N,G,w,M;const s=Array.isArray(e)?e:[],n=s.filter(u=>{var f,k;return(u==null?void 0:u.kind)==="cableRun"&&((k=(f=u==null?void 0:u.cableRun)==null?void 0:f.kring)!=null?k:null)===t});if(n.length===0)return[];const r=u=>{var f;return Js((f=i==null?void 0:i.getMetersPerUnitForPage)==null?void 0:f.call(i,u))},a=()=>{var f;const u=W((f=i==null?void 0:i.defaults)==null?void 0:f.defaultDeviceHeightCm);return Number.isFinite(u)&&u>=0?u:30},o=u=>{var x,T,_;const f=(T=(x=i==null?void 0:i.getFloorIdForPage)==null?void 0:x.call(i,u))!=null?T:null;return f==null?null:(_=(Array.isArray(i==null?void 0:i.floors)?i.floors:[]).find(P=>(P==null?void 0:P.id)===f))!=null?_:null},l=u=>{const f=o(u),k=W(f==null?void 0:f.cablePlaneOffsetCm);return Number.isFinite(k)?k:-10},c=u=>{var _;const f=Array.isArray((_=u==null?void 0:u.cableRun)==null?void 0:_.points)?u.cableRun.points:[];if(f.length<2)return 0;const k=W(u.posx)-W(u.sizex)/2,x=W(u.posy)-W(u.sizey)/2;let T=0;for(let P=0;P<f.length-1;P++){const $=W(f[P].x)+k,K=W(f[P].y)+x,b=W(f[P+1].x)+k,y=W(f[P+1].y)+x,I=b-$,z=y-K;T+=Math.sqrt(I*I+z*z)}return T},d=u=>{var P;const f=Array.isArray((P=u==null?void 0:u.cableRun)==null?void 0:P.points)?u.cableRun.points:[];if(f.length<2)return{a:null,b:null};const k=W(u.posx)-W(u.sizex)/2,x=W(u.posy)-W(u.sizey)/2,T=f[0],_=f[f.length-1];return{a:{x:W(T.x)+k,y:W(T.y)+x},b:{x:W(_.x)+k,y:W(_.y)+x}}},h=s.filter(u=>{var f;return(u==null?void 0:u.kind)==="connectionPoint"&&((f=u==null?void 0:u.connectionPoint)==null?void 0:f.connectionId)!=null}),p=new Map;for(const u of h){const f=W(u.page);if(!Number.isFinite(f))continue;const k=(A=p.get(f))!=null?A:[];k.push(u),p.set(f,k)}const g=(u,f)=>{if(!f)return null;const k=p.get(u);if(!k||k.length===0)return null;const x=14,T=x*x;let _=null,P=1/0;for(const $ of k){const K=W($.posx)-f.x,b=W($.posy)-f.y,y=K*K+b*b;y<=T&&y<P&&(P=y,_=$)}return _},m=new Map;for(const u of s){if(((V=u==null?void 0:u.getElectroItemId)==null?void 0:V.call(u))==null)continue;const f=W(u.page);if(!Number.isFinite(f))continue;const k=(C=m.get(f))!=null?C:[];k.push(u),m.set(f,k)}const v=(u,f)=>{if(!f)return null;const k=m.get(u);if(!k||k.length===0)return null;const x=18,T=x*x;let _=null,P=1/0;for(const $ of k){const K=W($.posx)-f.x,b=W($.posy)-f.y,y=K*K+b*b;y<=T&&y<P&&(P=y,_=$)}return _},S=a(),L=[];for(const u of n){const f=W(u.page);if(!Number.isFinite(f))continue;const k=Ws((N=u==null?void 0:u.cableRun)==null?void 0:N.cableSpec),x=String((G=u==null?void 0:u.id)!=null?G:"").trim(),T=d(u),_=r(f),P=_==null,$=new Set,K=g(f,T.a),b=g(f,T.b);for(const B of[K,b]){const R=String((M=(w=B==null?void 0:B.connectionPoint)==null?void 0:w.connectionId)!=null?M:"").trim();R&&$.add(R)}let y=null,I=0,z=0;if(P)I=null;else{y=c(u)*_;const B=l(f);for(const R of[T.a,T.b]){if(g(f,R))continue;const D=v(f,R);if(!D){z++;continue}const Z=(D==null?void 0:D.heightCm)!=null&&Number.isFinite(W(D.heightCm))?W(D.heightCm):S,j=Math.abs(Z-B)/100;Number.isFinite(j)&&j>=0&&(I=(I!=null?I:0)+j)}}const O=y!=null&&I!=null?y+I:null;L.push({runId:x||String(L.length+1),page:f,cableSpec:k,metersHorizontal:y==null?null:ot(y),metersEndpointDrops:I==null?null:ot(I),metersTotal:O==null?null:ot(O),connectionIdsTouched:Array.from($).sort((B,R)=>B.localeCompare(R)),unknownScale:P,unknownEndpointCount:z})}return L.sort((u,f)=>{var T,_;const k=(T=u.metersTotal)!=null?T:-1,x=(_=f.metersTotal)!=null?_:-1;return x!==k?x-k:u.page!==f.page?u.page-f.page:u.runId.localeCompare(f.runId)}),L}function br(i,e,t){const s=Zs(i,e,t);if(s.length===0)return{metersBySpec:{},unknownScaleRuns:0,unknownRiserCount:0,unknownEndpointCount:0};const n={};let r=0,a=0,o=0;for(const l of s){r+=l.unknownScaleRuns,a+=l.unknownRiserCount,o+=l.unknownEndpointCount;for(const[c,d]of Object.entries(l.metersBySpec))lt(n,c,d)}return{metersBySpec:Xs(n),unknownScaleRuns:r,unknownRiserCount:a,unknownEndpointCount:o}}class yr{constructor(e){this.zoeker=null,this.selectedKring=null,this.container=e}renderSymbols(){}getSelectedKring(){return this.selectedKring}render(){if(!this.container)return;if(!globalThis.structure){this.container.innerHTML="";return}this.zoeker==null?this.zoeker=new kt:this.zoeker.reCalculate();const e=globalThis.structure.sitplan,t=()=>{if(e!=null&&e.getElements&&typeof e.getElements=="function"){const w=e.getElements();return Array.isArray(w)?w:[]}return Array.isArray(e==null?void 0:e.elements)?e.elements:[]},s=t(),n=s.filter(w=>{var M;return((M=w==null?void 0:w.getElectroItemId)==null?void 0:M.call(w))==null}),r=n.length,a=n.filter(w=>(w==null?void 0:w.visible)!==!1).length,o=r===0||a===0?"hidden":a===r?"visible":"mixed",l=o==="visible"?"👁":o==="mixed"?"◐":"🚫",c=w=>{var M,u;if((w==null?void 0:w.kind)==="distanceLine"){const f=typeof w.getAdres=="function"?w.getAdres():"";return f?`Afstandslijn (${f})`:"Afstandslijn"}if((w==null?void 0:w.kind)==="connectionPoint"){const f=String((u=(M=w==null?void 0:w.connectionPoint)==null?void 0:M.connectionId)!=null?u:"").trim();return f?`Verbindingspunt (${f})`:"Verbindingspunt"}return typeof(w==null?void 0:w.svg)=="string"&&w.svg.includes("<image ")?"Achtergrond/tekening":"Niet-elektrisch element"},d=this.zoeker.getUniqueKringnaamWithLabels(),h=d.map(w=>w.value);(this.selectedKring==null||!h.includes(this.selectedKring))&&(this.selectedKring=h.length>0?h[0]:null);const p=d.map(w=>{const M=w.value.replace(/"/g,"&quot;"),u=w.value===this.selectedKring?"open":"",f=this.zoeker.getElectroItemsByKring(w.value).map(B=>B.id),k=s.filter(B=>{var R;return((R=B==null?void 0:B.getElectroItemId)==null?void 0:R.call(B))!=null&&f.includes(B.getElectroItemId())}),x=k.length,T=k.filter(B=>(B==null?void 0:B.visible)!==!1).length,_=x===0||T===0?"hidden":T===x?"visible":"mixed",P=_==="visible"?"👁":_==="mixed"?"◐":"🚫",$=x===0?"disabled":"",K=s.filter(B=>{var R,U;return(B==null?void 0:B.kind)==="cableRun"&&((U=(R=B==null?void 0:B.cableRun)==null?void 0:R.kring)!=null?U:null)===w.value}),b=K.length,y=K.filter(B=>(B==null?void 0:B.visible)!==!1).length,I=b===0||y===0?"hidden":y===b?"visible":"mixed";return`
                <details class="sitplan-sidebar-kring" data-kring="${M}" ${u}>
                    <summary class="sitplan-sidebar-kring-summary">
                        <button type="button" class="sitplan-sidebar-visbtn" data-kring-toggle="${M}" data-state="${_}" title="Zichtbaarheid kring" ${$}>${P}</button>
                        <button type="button" class="sitplan-sidebar-visbtn" data-kring-cables-toggle="${M}" data-state="${I}" title="Zichtbaarheid kabels" ${b===0?"disabled":""}>${I==="visible"?"👁":I==="mixed"?"◐":"🚫"}</button>
                        <span>${w.label}</span>
                    </summary>
                    <div class="sitplan-sidebar-cable-summary" data-kring-cable-summary="${M}"></div>
                    <div class="sitplan-sidebar-items" data-kring-items="${M}"></div>
                </details>`}).join(""),g=`
            <details class="sitplan-sidebar-kring" data-group="nonElectrical" ${r>0?"open":""}>
                <summary class="sitplan-sidebar-kring-summary">
                    <button type="button" class="sitplan-sidebar-visbtn" data-non-electrical-toggle="true" data-state="${o}" title="Zichtbaarheid niet-elektrische elementen" ${r===0?"disabled":""}>${l}</button>
                    <span>Niet-elektrisch</span>
                </summary>
                <div class="sitplan-sidebar-items" id="sitplan_sidebar_nonelectrical_items">
                    ${n.map(w=>{const M=c(w),u=(w==null?void 0:w.visible)!==!1?"visible":"hidden",f=u==="visible"?"👁":"🚫";return`<div class="sitplan-sidebar-itemrow">
                            <button type="button" class="sitplan-sidebar-visbtn" data-non-electrical-id="${w.id}" data-state="${u}" title="Zichtbaarheid" >${f}</button>
                            <div class="sitplan-sidebar-item" style="cursor: default;">
                                <span>${M}</span>
                                <span class="sitplan-sidebar-count"></span>
                            </div>
                        </div>`}).join("")}
                </div>
            </details>`;this.container.innerHTML=`
            <div class="sitplan-sidebar-titlebar">
                <div class="sitplan-sidebar-title">Snelle toevoeging</div>
                <div class="sitplan-sidebar-actions">
                    <button type="button" class="sitplan-sidebar-actionbtn" data-action="hideAll" title="Verberg alles">🙈</button>
                    <button type="button" class="sitplan-sidebar-actionbtn" data-action="showAll" title="Toon alles">👁</button>
                </div>
            </div>
            <div class="sitplan-sidebar-tree" id="sitplan_sidebar_tree">${p}${g}</div>
        `;const m=this.container.querySelector("#sitplan_sidebar_tree");if(!m)return;const v=(w,M)=>{var U;const u=t();if(u.filter(D=>{var Z,j;return(D==null?void 0:D.kind)==="cableRun"&&((j=(Z=D==null?void 0:D.cableRun)==null?void 0:Z.kring)!=null?j:null)===w}).length===0){M.innerHTML="";return}const k=globalThis.structure.sitplan,x=Zs(k,u,w),T=x.length,_={};let P=0,$=0,K=0;for(const D of x){P+=D.unknownScaleRuns,$+=D.unknownRiserCount,K+=D.unknownEndpointCount;for(const[Z,j]of Object.entries(D.metersBySpec))_[Z]=((U=_[Z])!=null?U:0)+j}const b=Object.values(_).reduce((D,Z)=>D+Z,0),y=Number.isFinite(b)?`${Math.round(b*10)/10} m`:"—",I=[];P>0&&I.push(`schaal ontbreekt voor ${P} run(s)`),$>0&&I.push(`hoogte ontbreekt voor ${$} stijgleiding(en)`),K>0&&I.push(`verticale aansluiting onbekend voor ${K} eindpunt(en)`);const z=I.length>0?` (${I.join(", ")})`:"",O=T>1?` • ${T} groepen`:"",B=Object.keys(_).sort((D,Z)=>D.localeCompare(Z)).map(D=>{const Z=_[D],j=Number.isFinite(Z)?`${Math.round(Z*10)/10} m`:"—";return`<div class="sitplan-sidebar-cable-line"><span>${D}</span><span class="sitplan-sidebar-count">${j}</span></div>`}).join("");M.innerHTML=`
                <div class="sitplan-sidebar-cable-header">
                    <span>Kabels${O}</span>
                    <span class="sitplan-sidebar-count">${y}${z}</span>
                </div>
                ${B}
            `;const R=mr(k,u,w);if(R.length>0){const D=R.map((Z,j)=>{const Y=Z.metersTotal==null?"—":`${Math.round(Z.metersTotal*10)/10} m`,te=Z.connectionIdsTouched.length>0?` ↕ ${Z.connectionIdsTouched.join(", ")}`:"",q=Z.unknownScale?" (schaal?)":Z.unknownEndpointCount>0?" (endpoint?)":"";return`<div class="sitplan-sidebar-cable-line"><span>${`Run ${j+1} • p${Z.page} • ${Z.cableSpec}${te}${q}`}</span><span class="sitplan-sidebar-count">${Y}</span></div>`}).join("");M.innerHTML+=D}},S=(w,M,u)=>{if(!this.zoeker)return;u&&v(w,u);const f=this.zoeker.getElectroItemsByKring(w),k=t();M.innerHTML=f.map(_=>{var Z,j;const P=_.adres&&_.adres.trim()!==""?`${_.adres} | ${_.type}`:_.type,$=k.filter(Y=>{var te;return((te=Y==null?void 0:Y.getElectroItemId)==null?void 0:te.call(Y))===_.id}),K=$.length,b=$.filter(Y=>(Y==null?void 0:Y.visible)!==!1).length,y=K===0||b===0?"hidden":b===K?"visible":"mixed",I=y==="visible"?"👁":y==="mixed"?"◐":"🚫",z=K===0?"disabled":"",O=(j=(Z=globalThis.structure).getElectroItemById)==null?void 0:j.call(Z,_.id),B=O&&typeof O.maxSituationPlanElements=="function"?Number(O.maxSituationPlanElements()):0,R=Number.isFinite(B)&&B>0,U=R&&K>=B,D=R?`${K}/${B}`:`${K}`;return`<div class="sitplan-sidebar-itemrow">
                    <button type="button" class="sitplan-sidebar-visbtn" data-electro-visible="${_.id}" data-state="${y}" title="Zichtbaarheid symbool" ${z}>${I}</button>
                    <button type="button" class="sitplan-sidebar-item" data-electro-id="${_.id}" ${U?"disabled":""}>
                        <span>${P}</span>
                        <span class="sitplan-sidebar-count">${D}</span>
                    </button>
                </div>`}).join(""),M.querySelectorAll("button[data-electro-id]").forEach(_=>{_.addEventListener("click",()=>{var B,R,U,D,Z,j,Y,te;if(_.disabled)return;const P=_.getAttribute("data-electro-id"),$=P?Number(P):NaN;if(!Number.isFinite($))return;const K=globalThis.structure.sitplanview;if(!K)return;const b=K.getVisibleCenterPaperPos?K.getVisibleCenterPaperPos():K.canvasPosToPaperPos(((B=K.canvas)==null?void 0:B.clientWidth)/2,((R=K.canvas)==null?void 0:R.clientHeight)/2),y=globalThis.structure.sitplan,I=(D=(U=y==null?void 0:y.defaults)==null?void 0:U.fontsize)!=null?D:11,z=(j=(Z=y==null?void 0:y.defaults)==null?void 0:Z.scale)!=null?j:globalThis.SITPLANVIEW_DEFAULT_SCALE,O=(te=(Y=y==null?void 0:y.defaults)==null?void 0:Y.rotate)!=null?te:0;K.addElectroItem($,"auto","","rechts",I,z,O,b==null?void 0:b.x,b==null?void 0:b.y)})}),M.querySelectorAll("button[data-electro-visible]").forEach(_=>{_.addEventListener("click",P=>{if(P.stopPropagation(),_.disabled)return;const $=Number(_.getAttribute("data-electro-visible"));if(!Number.isFinite($))return;const K=globalThis.structure.sitplanview;if(!K)return;const b=t().filter(O=>{var B;return((B=O==null?void 0:O.getElectroItemId)==null?void 0:B.call(O))===$}),y=b.length,I=b.filter(O=>(O==null?void 0:O.visible)!==!1).length,z=!(y>0&&I===y);for(let O of b)O.visible=z;K.redraw(),globalThis.undostruct.store(),this.render()})})};Array.from(m.querySelectorAll("details[data-kring]")).forEach(w=>{var x,T;const M=(T=(x=w.getAttribute("data-kring"))==null?void 0:x.replace(/&quot;/g,'"'))!=null?T:"",u=w.querySelector("div[data-kring-items]"),f=w.querySelector("div[data-kring-cable-summary]");if(!u)return;const k=()=>{w.open?(this.selectedKring=M,S(M,u,f)):(u.innerHTML="",f&&(f.innerHTML=""))};w.addEventListener("toggle",k),w.open&&k()}),m.querySelectorAll("button[data-kring-toggle]").forEach(w=>{w.addEventListener("click",M=>{var $,K;if(M.stopPropagation(),w.disabled)return;const u=(K=($=w.getAttribute("data-kring-toggle"))==null?void 0:$.replace(/&quot;/g,'"'))!=null?K:"";if(!u)return;const f=globalThis.structure.sitplanview;if(!f)return;const k=this.zoeker.getElectroItemsByKring(u).map(b=>b.id),x=t().filter(b=>{var y;return((y=b==null?void 0:b.getElectroItemId)==null?void 0:y.call(b))!=null&&k.includes(b.getElectroItemId())}),T=x.length,_=x.filter(b=>(b==null?void 0:b.visible)!==!1).length,P=!(T>0&&_===T);for(const b of x)b.visible=P;f.redraw(),globalThis.undostruct.store(),this.render()})}),m.querySelectorAll("button[data-kring-cables-toggle]").forEach(w=>{w.addEventListener("click",M=>{var P,$;if(M.stopPropagation(),w.disabled)return;const u=($=(P=w.getAttribute("data-kring-cables-toggle"))==null?void 0:P.replace(/&quot;/g,'"'))!=null?$:"";if(!u)return;const f=globalThis.structure.sitplanview;if(!f)return;const k=t().filter(K=>{var b,y;return(K==null?void 0:K.kind)==="cableRun"&&((y=(b=K==null?void 0:K.cableRun)==null?void 0:b.kring)!=null?y:null)===u}),x=k.length,T=k.filter(K=>(K==null?void 0:K.visible)!==!1).length,_=!(x>0&&T===x);for(const K of k)K.visible=_;f.redraw(),globalThis.undostruct.store(),this.render()})});const C=m.querySelector("button[data-non-electrical-toggle]");C&&C.addEventListener("click",w=>{if(w.stopPropagation(),C.disabled)return;const M=globalThis.structure.sitplanview;if(!M)return;const u=t().filter(T=>{var _;return((_=T==null?void 0:T.getElectroItemId)==null?void 0:_.call(T))==null}),f=u.length,k=u.filter(T=>(T==null?void 0:T.visible)!==!1).length,x=!(f>0&&k===f);for(const T of u)T.visible=x;M.redraw(),globalThis.undostruct.store(),this.render()}),m.querySelectorAll("button[data-non-electrical-id]").forEach(w=>{w.addEventListener("click",M=>{M.stopPropagation();const u=w.getAttribute("data-non-electrical-id");if(!u)return;const f=globalThis.structure.sitplanview;if(!f)return;const k=t().find(x=>String(x==null?void 0:x.id)===String(u));k&&(k.visible=(k==null?void 0:k.visible)===!1,f.redraw(),globalThis.undostruct.store(),this.render())})}),this.container.querySelectorAll("button[data-action]").forEach(w=>{w.addEventListener("click",()=>{const M=w.getAttribute("data-action"),u=globalThis.structure.sitplanview;if(!u)return;const f=t();if(M==="hideAll")for(const k of f)k.visible=!1;else if(M==="showAll")for(const k of f)k.visible=!0;else return;u.redraw(),globalThis.undostruct.store(),this.render()})})}}class kr{constructor(){this.data=[]}clear(){this.data=[]}selectOne(e){this.clear(),this.data.push(e)}select(e){if(this.data.includes(e)){this.data.indexOf(e)!=this.data.length-1&&(this.data.splice(this.data.indexOf(e),1),this.data.push(e));return}else this.data.push(e)}toggleButNeverRemoveLast(e){this.data.includes(e)?this.data.length!=1&&this.data.splice(this.data.indexOf(e),1):this.data.push(e)}getLastSelected(){return this.data.length==0?null:this.data[this.data.length-1]}getAllSelected(){return this.data}length(){return this.data.length}includes(e){return this.data.includes(e)}}class Gt{constructor(){this.listeners=[]}addEventListener(e,t,s){const n=this.listeners.findIndex(r=>r.element===e&&r.type===t);if(n!==-1){const r=this.listeners[n];e.removeEventListener(t,r.listener),this.listeners.splice(n,1)}this.listeners.push({element:e,type:t,listener:s}),e.addEventListener(t,s),this.cleanup()}removeAllEventListeners(){this.listeners.forEach(({element:e,type:t,listener:s})=>{e.removeEventListener(t,s)}),this.listeners=[]}dispose(){this.removeAllEventListeners()}cleanup(){this.listeners=this.listeners.filter(({element:e,type:t,listener:s})=>document.contains(e)?!0:(e.removeEventListener(t,s),!1))}}class ps{static showItemTypeSelectionPopup(e){function t(){a.style.visibility="visible",document.body.style.pointerEvents="none",a.style.pointerEvents="auto"}function s(){m.dispose(),a.style.visibility="hidden",document.body.style.pointerEvents="auto",r.remove()}const n=S=>{S.key==="Enter"&&(S.preventDefault(),S.stopPropagation(),p.click())},r=document.createElement("div");r.innerHTML=`
            <div id="popupOverlay" class="popup-overlay">
                <div id="popupWindow" class="popup">
                    <h3>Los symbool (niet in ééndraadschema)</h3>
                    <div style="position: absolute; top: 5px; right: 5px; display: flex; align-items: center; justify-content: center;">
                        <button id="closeButton" style="background-color: #e00; border-radius: 4px; width: 20px; height: 20px; font-size: 16px; color: white; border: none; outline: none; cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 0px; vertical-align: middle;">&#10006;</button>
                    </div>
                    <div style="display: flex; margin-bottom: 20px; align-items: center;">
                        <label for="itemTypeSelect" style="margin-right: 10px; display: inline-block;">Type:</label>
                        <select id="itemTypeSelect" style="width: 200px;">
                            <option value="Aardingsonderbreker">Aardingsonderbreker</option>
                            <option value="Elektriciteitsmeter">Elektriciteitsmeter</option>
                        </select>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 20px;">
                        <i>Dit is een nieuwe functionaliteit om elementen in het situatieschema te
                           tekenen die niet voorkomen in het ééndraadschema.
                           Op dit moment ondersteunt deze functionaliteit slechts een beperkt
                           aantal symbolen. Dit zal verder uitgebreid worden naar de toekomst toe.</i>
                    </div>
                    <div style="display: flex; margin-bottom: 10px; align-items: center;">
                        <label for="scaleInput" style="margin-right: 10px; display: inline-block;">Schaal (%):</label>
                        <input id="scaleInput" style="width: 100px;" type="number" min="10" max="400" step="10" value="${String(globalThis.SITPLANVIEW_DEFAULT_SCALE*100)}">
                    </div>
                    <div style="display: flex; margin-bottom: 20px; align-items: center;">
                        <label for="rotationInput" style="margin-right: 10px; display: inline-block;">Rotatie (°):</label>
                        <input id="rotationInput" style="width: 100px;" type="number" min="0" max="360" step="10" value="0">
                    </div>
                    <div id="setDefaultContainer" style="display: flex; margin-bottom: 20px; align-items: flex-start;">
                        <input type="checkbox" id="setDefaultCheckbox">
                        <label for="setDefaultCheckbox" style="margin-left: 10px; flex-grow: 1; flex-wrap: wrap;">Zet schaal als standaard voor alle toekomstige nieuwe symbolen.</label>
                    </div>
                    <div style="display: flex; justify-content: center; gap: 0px;">
                        <button id="okButton" class="rounded-button">OK</button>
                        <button id="cancelButton" class="rounded-button">Cancel</button>
                    </div>
                </div>
            </div>`;const a=r.querySelector("#popupOverlay"),o=r.querySelector("#closeButton"),l=r.querySelector("#itemTypeSelect"),c=r.querySelector("#scaleInput"),d=r.querySelector("#rotationInput"),h=r.querySelector("#setDefaultCheckbox"),p=r.querySelector("#okButton"),g=r.querySelector("#cancelButton");c.value=Ce(globalThis.structure.sitplan.defaults.scale*100,6),d.value=Ce(0);let m=new Gt;m.addEventListener(document,"keydown",S=>{S.key==="Enter"?n(S):S.key==="Escape"&&(S.preventDefault(),S.stopPropagation(),g.click())}),p.addEventListener("click",()=>{function S(A){return/^-?\d+(\.\d+)?$/.test(A)}(!S(c.value)||Number(c.value)<=0)&&(c.value=String(globalThis.structure.sitplan.defaults.scale*100)),S(d.value)||(d.value=String(0)),h.checked&&(globalThis.structure.sitplan.defaults.scale=Number(c.value)/100);const L=l.value;s(),e(L,Number(c.value)/100,Number(d.value))});const v=()=>{s()};g.addEventListener("click",v),o.addEventListener("click",v),document.body.appendChild(r),t()}}class Ys{constructor(e=document.body){this.menuItems=[],this.menuElement=null,this.menuElement=document.createElement("div"),this.menuElement.className="context-menu",e.appendChild(this.menuElement)}clearMenu(){this.menuItems=[],this.menuElement&&(this.menuElement.innerHTML="")}addMenuItem(e,t,s,n){var r,a;this.menuItems.push({label:e,shortcut:s,callback:t,disabled:(r=n==null?void 0:n.disabled)!=null?r:!1,hint:(a=n==null?void 0:n.hint)!=null?a:!1})}addLine(){this.menuItems.push({label:"separator",callback:()=>{}})}renderMenu(){this.menuElement&&(this.menuElement.innerHTML="",this.menuItems.forEach((e,t)=>{if(e.label==="separator"){const s=document.createElement("hr");s.className="context-menu-separator",this.menuElement.appendChild(s)}else{const s=document.createElement("div");s.className="context-menu-item",(e.disabled||e.callback==null)&&s.classList.add("context-menu-item-disabled"),e.hint&&s.classList.add("context-menu-item-hint");const n=document.createElement("span");n.textContent=e.label;const r=document.createElement("span");r.textContent=e.shortcut||"",r.className="context-menu-shortcut",s.appendChild(n),s.appendChild(r),e.disabled||e.callback==null||s.addEventListener("click",()=>{var a;(a=e.callback)==null||a.call(e),this.hide()}),this.menuElement.appendChild(s)}}))}show(e){if(this.menuElement){this.renderMenu(),this.menuElement.style.display="block";const{clientX:t,clientY:s}=e,{innerWidth:n,innerHeight:r}=window,{offsetWidth:a,offsetHeight:o}=this.menuElement;let l=t,c=s;l+a>n&&(l=n-a),c+o>r&&(c=r-o),this.menuElement.style.left=`${l}px`,this.menuElement.style.top=`${c}px`}}hide(){this.menuElement&&(this.menuElement.style.display="none")}}class xr{constructor(){this.startOffsetLeft=0,this.startOffsetTop=0,this.startPaperPos={x:0,y:0},this.hassMoved=!1}startDrag(e=0,t=0,s=0,n=0){this.startOffsetLeft=s,this.startOffsetTop=n,this.hassMoved=!1;const r=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--menu-height")),a=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--ribbon-height")),o=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--sideBarWidth"));this.startPaperPos=globalThis.structure.sitplanview.canvasPosToPaperPos(e-o,t-r-a)}returnNewPaperPos(e=0,t=0){const s=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--menu-height")),n=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--ribbon-height")),r=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--sideBarWidth"));let a=globalThis.structure.sitplanview.canvasPosToPaperPos(e-r,t-s-n);return(a.x!=this.startPaperPos.x||a.y!=this.startPaperPos.y)&&(this.hassMoved=!0),{x:a.x-this.startPaperPos.x+this.startOffsetLeft,y:a.y-this.startPaperPos.y+this.startOffsetTop}}}class ze{constructor(e,t="helpertip"){this.storage=e,this.storagePrefix=t}show(e,t,s=!1,n=()=>{}){const r=`${this.storagePrefix}.${e}.neverDisplay`,a=`${this.storagePrefix}.${e}.displayedInThisSession`;if(this.storage.get(r)===!0||this.storage.get(a)===!0){n&&n();return}const o=document.createElement("div");o.id="popupOverlay",o.classList.add("popup-overlay");const l=document.createElement("div");l.id="popup",l.classList.add("popup"),l.innerHTML=t;const c=document.createElement("label");c.style.display="block",c.style.marginTop="10px";const d=document.createElement("input");d.type="checkbox",d.checked=s,c.appendChild(d);const h=document.createTextNode(" Deze tekst nooit meer weergeven in deze browser."),p=document.createElement("i");p.appendChild(h),c.appendChild(p),l.appendChild(c);const g=document.createElement("div");g.style.display="flex",g.style.justifyContent="center",g.style.gap="0px";const m=document.createElement("button");m.textContent="OK",m.classList.add("rounded-button"),m.addEventListener("click",v=>{v.stopPropagation(),this.storage.set(a,!0,!0),d.checked&&this.storage.set(r,!0),document.body.removeChild(o),document.body.style.pointerEvents="auto",n&&n()}),g.appendChild(m),l.appendChild(g),o.appendChild(l),document.body.appendChild(o),o.style.visibility="visible",document.body.style.pointerEvents="none",o.style.pointerEvents="auto"}}class Ze{constructor(e,t,s=null){this.title=e,this.body=t,s?this.buttons=s:this.buttons=[{text:"OK",callback:()=>{}}]}show(){const e=document.createElement("div");e.id="popupOverlay",e.classList.add("popup-overlay");const t=document.createElement("div");t.id="popup",t.classList.add("popup"),t.innerHTML=`<h3>${this.title}</h3><p>${this.body}</p>`;const s=document.createElement("div");s.style.display="flex",s.style.justifyContent="center",s.style.gap="0px";for(const n of this.buttons){const r=document.createElement("button");r.textContent=n.text,r.classList.add("rounded-button"),r.addEventListener("click",(()=>{n.callback(),document.body.removeChild(e),document.body.style.pointerEvents="auto"}).bind(this)),s.appendChild(r)}t.appendChild(s),e.appendChild(t),document.body.appendChild(e),e.style.visibility="visible",document.body.style.pointerEvents="none",e.style.pointerEvents="auto"}}function _t(i,e,t=()=>{},s={}){let n=new kt,r=n.getUniqueKringnaam();function a(){f.innerHTML="";for(let q of r){const ie=document.createElement("option");ie.value=q,ie.text=q,f.appendChild(ie)}}function o(q=null){a(),q==null&&i!=null&&i.getElectroItemId()!=null&&(q=i.getElectroItemId()),q!=null&&(f.value=globalThis.structure.findKringName(q)),f.onchange=l}function l(){c(),h()}function c(){let q=n.getElectroItemsByKring(f.value);x.innerHTML="";for(let ie=0;ie<q.length;++ie){const ae=q[ie],pe=document.createElement("option");pe.value=String(ie),pe.text=(F(ae.adres)!==""?E(ae.adres)+" | ":"")+ae.type,x.appendChild(pe)}}function d(q=null){c();let ie=n.getElectroItemsByKring(f.value);if(q==null&&i!=null&&i.getElectroItemId()!=null&&(q=i.getElectroItemId()),q!=0)for(let ae=0;ae<ie.length;++ae)ie[ae].id==q&&(x.value=String(ae));x.onchange=h}function h(){p(),b.value="auto",L()}function p(){let q="",ie=n.getElectroItemsByKring(f.value),ae=Number(x.value);isNaN(ae)||ie[ae]!=null&&(q=ie[ae].id.toString()),P.value=q}function g(){i!=null?i.getElectroItemId()!=null&&(P.value=String(i.getElectroItemId())):p(),P.oninput=m}function m(){if(P.value!=null){P.value=P.value.replace(/[^0-9]/g,"");let q=Number(P.value);S(),globalThis.structure.getElectroItemById(q)!=null&&(o(q),d(q),b.value="auto",L())}}function v(q=null){if(q==null)return;let ie=globalThis.structure.getElectroItemById(q);ie!=null&&(ie.expand(),n.reCalculate(),r=n.getUniqueKringnaam(),m(),globalThis.structure.sitplanview.redraw())}function S(){if(P.value==null||F(P.value)=="")$.innerHTML='<span style="color: red;">Geen ID ingegeven</span>',T.style.display="none";else{let q=Number(P.value),ie=globalThis.structure.getElectroItemById(q);ie!=null?($.innerHTML='<span style="color:green;">'+ie.getType()+"</span>",ie.isExpandable()?(T.style.display="block",$.innerHTML+='<br><span style="color: black;">Klik op uitpakken indien u de onderliggende elementen in het situatieschema wil kunnen plaatsen.</span>',T.onclick=()=>{v(q)}):T.style.display="none"):($.innerHTML='<span style="color: red;">Element niet gevonden</span>',T.style.display="none")}}function L(){let q=Number(P.value);S();let ie=globalThis.structure.getElectroItemById(q);if(ie==null){I.value="",I.readOnly=!0;return}switch(b.value){case"manueel":I.value=ie!=null?I.value:"",I.readOnly=!1;break;case"auto":default:I.value=ie!=null?ie.getReadableAdres():"",I.readOnly=!0;break}}function A(){G.style.visibility="visible",document.body.style.pointerEvents="none",G.style.pointerEvents="auto"}function V(){te.dispose(),G.style.visibility="hidden",document.body.style.pointerEvents="auto",N.remove()}const C=q=>{q.key==="Enter"&&(q.preventDefault(),q.stopPropagation(),j.click())};s.toonTekenGrootteStandaardVoorNieuweObjecten==null&&(i==null?s.toonTekenGrootteStandaardVoorNieuweObjecten=!0:s.toonTekenGrootteStandaardVoorNieuweObjecten=i.getElectroItemId()!=null);const N=document.createElement("div");N.innerHTML=`
        <div id="popupOverlay" class="popup-overlay">
            <div id="popupWindow" class="popup">
                <h3>Element toevoegen/bewerken</h3>
                <div style="position: absolute; top: 5px; right: 5px; display: flex; align-items: center; justify-content: center;">
                    <button id="closeButton" style="background-color: #e00; border-radius: 4px; width: 20px; height: 20px; font-size: 16px; color: white; border: none; outline: none; cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 0px; vertical-align: middle;">&#10006;</button>
                </div>
                <div id="selectKringContainer" style="display: flex; margin-bottom: 10px; align-items: center;">
                    <label for="selectKring" style="margin-right: 10px; display: inline-block;">Kring:</label>
                    <select id="selectKring"></select>
                </div>
                <div id="selectElectroItemContainer" style="display: flex; margin-bottom: 10px; align-items: center;">
                    <label for="selectElectroItemBox" style="margin-right: 10px; display: inline-block;">Element:</label>
                    <select id="selectElectroItemBox"></select><span style="display: inline-block; width: 10px;"></span>
                    <button id="expandButton" title="Omzetten in indivuele elementen" style="background-color:lightblue;">Uitpakken</button>
                </div>
                <div id="electroItemIdContainer" style="display: flex; margin-bottom: 30px; align-items: center;">
                    <label for="electroItemIdInput" style="margin-right: 10px; display: inline-block;">ID:</label>
                    <input id="electroItemIdInput" style="width: 100px;" type="number" min="0" step="1" value="">
                    <div id="electroItemType" style="margin-left: 10px; width: 100%; font-size: 12px"></div>
                </div>
                <div id="selectContainer" style="display: flex; margin-bottom: 10px; align-items: center;">
                    <label for="selectAdresType" style="margin-right: 10px; display: inline-block; white-space: nowrap;">Label type:</label>
                    <select id="selectAdresType">
                        <option value="auto">Automatisch</option>
                        <option value="manueel">Handmatig</option>
                    </select>
                </div>
                <div id="adresContainer" style="display: flex; margin-bottom: 10px; align-items: center;">
                    <label for="adresInput" style="margin-right: 10px; display: inline-block; white-space: nowrap;">Label tekst:</label>
                    <input id="adresInput" style="width: 100%;" type="text" value="">
                    <select id="selectAdresLocation" style="margin-left: 10px; display: inline-block;">
                        <option value="links">Links</option>
                        <option value="rechts">Rechts</option>
                        <option value="boven">Boven</option>
                        <option value="onder">Onder</option>
                    </select>
                </div>
                <div id="fontSizeContainer" style="display: flex; margin-bottom: 30px; align-items: center;">
                    <label for="fontSizeInput" style="margin-right: 10px; display: inline-block; white-space: nowrap;">Tekengrootte (px):</label>
                    <input id="fontSizeInput" style="width: 100px;" type="number" min="1" max="72" step="11" value="11">
                </div> 
                <div style="display: flex; margin-bottom: 10px; align-items: center;">
                    <label for="scaleInput" style="margin-right: 10px; display: inline-block;">Schaal (%):</label>
                    <input id="scaleInput" style="width: 100px;" type="number" min="10" max="400" step="10" value="${String(globalThis.SITPLANVIEW_DEFAULT_SCALE*100)}">
                </div>
                <div style="display: flex; margin-bottom: 20px; align-items: center;">
                    <label for="rotationInput" style="margin-right: 10px; display: inline-block;">Rotatie (°):</label>
                    <input id="rotationInput" style="width: 100px;" type="number" min="0" max="360" step="10" value="0">
                </div>
                <div style="display: flex; margin-bottom: 20px; align-items: center;">
                    <label for="heightInput" style="margin-right: 10px; display: inline-block; white-space: nowrap;">Hoogte (cm):</label>
                    <input id="heightInput" style="width: 100px;" type="number" min="0" step="1" value="">
                </div>
                <div id="setDefaultContainer" style="display: flex; margin-bottom: 20px; align-items: flex-start;">
                    <input type="checkbox" id="setDefaultCheckbox">
                    ${s.toonTekenGrootteStandaardVoorNieuweObjecten?'<label for="setDefaultCheckbox" style="margin-left: 10px; flex-grow: 1; flex-wrap: wrap;">Zet tekengrootte en schaal als standaard voor alle toekomstige nieuwe symbolen.</label>':'<label for="setDefaultCheckbox" style="margin-left: 10px; flex-grow: 1; flex-wrap: wrap;">Zet schaal als standaard voor alle toekomstige nieuwe symbolen.</label>'}            
                </div>
                <div style="display: flex; justify-content: center; gap: 0px;">
                    <button id="okButton" class="rounded-button">OK</button>
                    <button id="cancelButton" class="rounded-button">Annuleren</button>
                </div>
            </div>
        </div>`;const G=N.querySelector("#popupOverlay"),w=G.querySelector("#popupWindow"),M=w.querySelector("#closeButton"),u=w.querySelector("#selectKringContainer"),f=w.querySelector("#selectKring"),k=w.querySelector("#selectElectroItemContainer"),x=w.querySelector("#selectElectroItemBox"),T=w.querySelector("#expandButton"),_=w.querySelector("#electroItemIdContainer"),P=w.querySelector("#electroItemIdInput"),$=w.querySelector("#electroItemType"),K=w.querySelector("#selectContainer"),b=w.querySelector("#selectAdresType"),y=w.querySelector("#adresContainer"),I=w.querySelector("#adresInput"),z=w.querySelector("#selectAdresLocation"),O=w.querySelector("#fontSizeContainer"),B=w.querySelector("#fontSizeInput"),R=w.querySelector("#scaleInput"),U=w.querySelector("#rotationInput"),D=w.querySelector("#heightInput"),Z=w.querySelector("#setDefaultCheckbox"),j=w.querySelector("#okButton"),Y=w.querySelector("#cancelButton");if(o(),d(),g(),i!=null){if(i.getElectroItemId()!=null){let q=globalThis.structure.getElectroItemById(i.getElectroItemId());q!=null&&q.getType()=="Bord"&&s.toonElementZoeker==null&&(s.toonElementZoeker=!1),b.value=i.getAdresType(),I.value=i.getAdres(),B.value=String(i.labelfontsize),z.value=i.getAdresLocation(),L()}else s.toonElementZoeker==null&&(s.toonElementZoeker=!1),K.style.display="none",O.style.display="none",y.style.display="none";R.value=Ce(i.getscale()*100,6),U.value=Ce(i.rotate,2),D.value=i.heightCm==null?"":Ce(i.heightCm,2)}else L(),B.value=Ce(globalThis.structure.sitplan.defaults.fontsize,2),R.value=Ce(globalThis.structure.sitplan.defaults.scale*100,6),z.value="rechts",D.value="";s.toonElementZoeker==null&&(s.toonElementZoeker=!0),s.toonElementZoeker||(u.style.display="none",k.style.display="none",_.style.display="none");let te=new Gt;te.addEventListener(document,"keydown",q=>{q.key==="Enter"?C(q):q.key==="Escape"&&(q.preventDefault(),q.stopPropagation(),Y.click())}),P.onblur=L,b.onchange=L,I.onclick=()=>{Array.from(b.options).forEach(q=>{q.text==="Handmatig"&&(q.selected=!0)}),I.readOnly=!1},j.onclick=()=>{function q(pe){return/^-?\d+(\.\d+)?$/.test(pe)}let ie=F(P.value)==""?null:Number(P.value);(!q(R.value)||Number(R.value)<=0)&&(R.value=String(globalThis.structure.sitplan.defaults.scale*100)),q(U.value)||(U.value=String(0));let ae=null;F(D.value)!==""&&q(D.value)&&Number(D.value)>=0&&(ae=Number(D.value)),Z.checked&&((i==null||i!=null&&i.getElectroItemId()!=null)&&(globalThis.structure.sitplan.defaults.fontsize=Number(B.value)),globalThis.structure.sitplan.defaults.scale=Number(R.value)/100),V(),e(ie,b.value,I.value,z.value,Number(B.value),Number(R.value)/100,Number(U.value),ae)},Y.onclick=()=>{V(),t()},M.onclick=Y.onclick,document.body.appendChild(N),A()}function vr(i,e,t=()=>{}){function s(){o.style.visibility="visible",document.body.style.pointerEvents="none",o.style.pointerEvents="auto"}function n(){o.style.visibility="hidden",document.body.style.pointerEvents="auto",a.remove()}const r=A=>{A.key==="Enter"&&(A.preventDefault(),A.stopPropagation(),g.click())},a=document.createElement("div");a.innerHTML=`
        <div id="popupOverlay" class="popup-overlay">
            <div id="popupWindow" class="popup">
                <h3>Meerdere elementen bewerken</h3>
                <div id="fontSizeContainer" style="display: flex; margin-bottom: 30px; align-items: center;">
                    <label for="fontSizeInput" style="margin-right: 10px; display: inline-block; white-space: nowrap;">Tekengrootte (px):</label>
                    <input id="fontSizeInput" style="width: 100px;" type="number" min="1" max="72" step="11" value="11">
                </div> 
                <div style="display: flex; margin-bottom: 10px; align-items: center;">
                    <label for="scaleInput" style="margin-right: 10px; display: inline-block;">Schaal (%):</label>
                    <input id="scaleInput" style="width: 100px;" type="number" min="10" max="400" step="10" value="${String(globalThis.SITPLANVIEW_DEFAULT_SCALE*100)}">
                </div>
                <div style="display: flex; margin-bottom: 20px; align-items: center;">
                    <label for="rotationInput" style="margin-right: 10px; display: inline-block;">Rotatie (°):</label>
                    <input id="rotationInput" style="width: 100px;" type="number" min="0" max="360" step="10" value="0">
                </div>
                <div id="setDefaultContainer" style="display: flex; margin-bottom: 20px; align-items: flex-start;">
                    <input type="checkbox" id="setDefaultCheckbox">
                    <label for="setDefaultCheckbox" style="margin-left: 10px; flex-grow: 1; flex-wrap: wrap;">Zet tekengrootte en schaal als standaard voor alle toekomstige nieuwe symbolen.</label>
                </div>
                <div style="display: flex; justify-content: center; gap: 0px;">
                    <button id="okButton" class="rounded-button">OK</button>
                    <button id="cancelButton" class="rounded-button">Annuleren</button>
                </div>
            </div>
        </div>`;const o=a.querySelector("#popupOverlay"),l=o.querySelector("#popupWindow"),c=l.querySelector("#fontSizeInput"),d=l.querySelector("#scaleInput"),h=l.querySelector("#rotationInput"),p=l.querySelector("#setDefaultCheckbox"),g=l.querySelector("#okButton"),m=l.querySelector("#cancelButton");let v=null,S=null,L=null;for(let A of i)A.labelfontsize!=null&&(v==null?v=A.labelfontsize:v!=A.labelfontsize&&(v="multiple")),A.getscale()!=null&&(S==null?S=A.getscale():S!=A.getscale()&&(S="multiple")),A.rotate!=null&&(L==null?L=A.rotate:L!=A.rotate&&(L="multiple"));c.value=v!="multiple"?String(v):"",d.value=S!="multiple"&&S!=null?String(S*100):"",h.value=L!="multiple"?String(L):"",c.onkeydown=r,d.onkeydown=r,h.onkeydown=r,g.onclick=()=>{function A(G){return/^-?\d+(\.\d+)?$/.test(G)}let V=null,C=null,N=null;A(c.value)&&(V=Number(c.value)),A(d.value)&&(C=Number(d.value)/100),A(h.value)&&(N=Number(h.value)),p.checked&&(V!=null&&(globalThis.structure.sitplan.defaults.fontsize=Number(c.value)),C!=null&&(globalThis.structure.sitplan.defaults.scale=Number(d.value)/100)),n(),e(V,C,N)},m.onclick=()=>{n(),t()},document.body.appendChild(a),s()}class wr{show(){const e=document.createElement("div");e.id="popupOverlay",Object.assign(e.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",visibility:"hidden",zIndex:"9999"});const t=document.createElement("div");Object.assign(t.style,{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"white",padding:"5px 20px 20px",border:"1px solid #ccc",borderRadius:"8px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.2)",zIndex:"1000"}),t.innerHTML=`<h3>Aanpassing symbolen schakelaars</h3><p>Beste gebruiker. Uw situatieschema bevat symbolen voor schakelaars. Tot nogtoe werden die altijd afgebeeld met een klein lijntje (leiding) aan de zijkant.</p><table border="0" style="border-collapse:collapse"><tr><td><svg style="padding: 0px; margin: 0px; display:block" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" transform="scale(1,1)" viewBox="12 0 38 40" width="38" height="40"><defs><g id="signalisatielamp"><circle cx="0" cy="0" r="5" fill="white" stroke="black"></circle><line x1="-3" y1="-3" x2="3" y2="3" stroke="black"></line><line x1="-3" y1="3" x2="3" y2="-3" stroke="black"></line></g><g id="schakelaar_enkel"><line x1="0" y1="0" x2="10" y2="-20" stroke="black"></line><line x1="10" y1="-20" x2="15" y2="-17.5" stroke="black"></line><circle cx="0" cy="0" r="5" fill="white" stroke="black"></circle></g></defs><line x1="1" x2="31" y1="25" y2="25" stroke="black"></line><use xlink:href="#schakelaar_enkel" x="31" y="25"></use></svg></td><td><svg style="padding: 0px; margin: 0px; display:block" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" transform="scale(1,1)" viewBox="12 0 38 40" width="38" height="40"><defs><g id="signalisatielamp"><circle cx="0" cy="0" r="5" fill="white" stroke="black"></circle><line x1="-3" y1="-3" x2="3" y2="3" stroke="black"></line><line x1="-3" y1="3" x2="3" y2="-3" stroke="black"></line></g><g id="schakelaar_enkel"><line x1="0" y1="0" x2="10" y2="-20" stroke="black"></line><line x1="10" y1="-20" x2="15" y2="-17.5" stroke="black"></line><circle cx="0" cy="0" r="5" fill="white" stroke="black"></circle></g></defs><use xlink:href="#schakelaar_enkel" x="31" y="25"></use></svg></td></tr></table><p>Op terechte vraag van enkele gebruikers zal dat voor toekomstige schema's niet meer het geval zijn en zullen de symbolen getekend worden zoals gangbaar in de meeste andere tekenprogramma's.</p><p>Doorgaans zal het dan ook niet langer noodzakelijk zijn om dergelijke schakelaars te roteren.</p><p>Voor dit schema kan u zelf nog kiezen hoe u de symbolen wenst weer te geven.</p>`;const s=t.querySelector("h3");s&&(s.style.color="#06F");const n=document.createElement("div");n.style.display="flex",n.style.flexDirection="column",n.style.marginTop="10px";const r=document.createElement("input");r.type="radio",r.name="symbolChoice",r.id="keepLegacy",r.checked=!0;const a=document.createElement("label");a.htmlFor="keepLegacy",a.style.display="flex",a.style.alignItems="start",a.style.marginBottom="10px",a.appendChild(r),a.appendChild(document.createTextNode("U behoudt de symbolen zoals voorheen voor dit schema.")),n.appendChild(a);const o=document.createElement("input");o.type="radio",o.name="symbolChoice",o.id="dropLegacy";const l=document.createElement("label");l.htmlFor="dropLegacy",l.style.display="flex",l.style.alignItems="start",l.style.marginBottom="10px",l.appendChild(o),l.appendChild(document.createTextNode("U gebruikt de nieuwe symbolen zonder lijntje. De oorspronkelijke rotatie wordt hersteld. Mogelijk zal u bepaalde symbolen zelf opnieuw moeten roteren.")),n.appendChild(l),t.appendChild(n);const c=document.createElement("button");return c.textContent="OK",Object.assign(c.style,{marginTop:"10px",padding:"10px 20px",cursor:"pointer",backgroundColor:"#3399FF",border:"none",borderRadius:"5px",marginLeft:"auto",marginRight:"auto",width:"100px"}),c.addEventListener("mouseover",()=>{c.style.backgroundColor="#06F"}),c.addEventListener("mouseout",()=>{c.style.backgroundColor="#3399FF"}),t.appendChild(c),e.appendChild(t),document.body.appendChild(e),e.style.visibility="visible",document.body.style.pointerEvents="none",e.style.pointerEvents="auto",new Promise(d=>{c.addEventListener("click",()=>{const h=document.querySelector('input[name="symbolChoice"]:checked');h&&h.id==="keepLegacy"?globalThis.structure.properties.legacySchakelaars=!0:h&&h.id==="dropLegacy"&&(globalThis.structure.properties.legacySchakelaars=!1,globalThis.structure.sitplan.dropLegacySchakelaars()),document.body.removeChild(e),document.body.style.pointerEvents="auto",d("OK clicked!")},{once:!0})})}}class _r{constructor(e,t,s){this.zoomfactor=1,this.canvas=null,this.paper=null,this.sideBar=new yr(document.getElementById("sidebar")),this.contextMenu=null,this.pendingAddPos=null,this.isPanningCanvas=!1,this.panStart=null,this.previousCanvasCursorPan=null,this.panCaptureMouseDown=n=>{var h,p;if(this.isAddingDistanceLine||this.isAddingCableRun||((h=document.getElementById("outerdiv"))==null?void 0:h.style.display)==="none"||document.getElementById("popupOverlay")!=null)return;const r=n.button===0||(n.buttons&1)===1,a=n.button===1||(n.buttons&4)===4;if(!(r&&(n.ctrlKey||n.metaKey))&&!a)return;const c=this.canvas.getBoundingClientRect();n.clientX>=c.left&&n.clientX<=c.right&&n.clientY>=c.top&&n.clientY<=c.bottom&&(n.preventDefault(),n.stopPropagation(),(p=n.stopImmediatePropagation)==null||p.call(n),this.startCanvasPan(n))},this.panCaptureContextMenu=n=>{var o,l;if(((o=document.getElementById("outerdiv"))==null?void 0:o.style.display)==="none"||document.getElementById("popupOverlay")!=null||!(n.ctrlKey||n.metaKey)&&!this.isPanningCanvas)return;const r=this.canvas.getBoundingClientRect();n.clientX>=r.left&&n.clientX<=r.right&&n.clientY>=r.top&&n.clientY<=r.bottom&&(n.preventDefault(),n.stopPropagation(),(l=n.stopImmediatePropagation)==null||l.call(n))},this.isAddingDistanceLine=!1,this.distanceLineFirstPoint=null,this.previousCanvasCursor=null,this.isAddingCableRun=!1,this.cableRunPoints=[],this.previousCanvasCursorCable=null,this.cableRunPreviewElement=null,this.cableRunPreviewCursorPos=null,this.pendingCableRunSpec=null,this.isAddingConnectionPoint=!1,this.pendingConnectionId=null,this.previousCanvasCursorConnection=null,this.cableVertexDrag=null,this.processCableVertexDrag=n=>{var h,p,g,m,v;if(!this.cableVertexDrag)return;(h=n.preventDefault)==null||h.call(n);const r=this.cableVertexDrag.element,a=this.cableVertexDrag.vertexIndex,o=(()=>{var S;if(n.touches!=null){const L=n,A=(S=L.touches[0])!=null?S:L.changedTouches[0];if(!A)return null;const V=this.canvas.getBoundingClientRect(),C=A.clientX-V.left,N=A.clientY-V.top;return this.canvasPosToPaperPos(C,N)}return this.mouseEventToPaperPos(n)})();if(!o)return;const l=this.getCableRunAbsolutePoints(r);if(!(a>=0&&a<l.length))return;const c=l[a].x-o.x,d=l[a].y-o.y;c*c+d*d>1e-4&&(this.cableVertexDrag.moved=!0),l[a]={x:o.x,y:o.y},r.setCableRunAbsolute(l,(g=(p=r.cableRun)==null?void 0:p.kring)!=null?g:null,(v=(m=r.cableRun)==null?void 0:m.cableSpec)!=null?v:null),this.updateBoxContent(r),this.updateSymbolAndLabelPosition(r)},this.stopCableVertexDrag=n=>{var r;document.removeEventListener("mousemove",this.processCableVertexDrag),document.removeEventListener("mouseup",this.stopCableVertexDrag),document.removeEventListener("touchmove",this.processCableVertexDrag),document.removeEventListener("touchend",this.stopCableVertexDrag),(r=this.cableVertexDrag)!=null&&r.moved&&globalThis.undostruct.store(),this.cableVertexDrag=null},this.cableRunCaptureMouseDown=n=>{var d;if(!this.isAddingCableRun||n.button!==0)return;const r=this.canvas.getBoundingClientRect();if(!(n.clientX>=r.left&&n.clientX<=r.right&&n.clientY>=r.top&&n.clientY<=r.bottom))return;n.preventDefault(),n.stopPropagation(),(d=n.stopImmediatePropagation)==null||d.call(n);const o=n.clientX-r.left,l=n.clientY-r.top,c=this.canvasPosToPaperPos(o,l);this.handleCableRunPoint(c)},this.cableRunCaptureMouseMove=n=>{if(!this.isAddingCableRun)return;const r=this.canvas.getBoundingClientRect();if(!(n.clientX>=r.left&&n.clientX<=r.right&&n.clientY>=r.top&&n.clientY<=r.bottom)){this.cableRunPreviewCursorPos=null,this.updateCableRunPreview();return}const o=n.clientX-r.left,l=n.clientY-r.top;this.cableRunPreviewCursorPos=this.canvasPosToPaperPos(o,l),this.updateCableRunPreview()},this.cableRunCaptureTouchStart=n=>{var h,p;if(!this.isAddingCableRun)return;const r=(h=n.touches[0])!=null?h:n.changedTouches[0];if(!r)return;const a=this.canvas.getBoundingClientRect();if(!(r.clientX>=a.left&&r.clientX<=a.right&&r.clientY>=a.top&&r.clientY<=a.bottom))return;n.preventDefault(),n.stopPropagation(),(p=n.stopImmediatePropagation)==null||p.call(n);const l=r.clientX-a.left,c=r.clientY-a.top,d=this.canvasPosToPaperPos(l,c);this.handleCableRunPoint(d)},this.cableRunCaptureTouchMove=n=>{var d;if(!this.isAddingCableRun)return;const r=(d=n.touches[0])!=null?d:n.changedTouches[0];if(!r)return;const a=this.canvas.getBoundingClientRect();if(!(r.clientX>=a.left&&r.clientX<=a.right&&r.clientY>=a.top&&r.clientY<=a.bottom)){this.cableRunPreviewCursorPos=null,this.updateCableRunPreview();return}const l=r.clientX-a.left,c=r.clientY-a.top;this.cableRunPreviewCursorPos=this.canvasPosToPaperPos(l,c),this.updateCableRunPreview()},this.cableRunCaptureContextMenu=n=>{var o;if(!this.isAddingCableRun)return;const r=this.canvas.getBoundingClientRect();n.clientX>=r.left&&n.clientX<=r.right&&n.clientY>=r.top&&n.clientY<=r.bottom&&(n.preventDefault(),n.stopPropagation(),(o=n.stopImmediatePropagation)==null||o.call(n),this.finishAddCableRun())},this.connectionPointCaptureMouseDown=n=>{var d;if(!this.isAddingConnectionPoint||n.button!==0)return;const r=this.canvas.getBoundingClientRect();if(!(n.clientX>=r.left&&n.clientX<=r.right&&n.clientY>=r.top&&n.clientY<=r.bottom))return;n.preventDefault(),n.stopPropagation(),(d=n.stopImmediatePropagation)==null||d.call(n);const o=n.clientX-r.left,l=n.clientY-r.top,c=this.canvasPosToPaperPos(o,l);this.placeConnectionPoint(c)},this.connectionPointCaptureTouchStart=n=>{var h,p;if(!this.isAddingConnectionPoint)return;const r=(h=n.touches[0])!=null?h:n.changedTouches[0];if(!r)return;const a=this.canvas.getBoundingClientRect();if(!(r.clientX>=a.left&&r.clientX<=a.right&&r.clientY>=a.top&&r.clientY<=a.bottom))return;n.preventDefault(),n.stopPropagation(),(p=n.stopImmediatePropagation)==null||p.call(n);const l=r.clientX-a.left,c=r.clientY-a.top,d=this.canvasPosToPaperPos(l,c);this.placeConnectionPoint(d)},this.connectionPointCaptureContextMenu=n=>{var o;if(!this.isAddingConnectionPoint)return;const r=this.canvas.getBoundingClientRect();n.clientX>=r.left&&n.clientX<=r.right&&n.clientY>=r.top&&n.clientY<=r.bottom&&(n.preventDefault(),n.stopPropagation(),(o=n.stopImmediatePropagation)==null||o.call(n),this.cancelAddConnectionPoint())},this.distanceLineCaptureMouseDown=n=>{var d;if(!this.isAddingDistanceLine||n.button!==0)return;const r=this.canvas.getBoundingClientRect();if(!(n.clientX>=r.left&&n.clientX<=r.right&&n.clientY>=r.top&&n.clientY<=r.bottom))return;n.preventDefault(),n.stopPropagation(),(d=n.stopImmediatePropagation)==null||d.call(n);const o=n.clientX-r.left,l=n.clientY-r.top,c=this.canvasPosToPaperPos(o,l);this.handleDistanceLinePoint(c)},this.distanceLineCaptureTouchStart=n=>{var h,p;if(!this.isAddingDistanceLine)return;const r=(h=n.touches[0])!=null?h:n.changedTouches[0];if(!r)return;const a=this.canvas.getBoundingClientRect();if(!(r.clientX>=a.left&&r.clientX<=a.right&&r.clientY>=a.top&&r.clientY<=a.bottom))return;n.preventDefault(),n.stopPropagation(),(p=n.stopImmediatePropagation)==null||p.call(n);const l=r.clientX-a.left,c=r.clientY-a.top,d=this.canvasPosToPaperPos(l,c);this.handleDistanceLinePoint(d)},this.distanceLineCaptureContextMenu=n=>{var o;if(!this.isAddingDistanceLine)return;const r=this.canvas.getBoundingClientRect();n.clientX>=r.left&&n.clientX<=r.right&&n.clientY>=r.top&&n.clientY<=r.bottom&&(n.preventDefault(),n.stopPropagation(),(o=n.stopImmediatePropagation)==null||o.call(n),this.cancelAddDistanceLine())},this.draggedBox=null,this.draggedHalo={left:0,top:0,right:0,bottom:0},this.selected=new kr,this.showContextMenu=n=>{n.preventDefault(),n.stopPropagation();const r=n.currentTarget;if(r!=null&&!this.selected.includes(r)&&(this.clearSelection(),this.selectOneBox(r)),this.selected.length()<1)return;let a=this.selected.getLastSelected().sitPlanElementRef;if(a!=null){switch(this.contextMenu.clearMenu(),a.movable&&(this.contextMenu.addMenuItem("Draai rechts",()=>{this.rotateSelectedBoxes(90,!0)},"Ctrl →"),this.contextMenu.addMenuItem("Draai links",()=>{this.rotateSelectedBoxes(-90,!0)},"Ctrl ←"),this.contextMenu.addLine()),this.contextMenu.addMenuItem("Bewerk",this.editSelectedBox.bind(this),"Enter"),this.contextMenu.addMenuItem("Verberg",()=>{this.hideSelectedBoxes()},""),this.contextMenu.addLine(),this.getSelectionMovability()){case 0:this.contextMenu.addMenuItem("Vergrendel",this.toggleSelectedBoxesMovable.bind(this),"Ctrl L");break;case 1:this.contextMenu.addMenuItem("Ontgrendel",this.toggleSelectedBoxesMovable.bind(this),"Ctrl L");break;case 2:this.contextMenu.addMenuItem("Vergrendel",()=>{this.toggleSelectedBoxesMovable.bind(this)(1)},"Ctrl L"),this.contextMenu.addMenuItem("Ontgrendel",()=>{this.toggleSelectedBoxesMovable.bind(this)(0)},"");break}a.movable&&(this.contextMenu.addLine(),this.contextMenu.addMenuItem("Verwijder",()=>{this.deleteSelectedBoxes(),globalThis.undostruct.store()},"Del"),this.sitplan.numPages>1&&a.movable&&(this.contextMenu.addLine(),this.contextMenu.addMenuItem("Naar pagina..",this.changePageSelectedBoxes.bind(this),"PgUp/PgDn"))),this.contextMenu.show(n)}},this.showQuickAddMenu=n=>{const r=n.target;if(r!=null&&(r.closest(".box")||r.closest(".boxlabel")||r.closest(".context-menu")))return;n.preventDefault(),n.stopPropagation();const a=this.mouseEventToPaperPos(n);this.contextMenu.clearMenu(),this.contextMenu.addMenuItem("Uit bestand…",()=>{this.pendingAddPos=a;const o=document.getElementById("fileInput");o==null||o.click()}),this.contextMenu.addMenuItem("Verberg alles",()=>{this.hideAllElements()}),this.contextMenu.addMenuItem("Toon alles",()=>{this.showAllElements()}),this.contextMenu.addMenuItem("Uit schema…",()=>{this.openAddElectroItemPopupAt(a)}),this.contextMenu.addMenuItem("Los symbool…",()=>{this.openAddCustomItemPopupAt(a)}),this.contextMenu.addMenuItem("Afstandslijn…",()=>{this.startAddDistanceLine()}),this.contextMenu.addMenuItem("Verbindingspunt…",()=>{this.startAddConnectionPoint(!0)}),this.contextMenu.addMenuItem("Kabel…",()=>{this.startAddCableRun(!0)}),this.contextMenu.show(n)},this.processCanvasPan=n=>{if(!this.isPanningCanvas||!this.panStart)return;n.preventDefault();const r=n.clientX-this.panStart.x,a=n.clientY-this.panStart.y;this.canvas.scrollLeft=this.panStart.scrollLeft-r,this.canvas.scrollTop=this.panStart.scrollTop-a},this.stopCanvasPan=n=>{var r;this.isPanningCanvas&&(document.removeEventListener("mousemove",this.processCanvasPan),document.removeEventListener("mouseup",this.stopCanvasPan),this.isPanningCanvas=!1,this.panStart=null,this.canvas.style.cursor=(r=this.previousCanvasCursorPan)!=null?r:"",this.previousCanvasCursorPan=null)},this.startDrag=n=>{var c,d,h,p,g,m;if(n==null)return;const r=n.shiftKey;if(n.button==1)return;this.contextMenu.hide();let a=null;const o=n.currentTarget;let l=o==null?void 0:o.sitPlanElementRef;if(l!=null&&((c=o==null?void 0:o.classList)!=null&&c.contains("box")?a=o:(d=o==null?void 0:o.classList)!=null&&d.contains("boxlabel")&&(a=l.boxref),a!=null&&(r?this.selectToggleBox(a):(this.selected.includes(a)||this.clearSelection(),this.selectBox(a)),n.stopPropagation(),n.button!=2))){if(l.kind==="cableRun"){const v=this.getCableVertexIndexFromEventTarget(n.target);if(v!=null){if(n.altKey){const S=this.getCableRunAbsolutePoints(l);S.length>2&&(S.splice(v,1),l.setCableRunAbsolute(S,(p=(h=l.cableRun)==null?void 0:h.kring)!=null?p:null,(m=(g=l.cableRun)==null?void 0:g.cableSpec)!=null?m:null),this.updateBoxContent(l),this.updateSymbolAndLabelPosition(l),globalThis.undostruct.store());return}this.startCableVertexDrag(n,l,v);return}}if(a.classList.contains("selected")&&a.getAttribute("movable")!="false")switch(this.draggedBox=a,this.draggedHalo=this.getDraggedHaloAroundElement(l),n.type){case"mousedown":this.mousedrag.startDrag(n.clientX,n.clientY,l.posx,l.posy),document.addEventListener("mousemove",this.processDrag),document.addEventListener("mouseup",this.stopDrag);break;case"touchstart":const v=n.touches[0];this.mousedrag.startDrag(v.clientX,v.clientY,l.posx,l.posy),document.addEventListener("touchmove",this.processDrag,{passive:!1}),document.addEventListener("touchend",this.stopDrag);break;default:console.error("Ongeldige event voor startDrag functie")}}},this.stopDrag=n=>{function r(){new ze(globalThis.appDocStorage).show("sitplan.arrowdrag",`<h3>Tip: Symbolen verplaatsen</h3>
            <p>Voor fijnere controle tijdens het verschuiven van symbolen kan u ook de pijltjes op het toetsenbord gebruiken.</p>`,!0)}switch(n.stopPropagation(),n.type){case"mouseup":document.removeEventListener("mousemove",this.processDrag),document.removeEventListener("mouseup",this.stopDrag),this.mousedrag.hassMoved&&(r(),globalThis.undostruct.store());break;case"touchend":document.removeEventListener("touchmove",this.processDrag),document.removeEventListener("touchend",this.stopDrag),this.mousedrag.hassMoved&&(r(),globalThis.undostruct.store());break;default:console.error("Ongeldige event voor stopDrag functie")}this.draggedBox=null},this.processDrag=n=>{if(this.draggedBox){n.preventDefault();const r=this.draggedBox.sitPlanElementRef;if(r===null)return;let a;if(n.type==="mousemove")a=this.mousedrag.returnNewPaperPos(n.clientX,n.clientY);else if(n.type==="touchmove"){const d=n.touches[0];a=this.mousedrag.returnNewPaperPos(d.clientX,d.clientY)}const o=parseFloat(getComputedStyle(this.paper).getPropertyValue("--paperPadding")),l={x:(this.canvas.scrollLeft-o)/this.zoomfactor,y:(this.canvas.scrollTop-o)/this.zoomfactor,width:this.canvas.offsetWidth/this.zoomfactor,height:this.canvas.offsetHeight/this.zoomfactor};a.x=Math.min(l.x+l.width,Math.max(l.x,this.draggedHalo.left-o/this.zoomfactor,a.x)),a.y=Math.min(l.y+l.height,Math.max(l.y,this.draggedHalo.top-o/this.zoomfactor,a.y));const c={x:a.x-r.posx,y:a.y-r.posy};for(let d of this.selected.getAllSelected()){if(d==null)continue;const h=d.sitPlanElementRef;h!=null&&h.movable!==!1&&(h.posx+=c.x,h.posy+=c.y,this.updateSymbolAndLabelPosition(h))}}},this.addElectroItem=(n,r,a,o,l,c,d,h=null,p=null,g=null,m={undoStore:!0})=>{m.undoStore==null&&(m.undoStore=!0);let v=this.canvasPosToPaperPos(50,50);if(p==null&&(p=v.x),g==null&&(g=v.y),n!=null){let S=this.sitplan.addElementFromElectroItem(n,this.sitplan.activePage,p,g,r,a,o,l,c,d);S!=null&&(S.heightCm=h,this.syncToSitPlan(),this.clearSelection(),this.redraw(),this.selectOneBox(S.boxref),this.bringToFront(m.undoStore))}else alert("Geen geldig ID ingegeven!")},this.editSelectedBox=n=>{var r,a,o,l;if(this.contextMenu.hide(),this.unattachArrowKeys(),this.selected.length()==1){const c=this.selected.getLastSelected().sitPlanElementRef;if(!c)return;if(c.kind==="distanceLine"){const d=(r=c.distanceLine)==null?void 0:r.distanceCm,h=window.prompt("Afstand in centimeter (cm):",d==null?"":String(d));if(this.attachArrowKeys(),h==null){n&&n();return}const p=h.trim(),g=p===""?null:Number(p.replace(",","."));if(p!==""&&!(Number.isFinite(g)&&g>=0)){alert("Ongeldige afstand. Geef een getal in centimeters in."),n&&n();return}if(c.distanceLine||(c.distanceLine={x1:0,y1:0,x2:1,y2:1,distanceCm:null}),c.distanceLine.distanceCm=g,g!=null&&c.distanceLine){const m=c.distanceLine,v=Number(m.x2)-Number(m.x1),S=Number(m.y2)-Number(m.y1),L=Math.sqrt(v*v+S*S);if(Number.isFinite(L)&&L>0){const A=g/100/L;this.sitplan.setMetersPerUnitForPage(c.page,A)}}this.updateBoxContent(c),this.updateSymbolAndLabelPosition(c),globalThis.undostruct.store();return}if(c.kind==="cableRun"){const d=(a=c.cableRun)==null?void 0:a.cableSpec,h=(o=c.cableRun)==null?void 0:o.kring,p=typeof h=="string"&&h.trim()!==""?this.getDefaultCableSpecForKring(h):null,g=d!=null&&String(d).trim()!==""?String(d):p!=null?p:"",m=window.prompt("Kabeltype/spec voor deze kabelrun:",g);if(this.attachArrowKeys(),m==null){n&&n();return}const v=m.trim();c.cableRun||(c.cableRun={points:[],kring:h!=null?h:null,cableSpec:null}),c.cableRun.cableSpec=v===""?null:v,this.updateBoxContent(c),this.updateSymbolAndLabelPosition(c),globalThis.undostruct.store();return}if(c.kind==="connectionPoint"){const d=(l=c.connectionPoint)==null?void 0:l.connectionId,h=window.prompt("Verbindings-ID (zelfde ID = zelfde verbinding):",d==null?"":String(d));if(this.attachArrowKeys(),h==null){n&&n();return}const p=h.trim();if(p===""){alert("Verbindings-ID mag niet leeg zijn."),n&&n();return}c.connectionPoint||(c.connectionPoint={connectionId:p}),c.connectionPoint.connectionId=p,this.updateBoxContent(c),this.updateSymbolAndLabelPosition(c),globalThis.undostruct.store();return}_t(c,(d,h,p,g,m,v,S,L)=>{this.attachArrowKeys(),d!=null&&(c.setElectroItemId(d),c.setAdres(h,p,g)),c.labelfontsize=m,c.setscale(v),c.rotate=S,c.heightCm=L,this.updateBoxContent(c),this.updateSymbolAndLabelPosition(c),globalThis.undostruct.store()},()=>{this.attachArrowKeys(),n&&n()},{toonElementZoeker:!1})}else if(this.selected.length()>1){const c=[];for(let d of this.selected.getAllSelected()){const h=d.sitPlanElementRef;h!=null&&c.push(h)}vr(c,(d,h,p)=>{this.attachArrowKeys();for(let g of c)d!=null&&(g.labelfontsize=d),h!=null&&g.setscale(h),p!=null&&(g.rotate=p),this.updateBoxContent(g),this.updateSymbolAndLabelPosition(g);globalThis.undostruct.store()},()=>{this.attachArrowKeys(),n&&n()})}},this.canvas=e,this.paper=t,this.contextMenu=new Ys,this.sitplan=s,this.paper.style.transformOrigin="top left",this.mousedrag=new xr,this.event_manager=new Gt,this.event_manager.addEventListener(e,"mousedown",n=>{this.handleCanvasPointerDown(n)}),this.event_manager.addEventListener(e,"touchstart",n=>{this.handleCanvasPointerDown(n)}),document.addEventListener("mousedown",this.panCaptureMouseDown,!0),document.addEventListener("contextmenu",this.panCaptureContextMenu,!0),this.event_manager.addEventListener(e,"mousedown",n=>{var r,a;this.isAddingDistanceLine||((r=document.getElementById("outerdiv"))==null?void 0:r.style.display)!=="none"&&document.getElementById("popupOverlay")==null&&n.button===0&&(n.ctrlKey||n.metaKey)&&(n.preventDefault(),n.stopPropagation(),(a=n.stopImmediatePropagation)==null||a.call(n),this.startCanvasPan(n))},{capture:!0}),this.event_manager.addEventListener(e,"contextmenu",this.showQuickAddMenu),this.event_manager.addEventListener(e,"contextmenu",n=>{this.isPanningCanvas&&(n.preventDefault(),n.stopPropagation())}),this.event_manager.addEventListener(e,"wheel",n=>{var c;if(((c=document.getElementById("outerdiv"))==null?void 0:c.style.display)==="none"||document.getElementById("popupOverlay")!=null||this.isAddingDistanceLine||this.isAddingCableRun)return;n.preventDefault();const r=this.canvas.getBoundingClientRect(),a=n.clientX-r.left,o=n.clientY-r.top,l=-n.deltaY;Math.abs(l)<.5||this.zoomIncrement(l/2e3,a,o)},{passive:!1}),this.attachArrowKeys()}getCableVertexIndexFromEventTarget(e){var t,s,n;try{const r=(n=(t=e==null?void 0:e.getAttribute)==null?void 0:t.call(e,"data-cable-vertex-index"))!=null?n:(s=e==null?void 0:e.getAttribute)==null?void 0:s.call(e,"data-cable-vertex-index");if(r==null)return null;const a=Number(r);return Number.isFinite(a)?a:null}catch(r){return null}}getCableRunAbsolutePoints(e){var n;if(!e||e.kind!=="cableRun"||!e.cableRun)return[];const t=e.posx-e.sizex/2,s=e.posy-e.sizey/2;return((n=e.cableRun.points)!=null?n:[]).map(r=>({x:r.x+t,y:r.y+s}))}startCableVertexDrag(e,t,s){var r,a;const n=this.getCableRunAbsolutePoints(t);n.length<2||s>=0&&s<n.length&&(this.cableVertexDrag={element:t,vertexIndex:s,moved:!1},(r=e.preventDefault)==null||r.call(e),(a=e.stopPropagation)==null||a.call(e),document.addEventListener("mousemove",this.processCableVertexDrag),document.addEventListener("mouseup",this.stopCableVertexDrag),document.addEventListener("touchmove",this.processCableVertexDrag,{passive:!1}),document.addEventListener("touchend",this.stopCableVertexDrag))}insertCableVertexAt(e,t){var o,l,c,d;const s=this.getCableRunAbsolutePoints(e);if(s.length<2)return;const n=(h,p,g)=>{const m=g.x-p.x,v=g.y-p.y,S=h.x-p.x,L=h.y-p.y,A=m*m+v*v;if(A<=0)return S*S+L*L;let V=(S*m+L*v)/A;V=Math.max(0,Math.min(1,V));const C=p.x+V*m,N=p.y+V*v,G=h.x-C,w=h.y-N;return G*G+w*w};let r=0,a=Number.POSITIVE_INFINITY;for(let h=0;h<s.length-1;h++){const p=n(t,s[h],s[h+1]);p<a&&(a=p,r=h)}s.splice(r+1,0,{x:t.x,y:t.y}),e.setCableRunAbsolute(s,(l=(o=e.cableRun)==null?void 0:o.kring)!=null?l:null,(d=(c=e.cableRun)==null?void 0:c.cableSpec)!=null?d:null),this.updateBoxContent(e),this.updateSymbolAndLabelPosition(e),globalThis.undostruct.store()}startAddConnectionPoint(e=!1){var s,n,r;const t=Array.from(new Set(((n=(s=this.sitplan)==null?void 0:s.elements)!=null?n:[]).filter(a=>{var o;return(a==null?void 0:a.kind)==="connectionPoint"&&((o=a==null?void 0:a.connectionPoint)==null?void 0:o.connectionId)!=null}).map(a=>String(a.connectionPoint.connectionId).trim()).filter(a=>a!=="")));if(e||this.pendingConnectionId==null){const a=(r=t[0])!=null?r:"CP1",o=window.prompt("Verbindings-ID (zelfde ID op meerdere verdiepingen = zelfde stijgleiding):",a);if(o==null)return;const l=o.trim();this.pendingConnectionId=l===""?a:l}this.isAddingConnectionPoint=!0,this.previousCanvasCursorConnection==null&&(this.previousCanvasCursorConnection=this.canvas.style.cursor),this.canvas.style.cursor="crosshair",this.paper.style.cursor="crosshair",document.body.classList.add("connection-point-mode"),this.clearSelection(),document.addEventListener("mousedown",this.connectionPointCaptureMouseDown,!0),document.addEventListener("touchstart",this.connectionPointCaptureTouchStart,{passive:!1,capture:!0}),document.addEventListener("contextmenu",this.connectionPointCaptureContextMenu,!0)}cancelAddConnectionPoint(){this.isAddingConnectionPoint&&(this.isAddingConnectionPoint=!1,this.pendingConnectionId=null,document.removeEventListener("mousedown",this.connectionPointCaptureMouseDown,!0),document.removeEventListener("touchstart",this.connectionPointCaptureTouchStart,!0),document.removeEventListener("contextmenu",this.connectionPointCaptureContextMenu,!0),this.previousCanvasCursorConnection!=null?(this.canvas.style.cursor=this.previousCanvasCursorConnection,this.previousCanvasCursorConnection=null):this.canvas.style.cursor="",this.paper.style.cursor="",document.body.classList.remove("connection-point-mode"))}placeConnectionPoint(e){var n;const t=String((n=this.pendingConnectionId)!=null?n:"").trim()||"CP1",s=new we;s.setVars({page:this.sitplan.activePage,movable:!0,labelfontsize:this.sitplan.defaults.fontsize}),s.setConnectionPointAbsolute(e,t),this.sitplan.addElement(s),this.syncToSitPlan(),this.clearSelection(),this.redraw(),this.selectOneBox(s.boxref),this.bringToFront(!0),this.cancelAddConnectionPoint(),globalThis.undostruct.store()}getVisibleCenterPaperPos(){return this.canvasPosToPaperPos(this.canvas.clientWidth/2,this.canvas.clientHeight/2)}mouseEventToPaperPos(e){const t=this.canvas.getBoundingClientRect(),s=e.clientX-t.left,n=e.clientY-t.top;return this.canvasPosToPaperPos(s,n)}openAddElectroItemPopupAt(e){this.contextMenu.hide(),this.unattachArrowKeys(),_t(null,(t,s,n,r,a,o,l,c)=>{this.attachArrowKeys(),this.addElectroItem(t,s,n,r,a,o,l,c,e.x,e.y)},()=>{this.attachArrowKeys()})}openAddCustomItemPopupAt(e){this.contextMenu.hide(),ps.showItemTypeSelectionPopup((t,s,n)=>{const r=globalThis.structure.createContainerIfNotExists(),a=globalThis.structure.createItem(t);globalThis.structure.insertChildAfterId(a,r.id);const o=globalThis.structure.sitplan.defaults.fontsize;this.addElectroItem(a.id,"manueel","","rechts",o,s,n,e.x,e.y)})}canvasPosToPaperPos(e,t){const s=parseFloat(getComputedStyle(this.paper).getPropertyValue("--paperPadding"));return{x:(e+this.canvas.scrollLeft-s)/this.zoomfactor,y:(t+this.canvas.scrollTop-s)/this.zoomfactor}}paperPosToCanvasPos(e,t){const s=parseFloat(getComputedStyle(this.paper).getPropertyValue("--paperPadding"));return{x:e*this.zoomfactor-this.canvas.scrollLeft+s,y:t*this.zoomfactor-this.canvas.scrollTop+s}}canvasAndPaperPosToScrollPos(e,t,s,n){const r=parseFloat(getComputedStyle(this.paper).getPropertyValue("--paperPadding"));return{x:s*this.zoomfactor-e+r+.5,y:n*this.zoomfactor-t+r+.5}}dispose(){this.event_manager.dispose();for(let e of this.sitplan.elements)e.boxref!=null&&e.boxref.remove(),e.boxlabelref!=null&&e.boxlabelref.remove()}syncToSitPlan(){this.sitplan.syncToEendraadSchema()}zoomToFit(e=parseFloat(getComputedStyle(this.paper).getPropertyValue("--paperPadding"))){parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--sideBarWidth"));const t=Math.min((this.canvas.offsetWidth-e*2)/this.paper.offsetWidth,(this.canvas.offsetHeight-e*2)/this.paper.offsetHeight);this.setzoom(t)}getZoomFactor(){return this.zoomfactor}setzoom(e=1){this.zoomfactor=e,this.paper.style.transform=`scale(${e})`}zoomIncrement(e=0,t=this.canvas.offsetWidth/2,s=this.canvas.offsetHeight/2){let n=this.canvasPosToPaperPos(t,s);this.setzoom(Math.min(globalThis.SITPLANVIEW_ZOOMINTERVAL.MAX,Math.max(globalThis.SITPLANVIEW_ZOOMINTERVAL.MIN,this.zoomfactor*(1+e))));const r=this.canvasAndPaperPosToScrollPos(t,s,n.x,n.y);this.canvas.scrollLeft=r.x,this.canvas.scrollTop=r.y}getSelectionMovability(){let e=3;for(let t of this.selected.getAllSelected()){let s=t.sitPlanElementRef;if(s!=null)switch(s.movable){case!0:e==3||e==0?e=0:e==1&&(e=2);break;case!1:default:e==3||e==1?e=1:e==0&&(e=2);break}}return e}toggleSelectedBoxesMovable(e=3){if(e==3){let t=this.getSelectionMovability();e=t==0||t==2?1:0}for(let t of this.selected.getAllSelected()){let s=t.sitPlanElementRef;if(s!=null){let n=s.boxlabelref;switch(e){case 1:s.movable=!1,t.setAttribute("movable","false"),n!=null&&n.setAttribute("movable","false");break;case 0:s.movable=!0,t.setAttribute("movable","true"),n!=null&&n.setAttribute("movable","true");break}}}this.selected.length()>0&&globalThis.undostruct.store()}changePageSelectedBoxes(){if(this.selected.length()>0){const e=Array.from({length:this.sitplan.numPages},(a,o)=>String(o+1)).filter(a=>a!==String(this.sitplan.activePage));let t=this.selected.getAllSelected().filter(a=>a!=null),s=t.filter(a=>a.sitPlanElementRef!=null&&a.sitPlanElementRef.movable),r=t.map(a=>a.sitPlanElementRef).filter(a=>a!=null).filter(a=>a.movable);(async()=>{const a=await Mi("Nieuwe pagina:",e);if(a!==null){for(let o of r)o.changePage(+a);this.selectPage(+a);for(let o of s)this.selectBox(o);globalThis.undostruct.store()}})()}}startAddDistanceLine(){this.isAddingDistanceLine=!0,this.distanceLineFirstPoint=null,this.previousCanvasCursor==null&&(this.previousCanvasCursor=this.canvas.style.cursor),this.canvas.style.cursor="crosshair",this.paper.style.cursor="crosshair",document.body.classList.add("distance-line-mode"),this.clearSelection(),document.addEventListener("mousedown",this.distanceLineCaptureMouseDown,!0),document.addEventListener("touchstart",this.distanceLineCaptureTouchStart,{passive:!1,capture:!0}),document.addEventListener("contextmenu",this.distanceLineCaptureContextMenu,!0)}cancelAddDistanceLine(){this.isAddingDistanceLine&&(this.isAddingDistanceLine=!1,this.distanceLineFirstPoint=null,document.removeEventListener("mousedown",this.distanceLineCaptureMouseDown,!0),document.removeEventListener("touchstart",this.distanceLineCaptureTouchStart,!0),document.removeEventListener("contextmenu",this.distanceLineCaptureContextMenu,!0),this.previousCanvasCursor!=null?(this.canvas.style.cursor=this.previousCanvasCursor,this.previousCanvasCursor=null):this.canvas.style.cursor="",this.paper.style.cursor="",document.body.classList.remove("distance-line-mode"))}startAddCableRun(e=!1){var n,r,a;const t=(r=(n=this.sideBar)==null?void 0:n.getSelectedKring)==null?void 0:r.call(n);if(t==null||t===""){alert("Selecteer eerst een kring in de sidebar (open een kring) om kabels voor die kring te tekenen.");return}const s=this.getDefaultCableSpecForKring(t);if(this.pendingCableRunSpec=s!=null?s:null,e||this.pendingCableRunSpec==null){const o=window.prompt("Kabeltype/spec voor deze kabelrun:",(a=this.pendingCableRunSpec)!=null?a:"");if(o==null)return;const l=o.trim();this.pendingCableRunSpec=l===""?s!=null?s:null:l}this.isAddingCableRun=!0,this.cableRunPoints=[],this.cableRunPreviewCursorPos=null,this.previousCanvasCursorCable==null&&(this.previousCanvasCursorCable=this.canvas.style.cursor),this.canvas.style.cursor="crosshair",this.paper.style.cursor="crosshair",document.body.classList.add("cable-run-mode"),this.clearSelection(),document.addEventListener("mousedown",this.cableRunCaptureMouseDown,!0),document.addEventListener("mousemove",this.cableRunCaptureMouseMove,!0),document.addEventListener("touchstart",this.cableRunCaptureTouchStart,{passive:!1,capture:!0}),document.addEventListener("touchmove",this.cableRunCaptureTouchMove,{passive:!1,capture:!0}),document.addEventListener("contextmenu",this.cableRunCaptureContextMenu,!0)}cancelAddCableRun(){this.isAddingCableRun&&(this.isAddingCableRun=!1,this.cableRunPoints=[],this.cableRunPreviewCursorPos=null,this.pendingCableRunSpec=null,this.removeCableRunPreview(),document.removeEventListener("mousedown",this.cableRunCaptureMouseDown,!0),document.removeEventListener("mousemove",this.cableRunCaptureMouseMove,!0),document.removeEventListener("touchstart",this.cableRunCaptureTouchStart,!0),document.removeEventListener("touchmove",this.cableRunCaptureTouchMove,!0),document.removeEventListener("contextmenu",this.cableRunCaptureContextMenu,!0),this.previousCanvasCursorCable!=null?(this.canvas.style.cursor=this.previousCanvasCursorCable,this.previousCanvasCursorCable=null):this.canvas.style.cursor="",this.paper.style.cursor="",document.body.classList.remove("cable-run-mode"))}handleCableRunPoint(e){this.cableRunPoints.push(e),this.updateCableRunPreview()}removeCableRunPreview(){var t,s;const e=this.cableRunPreviewElement;if(e){try{(t=e.boxref)==null||t.remove()}catch(n){}try{(s=e.boxlabelref)==null||s.remove()}catch(n){}this.cableRunPreviewElement=null}}updateCableRunPreview(){var s,n,r,a,o,l,c;if(!this.isAddingCableRun){this.removeCableRunPreview();return}const e=(r=(n=(s=this.sideBar)==null?void 0:s.getSelectedKring)==null?void 0:n.call(s))!=null?r:null,t=this.cableRunPoints.slice();if(t.length>=1&&this.cableRunPreviewCursorPos&&t.push(this.cableRunPreviewCursorPos),t.length<2){this.removeCableRunPreview();return}if(this.cableRunPreviewElement){const d=this.cableRunPreviewElement;d.page=this.sitplan.activePage,d.visible=!0,d.setCableRunAbsolute(t,e,this.pendingCableRunSpec),this.updateBoxContent(d)}else{const d=new we;d.setVars({page:this.sitplan.activePage,movable:!1,labelfontsize:this.sitplan.defaults.fontsize}),d.visible=!0,d.setCableRunAbsolute(t,e,this.pendingCableRunSpec),this.makeBox(d),(o=(a=d.boxref)==null?void 0:a.classList)==null||o.add("cable-run-preview"),(c=(l=d.boxlabelref)==null?void 0:l.classList)==null||c.add("hidden"),this.cableRunPreviewElement=d}this.updateSymbolAndLabelPosition(this.cableRunPreviewElement)}finishAddCableRun(){var n,r,a;if(!this.isAddingCableRun)return;const e=this.cableRunPoints.slice(),t=(a=(r=(n=this.sideBar)==null?void 0:n.getSelectedKring)==null?void 0:r.call(n))!=null?a:null;if(e.length<2){this.cancelAddCableRun();return}const s=new we;s.setVars({page:this.sitplan.activePage,movable:!0,labelfontsize:this.sitplan.defaults.fontsize}),s.setCableRunAbsolute(e,t,this.pendingCableRunSpec),this.sitplan.addElement(s),this.syncToSitPlan(),this.clearSelection(),this.redraw(),this.selectOneBox(s.boxref),this.bringToFront(!0),this.cancelAddCableRun(),globalThis.undostruct.store()}handleDistanceLinePoint(e){var l,c,d;if(this.distanceLineFirstPoint==null){this.distanceLineFirstPoint=e;return}const t=this.distanceLineFirstPoint,s=e;this.distanceLineFirstPoint=null;const n=(d=(c=(l=this.sitplan)==null?void 0:l.getMetersPerUnitForPage)==null?void 0:c.call(l,this.sitplan.activePage))!=null?d:null;if(n!=null){const h=s.x-t.x,p=s.y-t.y,g=Math.sqrt(h*h+p*p),m=Math.round(g*n*100);this.addDistanceLine(t,s,Number.isFinite(m)?m:null),this.cancelAddDistanceLine();return}const r=window.prompt("Afstand in centimeter (cm):","");if(r==null){this.cancelAddDistanceLine();return}const a=r.trim(),o=a===""?null:Number(a.replace(",","."));if(a!==""&&!(Number.isFinite(o)&&o>=0)){alert("Ongeldige afstand. Geef een getal in centimeters in."),this.cancelAddDistanceLine();return}this.addDistanceLine(t,s,o),this.cancelAddDistanceLine()}handleCanvasPointerDown(e){var s,n,r,a;if(this.contextMenu.hide(),!this.isAddingDistanceLine&&e.button!=null){const o=e;if(o.button===0&&(o.ctrlKey||o.metaKey)){(s=o.preventDefault)==null||s.call(o),(n=o.stopPropagation)==null||n.call(o),this.startCanvasPan(o);return}}if(!this.isAddingDistanceLine&&!this.isAddingCableRun){this.clearSelection();return}(r=e.preventDefault)==null||r.call(e),(a=e.stopPropagation)==null||a.call(e);const t=(()=>{var o;if(e.touches!=null){const l=e,c=(o=l.touches[0])!=null?o:l.changedTouches[0];if(!c)return null;const d=this.canvas.getBoundingClientRect(),h=c.clientX-d.left,p=c.clientY-d.top;return this.canvasPosToPaperPos(h,p)}return this.mouseEventToPaperPos(e)})();t&&this.handleDistanceLinePoint(t)}getDefaultCableSpecForKring(e){var t,s,n,r;try{const a=globalThis.structure,o=Array.isArray(a==null?void 0:a.data)?a.data:[],l=String(e!=null?e:"").trim();if(l==="")return null;for(const c of o){if(!(c!=null&&c.getType)||c.getType()!=="Kring"||String((s=(t=c==null?void 0:c.props)==null?void 0:t.naam)!=null?s:"").trim()!==l)continue;const h=String((r=(n=c==null?void 0:c.props)==null?void 0:n.type_kabel)!=null?r:"").trim();return h===""?null:h}}catch(a){}return null}startCanvasPan(e){this.isPanningCanvas||(this.isPanningCanvas=!0,this.panStart={x:e.clientX,y:e.clientY,scrollLeft:this.canvas.scrollLeft,scrollTop:this.canvas.scrollTop},this.previousCanvasCursorPan=this.canvas.style.cursor,this.canvas.style.cursor="grabbing",document.addEventListener("mousemove",this.processCanvasPan),document.addEventListener("mouseup",this.stopCanvasPan))}makeBox(e,t=null){let s=document.createElement("div");Object.assign(s,{id:e.id,className:"box",sitPlanElementRef:e}),s.setAttribute("movable",e.movable?"true":"false"),e.boxref=s;let n=document.createElement("div");Object.assign(n,{id:e.id+"_label",className:"boxlabel",sitPlanElementRef:e}),n.setAttribute("movable",e.movable?"true":"false"),n.innerHTML=E(e.getAdres()),e.boxlabelref=n,this.updateBoxContent(e),t?t.append(s,n):this.paper.append(s,n),s.addEventListener("mousedown",this.startDrag),s.addEventListener("touchstart",this.startDrag),s.addEventListener("dblclick",r=>{var l;const a=(l=r.currentTarget)==null?void 0:l.sitPlanElementRef;if(!a||a.kind!=="cableRun"||document.getElementById("popupOverlay")!=null)return;this.contextMenu.hide();const o=this.mouseEventToPaperPos(r);this.insertCableVertexAt(a,o)}),n.addEventListener("mousedown",this.startDrag),n.addEventListener("touchstart",this.startDrag),s.addEventListener("contextmenu",this.showContextMenu),n.addEventListener("contextmenu",this.showContextMenu)}updateBoxContent(e){if(!e)return;const t=e.boxref,s=e.boxlabelref;if(t==null)return;let n=e.getScaledSVG();if(e.needsViewUpdate&&(e.needsViewUpdate=!1,n!=null?t.innerHTML=n:t.innerHTML=""),s!=null){let r=e.getAdres();e.labelfontsize!=null&&(s.style.fontSize=String(e.labelfontsize)+"px");let a=r!=null?E(r):"";a!=s.innerHTML&&(s.innerHTML=a)}}updateLabelPosition(e){if(!e)return;const t=e.boxlabelref;if(!t)return;const s=e.getscale(),n=Ln(e.sizex*s+globalThis.SITPLANVIEW_SELECT_PADDING,e.sizey*s+globalThis.SITPLANVIEW_SELECT_PADDING,e.rotate),r=e.getAdresLocation();switch(r){case"links":e.labelposx=e.posx-n.width/2-t.offsetWidth/2;break;case"rechts":e.labelposx=e.posx+n.width/2+t.offsetWidth/2;break;default:e.labelposx=e.posx}const a=`${e.labelposx-t.offsetWidth/2}px`;t.style.left!=a&&(t.style.left=a);let o;switch(r){case"boven":{o=`${e.posy-n.height/2-t.offsetHeight*.8}px`,e.labelposy=e.posy-n.height/2-t.offsetHeight*.5/2;break}case"onder":{o=`${e.posy+n.height/2-t.offsetHeight*.2}px`,e.labelposy=e.posy+n.height/2+t.offsetHeight*.7/2;break}default:o=`${e.posy-t.offsetHeight/2}px`,e.labelposy=e.posy+1}t.style.top!=o&&(t.style.top=o),this.sitplan.activePage==e.page&&e.visible!==!1?t.classList.contains("hidden")&&t.classList.remove("hidden"):t.classList.contains("hidden")||t.classList.add("hidden")}updateSymbolPosition(e){function t(g){if(!g)return"";const[m,v]=g.berekenAfbeeldingsRotatieEnSpiegeling();return`rotate(${m}deg)`+(v?" scaleX(-1)":"")}if(!e)return;const s=e.boxref;if(!s)return;const n=e.getscale(),r=e.sizex*n,a=e.sizey*n,o=(e.posx-r/2-globalThis.SITPLANVIEW_SELECT_PADDING).toString()+"px";s.style.left!=o&&(s.style.left=o);const l=(e.posy-a/2-globalThis.SITPLANVIEW_SELECT_PADDING).toString()+"px";s.style.top!=l&&(s.style.top=l);const c=(r+globalThis.SITPLANVIEW_SELECT_PADDING*2).toString()+"px";s.style.width!=c&&(s.style.width=c);const d=(a+globalThis.SITPLANVIEW_SELECT_PADDING*2).toString()+"px";s.style.height!=d&&(s.style.height=d);const h=t(e);s.style.transform!=h&&(s.style.transform=h),this.sitplan.activePage==e.page&&e.visible!==!1?s.classList.contains("hidden")&&s.classList.remove("hidden"):s.classList.contains("hidden")||s.classList.add("hidden")}updateSymbolAndLabelPosition(e){e&&(this.updateSymbolPosition(e),this.updateLabelPosition(e))}redraw(){const e=performance.now();this.syncToSitPlan();const t=document.createDocumentFragment();let s=!1;for(let r of this.sitplan.elements)r.boxref||(this.makeBox(r,t),s=!0);s&&this.paper.append(t),this.showPage(this.sitplan.activePage);for(let r of this.sitplan.elements)r.page==this.sitplan.activePage&&(this.updateBoxContent(r),this.updateSymbolAndLabelPosition(r));this.updateRibbon(),this.sideBar.render();const n=performance.now();console.log(`Redraw took ${n-e}ms`)}getLastSelectedBoxOrdinal(){return this.selected.length()==0?null:this.sitplan.elements.findIndex(e=>e.boxref==this.selected.getLastSelected())}getSelectedBoxesOrdinals(){return this.selected.length()==0?[]:this.sitplan.elements.filter(e=>this.selected.includes(e.boxref)).map(e=>this.sitplan.elements.indexOf(e))}selectOneBox(e){e&&(e.classList.add("selected"),this.selected.selectOne(e),globalThis.undostruct.updateSelectedBoxes())}selectBox(e){e&&(e.classList.add("selected"),this.selected.select(e),globalThis.undostruct.updateSelectedBoxes())}selectToggleBox(e){e&&(this.selected.toggleButNeverRemoveLast(e),this.selected.includes(e)?e.classList.add("selected"):e.classList.remove("selected"),globalThis.undostruct.updateSelectedBoxes())}clearSelection(){document.querySelectorAll(".box").forEach(t=>t.classList.remove("selected")),this.selected.clear()}deleteSelectedBoxes(){if(this.selected.length()!=0){for(let e of this.selected.getAllSelected()){let t=e.sitPlanElementRef;t!=null&&t.movable!=!1&&(e.remove(),t.boxlabelref!=null&&t.boxlabelref.remove(),this.sitplan.removeElement(t))}this.selected.clear(),this.sideBar.render()}}sendToBack(){if(this.selected.length()!=0){for(let e of this.sitplan.elements)if(e.boxref!=null){let t;this.selected.includes(e.boxref)&&e.movable!=!1?t=0:t=(parseInt(e.boxref.style.zIndex)||0)+1,e.boxref.style.zIndex=t.toString(),e.boxlabelref!=null&&(e.boxlabelref.style.zIndex=t.toString())}this.sitplan.orderByZIndex(),globalThis.undostruct.store()}}bringToFront(e=!0){if(this.selected.length()==0)return;let t=0;for(let s of this.sitplan.elements)s.boxref!=null&&!this.selected.includes(s.boxref)&&(t=Math.max(t,parseInt(s.boxref.style.zIndex)||0));t+=1;for(let s of this.selected.getAllSelected()){let n=s.sitPlanElementRef;if(n==null){this.sitplan.syncToSitPlan();return}n.movable!=!1&&(s.style.zIndex=t.toString(),n.boxlabelref!=null&&(n.boxlabelref.style.zIndex=t.toString()))}this.sitplan.orderByZIndex(),e&&globalThis.undostruct.store()}getDraggedHaloAroundElement(e){let t=e.posx,s=e.posy,n=e.posx,r=e.posy;for(let o of this.selected.getAllSelected()){if(o==null||o===this.draggedBox)continue;const l=o.sitPlanElementRef;l!=null&&l.movable!=!1&&(t=Math.min(t,l.posx),s=Math.min(s,l.posy),n=Math.max(n,l.posx),r=Math.max(r,l.posy))}return{left:e.posx-t,right:n-e.posx,top:e.posy-s,bottom:r-e.posy}}selectPage(e){this.sitplan.activePage=e,this.redraw()}showPage(e){this.clearSelection();for(let t of this.sitplan.elements)t.page!=e||t.visible===!1?(t.boxref.classList.add("hidden"),t.boxlabelref.classList.add("hidden")):(t.boxref.classList.remove("hidden"),t.boxlabelref.classList.remove("hidden"));this.updateRibbon()}hideSelectedBoxes(){if(this.selected.length()!==0){for(let e of this.selected.getAllSelected()){const t=e==null?void 0:e.sitPlanElementRef;t&&(t.visible=!1,this.updateSymbolAndLabelPosition(t))}this.clearSelection(),this.sideBar.render(),globalThis.undostruct.store()}}showAllElements(){var e;for(let t of this.sitplan.elements)((e=t.getElectroItemId)==null?void 0:e.call(t))!=null&&(t.visible=!0);this.redraw(),globalThis.undostruct.store()}hideAllElements(){var e;for(let t of this.sitplan.elements)((e=t.getElectroItemId)==null?void 0:e.call(t))!=null&&(t.visible=!1);this.clearSelection(),this.redraw(),globalThis.undostruct.store()}rotateSelectedBoxes(e,t=!1){function s(n,r){const a=["boven","rechts","onder","links"];if(n==null)return;const o=a.indexOf(n.getAdresLocation());n.setAdresLocation(a[(o+r+4)%4])}for(let n of this.selected.getAllSelected()){let r=n.sitPlanElementRef;r!=null&&r.movable!=!1&&(r.rotate=(r.rotate+e)%360,t&&s.bind(this)(r,Math.round(e/90)),this.updateBoxContent(r),this.updateSymbolAndLabelPosition(r))}this.selected.length()>0&&globalThis.undostruct.store()}unattachArrowKeys(){this.event_manager.addEventListener(document,"keydown",()=>{})}attachArrowKeys(){this.event_manager.addEventListener(document,"keydown",e=>{if(this.contextMenu.hide(),document.getElementById("outerdiv").style.display=="none"||document.getElementById("popupOverlay")!=null)return;if(e.key==="Escape"){if(this.isAddingDistanceLine){this.cancelAddDistanceLine();return}if(this.isAddingCableRun){this.cancelAddCableRun();return}}let t=this.selected.getAllSelected().filter(o=>o!=null),s=t.filter(o=>o.sitPlanElementRef!=null&&o.sitPlanElementRef.movable),n=t.map(o=>o.sitPlanElementRef).filter(o=>o!=null),r=n.filter(o=>o.movable);const a=parseFloat(getComputedStyle(this.paper).getPropertyValue("--paperPadding"));if(e.ctrlKey)switch(e.key){case"z":e.preventDefault(),globalThis.undostruct.undo();return;case"y":e.preventDefault(),globalThis.undostruct.redo();return;case"r":e.preventDefault(),new ze(globalThis.appDocStorage).show("sitplan.Ctrl_r_key",`<h3>Ctrl-r genegeerd</h3>
                        <p>Om te vermijden dat u per ongeluk de pagina ververst en uw werk verliest is de refresh sneltoets uitgeschakeld in het situatieschema.</p>`,!0);return}if(this.selected.length()>0){e.preventDefault();const o=this.selected.getLastSelected().sitPlanElementRef;if(!o)return;const l=this.getDraggedHaloAroundElement(o);if(e.ctrlKey)switch(e.key){case"ArrowLeft":this.rotateSelectedBoxes(-90,!0);return;case"ArrowRight":this.rotateSelectedBoxes(90,!0);return;case"l":case"L":this.toggleSelectedBoxesMovable();return;default:return}else switch(e.key){case"ArrowLeft":{const h=Math.max(l.left-a/this.zoomfactor,o.posx-1)-o.posx;for(let p of r)p.posx+=h;globalThis.undostruct.store("arrowMove"+o.id);break}case"ArrowRight":const c=1;for(let h of r)h.posx+=c;globalThis.undostruct.store("arrowMove"+o.id);break;case"ArrowUp":{const h=Math.max(l.top-a/this.zoomfactor,o.posy-1)-o.posy;for(let p of r)p.posy+=h;globalThis.undostruct.store("arrowMove"+o.id);break}case"ArrowDown":const d=1;for(let h of r)h.posy+=d;globalThis.undostruct.store("arrowMove"+o.id);break;case"PageDown":{let h=o.page,p=o.page+1;if(p>this.sitplan.numPages&&(p=1),p==h)return;for(let g of r)g.changePage(p);this.selectPage(p);for(let g of s)this.selectBox(g);this.bringToFront(!1),globalThis.undostruct.store()}break;case"PageUp":{let h=o.page,p=o.page-1;if(p<1&&(p=this.sitplan.numPages),p==h)return;this.selected.getAllSelected();for(let g of r)g.changePage(p);this.selectPage(p);for(let g of s)this.selectBox(g);this.bringToFront(!1),globalThis.undostruct.store()}break;case"Escape":this.isAddingDistanceLine&&this.cancelAddDistanceLine(),this.clearSelection();break;case"Enter":this.editSelectedBox();return;case"Delete":this.selected.length()>0&&(this.deleteSelectedBoxes(),globalThis.undostruct.store());break;default:return}t=this.selected.getAllSelected().filter(c=>c!=null),s=t.filter(c=>c.sitPlanElementRef!=null&&c.sitPlanElementRef.movable),n=t.map(c=>c.sitPlanElementRef).filter(c=>c!=null),r=n.filter(c=>c.movable);for(let c of r)this.updateSymbolAndLabelPosition(c)}else switch(e.key){case"PageDown":{let o=this.sitplan.activePage,l=o+1;l>this.sitplan.numPages&&(l=1),this.selectPage(l),l!=o&&globalThis.undostruct.store("changePage")}break;case"PageUp":{let l=this.sitplan.activePage-1;l<1&&(l=this.sitplan.numPages),this.selectPage(l),l!=this.sitplan.activePage&&globalThis.undostruct.store("changePage")}break}})}attachDeleteButton(e){this.event_manager.addEventListener(e,"click",()=>{this.contextMenu.hide(),this.selected.length()>0&&(this.deleteSelectedBoxes(),new ze(globalThis.appDocStorage).show("sitplan.deletekey",`<h3>Tip: Symbolen verwijderen</h3>
                <p>Bespaar tijd en gebruik de 'Delete' toets op het toetsenbord om symbolen te verwijderen.</p>`,!0),globalThis.undostruct.store())})}attachSendToBackButton(e){this.event_manager.addEventListener(e,"click",()=>{this.contextMenu.hide(),this.sendToBack()})}attachBringToFrontButton(e){this.event_manager.addEventListener(e,"click",()=>{this.contextMenu.hide(),this.bringToFront()})}attachZoomButton(e,t){this.event_manager.addEventListener(e,"click",()=>{this.contextMenu.hide(),this.zoomIncrement(t)})}attachZoomToFitButton(e){this.event_manager.addEventListener(e,"click",()=>{this.contextMenu.hide(),this.zoomToFit()})}attachAddElementFromFileButton(e,t){this.event_manager.addEventListener(e,"click",()=>{this.contextMenu.hide(),t.click()}),this.event_manager.addEventListener(t,"change",s=>{var l,c;const n=this.pendingAddPos;this.pendingAddPos=null;const r=(l=n==null?void 0:n.x)!=null?l:this.paper.offsetWidth/2,a=(c=n==null?void 0:n.y)!=null?c:this.paper.offsetHeight/2;let o=this.sitplan.addElementFromFile(s,this.sitplan.activePage,r,a,(()=>{this.syncToSitPlan(),this.clearSelection(),o.needsViewUpdate=!0;const d=o.scale;if(o.scaleSelectedBoxToPaperIfNeeded(this.paper.offsetWidth*.995,this.paper.offsetHeight*.995,this.sitplan.defaults.scale),this.redraw(),this.selectOneBox(o.boxref),t.value="",o.sizex==0||o.sizey==0){this.deleteSelectedBoxes(),new Ze("Ongeldige afmetingen","<p>Dit bestand wordt door de browser herkend als een afbeelding met hoogte of breedte gelijk aan 0.</p><p>Dit bestand kan bijgevolg niet geladen worden.</p>").show();return}o.svg&&o.svg.length>5e6&&new Ze("Zeer groot bestand","<p>Dit bestand is met "+(o.svg.length/1e6*6/8).toFixed(0)+"MB behoorlijk groot en kan uw browser vertragen of tot moeilijkheden leiden bij het opslaan en/of printen.</p><p>We raden aan het bestand te verkleinen tot beneden 5MB, bijvoorbeeld door het gebruik van het jpeg-bestandsformaat en/of verlagen van de resolutie.</p>").show(),this.bringToFront(),o.scale!=d&&new ze(globalThis.appDocStorage).show("sitplan.scaledImageToFit",'<h3>Mededeling</h3><p>Deze afbeelding werd automatisch verkleind om binnen de tekenzone te blijven.</p><p>Kies "Bewerk" in het menu om de schaalfactor verder aan te passen indien gewenst.</p>',!0)}).bind(this))})}attachAddElectroItemButton(e){this.event_manager.addEventListener(e,"click",()=>{this.contextMenu.hide(),this.unattachArrowKeys(),_t(null,(t,s,n,r,a,o,l,c)=>{this.attachArrowKeys(),this.addElectroItem(t,s,n,r,a,o,l,c)},()=>{this.attachArrowKeys()})})}attachAddCustomItemButton(e){this.event_manager.addEventListener(e,"click",()=>{ps.showItemTypeSelectionPopup((t,s,n)=>{const r=globalThis.structure.createContainerIfNotExists(),a=globalThis.structure.createItem(t);globalThis.structure.insertChildAfterId(a,r.id);let o=globalThis.structure.sitplan.defaults.fontsize;this.addElectroItem(a.id,"manueel","","rechts",o,s,n)})})}addDistanceLine(e,t,s){const n=new we;if(n.setVars({page:this.sitplan.activePage,movable:!0,labelfontsize:this.sitplan.defaults.fontsize}),n.setDistanceLineAbsolute(e,t,s),s!=null){const r=t.x-e.x,a=t.y-e.y,o=Math.sqrt(r*r+a*a);if(Number.isFinite(o)&&o>0){const l=s/100/o;this.sitplan.setMetersPerUnitForPage(this.sitplan.activePage,l)}}this.sitplan.addElement(n),this.syncToSitPlan(),this.clearSelection(),this.redraw(),this.selectOneBox(n.boxref),this.bringToFront(!0)}attachEditButton(e){this.event_manager.addEventListener(e,"click",()=>{this.editSelectedBox()})}wipePage(e){let t=this.sitplan.elements.filter(s=>s.page==e);for(let s of t)s!=null&&(s.boxref!=null&&s.boxref.remove(),s.boxlabelref!=null&&s.boxlabelref.remove(),this.sitplan.removeElement(s))}updateRibbon(){if(globalThis.structure.properties.currentView!="draw")return;let e="",t="";e+=`
            <div class="icon" ${globalThis.undostruct.undoStackSize()>0?'onclick="undoClicked()"':'style="filter: opacity(45%)"'}>
                <img src="gif/undo.png" alt="Ongedaan maken" class="icon-image">
                <span class="icon-text">Ongedaan maken</span>
            </div>
            <div class="icon"  ${globalThis.undostruct.redoStackSize()>0?'onclick="redoClicked()"':'style="filter: opacity(45%)"'}>
                <img src="gif/redo.png" alt="Opnieuw" class="icon-image">
                <span class="icon-text">Opnieuw</span>
            </div>`,e+=`
            <span style="display: inline-block; width: 30px;"></span>
            <div class="icon" id="button_Add">
                <span class="icon-image" style="font-size:24px">➕</span>
                <span class="icon-text">Uit bestand</span>
            </div>
            <div class="icon" id="button_Add_electroItem">
                <span class="icon-image" style="font-size:24px">➕</span>
                <span class="icon-text">Uit schema</span>
            </div>`,e+=`
            <div class="icon" id="button_Add_customItem">
                <span class="icon-image" style="font-size:24px">➕</span>
                <span class="icon-text">Los symbool</span>
            </div>`,e+=`
            <div class="icon" id="button_Add_distanceLine">
                <span class="icon-image" style="font-size:24px">📏</span>
                <span class="icon-text">Afstandslijn</span>
            </div>`,e+=`
            <div class="icon" id="button_Add_connectionPoint">
                <span class="icon-image" style="font-size:24px">📍</span>
                <span class="icon-text">Verbinding</span>
            </div>`,e+=`
            <div class="icon" id="button_Add_cableRun">
                <span class="icon-image" style="font-size:24px">🧵</span>
                <span class="icon-text">Kabel</span>
            </div>`,e+=`
            <div class="icon" id="button_Delete">
                <span class="icon-image" style="font-size:24px">🗑</span>
                <span class="icon-text">Verwijder</span>
            </div>`,e+=`
            <span style="display: inline-block; width: 10px;"></span>
            <div class="icon" id="button_edit">
                <span class="icon-image" style="font-size:24px">&#x2699;</span>
                <span class="icon-text">Bewerk</span>
            </div>`,e+=`
            <span style="display: inline-block; width: 10px;"></span>
            <div class="icon" id="sendBack">
                <span class="icon-image" style="font-size:24px">⬇⬇</span>
                <span class="icon-text">Naar achter</span>
            </div>
            <div class="icon" id="bringFront">
                <span class="icon-image" style="font-size:24px">⬆⬆</span>
                <span class="icon-text">Naar voor</span>
            </div>`,globalThis.autoSaver&&globalThis.autoSaver.hasChangesSinceLastManualSave()?e+=`
                <span style="display: inline-block; width: 10px;"></span>
                <div class="highlight-warning-big" style="width: 64px; display: inline-block; vertical-align: middle; text-align: center;" id="button_save" onclick="saveSchema()" onmouseover="this.style.cursor='pointer'" onmouseout="this.style.cursor='default'">
                    <span class="icon-image" style="font-size:24px">💾</span>
                    <span class="icon-text" style="display: inline-block; width: 100%;">Opslaan</span>
                </div>`:e+=`
                <span style="display: inline-block; width: 10px;"></span>
                <div class="highlight-ok-big" id="button_save" style="width: 64px; display: inline-block; vertical-align: middle; text-align: center;" onmouseover="this.style.cursor='pointer'" onmouseout="this.style.cursor='default'" onclick="topMenu.selectMenuItemByName('Bestand')">
                    <span class="icon-image" style="font-size:24px; filter: grayscale(100%); opacity: 0.5;">💾</span>
                    <span class="icon-text" style="display: inline-block; width: 100%;">Bestand</span>
                </div>`,e+=`
            <span style="display: inline-block; width: 50px;"></span>
            <div>
                <center>
                    <span style="display: inline-block; white-space: nowrap;">Pagina
                        <select id="id_sitplanpage">`;for(let a=1;a<=this.sitplan.numPages;a++)e+='<option value="'+a+'"'+(a==this.sitplan.activePage?" selected":"")+">"+a+"</option>";e+=`
                        </select>
                    </span><br><span style="display: inline-block; white-space: nowrap;">
                        <button id="btn_sitplan_addpage" ${this.sitplan.activePage!=this.sitplan.numPages?" disabled":""}>Nieuw</button>
                        <button id="btn_sitplan_delpage" style="background-color:red;" ${this.sitplan.numPages<=1?" disabled":""}>&#9851;</button>
                    </span>
                    <br><span style="display: inline-block; white-space: nowrap; margin-top: 4px;">Verdieping
                        <select id="id_sitplanfloor" style="max-width: 160px;"></select>
                        <button id="btn_sitplan_addfloor">Nieuw</button>
                        <button id="btn_sitplan_pagesettings" title="Instellingen pagina/verdieping">⚙</button>
                    </span>
                </center>
            </div>`,t+=`
            <span style="display: inline-block; width: 10px;"></span>
            <div class="icon" id="button_zoomin">
                <span class="icon-image" style="font-size: 24px;">🔍</span>
                <span class="icon-text">In</span>
            </div>
            <div class="icon" id="button_zoomout">
                <span class="icon-image" style="font-size: 24px;">🌍</span>
                <span class="icon-text">Uit</span>
            </div>
            <div class="icon" id="button_zoomToFit">
                <span class="icon-image" style="font-size: 24px;">🖥️</span>
                \x3C!--<img src="gif/scaleup.png" alt="Schermvullend" class="icon-image">-->
                <span class="icon-text">Schermvullend</span>
            </div>
            <span style="display: inline-block; width: 10px;"></span>`,document.getElementById("ribbon").innerHTML=`<div id="left-icons">${e}</div><div id="right-icons">${t}</div>`,document.getElementById("id_sitplanpage").onchange=a=>{this.contextMenu.hide();const o=a.target;this.selectPage(Number(o.value)),globalThis.undostruct.store("changePage")},document.getElementById("btn_sitplan_addpage").onclick=()=>{this.contextMenu.hide(),this.sitplan.numPages++,this.selectPage(this.sitplan.numPages),this.sitplan.ensurePageFloorIdsLength();const a=this.sitplan.getFloorIdForPage(Math.max(1,this.sitplan.activePage-1));this.sitplan.numPages>=1&&this.sitplan.setFloorIdForPage(this.sitplan.numPages,a),this.sitplan.ensurePageMetersPerUnitLength();const o=this.sitplan.getMetersPerUnitForPage(Math.max(1,this.sitplan.activePage-1));this.sitplan.setMetersPerUnitForPage(this.sitplan.numPages,o),globalThis.undostruct.store(),this.updateRibbon()},document.getElementById("btn_sitplan_delpage").onclick=()=>{this.contextMenu.hide(),new Ze("Pagina verwijderen",`Pagina ${this.sitplan.activePage} volledig verwijderen?`,[{text:"OK",callback:(()=>{this.wipePage(this.sitplan.activePage),this.sitplan.elements.forEach(o=>{o.page>this.sitplan.activePage&&o.page--}),this.sitplan.ensurePageFloorIdsLength(),this.sitplan.pageFloorIds.splice(this.sitplan.activePage-1,1),this.sitplan.ensurePageMetersPerUnitLength(),this.sitplan.pageMetersPerUnit.splice(this.sitplan.activePage-1,1),this.sitplan.numPages>1&&this.sitplan.numPages--,this.sitplan.ensurePageFloorIdsLength(),this.sitplan.ensurePageMetersPerUnitLength(),this.selectPage(Math.min(this.sitplan.activePage,this.sitplan.numPages)),globalThis.undostruct.store(),this.updateRibbon()}).bind(this)},{text:"Annuleren",callback:()=>{}}]).show()},this.attachAddElementFromFileButton(document.getElementById("button_Add"),document.getElementById("fileInput")),this.attachAddElectroItemButton(document.getElementById("button_Add_electroItem")),this.attachAddCustomItemButton(document.getElementById("button_Add_customItem")),this.event_manager.addEventListener(document.getElementById("button_Add_distanceLine"),"click",()=>{this.contextMenu.hide(),this.startAddDistanceLine()}),this.event_manager.addEventListener(document.getElementById("button_Add_connectionPoint"),"click",()=>{this.contextMenu.hide(),this.startAddConnectionPoint(!0)}),this.event_manager.addEventListener(document.getElementById("button_Add_cableRun"),"click",()=>{this.contextMenu.hide(),this.startAddCableRun(!1)}),this.attachDeleteButton(document.getElementById("button_Delete")),this.attachEditButton(document.getElementById("button_edit")),this.attachSendToBackButton(document.getElementById("sendBack")),this.attachBringToFrontButton(document.getElementById("bringFront")),this.attachZoomButton(document.getElementById("button_zoomin"),.1),this.attachZoomButton(document.getElementById("button_zoomout"),-.1),this.attachZoomToFitButton(document.getElementById("button_zoomToFit")),this.sitplan.ensureFloorsInitialized(),this.sitplan.ensurePageFloorIdsLength(),this.sitplan.ensurePageMetersPerUnitLength();const s=document.getElementById("id_sitplanfloor");if(s){const a=this.sitplan.getFloorIdForPage(this.sitplan.activePage);s.innerHTML="";const o=document.createElement("option");o.value="",o.textContent="(geen)",s.appendChild(o);for(const l of this.sitplan.floors){const c=document.createElement("option");c.value=l.id,c.textContent=l.name,a===l.id&&(c.selected=!0),s.appendChild(c)}a==null?s.value="":s.value=a,s.onchange=l=>{this.contextMenu.hide();const d=l.target.value;this.sitplan.setFloorIdForPage(this.sitplan.activePage,d===""?null:d),globalThis.undostruct.store("changeFloor")}}const n=document.getElementById("btn_sitplan_addfloor");n&&(n.onclick=()=>{this.contextMenu.hide();const a=prompt("Naam van de verdieping:","Nieuwe verdieping");if(a==null)return;const o=a.trim();if(o==="")return;const l=prompt("Hoogte/elevatie in cm (leeg = onbekend):","");if(l==null)return;const c=l.trim(),d=c===""?null:Number(c.replace(",","."));if(c!==""&&!Number.isFinite(d)){alert("Ongeldige hoogte. Geef een getal in centimeter in (bv. 300), of laat leeg.");return}const h=this.sitplan.addFloor(o,d);this.sitplan.setFloorIdForPage(this.sitplan.activePage,h),globalThis.undostruct.store("addFloor"),this.updateRibbon()});const r=document.getElementById("btn_sitplan_pagesettings");r&&(r.onclick=()=>{var S;this.contextMenu.hide(),this.sitplan.ensureFloorsInitialized(),this.sitplan.ensurePageFloorIdsLength();const a=this.sitplan.getFloorIdForPage(this.sitplan.activePage),o=Array.isArray(this.sitplan.floors)?this.sitplan.floors:[],l=['<option value="">(geen)</option>'].concat(o.map(L=>{var V;const A=a!=null&&L.id===a?" selected":"";return`<option value="${String(L.id).replace(/"/g,"&quot;")}"${A}>${E(String((V=L.name)!=null?V:""))}</option>`})).join(""),c=a!=null?o.find(L=>L.id===a):null,d=c?E(String((S=c.name)!=null?S:"")):"",h=c&&c.elevationCm!=null&&Number.isFinite(Number(c.elevationCm))?String(Number(c.elevationCm)):"",p=c&&c.cablePlaneOffsetCm!=null&&Number.isFinite(Number(c.cablePlaneOffsetCm))?String(Number(c.cablePlaneOffsetCm)):"-10",g=(()=>{var A,V;const L=Number((V=(A=this.sitplan)==null?void 0:A.defaults)==null?void 0:V.defaultDeviceHeightCm);return Number.isFinite(L)&&L>=0?String(L):"30"})(),m=[`<b>Pagina:</b> ${this.sitplan.activePage}<br>`,"<b>Verdieping op deze pagina:</b><br>",`<select id="sp_settings_floor_select" style="max-width: 260px;">${l}</select><br>`,"<br><b>Algemeen</b><br>",`Standaard toestel hoogte (cm): <input id="sp_settings_default_device_height" style="width: 120px;" type="number" step="1" min="0" value="${g}"><br>`,"<br><b>Verdieping instellingen</b><br>",`Naam: <input id="sp_settings_floor_name" style="width: 240px;" value="${d}"><br>`,`Elevatie (cm): <input id="sp_settings_floor_elev" style="width: 120px;" type="number" step="1" value="${h}"><br>`,`Kabelhoogte t.o.v. vloer (cm): <input id="sp_settings_floor_cableplane" style="width: 120px;" type="number" step="1" value="${p}"><br>`,"<small>Tip: verticale lengtes gebruiken elevaties. Leeg = onbekend.</small>"].join("");new Ze("Instellingen",m,[{text:"Annuleer",callback:()=>{}},{text:"OK",callback:()=>{var M,u,f,k,x;const L=document.getElementById("sp_settings_floor_select"),A=document.getElementById("sp_settings_floor_name"),V=document.getElementById("sp_settings_floor_elev"),C=document.getElementById("sp_settings_floor_cableplane"),N=document.getElementById("sp_settings_default_device_height");if(N){const T=String((M=N.value)!=null?M:"").trim(),_=T===""?30:Number(T.replace(",","."));Number.isFinite(_)&&_>=0&&(this.sitplan.defaults.defaultDeviceHeightCm=_)}const G=((u=L==null?void 0:L.value)!=null?u:"").trim();this.sitplan.setFloorIdForPage(this.sitplan.activePage,G===""?null:G);const w=G===""?null:G;if(w!=null){const T=o.find(_=>_.id===w);if(T&&A){const _=String((f=A.value)!=null?f:"").trim();_!==""&&(T.name=_)}if(T&&V){const _=String((k=V.value)!=null?k:"").trim(),P=_===""?null:Number(_.replace(",","."));T.elevationCm=P==null?null:Number.isFinite(P)?P:null}if(T&&C){const _=String((x=C.value)!=null?x:"").trim(),P=_===""?-10:Number(_.replace(",","."));T.cablePlaneOffsetCm=Number.isFinite(P)?P:-10}}globalThis.undostruct.store("pageFloorSettings"),this.updateRibbon(),this.sideBar.render()}}]).show()})}}function Qs(){if(globalThis.toggleAppView("draw"),globalThis.structure.sitplan||(globalThis.structure.sitplan=new Ve),globalThis.structure.sitplanview||(document.querySelectorAll('[id^="SP_"]').forEach(t=>t.remove()),globalThis.structure.sitplanview=new _r(document.getElementById("canvas"),document.getElementById("paper"),globalThis.structure.sitplan),globalThis.structure.sitplanview.zoomToFit()),globalThis.structure.properties.legacySchakelaars==null)if(globalThis.structure.sitplan.heeftEenzameSchakelaars()){new wr().show().then(()=>{globalThis.structure.sitplanview.redraw()});return}else globalThis.structure.properties.legacySchakelaars=!1;globalThis.structure.sitplanview.redraw(),new ze(globalThis.appDocStorage).show("sitplan.introductie",`<h3>Situatieschema tekenen</h3>
    <p>Op deze pagina kan u een situatieschema tekenen.</p>
    <p>Laad een plattegrond met de knop "Uit bestand" en voeg symbolen toe met de knop "Uit schema".</p>
    <p>Klik <a href="Documentation/sitplandoc.pdf" target="_blank" rel="noopener noreferrer">hier</a> om in een nieuw venster de documentatie te bekijken.</p>
    <p>We werken elke dag om dit programma beter te maken. Opmerkingen en ideeën zijn welkom in het "contact"-formulier.</p>`)}function Tr(){document.getElementById("materialsscreen")!=null&&ni()}function qt(i){return Math.round(i*10)/10}function ei(i){return Number.isFinite(i)?`${qt(i)} m`:"—"}function ti(i){return Number.isFinite(i)?Math.abs(i-Math.round(i))<1e-9?`${Math.round(i)} st`:`${qt(i)} st`:"—"}function Fe(i,e){const t=Number.parseInt(String(i!=null?i:""),10);return!Number.isFinite(t)||t<=0?e:t}function us(i,e){!Number.isFinite(e.quantity)||e.quantity<=0||i.push(e)}function ft(i){const e=new Map;for(const s of i){const n=e.get(s.key);n?n.quantity+=s.quantity:e.set(s.key,Q({},s))}const t=Array.from(e.values());t.sort((s,n)=>s.label.localeCompare(n.label));for(const s of t)s.quantity=qt(s.quantity);return t}function si(i,e,t){const s=br(i,e,t),n=Object.entries(s.metersBySpec).map(([r,a])=>({key:`cable:${r}`,label:r,unit:"m",quantity:Number(a)})).filter(r=>Number.isFinite(r.quantity)&&r.quantity>0);return n.sort((r,a)=>r.label.localeCompare(a.label)),{lines:n,unknownScaleRuns:s.unknownScaleRuns,unknownRiserCount:s.unknownRiserCount,unknownEndpointCount:s.unknownEndpointCount}}function Sr(i,e){var t;if(i&&typeof i.findKringName=="function"){const s=String((t=i.findKringName(e))!=null?t:"").trim();if(s!=="")return s}return"Zonder naam"}function Lr(i){var t,s,n,r,a,o,l,c,d,h,p,g,m,v,S,L,A,V,C,N,G,w,M,u,f;const e=String((s=(t=i==null?void 0:i.getType)==null?void 0:t.call(i))!=null?s:"");if(!e)return[];switch(e){case"Contactdoos":return[{key:"device:contactdoos",label:"Contactdoos",unit:"pcs",quantity:Fe((n=i==null?void 0:i.props)==null?void 0:n.aantal,1)}];case"Schakelaars":{const k=Fe((r=i==null?void 0:i.props)==null?void 0:r.aantal_schakelaars,1),x=String((o=(a=i==null?void 0:i.props)==null?void 0:a.type_schakelaar)!=null?o:"").trim(),T=x?`Schakelaar (${x})`:"Schakelaar";return[{key:x?`device:schakelaar:${x}`:"device:schakelaar",label:T,unit:"pcs",quantity:k}]}case"Drukknop":{const k=Fe((l=i==null?void 0:i.props)==null?void 0:l.aantal,1),x=Fe((c=i==null?void 0:i.props)==null?void 0:c.aantal_knoppen_per_armatuur,1),T=k*x,_=String((h=(d=i==null?void 0:i.props)==null?void 0:d.type_knop)!=null?h:"").trim(),P=_?`Drukknop (${_})`:"Drukknop";return[{key:_?`device:drukknop:${_}`:"device:drukknop",label:P,unit:"pcs",quantity:T}]}case"Lichtpunt":{const k=Fe((p=i==null?void 0:i.props)==null?void 0:p.aantal,1),x=String((m=(g=i==null?void 0:i.props)==null?void 0:g.type_lamp)!=null?m:"").trim(),T=x?`Lichtpunt (${x})`:"Lichtpunt";return[{key:x?`device:lichtpunt:${x}`:"device:lichtpunt",label:T,unit:"pcs",quantity:k}]}case"Aftakdoos":return[{key:"device:aftakdoos",label:"Aftakdoos",unit:"pcs",quantity:1}];case"Aansluitpunt":return[{key:"device:aansluitpunt",label:"Aansluitpunt",unit:"pcs",quantity:1}];case"Zekering/differentieel":{const k=String((S=(v=i==null?void 0:i.props)==null?void 0:v.bescherming)!=null?S:"").trim(),x=String((A=(L=i==null?void 0:i.props)==null?void 0:L.aantal_polen)!=null?A:"").trim(),T=String((C=(V=i==null?void 0:i.props)==null?void 0:V.amperage)!=null?C:"").trim(),_=String((G=(N=i==null?void 0:i.props)==null?void 0:N.differentieel_delta_amperage)!=null?G:"").trim(),P=String((M=(w=i==null?void 0:i.props)==null?void 0:w.curve_automaat)!=null?M:"").trim(),$=String((f=(u=i==null?void 0:i.props)==null?void 0:u.type_differentieel)!=null?f:"").trim();let K="Zekering/differentieel";return k==="automatisch"?K=`Automaat ${x}P ${T}A${P?` curve ${P}`:""}`.trim():k==="differentieel"?K=`Differentieel ${x}P ${T}A Δ${_}mA${$?` type ${$}`:""}`.trim():k==="differentieelautomaat"?K=`Differentieelautomaat ${x}P ${T}A Δ${_}mA${P?` curve ${P}`:""}${$?` type ${$}`:""}`.trim():k==="smelt"&&(K=`Smeltzekering ${x}P ${T}A`.trim()),[{key:`device:zekering:${k}|${x}|${T}|${_}|${P}|${$}`,label:K,unit:"pcs",quantity:1}]}}return[]}function ii(i){var r;const e=new Map,t=[],s=new Set;if(!i||!Array.isArray(i.data)||!Array.isArray(i.active)||!Array.isArray(i.id))return{totals:[],byKring:new Map,kringSet:new Set};for(let a=0;a<i.data.length;a++){if(!i.active[a])continue;const o=i.data[a];if(!o||typeof o.getType!="function")continue;const l=Lr(o);if(l.length===0)continue;const c=Number(i.id[a]),d=Sr(i,c);s.add(d);const h=(r=e.get(d))!=null?r:[];for(const p of l)us(h,p),us(t,p);e.set(d,h)}const n=new Map;for(const[a,o]of e.entries())n.set(a,ft(o));return{totals:ft(t),byKring:n,kringSet:s}}function Ye(i,e){const t=i.filter(s=>s.unit===e);return t.length===0?"<i>Geen.</i>":(t.sort((s,n)=>s.label.localeCompare(n.label)),t.map(s=>{const n=e==="m"?ei(s.quantity):ti(s.quantity);return`${E(s.label)}: <b>${E(n)}</b>`}).join("<br>"))}function Qe(i){const e=i.unit==="m"?ei(i.quantity):ti(i.quantity);return`${i.label}: ${e}`}function Pr(i){var v,S,L,A,V,C;const e=i==null?void 0:i.sitplan,t=ii(i),s=!!e,n=s?typeof e.getElements=="function"?(v=e.getElements())!=null?v:[]:Array.isArray(e.elements)?e.elements:[]:[],r=new Set;for(const N of n){if((N==null?void 0:N.kind)!=="cableRun")continue;const G=String((L=(S=N==null?void 0:N.cableRun)==null?void 0:S.kring)!=null?L:"").trim();G!==""&&r.add(G)}const o=new kt().getUniqueKringnaamWithLabels(),l=new Map;for(const N of o)l.set(String(N.value),String(N.label));const c=Array.from(new Set([...Array.from(l.keys()),...Array.from(r),...Array.from(t.kringSet)]));c.sort((N,G)=>N.localeCompare(G));const d=[],h=new Map;if(s)for(const N of c){if(n.filter(M=>{var u,f;return(M==null?void 0:M.kind)==="cableRun"&&((f=(u=M==null?void 0:M.cableRun)==null?void 0:u.kring)!=null?f:null)===N}).length===0)continue;const w=si(e,n,N);h.set(N,w),d.push(...w.lines)}const p=ft(d),g=t.totals,m=[];m.push({heading:"Totaal",lines:["Kabels:",...p.length>0?p.filter(N=>N.unit==="m").map(N=>`- ${Qe(N)}`):["- Geen."],"","Toestellen:",...g.length>0?g.filter(N=>N.unit==="pcs").map(N=>`- ${Qe(N)}`):["- Geen."]]});for(const N of c){const G=(A=l.get(N))!=null?A:N,w=(V=t.byKring.get(N))!=null?V:[],M=h.get(N),u=(C=M==null?void 0:M.lines)!=null?C:[];if(!(w.length>0||u.length>0))continue;const k=[];M&&(M.unknownScaleRuns>0&&k.push(`schaal ontbreekt voor ${M.unknownScaleRuns} run(s)`),M.unknownRiserCount>0&&k.push(`hoogte ontbreekt voor ${M.unknownRiserCount} stijgleiding(en)`),M.unknownEndpointCount>0&&k.push(`verticale aansluiting onbekend voor ${M.unknownEndpointCount} eindpunt(en)`));const x=["Kabels:",...u.length>0?u.filter(T=>T.unit==="m").map(T=>`- ${Qe(T)}`):["- Geen."],"","Toestellen:",...w.length>0?w.filter(T=>T.unit==="pcs").map(T=>`- ${Qe(T)}`):["- Geen."]];k.length>0&&(x.push(""),x.push(`Opgelet: ${k.join(", ")}`)),m.push({heading:G,lines:x})}return{title:"Materialen (BOM)",sections:m}}function ni(){var V,C,N,G,w,M;const i=globalThis.structure,e=i==null?void 0:i.sitplan,t=document.getElementById("configsection");if(t==null)return;const s=ii(i),n=!!e,r=n?typeof e.getElements=="function"?(V=e.getElements())!=null?V:[]:Array.isArray(e.elements)?e.elements:[]:[],a=new Set;for(const u of r){if((u==null?void 0:u.kind)!=="cableRun")continue;const f=String((N=(C=u==null?void 0:u.cableRun)==null?void 0:C.kring)!=null?N:"").trim();f!==""&&a.add(f)}const l=new kt().getUniqueKringnaamWithLabels(),c=new Map;for(const u of l)c.set(String(u.value),String(u.label));const d=Array.from(new Set([...Array.from(c.keys()),...Array.from(a),...Array.from(s.kringSet)]));d.sort((u,f)=>u.localeCompare(f));const h=[],p=[];let g=!1,m=s.totals.length>0;const v=new Map;if(n)for(const u of d){if(r.filter(x=>{var T,_;return(x==null?void 0:x.kind)==="cableRun"&&((_=(T=x==null?void 0:x.cableRun)==null?void 0:T.kring)!=null?_:null)===u}).length===0)continue;g=!0;const k=si(e,r,u);v.set(u,k),h.push(...k.lines)}for(const u of d){const f=(G=c.get(u))!=null?G:u,k=(w=s.byKring.get(u))!=null?w:[],x=v.get(u),T=(M=x==null?void 0:x.lines)!=null?M:[],_=[];x&&(x.unknownScaleRuns>0&&_.push(`schaal ontbreekt voor ${x.unknownScaleRuns} run(s)`),x.unknownRiserCount>0&&_.push(`hoogte ontbreekt voor ${x.unknownRiserCount} stijgleiding(en)`),x.unknownEndpointCount>0&&_.push(`verticale aansluiting onbekend voor ${x.unknownEndpointCount} eindpunt(en)`));const P=_.length>0?`<br><small>Opgelet: ${E(_.join(", "))}</small>`:"";(k.length>0||T.length>0)&&p.push(`<br><b>${E(f)}</b>${P}<br><u>Kabels</u><br>${Ye(T,"m")}<br><br><u>Toestellen</u><br>${Ye(k,"pcs")}<br>`)}const S=ft(h),A=`
        <span id="materialsscreen"></span>
    <table border="1px" style="border-collapse:collapse" align="center" width="100%">
      <tr>
        <td width="100%" align="center" bgcolor="LightGrey">
          <b>Materialen (BOM)</b>
        </td>
      </tr>
      <tr>
        <td width="100%" align="left" style="padding:10px">
          ${n?g?"<small>Kabels zijn in meter, toestellen in stuks.</small>":'<span class="highlight-warning">Nog geen kabels getekend. Gebruik de kabel-tool in het situatieschema.</span>':'<span class="highlight-warning">Geen situatieschema geladen. Ga naar Situatieschema om kabels te tellen.</span>'}<br><br>
          <b>Totaal</b><br>
          <u>Kabels</u><br>
          ${Ye(S,"m")}<br><br>
          <u>Toestellen</u><br>
                    ${Ye(s.totals,"pcs")}<br>
          <br>
                    <b>Per kring</b><br>
                    ${p.length>0?p.join(""):g||m?"<i>Geen.</i>":"<i>Geen materialen gevonden.</i>"}
        </td>
      </tr>
    </table>`;t.innerHTML=A,globalThis.toggleAppView("config")}function Er(i,e,t,s,n="eendraadschema_print.pdf",r,a,o){const l=u=>{r&&(r.innerHTML=u)},c=u=>{try{let f=u;f=f.replace(/<svg\b(?![^>]*\bxmlns=)/,'<svg xmlns="http://www.w3.org/2000/svg"'),f=f.replace(/<(\/?)\s*([A-Za-z_][\w.-]*):([\w.-]+)/g,"<$1$3"),f=f.replace(/\b(?!xmlns:)([A-Za-z_][\w.-]*):([\w.-]+)=/g,"$2=");const x=new DOMParser().parseFromString(f,"image/svg+xml"),T=x.querySelector("svg");if(!T)return f;T.getAttribute("xmlns")||T.setAttribute("xmlns","http://www.w3.org/2000/svg"),T.getAttribute("xmlns:xlink")||T.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");for(const P of Array.from(x.querySelectorAll("svg")))P.getAttribute("xmlns")||P.setAttribute("xmlns","http://www.w3.org/2000/svg");const _="http://www.w3.org/1999/xlink";for(const P of Array.from(x.querySelectorAll("image"))){const $=P.getAttribute("href");$&&!P.getAttribute("xlink:href")&&P.setAttributeNS(_,"xlink:href",$)}return new XMLSerializer().serializeToString(T)}catch(f){return u}};let d;e.papersize==="A3"?d={paperwidth:420,paperheight:297,paper_margin:10,svg_padding:5,drawnby_box_height:5,owner_box_height:30,owner_box_width:80}:d={paperwidth:297,paperheight:210,paper_margin:10,svg_padding:5,drawnby_box_height:5,owner_box_height:30,owner_box_width:80};let h;const p=e.pages.length+a.numpages;let g=0;h=Array(p).fill(null);const m=s.split(",").map(u=>u.trim());for(const u of m)if(u.includes("-")){const[f,k]=u.split("-").map(Number);if(!isNaN(f)&&!isNaN(k))for(let x=f;x<=k;x++)x>=1&&x<=p&&(h[x-1]=x)}else{const f=Number(u);!isNaN(f)&&f>=1&&f<=p&&(h[f-1]=f)}function v(u,f,k,x){const T=d.paperheight-2*d.paper_margin-d.owner_box_height-d.drawnby_box_height-d.svg_padding,_=d.paperwidth-2*d.paper_margin,P=t.dpi||300,$=T/25.4*P,K=_/25.4*P,b=Math.min($/k,K/f);let y;if(u.replace(/^\s+/,"").startsWith("<svg"))try{const te=new DOMParser().parseFromString(u,"image/svg+xml").querySelector("svg");te?(te.setAttribute("xmlns",te.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),te.setAttribute("width",String(f*b)),te.setAttribute("height",String(k*b)),te.getAttribute("viewBox")||te.setAttribute("viewBox",`0 0 ${f} ${k}`),y=new XMLSerializer().serializeToString(te)):y=`<svg width="${f*b}" height="${k*b}" viewBox="0 0 ${f} ${k}" xmlns="http://www.w3.org/2000/svg">`+u+"</svg>"}catch(j){y=`<svg width="${f*b}" height="${k*b}" viewBox="0 0 ${f} ${k}" xmlns="http://www.w3.org/2000/svg">`+u+"</svg>"}else y=`<svg width="${f*b}" height="${k*b}" viewBox="0 0 ${f} ${k}" xmlns="http://www.w3.org/2000/svg">`+u+"</svg>";y=c(y);let z,O=!1;if(y.length>5e5){const j=new Blob([y],{type:"image/svg+xml;charset=utf-8"});z=URL.createObjectURL(j),O=!0}else z="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(y);const B=new Image;B.crossOrigin="anonymous";let R=!1;const U=j=>{R||(R=!0,x(j,b))},Z=window.setTimeout(()=>U(null),3e4);B.onload=function(){window.clearTimeout(Z);const j=document.createElement("canvas");j.width=B.width,j.height=B.height,j.crossOrigin="anonymous";const Y=j.getContext("2d");if(!Y){j.remove(),U(null);return}Y.drawImage(B,0,0);try{const te=j.toDataURL("image/png");U(te)}catch(te){B.complete?alert("Er is een element in het (situatie)schema dat verwijst naar een andere website en dit veroorzaakt een security-error (CORS) in deze browser. Hierdoor kan die pagina niet in de PDF worden opgenomen als afbeelding."):alert("Het genereren van de PDF is vastgelopen bij het omzetten van SVG naar PNG."),U(null)}finally{O&&z.startsWith("blob:")&&URL.revokeObjectURL(z),j.remove()}},B.onerror=function(){window.clearTimeout(Z),O&&z.startsWith("blob:")&&URL.revokeObjectURL(z),U(null)},B.src=z}function S(u,f){function k(_){const P=document.createElement("div");return P.innerHTML=_,P.textContent||P.innerText||""}let x=[];f=f.replace(/<div>/g,"");let T=f.split(/<br>|<\/div>/).map(k);for(let _ of T){let P=u.splitTextToSize(_,d.owner_box_width-4-3);x=x.concat(P)}return x}function L(){const{jsPDF:u}=window.jspdf;let f;return e.papersize==="A3"?f=new u("landscape","mm","a3",!0):f=new u("landscape","mm","a4",!0),f}function A(u,f){var K,b;const k=d.paper_margin,x=d.paperwidth-2*k,T=4,_=6;let P=k,$=1;P+=8;for(const y of(K=f.sections)!=null?K:[]){P+=_;for(const I of(b=y.lines)!=null?b:[]){if(I===""){P+=T;continue}const O=u.splitTextToSize(String(I),x).length*T;P+O>d.paperheight-k&&($+=1,P=k),P+=O}P+=T,P>d.paperheight-k&&($+=1,P=k)}return Math.max(1,$)}function V(u){var K;if(!o||!Array.isArray(o.sections)||o.sections.length===0)return;l("Materialen (BOM) wordt toegevoegd..");const f=d.paper_margin,k=d.paperwidth-2*f,x=4,_=(typeof u.getNumberOfPages=="function"?Number(u.getNumberOfPages()):0)+g,P=()=>{u.addPage();const b=typeof u.getNumberOfPages=="function"?Number(u.getNumberOfPages()):0;u.setFont("helvetica","bold"),u.setFontSize(14),u.text(String(o.title||"Materialen (BOM)"),f,f+2),u.setFontSize(9);try{u.text(`pagina ${b}/${_}`,d.paperwidth-f,f+2,{align:"right"})}catch(y){}return u.setFontSize(10),u.setFont("helvetica","normal"),f+10};let $=P();for(const b of o.sections){$+8>d.paperheight-f&&($=P()),u.setFont("helvetica","bold"),u.setFontSize(12),u.text(String(b.heading),f,$),$+=6,u.setFont("helvetica","normal"),u.setFontSize(10);for(const y of(K=b.lines)!=null?K:[]){const I=String(y!=null?y:"");if(I===""){$+=x,$>d.paperheight-f&&($=P());continue}const z=u.splitTextToSize(I,k);for(const O of z)$>d.paperheight-f&&($=P()),u.text(O,f,$),$+=x}$+=x}}function C(u,f,k,x,T,_=0){v(f,k,x,function(P,$){let K=d.paperwidth-2*d.paper_margin,b=d.paperheight-2*d.paper_margin-d.owner_box_height-d.drawnby_box_height-d.svg_padding;if(P&&k*x>0)try{if(k/x>K/b){let j=(d.paperheight-2*d.paper_margin-d.owner_box_height-d.drawnby_box_height-d.svg_padding-x/k*K)/2;u.addImage(P,"PNG",d.paper_margin,d.paper_margin+j,K,x/k*K,void 0,"FAST")}else u.addImage(P,"PNG",d.paper_margin,d.paper_margin,k/x*b,b,void 0,"FAST")}catch(Z){}u.setProperties({title:"Eendraadschema.pdf",subject:"Eendraadschema",author:"eendraadschema.goethals-jacobs.be",keywords:"eendraadschema, online",creator:"eendraadschema.goethals-jacobs.be"});let y=d.paperwidth-(297-d.paper_margin);u.rect(y,d.paperheight-d.paper_margin-d.drawnby_box_height,3*d.owner_box_width,d.drawnby_box_height),u.rect(y,d.paperheight-d.paper_margin-d.drawnby_box_height-d.owner_box_height,d.owner_box_width,d.owner_box_height),u.rect(y+d.owner_box_width,d.paperheight-d.paper_margin-d.drawnby_box_height-d.owner_box_height,d.owner_box_width,d.owner_box_height),u.rect(y+2*d.owner_box_width,d.paperheight-d.paper_margin-d.drawnby_box_height-d.owner_box_height,d.owner_box_width,d.owner_box_height),u.rect(y+3*d.owner_box_width,d.paperheight-d.paper_margin-d.drawnby_box_height-d.owner_box_height,d.paperwidth-d.paper_margin-y-3*d.owner_box_width,d.drawnby_box_height+d.owner_box_height);const I=8,z=I*.352778;u.setFont("helvetica","bold"),u.setFontSize(I),u.text("Getekend met https://eendraadschema.goethals-jacobs.be",y+2,d.paperheight-d.paper_margin-(d.drawnby_box_height-z)/2-z/6);let O=_+1,B=e.pages.length+a.numpages+g;u.text("pagina. "+O+"/"+B,y+3*d.owner_box_width+2,d.paperheight-d.paper_margin-d.drawnby_box_height-d.owner_box_height-z/6+z+1.5);let R=_<e.pages.length?"Eendraadschema":"Situatieschema";u.text(R,y+3*d.owner_box_width+2,d.paperheight-d.paper_margin-d.drawnby_box_height-d.owner_box_height-z/6+z*(1+1.2)+1.5),u.text(S(u,"Erkend Organisme"),y+2,d.paperheight-d.paper_margin-d.drawnby_box_height-d.owner_box_height-z/6+z+1.5),u.text(S(u,"Plaats van de elektrische installatie"),y+d.owner_box_width+2,d.paperheight-d.paper_margin-d.drawnby_box_height-d.owner_box_height-z/6+z+1.5),u.text(S(u,"Installateur"),y+2*d.owner_box_width+2,d.paperheight-d.paper_margin-d.drawnby_box_height-d.owner_box_height-z/6+z+1.5),u.setFont("helvetica","normal"),u.text(S(u,t.control).slice(0,8),y+2+3,d.paperheight-d.paper_margin-d.drawnby_box_height-d.owner_box_height-z/6+z*(1+1.2)+1.5),u.text(S(u,t.owner).slice(0,8),y+d.owner_box_width+2+3,d.paperheight-d.paper_margin-d.drawnby_box_height-d.owner_box_height-z/6+z*(1+1.2)+1.5),u.text(S(u,t.installer).slice(0,8),y+2*d.owner_box_width+2+3,d.paperheight-d.paper_margin-d.drawnby_box_height-d.owner_box_height-z/6+z*(1+1.2)+1.5);let D=(_<e.pages.length?e.pages[_].info||t.info||"":t.info||"").replace("https://www.eendraadschema.goethals-jacobs.be","eendraadschema");u.text(S(u,D).slice(0,8),y+3*d.owner_box_width+2+3,d.paperheight-d.paper_margin-d.drawnby_box_height-d.owner_box_height-z/6+z*(1+3*1.2)+1.5),T(u,_+1)})}function N(u,f){let k=e.pages[f].start,x=e.pages[f].stop-k,T=e.starty,_=e.stopy-T,P=`${k} ${T} ${x} ${_}`;return`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" transform="scale(1,1)" style="border:1px solid white" height="${_}" width="${x}" viewBox="${P}">`+u+"</svg>"}function G(u,f=0){let k=!1,x=h.findIndex(T=>T!==null);if(f===x&&(k=!0),f<e.pages.length)if(h[f]==null)G(u,f+1);else{l("Pagina "+h[f]+" wordt gegenereerd. Even geduld.."),k||u.addPage();let T=e.pages[h[f]-1].stop-e.pages[h[f]-1].start,_=e.stopy-e.starty;C(u,N(i,h[f]-1),T,_,G,f)}else if(f<h.length)if(h[f]==null)G(u,f+1);else{l("Pagina "+(f+1)+" wordt gegenereerd. Even geduld.."),k||u.addPage();let T=a.pages[f-e.pages.length];C(u,T.svg,T.sizex,T.sizey,G,f)}else V(u),w(u)}function w(u){try{const f=u.output("blob"),k=URL.createObjectURL(f);try{const x=document.createElement("a");x.href=k,x.download=n,x.rel="noopener",x.style.display="none",document.body.appendChild(x),x.click(),x.remove()}catch(x){}l('PDF is klaar. Indien de download niet start: <a href="'+k+'" download="'+n.replace(/"/g,"&quot;")+'">klik hier om te downloaden</a>.'),setTimeout(()=>URL.revokeObjectURL(k),120*1e3)}catch(f){u.save(n),l("PDF is klaar. Kijk in uw Downloads folder indien deze niet spontaan wordt geopend.")}}l("PDF wordt gegenereerd. Even geduld..");let M=L();g=o?A(M,o):0,G(M,0)}globalThis.HLDisplayPage=()=>{globalThis.structure.print_table.displaypage=parseInt(document.getElementById("id_select_page").value)-1,ve()};globalThis.dosvgdownload=()=>{const i=document.getElementById("printsvgarea");let e;if(i==null)return;let t=i.innerHTML;document.getElementById("dosvgname")==null?e="eendraadschema.svg":e=document.getElementById("dosvgname").value,Gs(t,e,"data:image/svg+xml;charset=utf-8")};function Ir(i,e=globalThis.structure.print_table.displaypage){var t=1,s=globalThis.structure.print_table.pages[e].start,n=globalThis.structure.print_table.pages[e].stop-s,r=globalThis.structure.print_table.getstarty(),a=globalThis.structure.print_table.getstopy()-r,o=""+s+" "+r+" "+n+" "+a,l='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" transform="scale(1,1)" style="border:1px solid white" height="'+a*t+'" width="'+n*t+'" viewBox="'+o+'">'+Ot(i.data)+"</svg>";return l}function ve(){function i(){var V,C;typeof globalThis.structure.properties.dpi=="undefined"&&(globalThis.structure.properties.dpi=300);let h=Ot(globalThis.structure.toSVG(0,"horizontal").data);const p=globalThis.structure.print_table.pages.length+(globalThis.structure.sitplan?globalThis.structure.sitplan.getNumPages():0),g=document.getElementById("print_page_mode"),m=document.getElementById("print_page_range");if(!globalThis.structure.print_table.canPrint()){g.value="all",m.value="",m.style.display="none";let N=document.getElementById("print_range_error");N&&(N.style.display="none")}let v="1-"+p;g&&g.value==="custom"&&m&&m.value.trim()!==""&&(v=m.value.trim());const S=globalThis.structure.sitplan?globalThis.structure.sitplan.toSitPlanPrint():{numpages:0,pages:[]},A=((C=(V=document.getElementById("print_include_bom"))==null?void 0:V.checked)!=null?C:!0)?Pr(globalThis.structure):void 0;if(globalThis.structure.print_table.enableAutopage){const N=globalThis.structure.properties.info;for(let G of globalThis.structure.print_table.pages)G.info=N}Er(h,globalThis.structure.print_table,globalThis.structure.properties,v,document.getElementById("dopdfname").value,document.getElementById("progress_pdf"),S,A)}function e(h){const p=document.getElementById("printarea");p!=null&&(p.innerHTML='<div id="printsvgarea">'+Ir(h)+"</div>")}function t(h){const p=globalThis.structure.sitplan.toSitPlanPrint(),g=document.getElementById("printarea");g!=null&&(g.innerHTML='<div id="printsvgarea">'+p.pages[h].svg+"</div>")}var s=new J;s=globalThis.structure.toSVG(0,"horizontal");var n=s.yup+s.ydown,r=s.xleft+s.xright;globalThis.structure.print_table.setHeight(n),globalThis.structure.print_table.setMaxWidth(r+10);let a="";var o="";const l=document.getElementById("configsection");l!=null&&(l.innerHTML='<div><button id="button_pdfdownload">Genereer PDF</button>&nbsp;<span id="select_papersize"></span>&nbsp;<span id="select_dpi"></span>&nbsp;<input id="dopdfname" size="20" value="eendraadschema_print.pdf">&nbsp;<span id="progress_pdf"></span></div><div style="margin-top: 4px"><label><input type="checkbox" id="print_include_bom" checked> BOM toevoegen</label></div><div id="select_page_range"></div>');const c=document.getElementById("button_pdfdownload");c!=null&&(c.onclick=i),globalThis.structure.print_table.insertHTMLselectPaperSize(document.getElementById("select_papersize"),ve),globalThis.structure.print_table.insertHTMLselectdpi(document.getElementById("select_dpi"),ve),globalThis.structure.print_table.insertHTMLselectPageRange(document.getElementById("select_page_range"),ve),a='<div><span style="margin-right: 2em" id="check_autopage"></span><span style="margin-right: 2em" id="id_verticals"></span><span id="id_suggest_xpos_button"></span></div>',l!=null&&l.insertAdjacentHTML("beforeend",a),globalThis.structure.print_table.insertHTMLcheckAutopage(document.getElementById("check_autopage"),ve),globalThis.structure.print_table.enableAutopage||(globalThis.structure.print_table.insertHTMLchooseVerticals(document.getElementById("id_verticals"),ve),globalThis.structure.print_table.insertHTMLsuggestXposButton(document.getElementById("id_suggest_xpos_button"),ve)),globalThis.structure.print_table.enableAutopage||(a=`<br><table border="0"><tr><td style="vertical-align:top;"><div id="id_print_table"></div></td><td style="vertical-align:top;padding:5px"><div>Klik op de groene pijl om het schema over meerdere pagina's te printen en kies voor elke pagina de start- en stop-positie in het schema (in pixels).</div><div>Je kan eventueel ook de tekst (info) aanpassen die op elke pagina rechts onderaan komt te staan.</div><div>Onderaan kan je bekijken welk deel van het schema op welke pagina belandt.</div></td></tr></table><br>`,l!=null&&l.insertAdjacentHTML("beforeend",a),globalThis.structure.print_table.insertHTMLposxTable(document.getElementById("id_print_table"),ve)),o+="<hr>";const d=globalThis.structure.print_table.pages.length+(globalThis.structure.sitplan?globalThis.structure.sitplan.getNumPages():0);globalThis.structure.print_table.displaypage>=d&&(globalThis.structure.print_table.displaypage=d-1),o+='<b>Printvoorbeeld: </b>Pagina <select onchange="HLDisplayPage()" id="id_select_page">';for(let h=0;h<d;h++)h==globalThis.structure.print_table.displaypage?o+="<option value="+(h+1)+" selected>"+(h+1)+"</option>":o+="<option value="+(h+1)+">"+(h+1)+"</option>";o+='</select>&nbsp;&nbsp;(Enkel tekening, kies "Genereer PDF" om ook de tekstuele gegevens te zien)',o+="<br><br>",o+='<table border="0"><tr><td style="vertical-align:top"><button onclick="dosvgdownload()">Zichtbare pagina als SVG opslaan</button></td><td>&nbsp;</td><td style="vertical-align:top"><input id="dosvgname" size="20" value="eendraadschema_print.svg"></td><td>&nbsp;&nbsp;</td><td>Sla tekening hieronder op als SVG en converteer met een ander programma naar PDF (bvb Inkscape).</td></tr></table><br>',o+=globalThis.displayButtonPrintToPdf(),o+='<div id="printarea"></div>',l!=null&&l.insertAdjacentHTML("beforeend",o),globalThis.structure.print_table.displaypage<globalThis.structure.print_table.pages.length?e(s):t(globalThis.structure.print_table.displaypage-globalThis.structure.print_table.pages.length),globalThis.toggleAppView("config")}var Ar=`<html>
  <head>
    <title>Eendraadschema online</title>
    <link rel="stylesheet" href="css/about.css" style="text/css" />
  </head>
  <body>
    <h2>Een &eacute;&eacute;ndraadschema tekenen.</h2>
    <p class="ondertitel">Een cr&eacute;atie van <a target="_blank" href="https://ivan.goethals-jacobs.be">Ivan Goethals</a></p>
    <p>Dit is een standalone versie (development) waarbij enkele functionaliteiten zijn uitgeschakeld.</p>
    <p>Gebruik de online versie op <a href="https://eendraadschema.goethals-jacobs.be">https://eendraadschema.goethals-jacobs.be</a> om toegang te krijgen tot het contactformulier.</p>
    <p>Kies <b>Bewerken</b> in het menu om verder te gaan met tekenen.</p>
  </body>
</html>`;function Cr(){return'<br><h2>Expert ontwikkel opties, Gebruik enkel indien u weet wat u doet.</h2><textarea id="HL_loadfromtext" style="width: 80%; height: 8em;"></textarea><br><button onclick="loadFileFromText()">Load from input</button>'}globalThis.loadFileFromText=()=>{let i=document.getElementById("HL_loadfromtext").value;he(i),globalThis.fileAPIobj.clear()};globalThis.displayButtonPrintToPdf=()=>"";globalThis.handleButtonPrintToPdf=()=>0;globalThis.propUpload=i=>0;class Tt{run(){}}function Mr(){let i=`
    <table border="1px" style="border-collapse:collapse" align="center" width="100%">
      <tr>
        <td width="100%" align="center" bgcolor="LightGrey">
          <b>Handleiding</b>
        </td>
      </tr>
      <tr>
        <td width="100%" align="left">
            <table border=0>
              <tr>
                <td width=100 style="vertical-align:top;padding:5px">
                  <button style="font-size:14px" id="Btn_downloadManual">Eéndraadschema</button>
                </td>
                <td style="vertical-align:top;padding:7px">
                  Een volledige handleiding is beschikbaar in PDF formaat.
                  Klik links om deze in een ander venster te openen.
                  <br>
                  Het programma is in volle ontwikkeling dus delen van de handleiding zijn
                  mogelijk ietwat verouderd.  
                </td>
              </tr>
              <tr>
                <td width=100 style="vertical-align:top;padding:5px">
                  <button style="font-size:14px" id="Btn_downloadSitPlanManual">Situatieschema</button>
                </td>
                <td style="vertical-align:top;padding:7px">
                  Specifiek voor het werken met het situatieschema werd een ander korter document opgesteld.
                  Klik link om deze in een ander venster te openen.
                </td>
              </tr>
            </table>
        </td>
      </tr>
    </table>`;const e=document.getElementById("configsection");e!=null&&(e.innerHTML=i),globalThis.toggleAppView("config"),document.getElementById("Btn_downloadManual").onclick=()=>{window.open("Documentation/edsdoc.pdf","_blank")},document.getElementById("Btn_downloadSitPlanManual").onclick=()=>{window.open("Documentation/sitplandoc.pdf","_blank")}}class Hr{constructor(){this.sessionKey="SessionJS",this.newUser=!1;const e=localStorage.getItem(this.sessionKey);e?this.sessionId=e:(this.sessionId=this.generateRandomBase64String(22),localStorage.setItem(this.sessionKey,this.sessionId),this.newUser=!0)}generateRandomBase64String(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";let s="";const n=t.length;for(let r=0;r<e;r++){const a=Math.floor(Math.random()*n);s+=t[a]}return s}getSessionId(){return this.sessionId}isNewUser(){return this.newUser}}class Br{constructor(e,t){this.storageKey=e,this.data=this.loadFromStorage()||De(t),this.memoryData=De(t)}loadFromStorage(){const e=localStorage.getItem(this.storageKey);return e?JSON.parse(e):null}saveToStorage(){localStorage.setItem(this.storageKey,JSON.stringify(this.data))}get(e){const t=e.split(".");let s=this.memoryData;for(const n of t)if(s&&typeof s=="object"&&n in s)s=s[n];else{s=void 0;break}if(s!==void 0)return s;s=this.data;for(const n of t)if(s&&typeof s=="object"&&n in s)s=s[n];else return;return s}set(e,t,s=!1){const n=e.split(".");let r=s?this.memoryData:this.data;for(let a=0;a<n.length-1;a++){const o=n[a];(!r[o]||typeof r[o]!="object")&&(r[o]={}),r=r[o]}r[n[n.length-1]]=t,s||this.saveToStorage()}delete(e){const t=e.split(".");let s=this.memoryData;for(let n=0;n<t.length-1;n++){const r=t[n];if(!s[r]||typeof s[r]!="object")break;s=s[r]}delete s[t[t.length-1]],s=this.data;for(let n=0;n<t.length-1;n++){const r=t[n];if(!s[r]||typeof s[r]!="object")return;s=s[r]}delete s[t[t.length-1]],this.saveToStorage()}getAll(){return Q(Q({},this.data),this.memoryData)}clear(){this.data={},this.memoryData={},localStorage.removeItem(this.storageKey)}}class gs{constructor(e=100){this.maxSteps=e,this.undoStack=[],this.redoStack=[]}store(e,t=!1){t&&this.undoStack.length>0&&this.undoStack.pop(),this.undoStack.length>=this.maxSteps&&this.undoStack.shift(),this.undoStack.push(e),this.redoStack=[]}replace(e){this.undoStack.length>0?this.undoStack[this.undoStack.length-1]=e:this.store(e)}undo(){if(this.undoStack.length<=1)return null;const e=this.undoStack.pop();return this.redoStack.push(e),this.undoStack.length>0?this.undoStack[this.undoStack.length-1]:null}redo(){if(this.redoStack.length===0)return null;let e=this.redoStack.pop();return this.undoStack.push(e),e}clear(){this.undoStack=[],this.redoStack=[]}undoStackSize(){return Math.max(this.undoStack.length-1,0)}redoStackSize(){return Math.max(this.redoStack.length,0)}}class Nr{constructor(){this.data=[]}push(e){return this.data.push(e),this.data.length-1}pushIfNotExists(e){let t=this.data.indexOf(e);return t==-1?(this.data.push(e),this.data.length-1):t}get(e){return this.data[e]}clear(){this.data=[]}}class zr{constructor(e=100){this.largeStrings=new Nr,this.samenVoegSleutel=null,this.historyEds=new gs(e),this.historyOptions=new gs(e)}replaceSVGsByStringStore(){if(globalThis.structure.sitplan!=null)for(let e of globalThis.structure.sitplan.getElements())e.isEendraadschemaSymbool()||(e.svg=this.largeStrings.pushIfNotExists(e.getUnscaledSVGifNotElectroItem()).toString())}replaceStringStoreBySVGs(){if(globalThis.structure.sitplan!=null)for(let e of globalThis.structure.sitplan.getElements())e.isEendraadschemaSymbool()||(e.svg=this.largeStrings.get(parseInt(e.svg)))}getOptions(){let e={};return globalThis.structure.sitplanview!=null&&(e.selectedBoxesOrdinals=globalThis.structure.sitplanview.getSelectedBoxesOrdinals(),globalThis.structure.sitplanview.sideBar.getUndoRedoOptions!=null&&Object.assign(e,globalThis.structure.sitplanview.sideBar.getUndoRedoOptions())),JSON.stringify(e)}store(e=null){let t=!1;e!=null&&e==this.samenVoegSleutel&&(t=!0),this.samenVoegSleutel=e,this.replaceSVGsByStringStore(),t?(this.historyEds.replace(globalThis.structure.toJsonObject(!1)),this.historyOptions.replace(this.getOptions())):(this.historyEds.store(globalThis.structure.toJsonObject(!1)),this.historyOptions.store(this.getOptions())),this.replaceStringStoreBySVGs(),globalThis.structure.properties.currentView=="draw"&&globalThis.structure.sitplanview!=null?globalThis.structure.sitplanview.updateRibbon():globalThis.structure.properties.currentView=="2col"&&globalThis.structure.updateRibbon()}updateSelectedBoxes(){this.historyOptions.store(this.getOptions(),!0)}reload(e,t){this.samenVoegSleutel=null;let s=globalThis.structure.properties.currentView,n=globalThis.structure.mode;switch(e!=null&&Fs(e,0,!1),this.replaceStringStoreBySVGs(),globalThis.structure.reSort(),globalThis.structure.mode=n,globalThis.structure.properties.currentView!=s&&globalThis.toggleAppView(globalThis.structure.properties.currentView),globalThis.structure.properties.currentView){case"draw":if(globalThis.topMenu.selectMenuItemByOrdinal(3),Qs(),globalThis.structure.sitplanview.sideBar.setUndoRedoOptions!=null&&globalThis.structure.sitplanview.sideBar.setUndoRedoOptions(t),t.selectedBoxesOrdinals==null)break;for(let r of t.selectedBoxesOrdinals){if(globalThis.structure.sitplan.getElements().length<=r)break;let a=globalThis.structure.sitplan.getElements()[r];if(a==null)break;let o=a.id;if(o==null)break;let l=document.getElementById(o);l!=null&&globalThis.structure.sitplanview.selectBox(l)}break;case"2col":globalThis.topMenu.selectMenuItemByOrdinal(2),globalThis.HLRedrawTree();break;case"config":globalThis.topMenu.selectMenuItemByOrdinal(4),ve();break}}undo(){let e=this.historyEds.undo(),t=this.historyOptions.undo(),s=t?JSON.parse(t):{};this.reload(e,s)}redo(){let e=this.historyEds.redo(),t=this.historyOptions.redo(),s=t?JSON.parse(t):{};this.reload(e,s)}clear(){this.samenVoegSleutel=null,this.historyEds.clear(),this.historyOptions.clear(),this.largeStrings.clear(),globalThis.structure.updateRibbon()}undoStackSize(){return this.historyEds.undoStackSize()}redoStackSize(){return this.historyEds.redoStackSize()}}const St=[{date:"2025-09-18",msg:"Eerste stapjes om symbolen toe te voegen aan het situatieschema die niet in het ééndraadschema zitten."},{date:"2025-08-22",msg:"Aftakdoos kan nu meerdere kinderen bevatten."},{date:"2025-08-19",msg:'Kring en Aansluiting kennen nu ook de bescherming "zekeringscheider".'},{date:"2025-07-29",msg:"Bij handmatig pagineren kan voor iedere pagina van het ééndraadschema een andere info-tekst gekozen worden om rechts onder te tonen bij het afprinten."},{date:"2025-07-28",msg:"Voor elementen op het hoogste niveau kan gekozen worden om tijdens het printen altijd een nieuwe pagina te starten."},{date:"2025-07-20",msg:'Micro-omvormer optie toegevoegd. Voor omvormers met maximaal één aansluiting kan nu "micro" worden aangevinkt, wat resulteert in een dunnere lijndikte in het schema.'},{date:"2025-07-20",msg:"Mogelijkheid om slechts bepaalde pagina's af te drukken uit het schema."},{date:"2025-07-07",msg:"Symbool voor afzuigkap (in Ventilator) en aarding (in Zeldzame symbolen)."},{date:"2025-07-05",msg:"Verbeteringen en meer mogelijkheden aan het contact/contactor symbool (binnen Kring, of Schakelaars)."},{date:"2025-07-01",msg:"Automatische nummering en automatische naamgeving voor kringen."},{date:"2025-06-26",msg:"De elecktriciteitsmeter van een aansluiting kan nu ook in het situatieschema worden toegevoegd."},{date:"2025-06-24",msg:"Mogelijkheid om files op te slaan zonder compressie."},{date:"2025-06-21",msg:'Wijzigingen aan het symbool voor "Omvormer". Zowel zonnepanelen als een batterij kunnen nu aan dezelfde omvormer worden gehangen.'},{date:"2025-06-08",msg:"De externe sturing van een domotica gestuurde verbruiker kan nu ook op het situatieplan worden toegevoegd (schakelaar/drukkknop)."},{date:"2025-05-25",msg:'Omvormer kan nu ook "in kring" worden geplaatst indien deze als backup kan dienen.'},{date:"2025-05-19",msg:"Support om meerdere elementen in het situatieschema tegelijkertijd te selecteren (met shift-click) en tegelijkertijd te bewerken."},{date:"2025-05-01",msg:"Automatisch opslaan van schema's in de browsercache (crash of ongewenste browser refresh recovery)."},{date:"2025-04-06",msg:"Bij kringen kan nu ook de fase worden ingesteld (Fase 1, Fase 2, Fase 3)."},{date:"2025-03-01",msg:`Inbouwen functionaliteit om meerdere eendraadschema's samen te voegen op het "Bestand"-scherm.`},{date:"2025-03-01",msg:"Mogelijkheid tot vergrendelen van symbolen in het situatieschema (Ctrl L)."},{date:"2025-02-28",msg:"Borden kunnen nu ook worden toegevoegd aan het situatieschema."},{date:"2025-02-16",msg:"Toevoegen sidebar in het situatieschema om makkelijker symbooltjes toe te voegen."}],ri="eds.theme",ai="eds-theme-changed";function oi(i){return i==="light"||i==="dark"}function fs(){return typeof window=="undefined"||typeof window.matchMedia!="function"?"light":window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function ms(){try{const i=localStorage.getItem(ri);return oi(i)?i:null}catch(i){return null}}function Kr(i){try{window.dispatchEvent(new CustomEvent(ai,{detail:i}))}catch(e){}}function $r(){return document.documentElement.dataset.theme==="dark"?"dark":"light"}function ct(i,e){var s;const t=(s=e==null?void 0:e.persist)!=null?s:!0;if(document.documentElement.dataset.theme=i,document.documentElement.style.colorScheme=i,t)try{localStorage.setItem(ri,i)}catch(n){}Kr(i)}function Rr(){const e=$r()==="dark"?"light":"dark";ct(e,{persist:!0})}function Dr(){const i=ms();if(i?ct(i,{persist:!1}):ct(fs(),{persist:!1}),typeof window.matchMedia=="function"){const e=window.matchMedia("(prefers-color-scheme: dark)"),t=()=>{ms()||ct(fs(),{persist:!1})};typeof e.addEventListener=="function"?e.addEventListener("change",t):typeof e.addListener=="function"&&e.addListener(t)}}function Vr(i){window.addEventListener(ai,e=>{const s=e.detail;oi(s)&&i(s)})}function Or(i){return i?{Authorization:`Bearer ${i}`}:{}}function Wt(i){if(!i)return"";try{return new Date(i).toLocaleString()}catch(e){return i}}function jr(i){return`${window.location.href.split("#")[0]}#share=${encodeURIComponent(i)}`}function et(i){var e,t;try{const s=(t=(e=globalThis.appDocStorage)==null?void 0:e.get)==null?void 0:t.call(e,`shareNames.${i}`);return s?String(s):""}catch(s){return""}}function Fr(i,e){var t,s,n,r;try{const a=String(e||"").trim();a?(r=(n=globalThis.appDocStorage)==null?void 0:n.set)==null||r.call(n,`shareNames.${i}`,a):(s=(t=globalThis.appDocStorage)==null?void 0:t.delete)==null||s.call(t,`shareNames.${i}`)}catch(a){}}async function li(i){try{return await navigator.clipboard.writeText(i),!0}catch(e){return prompt("Kopieer deze tekst:",i),!1}}function Ur(i){const e=document.getElementById("configsection");if(!e)throw new Error("configsection not found");e.innerHTML=i,globalThis.toggleAppView("config")}async function Gr(){if(!ee.isEnabled())return alert("Beheer vereist OIDC login, maar OIDC is niet geconfigureerd."),null;const i=await ee.getAccessToken();return i||(confirm("Aanmelden is nodig om shares/teams te beheren. Nu aanmelden?")&&await ee.login(),null)}function qr(i){return`
<table border="1px" style="border-collapse:collapse" align="center" width="100%">
  <tr>
    <td width="100%" align="center" bgcolor="LightGrey">
      <b>Beheer - Delen & Teams</b>
    </td>
  </tr>
  <tr>
    <td width="100%" align="left" style="padding:10px">
      <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
        <span><b>Ingelogd als:</b> <span id="stm_profile">${i}</span></span>
        <button type="button" style="font-size:14px" id="stm_back">Terug</button>
        <button type="button" style="font-size:14px" id="stm_copy_current">Kopieer deel-link (huidig schema)</button>
      </div>
      <div style="margin-top:8px" class="highlight-warning" id="stm_global_status" hidden></div>
    </td>
  </tr>
</table>
<br>

<table border="1px" style="border-collapse:collapse" align="center" width="100%">
  <tr>
    <td width="100%" align="center" bgcolor="LightGrey"><b>Mijn shares</b></td>
  </tr>
  <tr>
    <td width="100%" align="left" style="padding:10px">
      <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
        <button type="button" style="font-size:14px" id="stm_refresh_shares">Vernieuwen</button>
        <span id="stm_shares_status"></span>
      </div>
      <div style="overflow:auto; margin-top:10px">
        <table border="1px" style="border-collapse:collapse" width="100%">
          <thead>
            <tr bgcolor="LightGrey">
                            <th align="left">Naam</th>
              <th align="left">Team</th>
              <th align="left">Aangepast</th>
              <th align="left">Acties</th>
            </tr>
          </thead>
          <tbody id="stm_shares_body"></tbody>
        </table>
      </div>
    </td>
  </tr>
</table>
<br>

<table border="1px" style="border-collapse:collapse" align="center" width="100%">
  <tr>
    <td width="100%" align="center" bgcolor="LightGrey"><b>Teams</b></td>
  </tr>
  <tr>
    <td width="100%" align="left" style="padding:10px">
      <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
        <button type="button" style="font-size:14px" id="stm_refresh_teams">Vernieuwen</button>
        <span id="stm_teams_status"></span>
      </div>

      <div style="margin-top:10px; display:flex; gap:20px; flex-wrap:wrap; align-items:flex-start;">
        <div style="min-width:320px; flex:1;">
          <b>Mijn teams</b>
          <div style="overflow:auto; margin-top:8px">
            <table border="1px" style="border-collapse:collapse" width="100%">
              <thead>
                <tr bgcolor="LightGrey">
                  <th align="left">Team ID</th>
                  <th align="left">Naam</th>
                  <th align="left">Rol</th>
                </tr>
              </thead>
              <tbody id="stm_teams_body"></tbody>
            </table>
          </div>
        </div>

        <div style="min-width:320px; flex:1;">
          <b>Team aanmaken</b>
          <div style="margin-top:8px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
            <input type="text" id="stm_new_team_name" placeholder="Team naam" style="min-width:220px" />
            <button type="button" style="font-size:14px" id="stm_create_team">Aanmaken</button>
          </div>
          <div id="stm_create_team_status" style="margin-top:6px"></div>

          <hr style="margin:12px 0" />

          <b>Invite maken (owner)</b>
          <div style="margin-top:8px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
            <input type="text" id="stm_invite_team_id" placeholder="Team ID" style="min-width:220px" />
            <input type="text" id="stm_invite_email" placeholder="Email (optioneel)" style="min-width:220px" />
            <button type="button" style="font-size:14px" id="stm_create_invite">Maak invite</button>
          </div>
          <div style="margin-top:8px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
            <input type="text" id="stm_invite_token" placeholder="Invite token" style="min-width:260px" readonly />
            <button type="button" style="font-size:14px" id="stm_copy_invite">Kopieer</button>
          </div>
          <div id="stm_invite_status" style="margin-top:6px"></div>

          <hr style="margin:12px 0" />

          <b>Invite accepteren</b>
          <div style="margin-top:8px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
            <input type="text" id="stm_accept_token" placeholder="Invite token" style="min-width:260px" />
            <button type="button" style="font-size:14px" id="stm_accept_invite">Accepteren</button>
          </div>
          <div id="stm_accept_status" style="margin-top:6px"></div>
        </div>
      </div>
    </td>
  </tr>
</table>
<br>

`}async function Se(i,e,t){const s=await fetch(i,_e(Q({},t),{headers:Q(Q({},(t==null?void 0:t.headers)||{}),Or(e))}));if(!s.ok){const n=await s.text();throw new Error(`${s.status} ${n}`)}return await s.json()}function be(i,e){const t=document.getElementById(i);t&&(t.textContent=e)}function Te(i,e){const t=document.getElementById(i);t&&(t.innerHTML=e)}function Be(){const i=document.getElementById("stm_share_versions_modal_overlay");i&&i.parentElement&&i.parentElement.removeChild(i)}function bs(){const i=document.getElementById("stm_confirm_modal_overlay");i&&i.parentElement&&i.parentElement.removeChild(i)}async function Wr(i){return bs(),await new Promise(e=>{const t=document.createElement("div");t.id="stm_confirm_modal_overlay",t.classList.add("popup-overlay");const s=document.createElement("div");s.classList.add("popup"),s.style.width="min(640px, calc(100vw - 24px))";const n=document.createElement("h3");n.textContent=i.title;const r=document.createElement("div");r.innerHTML=i.messageHtml,r.style.marginTop="8px";const a=document.createElement("div");a.style.display="flex",a.style.gap="10px",a.style.marginTop="14px",a.style.justifyContent="flex-end";const o=document.createElement("button");o.type="button",o.textContent=i.cancelText||"Annuleer";const l=document.createElement("button");l.type="button",l.textContent=i.confirmText||"Bevestig";const c=h=>{window.removeEventListener("keydown",d),bs(),e(h)};o.addEventListener("click",()=>c(!1)),l.addEventListener("click",()=>c(!0));const d=h=>{h.key==="Escape"&&c(!1)};window.addEventListener("keydown",d),t.addEventListener("mousedown",h=>{h.target===t&&c(!1)}),a.appendChild(o),a.appendChild(l),s.appendChild(n),s.appendChild(r),s.appendChild(a),t.appendChild(s),document.body.appendChild(t),t.style.visibility="visible",t.style.pointerEvents="auto",setTimeout(()=>l.focus(),0)})}async function Jr(i,e){Be();const t=document.createElement("div");t.id="stm_share_versions_modal_overlay",t.classList.add("popup-overlay");const s=document.createElement("div");s.classList.add("popup"),s.style.width="min(980px, calc(100vw - 24px))",s.style.maxHeight="min(80vh, 720px)",s.style.overflow="auto";const n=document.createElement("h3");n.textContent="Share versies";const r=document.createElement("div");r.style.display="flex",r.style.alignItems="center",r.style.gap="10px";const a=document.createElement("div");a.innerHTML=`Share: <code>${i}</code>`;const o=document.createElement("button");o.type="button",o.textContent="Sluiten",o.style.marginLeft="auto",o.addEventListener("click",()=>Be()),r.appendChild(a),r.appendChild(o);const l=document.createElement("div");l.id="stm_share_versions_status",l.style.marginTop="8px",l.textContent="Laden...";const c=document.createElement("div");c.style.marginTop="10px",s.appendChild(n),s.appendChild(r),s.appendChild(l),s.appendChild(c),t.appendChild(s),document.body.appendChild(t),t.style.visibility="visible",t.style.pointerEvents="auto",t.addEventListener("mousedown",C=>{C.target===t&&Be()}),window.addEventListener("keydown",function C(N){N.key==="Escape"&&(window.removeEventListener("keydown",C),Be())});let d=[];try{d=await Se(`/api/shares/${encodeURIComponent(i)}/versions`,e,{method:"GET"})}catch(C){l.innerHTML=`<span class="highlight-warning">Fout: ${String((C==null?void 0:C.message)||C)}</span>`;return}if(!Array.isArray(d)||d.length===0){l.textContent="Geen versies";return}l.textContent=`${d.length} versies`;const h=document.createElement("div");h.style.overflow="auto";const p=document.createElement("table");p.setAttribute("border","1px"),p.style.borderCollapse="collapse",p.style.width="100%";const g=document.createElement("thead"),m=document.createElement("tr");m.setAttribute("bgcolor","LightGrey");const v=document.createElement("th");v.align="left",v.textContent="Gemaakt";const S=document.createElement("th");S.align="left",S.textContent="Versie";const L=document.createElement("th");L.align="left",L.textContent="Door";const A=document.createElement("th");A.align="left",A.textContent="Acties",m.appendChild(v),m.appendChild(S),m.appendChild(L),m.appendChild(A),g.appendChild(m);const V=document.createElement("tbody");for(const C of d.slice(0,200)){const N=document.createElement("tr"),G=document.createElement("td");G.textContent=Wt(C.createdAt);const w=document.createElement("td"),M=document.createElement("code");M.textContent=C.id,w.appendChild(M);const u=document.createElement("td");u.textContent=C.createdBySub?String(C.createdBySub):"";const f=document.createElement("td"),k=document.createElement("button");k.type="button",k.style.fontSize="14px",k.textContent="Open",k.addEventListener("click",async()=>{if(confirm("Dit zal je huidige schema vervangen. Doorgaan?"))try{const _=await Se(`/api/shares/${encodeURIComponent(i)}/versions/${encodeURIComponent(C.id)}`,e,{method:"GET"});if(!(_!=null&&_.schema)){alert("Versie bevat geen schema.");return}globalThis.currentShareId=i,he(_.schema,!0,!0),globalThis.fileAPIobj.clear(),Be(),globalThis.topMenu.selectMenuItemByName("Eéndraadschema")}catch(_){alert(`Kon versie niet openen: ${String((_==null?void 0:_.message)||_)}`)}});const x=document.createElement("button");x.type="button",x.style.fontSize="14px",x.style.marginLeft="8px",x.textContent="Herstel",x.addEventListener("click",async()=>{if(confirm("Herstellen zal de share in de cloud overschrijven. Doorgaan?"))try{await Se(`/api/shares/${encodeURIComponent(i)}/versions/${encodeURIComponent(C.id)}/restore`,e,{method:"POST"}),alert("Hersteld."),Be(),await mt(e)}catch(_){alert(`Kon niet herstellen: ${String((_==null?void 0:_.message)||_)}`)}}),f.appendChild(k),f.appendChild(x),N.appendChild(G),N.appendChild(w),N.appendChild(u),N.appendChild(f),V.appendChild(N)}p.appendChild(g),p.appendChild(V),h.appendChild(p),c.appendChild(h)}async function mt(i){be("stm_shares_status","Laden...");const e=document.getElementById("stm_shares_body");if(!e)return;e.innerHTML="";let t=[];try{t=await Se("/api/shares/mine",i,{method:"GET",headers:{"Content-Type":"application/json"}})}catch(s){be("stm_shares_status",""),alert(`Kon shares niet laden: ${String((s==null?void 0:s.message)||s)}`);return}if(!Array.isArray(t)||t.length===0){be("stm_shares_status","Geen shares");return}be("stm_shares_status",`${t.length} shares`);for(const s of t){const n=document.createElement("tr");n.dataset.shareId=s.id;const r=document.createElement("td");r.textContent=s.teamId?String(s.teamId):"-";const a=document.createElement("td"),o=document.createElement("span");o.textContent=et(s.id)||"-",a.appendChild(o);const l=document.createElement("td");l.textContent=Wt(s.updatedAt);const c=document.createElement("td"),d=document.createElement("button");d.type="button",d.style.fontSize="14px",d.textContent="Naam",d.addEventListener("click",async()=>{const v=et(s.id),S=prompt("Geef een naam voor deze share (leeg = wissen):",v);S!==null&&(Fr(s.id,S),o.textContent=et(s.id)||"-")});const h=document.createElement("button");h.type="button",h.style.fontSize="14px",h.style.marginLeft="8px",h.textContent="Versies",h.addEventListener("click",async()=>{const v=await ee.getAccessToken();if(!v){alert("Niet ingelogd.");return}await Jr(s.id,v)});const p=document.createElement("button");p.type="button",p.style.fontSize="14px",p.textContent="Open",p.addEventListener("click",async()=>{if(confirm("Dit zal je huidige schema vervangen. Doorgaan?"))try{const S=await fetch(`/api/shares/${encodeURIComponent(s.id)}`);if(!S.ok){alert(`Kon share niet laden: ${S.status} ${await S.text()}`);return}const L=await S.json();if(!(L!=null&&L.schema)){alert("Share bevat geen schema.");return}globalThis.currentShareId=s.id,he(L.schema,!0,!0),globalThis.fileAPIobj.clear(),globalThis.topMenu.selectMenuItemByName("Eéndraadschema")}catch(S){alert(`Kon share niet laden: ${String((S==null?void 0:S.message)||S)}`)}});const g=document.createElement("button");g.type="button",g.style.fontSize="14px",g.style.marginLeft="8px",g.textContent="Kopieer link",g.addEventListener("click",async()=>{const v=jr(s.id);await li(v)});const m=document.createElement("button");m.type="button",m.style.fontSize="14px",m.style.marginLeft="8px",m.textContent="Verwijder",m.addEventListener("click",async()=>{const v=await ee.getAccessToken();if(!v){alert("Niet ingelogd.");return}const S=et(s.id);if(await Wr({title:"Share verwijderen",messageHtml:`Weet je zeker dat je deze share wilt verwijderen?${S?`<br><br><b>Naam:</b> ${S}`:""}<br><br><b>Opgelet:</b> dit kan niet ongedaan gemaakt worden.`,confirmText:"Verwijder",cancelText:"Annuleer"}))try{m.disabled=!0,await Se(`/api/shares/${encodeURIComponent(s.id)}`,v,{method:"DELETE"}),globalThis.currentShareId===s.id&&(globalThis.currentShareId=null),await mt(v)}catch(A){alert(`Kon share niet verwijderen: ${String((A==null?void 0:A.message)||A)}`)}finally{m.disabled=!1}}),c.appendChild(d),c.appendChild(h),c.appendChild(p),c.appendChild(g),c.appendChild(m),n.appendChild(a),n.appendChild(r),n.appendChild(l),n.appendChild(c),e.appendChild(n)}}async function tt(i){be("stm_teams_status","Laden...");const e=document.getElementById("stm_teams_body");if(!e)return[];e.innerHTML="";let t=[];try{t=await Se("/api/teams",i,{method:"GET"})}catch(s){return be("stm_teams_status",""),alert(`Kon teams niet laden: ${String((s==null?void 0:s.message)||s)}`),[]}if(!Array.isArray(t)||t.length===0)return be("stm_teams_status","Geen teams"),[];be("stm_teams_status",`${t.length} teams`);for(const s of t){const n=document.createElement("tr"),r=document.createElement("td"),a=document.createElement("code");a.textContent=s.id,r.appendChild(a);const o=document.createElement("td");o.textContent=s.name;const l=document.createElement("td");l.textContent=s.role,n.appendChild(r),n.appendChild(o),n.appendChild(l),e.appendChild(n)}return t}async function Xr(){const i=await Gr();if(!i)return;const e=await ee.getProfile(),t=(e==null?void 0:e.name)||(e==null?void 0:e.email)||(e==null?void 0:e.sub)||"";Ur(qr(t));const s=document.getElementById("stm_back");s==null||s.addEventListener("click",()=>{globalThis.topMenu.selectMenuItemByName("Bestand")});const n=document.getElementById("stm_copy_current");n==null||n.addEventListener("click",async()=>{typeof globalThis.copyShareLink=="function"?await globalThis.copyShareLink():alert("copyShareLink is niet beschikbaar.")});const r=document.getElementById("stm_refresh_shares");r==null||r.addEventListener("click",async()=>{const h=await ee.getAccessToken();if(!h){alert("Niet ingelogd.");return}await mt(h)});const a=document.getElementById("stm_refresh_teams");a==null||a.addEventListener("click",async()=>{const h=await ee.getAccessToken();if(!h){alert("Niet ingelogd.");return}await tt(h)});const o=document.getElementById("stm_create_team");o==null||o.addEventListener("click",async()=>{const h=await ee.getAccessToken();if(!h){alert("Niet ingelogd.");return}const p=document.getElementById("stm_new_team_name"),g=((p==null?void 0:p.value)||"").trim();if(!g){Te("stm_create_team_status",'<span class="highlight-warning">Naam is verplicht.</span>');return}be("stm_create_team_status","Bezig...");try{const m=await Se("/api/teams",h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:g})});p&&(p.value=""),Te("stm_create_team_status",`Team aangemaakt: <code>${m.id}</code> (${m.name})`),await tt(h)}catch(m){Te("stm_create_team_status",`<span class="highlight-warning">Fout: ${String((m==null?void 0:m.message)||m)}</span>`)}});const l=document.getElementById("stm_create_invite");l==null||l.addEventListener("click",async()=>{var v,S;const h=await ee.getAccessToken();if(!h){alert("Niet ingelogd.");return}const p=(((v=document.getElementById("stm_invite_team_id"))==null?void 0:v.value)||"").trim(),g=(((S=document.getElementById("stm_invite_email"))==null?void 0:S.value)||"").trim(),m=document.getElementById("stm_invite_token");if(!p){Te("stm_invite_status",'<span class="highlight-warning">Team ID is verplicht.</span>');return}be("stm_invite_status","Bezig..."),m&&(m.value="");try{const L=await Se(`/api/teams/${encodeURIComponent(p)}/invites`,h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:g||""})});m&&(m.value=L.token),Te("stm_invite_status",`Invite gemaakt (vervalt ${Wt(L.expiresAt)}).`)}catch(L){Te("stm_invite_status",`<span class="highlight-warning">Fout: ${String((L==null?void 0:L.message)||L)}</span>`)}});const c=document.getElementById("stm_copy_invite");c==null||c.addEventListener("click",async()=>{const h=document.getElementById("stm_invite_token"),p=((h==null?void 0:h.value)||"").trim();p&&await li(p)});const d=document.getElementById("stm_accept_invite");d==null||d.addEventListener("click",async()=>{var g;const h=await ee.getAccessToken();if(!h){alert("Niet ingelogd.");return}const p=(((g=document.getElementById("stm_accept_token"))==null?void 0:g.value)||"").trim();if(!p){Te("stm_accept_status",'<span class="highlight-warning">Token is verplicht.</span>');return}be("stm_accept_status","Bezig...");try{const m=await Se("/api/invites/accept",h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:p})});Te("stm_accept_status",`Toegevoegd aan team: <code>${m.teamId}</code>`),await tt(h)}catch(m){Te("stm_accept_status",`<span class="highlight-warning">Fout: ${String((m==null?void 0:m.message)||m)}</span>`)}}),await mt(i),await tt(i)}function Zr(i){return i?{Authorization:`Bearer ${i}`}:{}}function Yr(i){const e=document.getElementById("configsection");if(!e)throw new Error("configsection not found");e.innerHTML=i,globalThis.toggleAppView("config")}function Re(i,e){const t=document.getElementById(i);t&&(t.textContent=e)}function ci(i,e){const t=document.getElementById(i);t&&(t.innerHTML=e)}function di(i){if(!i)return"";try{return new Date(i).toLocaleString()}catch(e){return i}}function Qr(i){return`${window.location.href.split("#")[0]}#share=${encodeURIComponent(i)}`}async function ea(i){try{await navigator.clipboard.writeText(i)}catch(e){prompt("Kopieer deze tekst:",i)}}async function ta(){if(!ee.isEnabled())return alert("Admin vereist OIDC login, maar OIDC is niet geconfigureerd."),null;const i=await ee.getAccessToken();return i||(confirm("Aanmelden is nodig voor admin. Nu aanmelden?")&&await ee.login(),null)}async function Je(i,e,t){const s=await fetch(i,_e(Q({},t),{headers:Q(Q({},(t==null?void 0:t.headers)||{}),Zr(e))}));if(!s.ok){const n=await s.text();throw new Error(`${s.status} ${n||s.statusText}`)}return await s.json()}function sa(i){return`
<table border="1px" style="border-collapse:collapse" align="center" width="100%">
  <tr>
    <td width="100%" align="center" bgcolor="LightGrey"><b>Admin</b></td>
  </tr>
  <tr>
    <td width="100%" align="left" style="padding:10px">
      <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
        <span><b>Ingelogd als:</b> <span id="adm_profile">${i}</span></span>
        <button type="button" style="font-size:14px" id="adm_back">Terug</button>
      </div>
      <div style="margin-top:8px" class="highlight-warning" id="adm_status" hidden></div>
    </td>
  </tr>
</table>
<br>

<table border="1px" style="border-collapse:collapse" align="center" width="100%">
  <tr>
    <td width="100%" align="center" bgcolor="LightGrey"><b>Users</b></td>
  </tr>
  <tr>
    <td width="100%" align="left" style="padding:10px">
      <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
        <button type="button" style="font-size:14px" id="adm_users_refresh">Vernieuwen</button>
        <span id="adm_users_status"></span>
      </div>
      <div style="overflow:auto; margin-top:10px">
        <table border="1px" style="border-collapse:collapse" width="100%">
          <thead>
            <tr bgcolor="LightGrey">
              <th align="left">Sub</th>
              <th align="left">Naam</th>
              <th align="left">Email</th>
              <th align="left">Admin</th>
              <th align="left">Laatste login</th>
              <th align="left">Acties</th>
            </tr>
          </thead>
          <tbody id="adm_users_body"></tbody>
        </table>
      </div>
    </td>
  </tr>
</table>
<br>

<table border="1px" style="border-collapse:collapse" align="center" width="100%">
  <tr>
    <td width="100%" align="center" bgcolor="LightGrey"><b>Alle schemas</b></td>
  </tr>
  <tr>
    <td width="100%" align="left" style="padding:10px">
      <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
        <button type="button" style="font-size:14px" id="adm_shares_refresh">Vernieuwen</button>
        <span id="adm_shares_status"></span>
      </div>
      <div style="overflow:auto; margin-top:10px">
        <table border="1px" style="border-collapse:collapse" width="100%">
          <thead>
            <tr bgcolor="LightGrey">
              <th align="left">Share ID</th>
              <th align="left">Owner</th>
              <th align="left">Team</th>
              <th align="left">Aangepast</th>
              <th align="left">Acties</th>
            </tr>
          </thead>
          <tbody id="adm_shares_body"></tbody>
        </table>
      </div>
    </td>
  </tr>
</table>
`}async function Kt(i){Re("adm_users_status","Bezig...");const e=document.getElementById("adm_users_body");e&&(e.innerHTML="");try{const t=await Je("/api/admin/users",i);if(!Array.isArray(t)||t.length===0){Re("adm_users_status","Geen users");return}if(Re("adm_users_status",`${t.length} users`),!e)return;for(const s of t){const n=document.createElement("tr"),r=document.createElement("td"),a=document.createElement("code");a.textContent=s.sub,r.appendChild(a);const o=document.createElement("td");o.textContent=s.name||"";const l=document.createElement("td");l.textContent=s.email||"";const c=document.createElement("td");c.textContent=s.isAdmin?"Ja":"Nee";const d=document.createElement("td");d.textContent=di(s.lastSeenAt);const h=document.createElement("td"),p=document.createElement("button");p.type="button",p.style.fontSize="14px",p.textContent=s.isAdmin?"Maak geen admin":"Maak admin",p.addEventListener("click",async()=>{const g=!s.isAdmin;confirm(`${g?"Admin rechten geven aan":"Admin rechten verwijderen van"} ${s.sub}?`)&&(await Je(`/api/admin/users/${encodeURIComponent(s.sub)}`,i,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({isAdmin:g})}),await Kt(i))}),h.appendChild(p),n.appendChild(r),n.appendChild(o),n.appendChild(l),n.appendChild(c),n.appendChild(d),n.appendChild(h),e.appendChild(n)}}catch(t){ci("adm_users_status",`<span class="highlight-warning">Fout: ${String((t==null?void 0:t.message)||t)}</span>`)}}async function ys(i){Re("adm_shares_status","Bezig...");const e=document.getElementById("adm_shares_body");e&&(e.innerHTML="");try{const t=await Je("/api/admin/shares",i);if(!Array.isArray(t)||t.length===0){Re("adm_shares_status","Geen shares");return}if(Re("adm_shares_status",`${t.length} shares`),!e)return;for(const s of t){const n=document.createElement("tr"),r=document.createElement("td"),a=document.createElement("code");a.textContent=s.id,r.appendChild(a);const o=document.createElement("td"),l=(s.ownerName||s.ownerEmail||"").trim();o.textContent=l||s.ownerSub||"";const c=document.createElement("td");c.textContent=s.teamId||"";const d=document.createElement("td");d.textContent=di(s.updatedAt);const h=document.createElement("td"),p=document.createElement("button");p.type="button",p.style.fontSize="14px",p.textContent="Open",p.addEventListener("click",async()=>{const m=await Je(`/api/admin/shares/${encodeURIComponent(s.id)}`,i),v=he(m.schema);globalThis.load_from_txt(v),globalThis.currentShareId=m.id,globalThis.topMenu.selectMenuItemByName("Schema")});const g=document.createElement("button");g.type="button",g.style.fontSize="14px",g.textContent="Kopieer link",g.style.marginLeft="6px",g.addEventListener("click",async()=>{await ea(Qr(s.id))}),h.appendChild(p),h.appendChild(g),n.appendChild(r),n.appendChild(o),n.appendChild(c),n.appendChild(d),n.appendChild(h),e.appendChild(n)}}catch(t){ci("adm_shares_status",`<span class="highlight-warning">Fout: ${String((t==null?void 0:t.message)||t)}</span>`)}}async function ia(){const i=await ta();if(!i)return;const e=await ee.getProfile(),t=(e==null?void 0:e.name)||(e==null?void 0:e.email)||(e==null?void 0:e.sub)||"";try{const a=await Je("/api/me",i);if(!(a!=null&&a.isAdmin)){alert("Geen toegang: admin vereist.");return}}catch(a){alert(`Kon admin status niet controleren: ${String((a==null?void 0:a.message)||a)}`);return}Yr(sa(t));const s=document.getElementById("adm_back");s==null||s.addEventListener("click",()=>{globalThis.topMenu.selectMenuItemByName("Bestand")});const n=document.getElementById("adm_users_refresh");n==null||n.addEventListener("click",async()=>{const a=await ee.getAccessToken();a&&await Kt(a)});const r=document.getElementById("adm_shares_refresh");r==null||r.addEventListener("click",async()=>{const a=await ee.getAccessToken();a&&await ys(a)}),await Kt(i),await ys(i)}function Ke(i){return i?{Authorization:`Bearer ${i}`}:{}}globalThis.authLogin=async()=>{try{await ee.login()}catch(i){console.error("OIDC login failed",i);const e=i!=null&&i.message?String(i.message):String(i);alert(`Aanmelden mislukt: ${e}`)}};globalThis.authLogout=async()=>{await ee.logout()};globalThis.authWhoAmI=async()=>{if(!ee.isEnabled()){alert("OIDC is niet geconfigureerd.");return}const i=await ee.getProfile();if(!i){alert("Niet ingelogd.");return}alert(`Ingelogd als: ${i.name||i.email||i.sub}`)};globalThis.openShareManager=async()=>{if(!ee.isEnabled()){alert("Share beheer vereist OIDC login, maar OIDC is niet geconfigureerd.");return}const i=await ee.getAccessToken();if(!i){confirm("Aanmelden is nodig om je shares te bekijken. Nu aanmelden?")&&await ee.login();return}const e=await fetch("/api/shares/mine",{method:"GET",headers:Q({"Content-Type":"application/json"},Ke(i))});if(!e.ok){alert(`Kon shares niet laden: ${e.status} ${await e.text()}`);return}const t=await e.json();if(!Array.isArray(t)||t.length===0){alert("Geen shares gevonden.");return}const s=window.location.href.split("#")[0],n=t.slice(0,50).map(r=>`${r.id}  (updated ${r.updatedAt})  ->  ${s}#share=${r.id}`);prompt("Je shares (kopieer wat je nodig hebt):",n.join(`
`))};globalThis.openTeamManager=async()=>{if(!ee.isEnabled()){alert("Teams vereisen OIDC login, maar OIDC is niet geconfigureerd.");return}const i=await ee.getAccessToken();if(!i){confirm("Aanmelden is nodig voor teams. Nu aanmelden?")&&await ee.login();return}const e=prompt(`Team acties:
1 = List teams
2 = Create team
3 = Invite to team (by team id)
4 = Accept invite (token)`,"1");if(e){if(e==="1"){const t=await fetch("/api/teams",{headers:Ke(i)});if(!t.ok){alert(`Kon teams niet laden: ${t.status} ${await t.text()}`);return}const n=(await t.json()).map(r=>`${r.id}  ${r.name}  (${r.role})`);prompt("Teams:",n.join(`
`));return}if(e==="2"){const t=prompt("Team naam:","Mijn team");if(!t)return;const s=await fetch("/api/teams",{method:"POST",headers:Q({"Content-Type":"application/json"},Ke(i)),body:JSON.stringify({name:t})});if(!s.ok){alert(`Kon team niet aanmaken: ${s.status} ${await s.text()}`);return}const n=await s.json();alert(`Team aangemaakt: ${n.name} (${n.id})`);return}if(e==="3"){const t=prompt("Team id:","");if(!t)return;const s=prompt("Invite email (optioneel):",""),n=await fetch(`/api/teams/${encodeURIComponent(t)}/invites`,{method:"POST",headers:Q({"Content-Type":"application/json"},Ke(i)),body:JSON.stringify({email:s||""})});if(!n.ok){alert(`Kon invite niet maken: ${n.status} ${await n.text()}`);return}const r=await n.json();prompt("Invite token (deel dit):",r.token);return}if(e==="4"){const t=prompt("Invite token:","");if(!t)return;const s=await fetch("/api/invites/accept",{method:"POST",headers:Q({"Content-Type":"application/json"},Ke(i)),body:JSON.stringify({token:t})});if(!s.ok){alert(`Kon invite niet accepteren: ${s.status} ${await s.text()}`);return}alert("Invite geaccepteerd.")}}};globalThis.openShareTeamsScreen=async()=>{await Xr()};globalThis.openAdminScreen=async()=>{await ia()};async function na(){await ee.init();try{if(ee.isEnabled()){const i=await ee.getAccessToken();i&&await fetch("/api/me",{headers:Ke(i)})}}catch(i){}}Dr();console.log("20260214-225105");globalThis.session=new Hr;globalThis.appDocStorage=new Br("appDocStorage",{});globalThis.undostruct=new zr(100);var Ts;{const i=globalThis.undostruct,e=(Ts=i.store)==null?void 0:Ts.bind(i);typeof e=="function"&&(i.store=(...t)=>{e(...t),Tr()})}globalThis.fileAPIobj=new hr;globalThis.currentShareId=null;globalThis.treeEditInModal=!0;globalThis.SITPLANVIEW_SELECT_PADDING=parseInt(F(getComputedStyle(document.documentElement).getPropertyValue("--selectPadding")));globalThis.SITPLANVIEW_ZOOMINTERVAL={MIN:.1,MAX:1e3};globalThis.SITPLANVIEW_DEFAULT_SCALE=.7;globalThis.CONFIGPAGE_LEFT=`
    <table border="1px" style="border-collapse:collapse;" align="center" width="100%"><tr><td style="padding-top: 0; padding-right: 10px; padding-bottom: 10px; padding-left: 10px;">
        <p><font size="+2">
          <b>Welkom op ééndraadschema</b>
        </font></p>
      <p><font size="+1">  
           Deze gratis tool laat toe zowel ééndraadschema's als situatieschema's te tekenen, inclusief complexere schema's
           met bijvoorbeeld domotica. De schema's kunnen als PDF bestand worden geëxporteerd en geprint.
           Voor de experts kunnen schema's eveneens worden omgezet in SVG vectorformaat om in andere programma's verder te bewerken.
      </font></p>
      <p><font size="+1">  
           Kies één van onderstaande voorbeelden om van te starten of start van een leeg schema (optie 3).
      </font></p>
      <font size="+1">
        <i>
          <b>Tip: </b>Om de mogelijkheden van het programma te leren kennen is het vaak beter eerst een voorbeeldschema te
          bekijken alvorens van een leeg schema te vertrekken.
        </i>
      </font>
    </td></tr></table>
    <div id="autoSaveRecover"></div>
    <br>
    <table border="1px" style="border-collapse:collapse" align="center" width="100%">
      <tr>
        <td width="25%" align="center" bgcolor="LightGrey">
          <b>Voorbeeld 1</b>
        </td>
        <td width="25%" align="center" bgcolor="LightGrey">
          <b>Voorbeeld 2</b>
        </td>
        <td width="25%" align="center" bgcolor="LightGrey">
          <b>Leeg schema</b>
        </td>
        <td width="25%" align="center" bgcolor="LightGrey">
          <b>Openen</b>
        </td>
      </tr>
      <tr>
        <td width="25%" align="center">
          <br>
          <img src="examples/example000.svg" height="300px"><br><br>
          Eenvoudig schema, enkel contactdozen en lichtpunten.
          <br><br>
        </td>
        <td width="25%" align="center">
          <br>
          <img src="examples/example001.svg" height="300px"><br><br>
          Iets complexer schema met teleruptoren, verbruikers achter contactdozen en gesplitste kringen.
          <br><br>
        </td>
        <td width="25%" align="center">
          <br>
          <img src="examples/gear.svg" height="100px"><br><br>
`;globalThis.CONFIGPAGE_RIGHT=`
          <br><br>
        </td>
        <td width="25%" align="center">
          <br>
          <img src="examples/import_icon.svg" height="100px"><br><br>
          Open een schema dat u eerder heeft opgeslagen op uw computer (EDS-bestand). Enkel bestanden aangemaakt na 12 juli 2019 worden herkend.
          <br><br>
        </td>
      </tr>
      <tr>
        <td width="25%" align="center">
          <br>
          <button onclick="load_example(0)">Verdergaan met deze optie</button>
          <br><br>
        </td>
        <td width="25%" align="center">
          <br>
          <button onclick="load_example(1)">Verdergaan met deze optie</button>
          <br><br>
        </td>
        <td width="25%" align="center">
          <br>
          <button onclick="read_settings()">Verdergaan met deze optie</button>
          <br><br>
        </td>
        <td width="25%" align="center">
          <br>
          <button onclick="loadClicked()">Verdergaan met deze optie</button>
          <br><br>
        </td>
      </tr>
    </table>
  `;globalThis.CONFIGPRINTPAGE="<div></div><br>";globalThis.EXAMPLE0="EDS0040000eJztWW1v2zYQ/iuCvk4L9JZkNoZhSQZ0Q7ehQIZsQFEItHS2GVGkQVF2XpD99t2RsiWjrptqcbYUAYJAOpLH4/M8vKOpez9vtAZprjis/LHvB74AOTNzfxyNAr9ghvnj9/c+L9AQ+AtGff1xGPhcFuvHXAnBFjVgnykTNWA/rRa1P773pUanP/HpFB2zxij7XjHZAIjW9FZzOfudsWqrxdwuAA1nTNai4Qa7UHcmDRPZQmGM2BijaQJ1PgddUYexX+BMQCHy1n+1AM1m5CkNW69ZySYgMskyA0IABRTfRCfYujU6K0AYlvU8JCG5YIWG2iFlvW1PiRFjA2K6hIwWVzFmXOdt57zOahCQ49t0g1qptLGrXeKC1MyuMcGh0oGzHf9SKd2tANvmDa/nqsGw+XXpj41u0OWU1RS6/xD4tWp0jo01BiQbIR4CR2vc0Rp1tEafp3UgpedKF/iGCMyAMXxuQ+1WuYF4T9SkznXYcRd2fLCwbePTahAtf12de8mbODh+jPxoMJR1KygnA6FyhgPQVBsmCwvoFyrTOUI+uMwmKKINbv9CsnvF2JsS0VzBHZ9tHLYqsCljn2jDnmpHHf/JM8p2O+JH6va0J9vwU7p1cA0Jm94HaNYJwnC0bSs23qnYiwv2eNX2ZfsWmhJD+Fi8v0hvhfL9lHR3Kfdip3QddM+q3K30dbaP/KTH/ukXiTbq09+S/FnJXiikPTeFUvWuhIuGkkJAXLnoFuLEsp6zq3atiAgKwrvgILMKQKOBBm/lnznA1GCnGUxUsyogQ2GxEgQ2bxaI08+ZmK6YAV3wfG76LT3HrdG5RDR3zL0eJzMks0AMJmqzQffQkcZD6Yhf6TgAHUlHR9qr6enBcvqV5tfgueTUJak/CYJSlXiwCvwldclsU9aOulPEkleywvaYK83viFoBGaYTTBvSJdUco9fg+li0elkWsgk2FYb8zZEoMlOm7qwnoRPJEraYwDRY99PYY2pOGg3VefKq8wPoPBxKR/pKx9PTkYyG0nH8SsfT03Hysg7I9uLgEwfk6MsPyFegBcHuwvpqT8nne3/a9yRwcvhT8q+Ed851jqvspNDtjbp1bCHvbxm/aCa4TBSNLd29Xem2Be4CyXB5RJ5Axq/hEdvMDUW0S8FLPIJ8PBDPFOWOndvGbdWzaKSxVEV7cT4divOg4+9jcI534gyyfMEwJ/FQmAedvobL+WXDHEe7C0f6AgvHgJuVc1aUrLI/Nr7aqnGxl//eNot7F9nHr5cr/8k5Lk4H8/F6u3IIPkaD+XjmOrT7WHW54DCzE/zP69EH7I3pcIlu31uRHewfzkTMvo+COIhGAVa90yA5DdI4SJMgjYI0DPDH7UmAB2o86+E5BHnHNIk7Mx59IJK5NJlhEwFE9Rz4jKA6PsFMWrGbFS/oM3D6XUo5v14IdruwlQeLK0gadYYacKa2rOJzbT8Xb/nCvaLdh+Ia+1uPBBL1rphGFmqHHM6qCkByDM/tnmRCAG1m6+B24+G29btgWAtrfme/E6fEBcmWhoPV7pRjUcaaSEebGyRaQBiGR1CQS7WS9rvplVKaqot3hsSCffx+on+4NBoLoRfSMw4KPQwVcLsAGf4AMfa+SWIP7es/sr+5/G1t326AbyvGccyyneyIbSb7sVAVcHk0AUpaElfaftDlBVRUmTGraUVgkCPbZ6ooRXo3XpyEV97fx6H3852r4d13fAengBnLby/7W85lBOpsb6KOHeaEUGG3ac0NEi3XHtrX61pJmw2a6p3jOFqL/J3lH18LmLJGGIc8Ru2IibClRjZJNkf4e0Mrw+h6M8Qg8NhQYcSkmA8Pm7mWmwU8/ANHMC6N";globalThis.EXAMPLE1="EDS0040000eJztWm1v2zYQ/iuGvk4LrBc7iTEMS1KgHdoOBVIEA4pCoK2zzYgSDYpyXor0t++OlC0ptR1HjdO0cxEUMl+Ox+d5eDxS+uKMCqUg0xccrpyB47iOgGyip84g8FwnZpo5g09fHB47A/w9Y9TWGXRdh2fx4nEkhWCzHLDNmIkcsJ2Ss9wZfHEyhUZf8fEYDbNCS/M7ZVkBIMqit4pnk38YSxs1+mYGWHDCslwUXGMTas4yzUQ0k+gjVvpYNIR8NAWVUoOBE+NIQC7y0n46A8UmZCnsllajhA1BRBmLNAgB5JB/7fWxttE7ikFoFtUsBF0ywWIFuUXKWGsOiR5jBWI6h4gmlzKmbeOmcZ5HOQgY4a/xErVEKm1mO8cJyYmZY4BdMwtO0/+5lKqaAdZNC55PZYFu88vEGWhVoMkxy8l15851clmoEVbm6FBWCHHnWlr9ilavotV7mNaWlJ5KFeMvRGACjOFz6Wo1yyXEG7z2jiu3/cptf2dum8qn1SCW/Htx2gle+25vG/lRZ0jyUlBWBkKOGHbAolyzLDaAPlKZ1hDywbNoiCJa4vYdkt0oxtqQiOYV3PLJ0mCpAhMyNom2W1PtccV/8IyybXq8pW4Pa7LtrtOthauN2/S7hWatIDTHsqZi/ZWKPRux7VVbl+1bloLqeCvU+3fWuUL9rtPuKumerdSuxe5ZpduIXyeb2D+q2D98DtGezwTXeSmCLdRZC6pHlX/hjxXnBLBiC1W2UmSbQPpMcfQJwujGHbSWz9UiaO9hMXp1uktSH5TimUSaRzqWMl+1+2NBQi4grFxUi8qKYzFmlXqVoiEoCO+YQxalAAoLqHODwynAWGOjCQxlcRVDhOJiCQisXk4Qh58yMb5iGlTMR1Ndr6kZLgutSURzxdiLflmEXMaIwVAud4tNdARt6fD3dDw9HWFYSzCCio/+zmL1ez5SciLFWM5tvNsmC/bbiib4AaLxf3XRBOEWdKzaP8M2bLwH8k1BB30cqoInoPItdRP0KkfJ6d2r+3zJV15Rn9cKbUwx+22dWycuhrjJYXbAJ035WP6QrozhBGnvFrjLX8IWerBdEbZE8ARh+7ajVpgf3JfYJkD7zw3oPoA/sJ92d5rLtr8f2Kezu0lnayHN6z5qL+ztE6gdrL+wNR/9PR9Pz0f/57p4Mhfyay6evLYXT/6vfPF0ujE61ujvr7t5WsV+q7P+d2SmYe1Wwuuv27f3menWmWnoPzeg72hGswIHuR9fLba4XG4xpJWR7eO7b6OvwZqmvip9yaSMESBBo9gg8tpmVAgOrWTbbxn1NwK9KWhvwjT4X2K6Xr0W7e/C1DtsGaFaXX8ZPEdcjTAMr1v1/spVD1nyQhb90m2xEIfZSryNB3+/Jcqt7ou2QXl1bNW4a6pipqX6GVEOey1RbnUP9EqmUnPMjCaQ66LAnbe27y7QhWsEJEOUdaHsCl8nZAQiVozFgjLpxsoWMmECUyRVJEkmGwFhAjiRiWIpJapxs1sM2mRA95j4xqMHo24thyGEX3zUfVPAvcAr4MlC7lPsY763+lDwg1/4tToUtLgsOWVxQueCX/lUcLbxK4rabuB7jzqj798B7uL9wXFrPvYvAXfxErB2hxzUXujs7lb/QvFL6NgAVQWqN4Qa7q8mVM2pSWSqorLXrSSWOgmLTYupVPyWqMXNGgMKBo7MBtYReq/AtjFo1SItREOsijXZmyJRVEzRuirt9axI5tBgAgNhXg9k25zy/fZCf+ZE9AUd8h+ViX7G1rjBzNHsJ7NsX+R/6CXJ4ZPn+q537GIOcugeuceu57le4Iah6/luELpBzw36rtd1vZ7rhS4+9t3Qc0PfxZM4HhzxVIMJIeaHqCXc03Cp4sr1jz+TdniGy4QNBZCCpsAnREQvxNNmyq6veEyfOveOe7RH5zPBbmYmU8CFDxn1OkFp2aIyDcLn3HwS3bCFsU3Zj6FzTZkxWiQKqHXKlLn/MrzgqDIGpJ4SdoqhTAig4GsM3Cwt3JR2ZwxzlxyzTGx6EhLTtBqoO5glMeaYRGEOQ/n8NcpIQLfrHUBMJuVVZr4NvpBSUTbQOUHZgHn8Y6j+PNeY5etOl567+A+PDxgxUVRU8BHEoPNb4HewfPFH5a/P3y/KmxXwe8o49pmXgx2w5WB/xTIFnh0MKRvmGc60/GiZx5BSJoWhSkkCgwyZNmNJW1rnuuMH3YvO11638+bW5lzVt+oWTgETNrqp3+GVgYYamxh+ZDEnhGKz+nOukehsYaH8eZnLzASZIv1gOfYWS+iD4Z8+h4cxK4S2yKPXlhj6kCpHNkk2B8iZkppRwOyiE5jmpegxKebz3XKs+XICd/8BlbFDJw==";globalThis.EXAMPLE_DEFAULT="EDS0040000eJytVN9v00AM/leieyWM/GgniBCivICE4GVoL9MUuTk3PfVyF91dunbT+NuxkzZZAQ0VqKLq4rM/f/7s+EFoNHVYi2IWCwkBRHHzIJQURRqLFhyaIIokFsrI47GyWkPrkXxWoD2Sn7OtF8WDME4UQsQi7Fuk0wKM150KytRkBDABdNlayiiKLBZL9NUaXcPXhZBqtULOpxA1uzctOqgJ53I+IJYbWKIuDZQBtUbOle3SS/I9iS0l6gDlFJ8nxBqkQz+xK0/T9faqc1ssoQu2AQiD7RRZ+dKjxoreVmP1G+tCX+aWarE1F8eRBqB5km/gvrXWTezFYyy87VyFWnlKaDqtH+NB/mySP53kT8+R/4N1kt6IdI0AdC6C6/Aps1GUZ4jkE5FsIpKdQ+Sz+68T8LvO/NpzisCNP7RxUF/bCsidTF9fLc4chAGBtFSmXHbKj0X//YSMkKTLHd6regw4duiZtsymtuRTW/J/m4+f0v9hQG7pngrdEtZNP1mnf3TNRG/SOIvzeHbLRJQJZYClRqaDhk8LkrntezZM5xpVveZRv3wTiwZ2d0ryekpfp6y1bzXsB/eEFaiZHm2skygfwA27yhN2H8tk2bsBt0HnhwoI30qkpgRVAfce6MP04gCwHxH2B9wWaLy8uu9324w1YWk5HHt9V4oGGxq+RjTSAUie7wYuUDKsvTP9d39NW4A1jhbVOmB/fLt0764CRYQo4XNCv4joEk5ANnxDXUQv8iwi+/Fh+8erL0f76QW+bEBRzPaQ7ALGZO+lbVCZiyVy+w1Ve1hISmLD829NcJYFYaDeZ2V520a7KMuT6+j7PIk+3bMA9Klwk+eDlFy4VEE8/gDGURmI";globalThis.forceUndoStore=()=>{globalThis.undostruct.store()};globalThis.HLCollapseExpand=(i,e)=>{let t;t=globalThis.structure.getOrdinalById(i),t!=null&&(e==null?globalThis.structure.data[t].collapsed=!globalThis.structure.data[t].collapsed:globalThis.structure.data[t].collapsed=e,globalThis.undostruct.store(),fe()?globalThis.HLRedrawTree():(globalThis.structure.updateHTMLinner(i),globalThis.HLRedrawTreeSVG()))};function st(){const i=document.getElementById("edsKeybindsModalOverlay");i&&i.parentElement&&i.parentElement.removeChild(i)}function ra(){st();const i=document.createElement("div");i.id="edsKeybindsModalOverlay",i.classList.add("popup-overlay","eds-keybinds-modal-overlay");const e=document.createElement("div");e.classList.add("popup","eds-keybinds-modal"),e.innerHTML=`
        <div class="eds-keybinds-header">
            <h3 class="eds-keybinds-title">Keybinds</h3>
            <button type="button" class="eds-keybinds-close" title="Sluiten">×</button>
        </div>
        <div class="eds-keybinds-body">
            <div class="eds-keybinds-note">
                Shortcuts apply to the element you are hovering in the SVG drawing (EDS). If you're typing in a text field, normal browser copy/paste wins.
            </div>

            <div class="eds-keybinds-grid">
                <div class="eds-keybinds-key">Ctrl/Cmd + C</div>
                <div class="eds-keybinds-desc">Copy settings</div>

                <div class="eds-keybinds-key">Ctrl/Cmd + V</div>
                <div class="eds-keybinds-desc">Paste settings (same type), or confirm to replace type</div>

                <div class="eds-keybinds-key">Shift + Ctrl/Cmd + C</div>
                <div class="eds-keybinds-desc">Copy component (including sub-elements)</div>

                <div class="eds-keybinds-key">Shift + Ctrl/Cmd + V</div>
                <div class="eds-keybinds-desc">Paste component after hovered element (same parent)</div>

                <div class="eds-keybinds-key">Shift + Alt + Ctrl/Cmd + V</div>
                <div class="eds-keybinds-desc">Paste component before hovered element</div>

                <div class="eds-keybinds-key">Ctrl/Cmd + Click</div>
                <div class="eds-keybinds-desc">Highlight element in tree</div>
            </div>

            <div class="eds-keybinds-note">
                Note: some browsers reserve Ctrl/Cmd+Shift+C for DevTools “Inspect”. If that happens, choose the context menu instead.
            </div>
        </div>
    `,i.appendChild(e),document.body.appendChild(i),i.style.visibility="visible",i.style.pointerEvents="auto";const t=e.querySelector(".eds-keybinds-close");t==null||t.addEventListener("click",()=>st()),i.addEventListener("mousedown",s=>{s.target===i&&st()}),window.addEventListener("keydown",function s(n){n.key==="Escape"&&(window.removeEventListener("keydown",s),st())})}function $e(){const i=document.getElementById("edsTreeModalOverlay");i&&i.parentElement&&i.parentElement.removeChild(i),document.body.style.pointerEvents="auto",globalThis._edsTreeModalOpenId=null}function ks(i,e){var n;const t=i.querySelector(".eds-tree-modal-preview");if(!t)return;const s=globalThis.structure.getElectroItemById(e);if(s==null||typeof s.updateSituationPlanElement!="function"){t.innerHTML="";return}try{const r=new we;r.setElectroItemId(e),r.rotate=0,r.setscale(1),s.updateSituationPlanElement(r),t.innerHTML=(n=r.svg)!=null?n:"";const a=t.querySelector("svg");a&&(a.removeAttribute("width"),a.removeAttribute("height"),a.setAttribute("width","100%"),a.setAttribute("height","100%"),a.setAttribute("preserveAspectRatio","xMidYMid meet"))}catch(r){t.innerHTML=""}}function aa(i){if(i.querySelector(".eds-prop-grid"))return;let e=i.innerHTML;if(e.trim()==="")return;e=e.replace(/<br\s*\/?>/gi,'<span class="eds-prop-section-break"></span>'),e=e.replace(/,\s+/g,'<span class="eds-prop-delim"></span>'),i.innerHTML=e;const t=Array.from(i.childNodes),s=document.createElement("div");s.className="eds-prop-grid";const n=l=>{var c;for(const d of Array.from(l.childNodes))if(d.nodeType===Node.ELEMENT_NODE||d.nodeType===Node.TEXT_NODE&&((c=d.textContent)!=null?c:"").trim()!=="")return!0;return!1},r=l=>{n(l)&&s.appendChild(l)},a=l=>{var d,h;const c=Array.from(l.querySelectorAll('input[type="checkbox"]'));for(const p of c){if(p.closest("label"))continue;const g=p.closest(".eds-prop-row");if(!g)continue;const m=[];let v=p.previousSibling;for(;v;){if(v.nodeType===Node.ELEMENT_NODE){const A=v.tagName;if(A==="LABEL"||A==="INPUT"||A==="SELECT"||A==="TEXTAREA"||A==="BUTTON")break}v.nodeType===Node.TEXT_NODE&&((d=v.textContent)!=null?d:"").trim(),m.push(v),v=v.previousSibling}if(!m.some(A=>{var V;return A.nodeType!==Node.TEXT_NODE||((V=A.textContent)!=null?V:"").trim()!==""}))continue;m.reverse();const L=document.createElement("label");L.className="eds-inline-checkbox-label",g.insertBefore(L,(h=m[0])!=null?h:p);for(const A of m)L.appendChild(A);L.appendChild(p)}};let o=document.createElement("div");o.className="eds-prop-row";for(const l of t){if(l.nodeType===Node.ELEMENT_NODE){const c=l;if(c.classList.contains("eds-prop-delim")){r(o),o=document.createElement("div"),o.className="eds-prop-row";continue}if(c.classList.contains("eds-prop-section-break")){r(o);const d=document.createElement("div");d.className="eds-prop-section-spacer",s.appendChild(d),o=document.createElement("div"),o.className="eds-prop-row";continue}}o.appendChild(l)}r(o),i.innerHTML="",i.appendChild(s),a(s)}function Ae(i){if(globalThis.treeEditInModal!==!0)return;const e=globalThis.structure.getElectroItemById(i);if(e===null)return;$e();const t=document.createElement("div");t.id="edsTreeModalOverlay",t.classList.add("popup-overlay","eds-tree-modal-overlay");const s=document.createElement("div");s.classList.add("popup","eds-tree-modal");const n=`${F(e.getType())||"Element"} — ${F(e.getReadableAdres())||`ID ${i}`}`,r=ge!=null&&F(ge.type)!==""&&F(ge.type)===F(e.getType());s.innerHTML=`
        <div class="eds-tree-modal-header">
            <div class="eds-tree-modal-title">${n}</div>
            <div class="eds-tree-modal-actions">
                <button type="button" class="eds-tree-modal-action" data-eds-action="copy-settings" title="Copy settings">Copy</button>
                <button type="button" class="eds-tree-modal-action" data-eds-action="paste-settings" title="Paste settings" ${r?"":"disabled"}>Paste</button>
                <button type="button" class="eds-tree-modal-action" data-eds-action="replace-settings" title="Replace settings">Replace</button>
            </div>
            <div class="eds-tree-modal-preview" aria-hidden="true"></div>
            <button type="button" class="eds-tree-modal-close" title="Sluiten">×</button>
        </div>
        <div class="eds-tree-modal-body">
            ${e.toHTML(globalThis.structure.mode)}
        </div>
    `,t.appendChild(s),document.body.appendChild(t);const a=s.querySelector(".eds-tree-modal-body");a&&aa(a),ks(s,i),t.style.visibility="visible",document.body.style.pointerEvents="none",t.style.pointerEvents="auto",globalThis._edsTreeModalOpenId=i;const o=s.querySelector(".eds-tree-modal-close");o==null||o.addEventListener("click",()=>$e());const l=s.querySelector(".eds-tree-modal-actions");l==null||l.addEventListener("click",c=>{var p;const d=c.target,h=(p=d==null?void 0:d.getAttribute)==null?void 0:p.call(d,"data-eds-action");if(h){if(c.preventDefault(),c.stopPropagation(),h==="copy-settings"){Xt(i),Ae(i);return}if(h==="paste-settings"){je(i,{replaceType:!1});return}if(h==="replace-settings"){if(ge==null){alert("No copied settings yet. Use Copy first.");return}const g=F(ge.type),m=F(e.getType());if(!(g!==""&&g!==m?confirm(`Replace this element (type ${m||"unknown"}) with copied settings (type ${g})?`):!0))return;je(i,{replaceType:!0});return}}}),s.addEventListener("change",c=>{Ti(c.target),ks(s,i);const d=c.target;if(d&&typeof d.id=="string"&&/_type$/.test(d.id)){const h=globalThis._edsTreeModalOpenId;h!=null&&h===i&&Ae(i)}}),t.addEventListener("mousedown",c=>{c.target===t&&$e()}),window.addEventListener("keydown",function c(d){d.key==="Escape"&&(window.removeEventListener("keydown",c),$e())})}function hi(i){i._treeModalEditingBound!==!0&&(i._treeModalEditingBound=!0,i.addEventListener("click",e=>{var a;if(globalThis.treeEditInModal!==!0)return;const t=e.target;if(t==null)return;const s=t.tagName;if(s==="INPUT"||s==="SELECT"||s==="TEXTAREA"||s==="BUTTON"||t.closest(".hl-collapse-cell")||t.closest(".tree-drag-handle"))return;const n=(a=t.closest("[data-hl-open-id]"))==null?void 0:a.getAttribute("data-hl-open-id");let r=null;if(n!=null){const o=Number(n);Number.isFinite(o)&&o>0&&(r=o)}if(r==null){const o=t.closest("table.html_edit_table[data-hl-id]"),l=o==null?void 0:o.getAttribute("data-hl-id"),c=l!=null?Number(l):NaN;Number.isFinite(c)&&c>0&&(r=c)}r!=null&&Ae(r)}))}globalThis.HLDelete=i=>{const e=globalThis.structure.getElectroItemById(i);if(e===null)return;const t=e.getParent();globalThis.structure.deleteById(i),globalThis.undostruct.store(),globalThis._edsTreeModalOpenId===i&&$e(),t!==null&&!fe()?(globalThis.structure.reNumber(),globalThis.structure.updateHTMLinner(t.id),globalThis.HLRedrawTreeSVG()):globalThis.HLRedrawTree()};globalThis.HLAdd=()=>{globalThis.structure.addItem(""),globalThis.undostruct.store(),globalThis.HLRedrawTree()};globalThis.HLInsertBefore=i=>{const e=globalThis.structure.getElectroItemById(i);if(e===null)return;const t=e.getParent(),s=globalThis.structure.curid;globalThis.structure.insertItemBeforeId(new X(globalThis.structure),i),globalThis.undostruct.store(),t!==null&&!fe()?(globalThis.structure.reNumber(),globalThis.structure.updateHTMLinner(t.id),globalThis.HLRedrawTreeSVG()):globalThis.HLRedrawTree(),globalThis.treeEditInModal===!0&&globalThis.structure.curid!==s&&Ae(s)};globalThis.HLInsertAfter=i=>{const e=globalThis.structure.getElectroItemById(i);if(e===null)return;const t=e.getParent(),s=globalThis.structure.curid;globalThis.structure.insertItemAfterId(new X(globalThis.structure),i),globalThis.undostruct.store(),t!==null&&!fe()?(globalThis.structure.reNumber(),globalThis.structure.updateHTMLinner(t.id),globalThis.HLRedrawTreeSVG()):globalThis.HLRedrawTree(),globalThis.treeEditInModal===!0&&globalThis.structure.curid!==s&&Ae(s)};globalThis.HLMoveDown=i=>{const e=globalThis.structure.getElectroItemById(i);if(e===null)return;const t=e.getParent();globalThis.structure.moveDown(i),globalThis.undostruct.store(),t!==null&&!fe()?(globalThis.structure.reNumber(),globalThis.structure.updateHTMLinner(t.id),globalThis.HLRedrawTreeSVG()):globalThis.HLRedrawTree()};globalThis.HLMoveUp=i=>{const e=globalThis.structure.getElectroItemById(i);if(e===null)return;const t=e.getParent();globalThis.structure.moveUp(i),globalThis.undostruct.store(),t!==null&&!fe()?(globalThis.structure.reNumber(),globalThis.structure.updateHTMLinner(t.id),globalThis.HLRedrawTreeSVG()):globalThis.HLRedrawTree()};globalThis.HLClone=i=>{const e=globalThis.structure.getElectroItemById(i);if(e===null)return;const t=e.getParent();globalThis.structure.clone(i),globalThis.undostruct.store(),t!==null&&!fe()?(globalThis.structure.reNumber(),globalThis.structure.updateHTMLinner(t.id),globalThis.HLRedrawTreeSVG()):globalThis.HLRedrawTree()};globalThis.HLInsertChild=i=>{const e=globalThis.structure.curid;globalThis.structure.insertChildAfterId(new X(globalThis.structure),i),globalThis.structure.reNumber(),globalThis.HLCollapseExpand(i,!1),globalThis.treeEditInModal===!0&&globalThis.structure.curid!==e&&Ae(e)};globalThis.HL_editmode=()=>{globalThis.structure.mode=document.getElementById("edit_mode").value,globalThis.HLRedrawTreeHTML()};globalThis.HL_toggleTreeEditModal=()=>{const i=document.getElementById("hl_tree_edit_in_modal");globalThis.treeEditInModal=(i==null?void 0:i.checked)===!0,$e(),globalThis.HLRedrawTreeHTML()};globalThis.HLExpand=i=>{let e=globalThis.structure.getElectroItemById(i);e!==null&&e.expand(),globalThis.structure.reSort(),globalThis.undostruct.store(),globalThis.HLRedrawTree()};globalThis.HL_changeparent=i=>{var r,a;let e=document.getElementById("id_parent_change_"+i).value,t=0,s=0;Hi(e)||(t=1);let n=parseInt(e);if(n!=0)if(s=globalThis.structure.getOrdinalById(n),s==null)t=1;else if(!globalThis.structure.active[s]||n==i)t=1;else{let o=n;for(;o!=0;)o=(a=(r=globalThis.structure.getElectroItemById(o))==null?void 0:r.parent)!=null?a:0,o==i&&(t=2)}switch(t){case 1:alert("Dat is geen geldig moeder-object. Probeer opnieuw.");break;case 2:alert("Circulaire referentie. Nieuwe moeder kan geen afstammeling van het te verplaatsen element zijn.");break;default:const o=globalThis.structure.getOrdinalById(i);o!==null&&(globalThis.structure.data[o].parent=n)}globalThis.structure.reSort(),globalThis.undostruct.store(),globalThis.HLRedrawTree()};globalThis.HL_cancelFilename=()=>{const i=document.getElementById("settings");i!==null&&(i.innerHTML="<code>"+globalThis.structure.properties.filename+'</code><br><button style="font-size:14px" onclick="saveSchema()">Opslaan</button>&nbsp;<button style="font-size:14px" onclick="HL_enterSettings()">Naam wijzigen</button>')};globalThis.HL_changeFilename=()=>{var i=new RegExp("^.*\\.eds$"),e=document.getElementById("filename").value;const t=document.getElementById("settings");t!==null&&(i.test(e)?(globalThis.structure.properties.setFilename(document.getElementById("filename").value),t.innerHTML="<code>"+globalThis.structure.properties.filename+'</code><br><button style="font-size:14px" onclick="HL_enterSettings()">Wijzigen</button>&nbsp;<button style="font-size:14px" onclick="saveSchema()">Opslaan</button>'):(globalThis.structure.properties.setFilename(document.getElementById("filename").value+".eds"),t.innerHTML="<code>"+globalThis.structure.properties.filename+'</code><br><button style="font-size:14px" onclick="HL_enterSettings()">Wijzigen</button>&nbsp;<button style="font-size:14px" onclick="saveSchema()">Opslaan</button>'))};globalThis.HL_enterSettings=()=>{const i=document.getElementById("settings");i!=null&&(i.innerHTML='<input type="text" id="filename" onchange="HL_changeFilename()" value="'+globalThis.structure.properties.filename+'" pattern="^.*\\.eds$"><br><i>Gebruik enkel alphanumerieke karakters a-z A-Z 0-9, streepjes en spaties. <b>Eindig met ".eds"</b>. Druk daarna op enter.</i><br><button onclick="HL_cancelFilename()">Annuleer</button>&nbsp;<button onclick="HL_changeFilename()">Toepassen</button>')};globalThis.HLRedrawTreeHTML=()=>{globalThis.toggleAppView("2col");const i=document.getElementById("settings");i!==null&&(i.innerHTML="");var e=globalThis.structure.toHTML(0)+"<br>"+mi();const t=document.getElementById("left_col_inner");t!==null&&(t.innerHTML=e,pi(t),hi(t))};globalThis.HLRedrawTreeHTMLLight=()=>{var i=globalThis.structure.toHTML(0)+"<br>"+mi();const e=document.getElementById("left_col_inner");e!==null&&(e.innerHTML=i,pi(e),hi(e))};function pi(i){if(i._treeDragDropBound===!0)return;i._treeDragDropBound=!0;let e=null,t=null,s=null;const n=()=>{t!=null&&t.classList.remove("tree-drop-before","tree-drop-after"),t=null,s=null};i.addEventListener("dragstart",r=>{if(globalThis.structure.mode!=="move"){r.preventDefault();return}const a=r.target;if(a==null)return;const o=a.tagName;if(o==="INPUT"||o==="SELECT"||o==="TEXTAREA"||o==="BUTTON"){r.preventDefault();return}const l=a.closest('table.html_edit_table[data-hl-id][draggable="true"]');if(l==null)return;const c=l.getAttribute("data-hl-id"),d=c!=null?Number(c):NaN;!Number.isFinite(d)||d<=0||(e=d,l.classList.add("tree-dragging"),r.dataTransfer&&(r.dataTransfer.setData("text/plain",String(d)),r.dataTransfer.effectAllowed="move"))}),i.addEventListener("dragend",()=>{const r=i.querySelectorAll("table.html_edit_table.tree-dragging");for(let a=0;a<r.length;a++)r[a].classList.remove("tree-dragging");e=null,n()}),i.addEventListener("dragover",r=>{if(globalThis.structure.mode!=="move"||e==null)return;const a=r.target;if(a==null)return;const o=a.closest('table.html_edit_table[data-hl-id][draggable="true"]');if(o==null){n();return}const l=o.getAttribute("data-hl-id"),c=l!=null?Number(l):NaN;if(!Number.isFinite(c)||c<=0)return;if(c===e){n();return}r.preventDefault(),r.dataTransfer&&(r.dataTransfer.dropEffect="move");const d=o.getBoundingClientRect(),h=r.clientY<d.top+d.height/2?"before":"after";(t!==o||s!==h)&&(n(),t=o,s=h,o.classList.add(h==="before"?"tree-drop-before":"tree-drop-after"))}),i.addEventListener("drop",r=>{var v;if(globalThis.structure.mode!=="move")return;const a=r.target;if(a==null)return;const o=a.closest('table.html_edit_table[data-hl-id][draggable="true"]');if(o==null)return;const l=o.getAttribute("data-hl-id"),c=l!=null?Number(l):NaN;if(!Number.isFinite(c)||c<=0)return;const d=(v=r.dataTransfer)==null?void 0:v.getData("text/plain"),h=d!=null&&d!==""?Number(d):e;if(h==null||!Number.isFinite(h)||h<=0||h===c)return;r.preventDefault();const p=o.getBoundingClientRect(),g=r.clientY<p.top+p.height/2?"before":"after",m=globalThis.structure.moveSubtreeRelativeToId(h,c,g,!1);n(),e=null,m&&(globalThis.undostruct.store(),globalThis.HLRedrawTree(),Ee(h))})}globalThis.HLRedrawTreeSVG=()=>{let i='<div class="eds-drawing-header"><b>Tekening: </b>Ga naar het print-menu om de tekening af te printen of te exporteren als SVG vector graphics.<button type="button" id="edsKeybindsHelpButton" class="eds-keybinds-help-button" title="Keybinds">?</button></div><br><div id="EDS">'+Ot(globalThis.structure.toSVG(0,"horizontal").data,10)+`</div><h2>Legende:</h2><button class="button-insertBefore"></button> Item hierboven invoegen (zelfde niveau)<br><button class="button-insertAfter"></button> Item hieronder invoegen (zelfde niveau)<br><button class="button-insertChild"></button> Afhankelijk item hieronder toevoegen (niveau dieper)<br><button class="button-delete-garbage-can"></button> Item verwijderen<br><i><br><small>Versie: 20260214-225105 (C) Ivan Goethals -- <a href="license.html" target="popup" onclick="window.open('license.html','popup','width=800,height=600'); return false;">Terms</a></small></i><br><br>`;const e=document.getElementById("right_col_inner");e!=null&&(e.innerHTML=i),e!=null&&e._edsKeybindsHelpBound!==!0&&(e._edsKeybindsHelpBound=!0,e.addEventListener("click",t=>{const s=t.target;s!=null&&s.closest("#edsKeybindsHelpButton")!=null&&(t.preventDefault(),t.stopPropagation(),ra())})),la()};const it=new Map;function oa(i){var e;try{const t=globalThis.structure;if(t==null)return!1;let s=!1,n=i;for(;Number.isFinite(n)&&n>0;){const r=t.getOrdinalById(n);if(r==null)break;const a=(e=t.data[r])==null?void 0:e.parent;if(a==null||a===0)break;const o=t.getOrdinalById(a);if(o==null)break;const l=t.data[o];l!=null&&l.collapsed&&(l.collapsed=!1,s=!0),n=a}return s}catch(t){return!1}}function Ee(i){var r,a;if(!Number.isFinite(i)||i<=0)return;const e=oa(i);let t=document.getElementById("id_elem_"+i);if(t==null&&((a=(r=globalThis.structure)==null?void 0:r.properties)==null?void 0:a.currentView)!=="2col")try{globalThis.toggleAppView("2col"),globalThis.HLRedrawTreeHTMLLight(),t=document.getElementById("id_elem_"+i)}catch(o){}if(e)try{globalThis.HLRedrawTreeHTMLLight(),t=document.getElementById("id_elem_"+i)}catch(o){}if(t==null)return;try{t.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}catch(o){}const s=it.get(i);s!=null&&(clearTimeout(s),it.delete(i)),t.classList.remove("eds-tree-flash"),t.offsetWidth,t.classList.add("eds-tree-flash");const n=window.setTimeout(()=>{t.classList.remove("eds-tree-flash"),it.delete(i)},2600);it.set(i,n)}function la(){const i=document.getElementById("right_col_inner");if(i!=null&&i._edsClickToTreeFlashBound!==!0){if(i._edsClickToTreeFlashBound=!0,ha(i),window._edsModifierKeyBound!==!0){window._edsModifierKeyBound=!0;const e=t=>{const s=!!(t&&(t.ctrlKey||t.metaKey));document.documentElement.classList.toggle("eds-modifier-active",s)};window.addEventListener("keydown",t=>e(t)),window.addEventListener("keyup",t=>e(t)),window.addEventListener("blur",()=>document.documentElement.classList.remove("eds-modifier-active"))}i.addEventListener("click",e=>{const t=e.target;if(t==null||t.closest("#EDS")==null)return;const s=t.closest("#EDS");if(s==null)return;const n=Zt(e,t,s);if(n!=null){if(gi(n),e.ctrlKey||e.metaKey){Ee(n);return}globalThis.treeEditInModal===!0&&Ae(n)}}),da(),ua(i)}}let Ne=null,le=null,Ge=null,ui=null,dt=null,Jt=0;function gi(i){ui=i,Jt=Date.now()+6e4}function Lt(i){dt=i,i!=null&&(Jt=Date.now()+6e4)}function ca(i){const e=i;if(e==null)return!1;if(e.isContentEditable)return!0;const t=e.tagName;if(!t)return!1;const s=t.toUpperCase();return s==="INPUT"||s==="TEXTAREA"||s==="SELECT"}function da(){window._edsKeyboardCopyPasteBound!==!0&&(window._edsKeyboardCopyPasteBound=!0,window.addEventListener("keydown",i=>{var l;if(!(i.ctrlKey||i.metaKey)||ca(i.target))return;const e=((l=i.key)!=null?l:"").toLowerCase();if(e!=="c"&&e!=="v")return;const t=dt!=null?dt:ui;if(t==null||Date.now()>Jt)return;const s=globalThis.structure.getElectroItemById(t);if(s==null)return;if(i.shiftKey&&e==="c"){Ge=t,Ee(t),i.preventDefault(),i.stopPropagation();return}if(i.shiftKey&&e==="v"){if(Ge==null)return;const c=Ge,d=i.altKey?"before":"after";$t(t,d,c),Ee(t),i.preventDefault(),i.stopPropagation();return}if(e==="c"){Xt(t),Ee(t),i.preventDefault(),i.stopPropagation();return}if(ge==null)return;const n=F(ge.type),r=F(s.getType());if(n!==""&&n===r){je(t,{replaceType:!1}),Ee(t),i.preventDefault(),i.stopPropagation();return}const a=fi(s,t);confirm(`Replace settings of ${a} with copied ${n||"element"} settings?

If the type differs, the element type will be updated too.`)&&(je(t,{replaceType:!0}),Ee(t),i.preventDefault(),i.stopPropagation())}))}function ha(i){if(i._edsHoverTargetTrackingBound===!0)return;i._edsHoverTargetTrackingBound=!0;let e=0;i.addEventListener("mousemove",t=>{const s=Date.now();if(s-e<40)return;e=s;const n=t.target;if(n==null)return;const r=n.closest("#EDS");if(r==null){Lt(null);return}const a=Zt(t,n,r);a!=null&&Lt(a)}),i.addEventListener("mouseleave",()=>{Lt(null)})}let ge=null;function pa(i,e){const t=De(e!=null?e:{});return F(i)!=="Vrije tekst"&&t&&typeof t=="object"&&(delete t.tekst,delete t.Tekst),t}function Xt(i){var s,n;const e=globalThis.structure.getElectroItemById(i);if(e==null)return;const t=F((n=(s=e.getType)==null?void 0:s.call(e))!=null?n:"");ge={type:t,props:pa(t,e.props)}}function je(i,e={}){var h,p,g,m,v,S,L,A,V,C;if(ge==null)return;const t=globalThis.structure.getElectroItemById(i);if(t==null)return;const s=(h=t.props)==null?void 0:h.nr,n=(p=t.props)==null?void 0:p.adres,r=(g=t.props)==null?void 0:g.isAttribuut,a=(m=t.props)==null?void 0:m.tekst,o=F(ge.type),l=F((S=(v=t.getType)==null?void 0:v.call(t))!=null?S:"");e.replaceType===!0&&o!==""&&o!==l&&globalThis.structure.adjustTypeById(i,o);const c=globalThis.structure.getElectroItemById(i);if(c==null)return;const d=De((L=ge.props)!=null?L:{});if(s!=null&&(d.nr=s),n!=null&&(d.adres=n),r!=null&&(d.isAttribuut=r),!Object.prototype.hasOwnProperty.call(d!=null?d:{},"tekst")&&a!=null&&(d.tekst=a),d.type=F((C=(V=(A=c.getType)==null?void 0:A.call(c))!=null?V:d.type)!=null?C:""),c.props=d,c.getType()=="Domotica gestuurde verbruiker"&&globalThis.structure.voegAttributenToeAlsNodigEnReSort(),globalThis.undostruct.store(),fe())globalThis.HLRedrawTreeHTML();else{globalThis.structure.reNumber();const N=c.getParent();N!==null?globalThis.structure.updateHTMLinner(N.id):globalThis.structure.updateHTMLinner(i)}if(globalThis.HLRedrawTreeSVG(),globalThis.treeEditInModal===!0){const N=globalThis._edsTreeModalOpenId;N!=null&&N===i&&Ae(i)}}function xs(i){if(i==null)return!1;const e=i.getType();return e==="Zekering"||e==="Kring"}function fi(i,e){var n,r,a,o;const t=i.getType();if(t==="Kring"){const l=F((r=(n=i.props)==null?void 0:n.naam)!=null?r:"");return l!==""?`Kring ${l}`:`Kring #${e}`}const s=F((o=(a=i.getReadableAdres)==null?void 0:a.call(i))!=null?o:"");return s!==""?`${t} ${s}`:`${t} #${e}`}function ua(i){i._edsRightClickCopyPasteBound!==!0&&(i._edsRightClickCopyPasteBound=!0,window.addEventListener("click",()=>{le&&le.hide()}),i.addEventListener("contextmenu",e=>{const t=e.target;if(t==null)return;const s=t.closest("#EDS");if(s==null)return;e.preventDefault();const n=Zt(e,t,s);if(n==null)return;gi(n);const r=globalThis.structure.getElectroItemById(n);if(r==null)return;le==null&&(le=new Ys(document.body)),le.clearMenu();const a=fi(r,n);if(le.addMenuItem("Copy settings",()=>{Xt(n)}),ge!=null){const o=F(ge.type),l=F(r.getType());o!==""&&o===l?le.addMenuItem("Paste settings",()=>{je(n,{replaceType:!1})}):le.addMenuItem("Replace with copied settings",()=>{confirm(`Replace settings of ${a} with copied ${o||"element"} settings?

If the type differs, the element type will be updated too.`)&&je(n,{replaceType:!0})})}if(xs(r)&&(le.addLine(),le.addMenuItem("Copy circuit",()=>{Ne=n})),le.addLine(),le.addMenuItem("Delete "+a+"…",()=>{confirm("Delete "+a+`?

This will also delete child elements.`)&&(Ne===n&&(Ne=null),Ge===n&&(Ge=null),globalThis.HLDelete(n))}),Ne!=null){const o=globalThis.structure.getElectroItemById(Ne);xs(o)&&(le.addLine(),le.addMenuItem("Paste left of "+a,()=>{$t(n,"before")}),le.addMenuItem("Paste right of "+a,()=>{$t(n,"after")}))}le.addLine(),le.addMenuItem("Tip: click-highlight in tree",null,"Ctrl/Cmd",{disabled:!0,hint:!0}),le.show(e)}))}function $t(i,e,t){const s=t!=null?t:Ne;if(s==null)return;const n=globalThis.structure.getElectroItemById(i);if(n==null)return;const r=n.getParent(),a=globalThis.structure.cloneRelativeToId(s,i,e);a!=null&&(globalThis.undostruct.store(),r!==null&&!fe()?(globalThis.structure.reNumber(),globalThis.structure.updateHTMLinner(r.id),globalThis.HLRedrawTreeSVG()):globalThis.HLRedrawTree(),Ee(a))}function Zt(i,e,t){const s=i;if(typeof s.composedPath=="function"){const r=s.composedPath();for(let a=0;a<r.length;a++){const o=r[a];if(o&&typeof o.getAttribute=="function"){const l=o.getAttribute("data-eds-id"),c=l!=null?Number(l):NaN;if(Number.isFinite(c)&&c>0)return c}if(o===t)break}}const n=e.closest("[data-eds-id]");if(n!=null){const r=n.getAttribute("data-eds-id"),a=r!=null?Number(r):NaN;if(Number.isFinite(a)&&a>0)return a}if(typeof document.elementsFromPoint=="function"){const r=document.elementsFromPoint(i.clientX,i.clientY);for(let a=0;a<r.length;a++){const o=r[a];if(o.closest("#EDS")==null)continue;const l=o.closest("[data-eds-id]");if(l!=null){const c=l.getAttribute("data-eds-id"),d=c!=null?Number(c):NaN;if(Number.isFinite(d)&&d>0)return d}}}return ga(t,i.clientX,i.clientY,14)}function ga(i,e,t,s){const n=i.querySelectorAll("[data-eds-id]");let r=null,a=s*s;for(let o=0;o<n.length;o++){const l=n[o],c=l.getAttribute("data-eds-id");if(c==null||c===""||c==="0")continue;const d=Number(c);if(!Number.isFinite(d)||d<=0)continue;const h=l.getBoundingClientRect();if(h.width===0&&h.height===0)continue;const p=e<h.left?h.left-e:e>h.right?e-h.right:0,g=t<h.top?h.top-t:t>h.bottom?t-h.bottom:0,m=p*p+g*g;m<=a&&(a=m,r=d)}return r}globalThis.HLRedrawTree=()=>{globalThis.HLRedrawTreeHTML(),globalThis.HLRedrawTreeSVG()};function fa(i){let e=0;switch(i.addItem("Aansluiting"),i.data[0].props.type="Aansluiting",i.data[0].props.naam="",i.data[0].props.bescherming="differentieel",i.data[0].props.aantal_polen=qe,i.data[0].props.amperage=Rt,i.data[0].props.type_kabel_na_teller=qe+"x16",i.data[0].props.differentieel_delta_amperage=vi,e++,i.insertChildAfterId(new It(i),e),i.data[e].props.type="Bord",e++,i.insertChildAfterId(new Ls(i),e),i.data[e].props.type="Kring",i.data[e].props.autoKringNaam="manueel",i.data[e].props.bescherming="differentieel",i.data[e].props.aantal_polen=xi,i.data[e].props.amperage=Rt,i.data[e].props.kabel_is_aanwezig=!1,i.data[e].props.differentieel_delta_amperage=ya,e++,i.insertChildAfterId(new It(i),e),i.data[e].props.type="Bord",i.data[e].props.is_geaard=!1,e++,qe){case 2:i.properties.info="2 x 230V ~50 Hz";break;case 3:i.properties.info="3 x 230V ~50 Hz";break;case 4:i.properties.info="3 x 400V + N ~50 Hz"}}function ma(){globalThis.structure!=null&&globalThis.structure.dispose(),globalThis.structure=new Es,fa(globalThis.structure),globalThis.topMenu.selectMenuItemByName("Eéndraadschema"),globalThis.undostruct.clear(),globalThis.undostruct.store()}function mi(){var i="";return globalThis.structure.properties.control||(globalThis.structure.properties.control="<br>"),i='Plaats van de elektrische installatie<table width="90%" cols="1" rows="1" style="border-collapse: collapse;border-style: solid; border-width:thin;" cellpadding="5"><tr><td style="border-style: solid; border-width:thin;" contenteditable="true" valign="top" id="conf_owner" onblur="javascript:forceUndoStore()" onkeyup="javascript:changeAddressParams()">'+globalThis.structure.properties.owner+'</td></tr></table><br>Installateur<table width="90%" cols="1" rows="1" style="border-collapse: collapse;border-style: solid; border-width:thin;" cellpadding="5"><tr><td style="border-style: solid; border-width:thin;" contenteditable="true" valign="top" id="conf_installer" onblur="javascript:forceUndoStore()" onkeyup="javascript:changeAddressParams()">'+globalThis.structure.properties.installer+'</td></tr></table><br>Erkend organisme (keuring)<table width="90%" cols="1" rows="1" style="border-collapse: collapse;border-style: solid; border-width:thin;" cellpadding="5"><tr><td style="border-style: solid; border-width:thin;" contenteditable="true" valign="top" id="conf_control" onblur="javascript:forceUndoStore()" onkeyup="javascript:changeAddressParams()">'+globalThis.structure.properties.control+'</td></tr></table><br>Info <i>(wordt overschreven bij handmatig pagineren in het print-menu)</i><table width="90%" cols="1" rows="1" style="border-collapse: collapse;border-style: solid; border-width:thin;" cellpadding="5"><tr><td style="border-style: solid; border-width:thin;" contenteditable="true" valign="top" id="conf_info" onblur="javascript:forceUndoStore()" onkeyup="javascript:changeAddressParams()">'+globalThis.structure.properties.info+"</td></tr></table>",i}globalThis.changeAddressParams=()=>{globalThis.structure.properties.owner=document.getElementById("conf_owner").innerHTML,globalThis.structure.properties.installer=document.getElementById("conf_installer").innerHTML,globalThis.structure.properties.control=document.getElementById("conf_control").innerHTML,globalThis.structure.properties.info=document.getElementById("conf_info").innerHTML};function ba(){var i=Ar;i=i.replace(/Bewerken/g,"Eéndraadschema");const e=document.getElementById("configsection");e!=null&&(e.innerHTML=i),globalThis.toggleAppView("config")}function bi(){globalThis.currentShareId=null;var i=globalThis.CONFIGPAGE_LEFT;if(i+=`
      Hoofddifferentieel (in mA) <input id="differentieel_droog" type="text" size="5" maxlength="5" value="300"><br><br>
      Hoofdzekering (in A) <input id="hoofdzekering" type="text" size="4" maxlength="4" value="65"><br><br>
      Aantal fazen:
      <select id="aantal_fazen_droog"><option value="2">2p</option><option value="3">3p</option><option value="4">4p (3p+n)</option></select>`,i+=globalThis.CONFIGPAGE_RIGHT,i+=Cr(),i+="<h2>Recent toegevoegde functionaliteiten</h2>",Array.isArray(St)){i+='<table style="width:100%;border-collapse:collapse;">';for(let t=0;t<Math.min(10,St.length);t++){const s=St[t];i+=`
                <tr>
                    <td style="vertical-align:top; font-weight:bold; white-space:nowrap; padding-right:10px;">${s.date}</td>
                    <td style="vertical-align:top;">${s.msg}</td>
                </tr>
            `}i+="</table>"}const e=document.getElementById("configsection");e!=null&&(e.innerHTML=i),globalThis.toggleAppView("config"),Bi()&&alert("Deze appicatie werkt niet in Internet Explorer. Wij raden aan een moderne browser te gebruiken zoals Edge, Firefox, Google Chrome, Opera, Vivaldi, ...")}globalThis.toggleAppView=i=>{let e=globalThis.structure.properties.currentView;globalThis.structure.sitplanview!=null&&globalThis.structure.sitplanview.contextMenu!=null&&globalThis.structure.sitplanview.contextMenu.hide(),globalThis.structure.properties.currentView=i;const t=document.getElementById("configsection"),s=document.getElementById("outerdiv"),n=document.getElementById("ribbon"),r=document.getElementById("canvas_2col"),a=document.getElementById("left_col_inner"),o=document.getElementById("EDSSVG");if(i==="2col"){if(t==null||s==null||n==null||r==null)return;r.style.display==="none"&&(n.style.display="flex",r.style.display="flex",t.style.display="none",s.style.display="none",t.innerHTML="",globalThis.structure.updateRibbon())}else if(i==="config"){if(t==null||s==null||n==null||a==null||r==null)return;t.style.display==="none"&&(t.style.display="block",s.style.display="none",n.style.display="none",n.innerHTML=""),a.innerHTML="",r.style.display="none"}else if(i==="draw"){if(t==null||s==null||n==null||a==null||r==null)return;s.style.display==="none"&&(s.style.display="flex",n.style.display="flex",t.style.display="none",r.style.display="none",t.innerHTML="",a.innerHTML="",o!==null&&(o.innerHTML=""))}["2col","draw"].includes(i)&&["2col","draw"].includes(e)&&i!==e&&globalThis.undostruct.store()};globalThis.load_example=i=>{switch(globalThis.currentShareId=null,i){case 0:he(globalThis.EXAMPLE0),globalThis.fileAPIobj.clear();break;case 1:he(globalThis.EXAMPLE1),globalThis.fileAPIobj.clear();break}};globalThis.undoClicked=()=>{globalThis.structure.sitplanview!=null&&globalThis.structure.sitplanview.contextMenu!=null&&globalThis.structure.sitplanview.contextMenu.hide(),globalThis.undostruct.undo()};globalThis.redoClicked=()=>{globalThis.structure.sitplanview!=null&&globalThis.structure.sitplanview.contextMenu!=null&&globalThis.structure.sitplanview.contextMenu.hide(),globalThis.undostruct.redo()};globalThis.read_settings=()=>{qe=parseInt(document.getElementById("aantal_fazen_droog").value),xi=qe,Rt=parseInt(document.getElementById("hoofdzekering").value),vi=parseInt(document.getElementById("differentieel_droog").value),globalThis.fileAPIobj.clear(),ma()};const yi=document.getElementById("container");if(yi==null)throw new Error("HTML element container is null");yi.innerHTML=`
<div id="topmenu"><ul id="minitabs"></ul></div>
<div id="app">
<svg id="svgdefs"></svg> \x3C!-- Bevat SVG patronen die app-wide gebruikt worden -->
<div id="configsection" class="configsection">
    <div style="display:flex;align-items:center;justify-content:center;height:100vh;font-size:larger;font-weight:bold; text-align: center;">
    De App wordt geladen.<br><br>Even geduld..
    </div>
</div> \x3C!-- Full page configuratie --> 
<div id="ribbon" style="display:none;">
    <div id="left-icons" class="left-icons"></div>
    <div id="right-icons" class="right-icons"></div>
</div> \x3C!-- Ribbon -->
<div id="canvas_2col" style="display:none;"> \x3C!-- Eendraadschema-->
    <div id="left_col">
    <div id="left_col_inner"></div>
    </div>
    <div id="right_col">
    <div id="right_col_inner"></div>
    </div>
</div>
<div id="outerdiv" style="display:none;"> \x3C!-- Situatieschets -->
    <div id="sidebar"></div>
    <div id="canvas">
    <div id="paper"></div>
    </div>
</div>
</div>`;const ki=document.getElementById("svgdefs");if(ki==null)throw new Error("HTML element svgdefs is null");ki.innerHTML='<pattern id="VerticalStripe" x="5" y="0" width="5" height="10" patternUnits="userSpaceOnUse" ><line x1="0" y1="0" x2="0" y2="10" stroke="black" /></pattern>';document.getElementById("importfile")||(document.body.innerHTML+=`
    <input id="importfile" type="file" accept=".eds" onchange="importjson(event)" style="display:none;">
    <input id="appendfile" type="file" accept=".eds" onchange="appendjson(event)" style="display:none;">
    <input type="file" id="fileInput" accept="image/*" style="display:none;">
  `);var qe=2,xi=2,Rt=65,vi=300,ya=30;let wi;const Dt=[{name:"Nieuw",callback:bi},{name:"Bestand",callback:qs},{name:"Eéndraadschema",callback:globalThis.HLRedrawTree},{name:"Situatieschema",callback:Qs},{name:"Materialen",callback:ni},{name:"Print",callback:ve},{name:"Documentatie",callback:Mr},{name:"Info/Contact",callback:ba}];function ka(i){return i?{Authorization:`Bearer ${i}`}:{}}async function xa(i){try{const e=await fetch("/api/me",{headers:ka(i)});if(!e.ok)return!1;const t=await e.json();return!!(t!=null&&t.isAdmin)}catch(e){return!1}}async function vs(){if(!ee.isEnabled())return;const i=await ee.getAccessToken(),e=!!i,t=i?await xa(i):!1,s=[...Dt.slice(0,2),...e?[{name:"Beheer",callback:()=>{var n;(n=globalThis.openShareTeamsScreen)==null||n.call(globalThis)}}]:[],...t?[{name:"Admin",callback:()=>{var n;(n=globalThis.openAdminScreen)==null||n.call(globalThis)}}]:[],...Dt.slice(2)];globalThis.topMenu.setMenuItems(s)}wi=[...Dt];globalThis.topMenu=new Ai("minitabs","menu-item",wi);let Vt=null;const ws=document.getElementById("minitabs");if(ws){const i=document.createElement("li");i.className="menu-item menu-item-right";const e=document.createElement("button");e.type="button",e.className="theme-toggle topmenu-hamburger",e.id="topmenu-hamburger",e.textContent="☰",e.setAttribute("aria-label","Menu"),e.title="Menu";const t=document.createElement("div");t.className="topmenu-dropdown",t.hidden=!0;const s=o=>{t.hidden=!o,e.setAttribute("aria-expanded",o?"true":"false")},n=()=>s(t.hidden),r=document.createElement("button");r.type="button",r.id="theme-toggle",r.className="theme-toggle";const a=o=>{const l=o==="dark"?"Licht":"Donker";r.textContent=l,r.setAttribute("aria-label",`Schakel naar ${l.toLowerCase()}e modus`),r.title=`Schakel naar ${l.toLowerCase()}e modus`};if(r.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),Rr(),s(!1)}),t.appendChild(r),ee.isEnabled()){const o=document.createElement("span");o.className="topmenu-auth-user";const l=document.createElement("button");l.type="button",l.className="theme-toggle",l.textContent="Beheer",l.setAttribute("aria-label","Beheer delen en teams"),l.title="Beheer delen en teams",l.style.display="none",l.onclick=async h=>{h.preventDefault(),h.stopPropagation(),typeof globalThis.openShareTeamsScreen=="function"?await globalThis.openShareTeamsScreen():alert("Beheer scherm is niet beschikbaar."),s(!1)};const c=document.createElement("button");c.type="button",c.className="theme-toggle";const d=async()=>{const h=await ee.getProfile();h?(o.textContent=h.name||h.email||h.sub,o.style.display="",l.style.display="",c.textContent="Afmelden",c.setAttribute("aria-label","Afmelden"),c.title="Afmelden",c.onclick=async p=>{p.preventDefault(),p.stopPropagation(),await ee.logout(),await d(),await vs(),s(!1)}):(o.textContent="",o.style.display="none",l.style.display="none",c.textContent="Aanmelden",c.setAttribute("aria-label","Aanmelden"),c.title="Aanmelden",c.onclick=async p=>{p.preventDefault(),p.stopPropagation(),await ee.login()}),await vs()};Vt=d,d(),t.appendChild(o),t.appendChild(l),t.appendChild(c)}e.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),n()}),document.addEventListener("click",o=>{if(t.hidden)return;const l=o.target;l&&i.contains(l)||s(!1)}),window.addEventListener("keydown",o=>{o.key==="Escape"&&s(!1)}),i.appendChild(e),i.appendChild(t),ws.appendChild(i),Vr(a),a(document.documentElement.dataset.theme==="dark"?"dark":"light")}const _i=document.querySelector("#left_col_inner");if(_i==null)throw new Error("HTML element left_col_inner is null");function va(i,e,t,s){const n=globalThis.structure.getElectroItemById(i);if(n!=null){switch(t){case"select-one":if(e=="type")if(globalThis.structure.adjustTypeById(i,s),fe())globalThis.HLRedrawTreeHTML();else{globalThis.structure.reNumber();const r=n.getParent();r!==null?globalThis.structure.updateHTMLinner(r.id):globalThis.structure.updateHTMLinner(i)}else n.props[e]=s,fe()?globalThis.HLRedrawTreeHTML():(globalThis.structure.reNumber(),globalThis.structure.updateHTMLinner(i));break;case"text":n.props[e]=s,globalThis.structure.reNumber(),e==="kortsluitvermogen"&&(fe()?globalThis.HLRedrawTreeHTML():globalThis.structure.updateHTMLinner(i));break;case"checkbox":n.props[e]=s,fe()?globalThis.HLRedrawTreeHTML():(globalThis.structure.reNumber(),globalThis.structure.updateHTMLinner(i));break}n.getType()=="Domotica gestuurde verbruiker"&&globalThis.structure.voegAttributenToeAlsNodigEnReSort(),globalThis.undostruct.store(),globalThis.HLRedrawTreeSVG()}}function Ti(i){const e=i;if(e==null||typeof e.id!="string"||!e.id.startsWith("HL_edit_"))return;const t=e.id,s=e.type,n=s==="checkbox"?e.checked:e.value,r=t.match(/^HL_edit_(\d+)_(.+)$/),a=r?r[1]:null,o=r?r[2]:null;a==null||o==null||va(parseInt(a),o,s,n)}_i.addEventListener("change",function(i){Ti(i.target)});async function wa(){try{let i=function(){try{const o=window.location.href.split("#")[0];window.history.replaceState(null,document.title,o)}catch(o){}},e=function(o){try{const l=document.getElementById("eds_share_toast");l&&l.remove();const c=document.createElement("div");c.id="eds_share_toast",c.textContent=o,c.style.position="fixed",c.style.right="16px",c.style.bottom="16px",c.style.zIndex="99999",c.style.padding="10px 12px",c.style.borderRadius="8px",c.style.background="rgba(0,0,0,0.85)",c.style.color="white",c.style.fontSize="13px",c.style.maxWidth="60vw",c.style.boxShadow="0 8px 24px rgba(0,0,0,0.25)",c.style.pointerEvents="none",document.body.appendChild(c),setTimeout(()=>{c.remove()},2600)}catch(l){}},t=function(o){let l=o.replace(/-/g,"+").replace(/_/g,"/");for(;l.length%4!==0;)l+="=";return l},s=function(o){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)};const n=window.location.hash&&window.location.hash.startsWith("#")?window.location.hash.slice(1):window.location.hash;if(!n)return!1;const r=new URLSearchParams(n),a=r.get("share")||r.get("s");if(!a)return!1;if(a.startsWith("EDS")&&a.length>10){globalThis.currentShareId=null;const o=a.substring(0,10),l=a.substring(10),c=o+t(l);return he(c,!0,!0),globalThis.structure.sitplan&&(globalThis.structure.sitplan.activePage=1),i(),e("Schema geladen uit deel-link."),!0}if(a.startsWith("TXT")&&a.length>10){globalThis.currentShareId=null;const o=a.substring(0,10),l=a.substring(10),c=o+decodeURIComponent(l);return he(c,!0,!0),globalThis.structure.sitplan&&(globalThis.structure.sitplan.activePage=1),i(),e("Schema geladen uit deel-link."),!0}if(s(a)){const o=a;globalThis.currentShareId=o;const l=await fetch(`/api/shares/${o}`,{credentials:"include"});if(!l.ok)return console.warn("Share API error:",l.status,await l.text()),alert("Kon het schema niet laden uit de deel-link (serverfout)."),!1;const c=await l.json();return!c||typeof c.schema!="string"||c.schema.length<10?(alert("Kon het schema niet laden uit de deel-link (ongeldig antwoord)."),!1):(he(c.schema,!0,!0),globalThis.structure.sitplan&&(globalThis.structure.sitplan.activePage=1),i(),e("Schema geladen uit deel-link."),!0)}return console.warn("Onbekend share-formaat in URL."),!1}catch(i){return console.error("Fout bij laden van deel-link:",i),alert("Kon het schema niet laden uit de deel-link (de link is mogelijk beschadigd of te oud)."),!1}}he(globalThis.EXAMPLE_DEFAULT,!1);globalThis.autoSaver=new zt(5,()=>globalThis.structure);globalThis.autoSaver.setCallbackAfterSave((()=>{let i=globalThis.autoSaver.getSavedType();function e(){const t=globalThis.autoSaver.getSavedType();i!==t&&(i=t,globalThis.structure.updateRibbon(),globalThis.structure.sitplanview&&globalThis.structure.sitplanview.updateRibbon())}return e})());let _s=!1,nt=null,rt=null;(async()=>{await na(),Vt&&await Vt(),[nt,rt]=await globalThis.autoSaver.loadLastSaved();try{const i=rt;globalThis.currentShareId=i!=null&&i.shareId?String(i.shareId):null}catch(i){globalThis.currentShareId=null}nt!=null&&(_s=!0)})().then(async()=>{if(await wa()){new Tt().run(),globalThis.autoSaver.start();return}if(!_s)he(globalThis.EXAMPLE_DEFAULT,!1),bi(),new Tt().run();else{if(new ze(globalThis.appDocStorage).show("file.autoRecovered",`<h3>Laatste schema geladen uit browsercache</h3><p>Deze tool vond een schema in de browsercache. Dit schema dateert van <b>${rt.currentTimeStamp}</b> met als naam <b>${rt.filename}</b>. U kan op dit gerecupereerde schema verder werken of een ander schema laden in het "Bestand"-menu.</p><p><b>Opgelet! </b>De browsercache is een tijdelijke opslag, en wordt occasioneel gewist. Het blijft belangrijk uw werk regelmatig op te slaan om gegevensverlies te voorkomen.</p>`,!1,(()=>{new Tt().run()}).bind(void 0)),nt==null)return;he(nt,!0,!0),globalThis.structure.sitplan&&(globalThis.structure.sitplan.activePage=1)}globalThis.autoSaver.start()});</script>
    <style rel="stylesheet" crossorigin>:root{--selectPadding: 2;--paperPadding: 10px;--menu-height: 40px;--ribbon-height: 92px;--status-bar-height: 0px;--sideBarWidth: 260px;--total-offset: calc(var(--menu-height) + var(--ribbon-height) + var(--status-bar-height));--EDStekenFoutKleur: #8C5A00;--bg: #ffffff;--text: #111827;--muted-text: #6b7280;--surface-1: #f8f8f8;--surface-2: #e8e8e8;--border: #c8c8c8;--border-strong: #b8b8b8;--hover: #cccccc;--menu-bg: var(--surface-2);--ribbon-bg: var(--surface-1);--canvas-bg: var(--bg);--popup-bg: var(--bg);--context-bg: #f0f0f0;--context-hover: #e0e0e0;--link: #0066ff;--menu-link: #555565;--menu-link-hover: #333333;--menu-current: #0066ff;--menu-accent: #ff6600;--eds-ink: #000000;--eds-ink-on-dark: #e5e7eb;color-scheme:light}html[data-theme=dark]{--bg: #0b1220;--text: #e5e7eb;--muted-text: #9ca3af;--surface-1: #0f172a;--surface-2: #111c33;--border: #26324b;--border-strong: #33415e;--hover: #1f2a44;--menu-bg: var(--surface-2);--ribbon-bg: var(--surface-1);--canvas-bg: #0b1220;--popup-bg: #0f172a;--context-bg: #0f172a;--context-hover: #142041;--link: #7aa7ff;--menu-link: #cbd5e1;--menu-link-hover: #ffffff;--menu-current: #7aa7ff;--menu-accent: #ff9a3c;--eds-ink: var(--eds-ink-on-dark);color-scheme:dark}html[data-theme=dark] #EDS{background-color:#fff;color:#000;--eds-ink: #000000;display:inline-block;padding:12px;border-radius:8px;box-shadow:0 2px 10px #00000059}#EDS svg,#EDSSVG{color:var(--eds-ink)}#EDS svg text,#EDSSVG text,.svg-icon text{fill:var(--eds-ink)!important}#EDS svg [stroke=black],#EDS svg [stroke="#000"],#EDS svg [stroke="#000000"],#EDSSVG [stroke=black],#EDSSVG [stroke="#000"],#EDSSVG [stroke="#000000"],.svg-icon [stroke=black],.svg-icon [stroke="#000"],.svg-icon [stroke="#000000"],#EDS svg [style*="stroke:black"],#EDS svg [style*="stroke: black"],#EDSSVG [style*="stroke:black"],#EDSSVG [style*="stroke: black"],.svg-icon [style*="stroke:black"],.svg-icon [style*="stroke: black"]{stroke:var(--eds-ink)!important}#EDS svg [fill=black],#EDS svg [fill="#000"],#EDS svg [fill="#000000"],#EDSSVG [fill=black],#EDSSVG [fill="#000"],#EDSSVG [fill="#000000"],.svg-icon [fill=black],.svg-icon [fill="#000"],.svg-icon [fill="#000000"],#EDS svg [style*="fill:black"],#EDS svg [style*="fill: black"],#EDSSVG [style*="fill:black"],#EDSSVG [style*="fill: black"],.svg-icon [style*="fill:black"],.svg-icon [style*="fill: black"]{fill:var(--eds-ink)!important}*{box-sizing:border-box}html{height:100%;background-color:var(--bg)}body{margin:0;padding:0;cursor:default;color:var(--text);background-color:var(--bg)}.spinner{display:none;width:50px;height:50px;border:5px solid rgba(0,0,0,.1);border-top:5px solid #000;border-radius:50%;animation:spin 1s linear infinite;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%)}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.loading .spinner{display:block}button,select,select option,input[type=checkbox]{cursor:pointer}select option{background-color:var(--surface-1);color:var(--text)}td[contenteditable=true]{cursor:text}.container{width:100vw;height:100vh}#topmenu{height:var(--menu-height);width:100%;background-color:var(--menu-bg);align-items:center;padding:0 7px;border-bottom:1px solid var(--border-strong);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}ul#minitabs{display:flex;height:100%;list-style:none;margin:0;padding:1px 0;font-weight:700;text-align:left;align-items:center;white-space:nowrap}ul#minitabs li,ul#minitabs li.menu-item{display:inline;margin:0 6px}ul#minitabs a{text-decoration:none;padding:0 0 3px;border-bottom:4px solid var(--menu-bg);color:var(--menu-link)}ul#minitabs a#current{border-color:var(--menu-accent);color:var(--menu-current)}ul#minitabs a:hover{border-color:var(--menu-accent);color:var(--menu-link-hover);cursor:pointer}ul#minitabs li.menu-item-right{margin-left:auto;position:relative}.topmenu-hamburger{padding:4px 10px}.topmenu-dropdown{position:absolute;right:0;top:calc(100% + 6px);flex-direction:column;gap:6px;padding:8px;background-color:var(--menu-bg);border:1px solid var(--border);border-radius:8px;z-index:1000}.topmenu-dropdown[hidden]{display:none!important}.topmenu-dropdown:not([hidden]){display:flex}.topmenu-auth-user{max-width:220px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:600}.theme-toggle{background:transparent;color:var(--text);border:1px solid var(--border);border-radius:8px;padding:4px 10px;font-weight:600}.theme-toggle:hover{background-color:var(--hover)}#ribbon{position:absolute;top:var(--menu-height);height:var(--ribbon-height);left:0;right:0;bottom:0;justify-content:space-between;display:flex;background-color:var(--ribbon-bg);align-items:center;width:100%;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;border-bottom:1px solid var(--border);flex-direction:row}#left-icons{top:var(--menu-height);height:var(--ribbon-height);left:0;right:0;bottom:0;justify-content:left;display:flex;background-color:var(--ribbon-bg);align-items:center;width:100%;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;border-bottom:1px solid var(--border);flex-direction:row}#right-icons{top:var(--menu-height);height:var(--ribbon-height);left:0;right:0;bottom:0;justify-content:right;display:flex;background-color:var(--ribbon-bg);align-items:center;width:100%;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;border-bottom:1px solid var(--border);flex-direction:row}.icon{margin:0 0 0 10px;text-align:center;cursor:pointer;color:var(--text);border-radius:8px;padding:4px}.icon:hover{background-color:var(--hover)}.icon-image{width:32px;height:32px;display:flex;justify-content:center;align-items:baseline;margin:0 auto}.icon-text{display:inline-block;font-size:12px;margin-top:4px;white-space:nowrap}.icon-button{height:50px;margin:0 0 0 5px;text-align:center;cursor:pointer;font-size:24px}.box{position:absolute;background-color:#c0c0c000;border:0px solid #000;cursor:pointer;box-sizing:border-box;transform:rotate(0);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}.box[movable=false]{cursor:default}.boxlabel{position:absolute;font-size:11px;background-color:#c0c0c000;border:0px solid #000;cursor:pointer;box-sizing:border-box;transform:rotate(0);display:inline-block;white-space:nowrap;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}.boxlabel[movable=false]{cursor:default}.boxlabel.hidden{display:none}.box.selected[movable=false]{border:calc(var(--selectPadding) * 1px) solid red}.box.selected{border:calc(var(--selectPadding) * 1px) solid green}.box.hidden{display:none}body.distance-line-mode #canvas,body.distance-line-mode #paper,body.distance-line-mode .box,body.distance-line-mode .boxlabel,body.cable-run-mode #canvas,body.cable-run-mode #paper,body.cable-run-mode .box,body.cable-run-mode .boxlabel{cursor:crosshair!important}.cable-run-preview{pointer-events:none}.cable-run-preview .svg-icon.cable-run-svg{pointer-events:none!important}#app{flex:1;overflow:hidden}#configsection{position:absolute;top:var(--menu-height);left:0;right:0;bottom:0;overflow:auto;background-color:var(--canvas-bg);padding:12px 8px 8px}#configsection table[border]{border:1px solid var(--border);border-radius:10px;border-collapse:separate!important;border-spacing:0;background-color:var(--bg)}#configsection table[border] td,#configsection table[border] th{border:0;padding:10px}#configsection tr[bgcolor=LightGrey] td,#configsection tr[bgcolor=LightGrey] th,#configsection td[bgcolor=LightGrey]{background-color:var(--surface-2)!important;color:var(--text)}#configsection table[border] thead th{background-color:var(--surface-2);font-weight:700}#configsection table[border] tbody tr+tr td{border-top:1px solid var(--border)}#configsection table[border] tbody tr:hover td{background-color:var(--surface-1)}#configsection button{background:var(--surface-1);color:var(--text);border:1px solid var(--border);border-radius:8px;padding:6px 10px;font-weight:600}#configsection button:hover{background-color:var(--hover)}#configsection input[type=text],#configsection input[type=search],#configsection input[type=email],#configsection input[type=password],#configsection textarea{background:var(--bg);color:var(--text);border:1px solid var(--border);border-radius:8px;padding:6px 10px}#configsection input[type=text]:focus,#configsection input[type=search]:focus,#configsection input[type=email]:focus,#configsection input[type=password]:focus,#configsection textarea:focus,#configsection button:focus{outline:2px solid var(--menu-current);outline-offset:2px}#configsection code{background-color:var(--surface-2);border:1px solid var(--border);border-radius:6px;padding:1px 6px}#canvas_2col{position:absolute;top:calc(var(--menu-height) + var(--ribbon-height));left:0;right:0;bottom:0;overflow:hidden;background-color:var(--canvas-bg);padding:0x;display:flex;flex-direction:row}#outerdiv{display:flex;position:absolute;top:calc(var(--menu-height) + var(--ribbon-height));left:0;right:0;bottom:0;overflow:none;background-color:var(--canvas-bg);padding:0;flex-direction:row}#sidebar{top:0;left:0;width:var(--sideBarWidth);height:100%;overflow:auto;background-color:var(--surface-1);border-right:1px solid var(--border);padding:10px;box-sizing:border-box}.sitplan-sidebar-title{margin:0 0 10px;font-weight:700}.sitplan-sidebar-titlebar{display:flex;align-items:center;justify-content:space-between;gap:10px;margin:0 0 10px}.sitplan-sidebar-titlebar .sitplan-sidebar-title{margin:0}.sitplan-sidebar-actions{display:flex;gap:6px}.sitplan-sidebar-actionbtn{border:1px solid var(--border);border-radius:6px;background:var(--popup-bg);color:var(--text);cursor:pointer;padding:2px 4px;line-height:1;min-width:24px;min-height:22px;display:inline-flex;align-items:center;justify-content:center}.sitplan-sidebar-actionbtn:hover{background:color-mix(in srgb,var(--popup-bg) 85%,white 15%)}.sitplan-sidebar-itemrow{display:flex;align-items:center;gap:8px}.sitplan-sidebar-visbtn{flex:0 0 auto;border:1px solid var(--border);border-radius:6px;background:var(--popup-bg);color:var(--text);cursor:pointer;padding:2px 4px;line-height:1;min-width:24px;min-height:22px;display:inline-flex;align-items:center;justify-content:center}.sitplan-sidebar-visbtn:hover{background:color-mix(in srgb,var(--popup-bg) 85%,white 15%)}.sitplan-sidebar-visbtn:disabled{cursor:default;opacity:.55}.sitplan-sidebar-select{width:100%;margin:6px 0 10px}.sitplan-sidebar-items{display:flex;flex-direction:column;gap:6px}.sitplan-sidebar-cable-summary{margin:8px 0 6px;padding:6px 8px;border:1px solid var(--border);border-radius:8px;background:var(--popup-bg);color:var(--text)}.sitplan-sidebar-cable-header{display:flex;align-items:center;justify-content:space-between;gap:10px;font-weight:600;margin-bottom:4px}.sitplan-sidebar-cable-line{display:flex;align-items:center;justify-content:space-between;gap:10px;font-size:12px}.sitplan-sidebar-item{text-align:left;width:100%;padding:6px 8px;border:1px solid var(--border);border-radius:8px;background:var(--popup-bg);color:var(--text);cursor:pointer;display:flex;align-items:center;justify-content:space-between;gap:10px}.sitplan-sidebar-count{color:var(--muted-text);font-size:12px;white-space:nowrap}.sitplan-sidebar-item:disabled{cursor:default;opacity:.55}.sitplan-sidebar-item:hover{background:color-mix(in srgb,var(--popup-bg) 85%,white 15%)}#canvas{display:flex;position:absolute;top:0;left:var(--sideBarWidth);right:0;bottom:0;overflow:auto;background-color:var(--canvas-bg);padding:0;flex-direction:row}#paper{top:var(--paperPadding);left:var(--paperPadding);width:277mm;height:150mm;background-color:#fff;box-shadow:0 4px 8px #0003,0 6px 20px #00000030;border-radius:5px;position:absolute}#left_col{flex:.35;overflow:auto}#right_col{flex:.65;overflow:auto}#left_col_inner,#right_col_inner{padding:10px;color:var(--text)}#EDS,#EDS #EDSSVG,#EDS [data-eds-id]{cursor:default}html.eds-modifier-active #EDS,html.eds-modifier-active #EDS #EDSSVG,html.eds-modifier-active #EDS [data-eds-id]{cursor:pointer}table.html_edit_table{width:"100%"}table.html_edit_table td:nth-child(1){border-radius:10px;border-collapse:collapse;padding:2px;font-size:150%;text-align:center;cursor:pointer}table.html_edit_table td:nth-child(2){width:"100%";border-collapse:collapse;padding:2px 2px 2px 5px}table.html_edit_table.eds-tree-flash{outline:2px solid rgba(255,170,0,.95);border-radius:6px;animation:edsTreeFlashPulse 2.5s ease-in-out 1}table.html_edit_table.eds-tree-flash td:nth-child(2){background-color:#ffeb788c;transition:background-color .12s ease-in-out}table.html_edit_table.tree-dragging{opacity:.45}table.html_edit_table.tree-drop-before{box-shadow:inset 0 3px #0078d4e6}table.html_edit_table.tree-drop-after{box-shadow:inset 0 -3px #0078d4e6}.tree-drag-handle{display:inline-block;margin-right:8px;padding:1px 6px;border-radius:6px;background:#0078d41f;color:#003c78f2;font-weight:700;user-select:none;cursor:grab}table.html_edit_table.tree-dragging .tree-drag-handle{cursor:grabbing}table.html_edit_table td.hl-collapse-cell{width:16px;min-width:16px;max-width:16px;padding:3px 1px 0;text-align:center;vertical-align:top;font-size:11px;line-height:1.1}table.html_edit_table td.hl-collapse-cell .hl-collapse-icon{position:relative;top:1px;display:inline-block}.hl-open-modal-label{cursor:pointer;color:var(--text)}.hl-open-modal-label:hover{text-decoration:underline}.hl-quick-actions{display:inline-flex;align-items:center;gap:2px;margin-right:4px}.eds-tree-modal{width:min(980px,94vw);max-height:88vh;overflow:hidden;padding:10px 14px 14px}.eds-tree-modal-header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:8px}.eds-tree-modal-preview{width:160px;height:96px;flex:0 0 auto;border:1px solid var(--border);border-radius:10px;background:var(--surface-1);display:flex;align-items:center;justify-content:center;overflow:hidden}.eds-tree-modal-actions{display:inline-flex;gap:6px;align-items:center;flex:0 0 auto}.eds-tree-modal-action{border:1px solid var(--border);background:transparent;color:var(--text);border-radius:8px;padding:6px 10px;font-size:12px}.eds-tree-modal-action:hover:not(:disabled){background:#0000000d}.eds-tree-modal-action:disabled{opacity:.5;cursor:not-allowed}.eds-tree-modal-preview svg{display:block}@media(max-width:560px){.eds-tree-modal-preview{display:none}}.eds-tree-modal-title{font-weight:700;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.eds-tree-modal-close{border:1px solid var(--border);background:transparent;color:var(--text);border-radius:8px;width:32px;height:32px;cursor:pointer;font-size:20px;line-height:28px}.eds-tree-modal-close:hover{background:#0000000d}.eds-tree-modal-body{max-height:calc(88vh - 64px);overflow:auto;padding-right:6px}.eds-tree-modal-body .eds-prop-grid{display:flex;flex-direction:column;gap:8px}.eds-tree-modal-body .eds-prop-row{border:1px solid var(--border);border-radius:10px;padding:8px 10px;background:var(--surface-1);line-height:1.35}.eds-tree-modal-body .eds-prop-row:empty{display:none}.eds-tree-modal-body .eds-prop-section-spacer{height:2px;margin:2px 0;border-top:1px dashed var(--border)}.eds-tree-modal-body .eds-prop-row input[type=text],.eds-tree-modal-body .eds-prop-row select{margin:2px}.eds-tree-modal-body .eds-inline-checkbox-label{cursor:pointer;user-select:none}html[data-theme=dark] table.html_edit_table.eds-tree-flash td:nth-child(2){background-color:#ffd25a38}@keyframes edsTreeFlashPulse{0%,10%{outline-color:#ffaa00f2}20%{outline-color:#fa00}30%{outline-color:#ffaa00f2}40%{outline-color:#fa00}50%{outline-color:#ffaa00f2}60%,to{outline-color:#fa00}}#config{padding-left:7px;padding-right:7px;min-width:100%;min-height:0px}#AJAX_sent,#AJAX_received,#AJAX_draw{padding:0;color:#000}html[data-theme=dark] #AJAX_sent,html[data-theme=dark] #AJAX_received,html[data-theme=dark] #AJAX_draw{color:var(--text)}.onlypointer{cursor:pointer}p{font-size:16px;line-height:16px}div.kring{background-color:#fc9}div.verbruiker{background-color:#ffc}table{border-collapse:collapse}.highlight-warning,.highlight-warning-big{background-color:#ffd1d1;border:1px solid #FF6347;padding:4px 5px;font-weight:400;font-size:smaller;color:#b22222}.highlight-ok-big{background-color:#cfc;border:1px solid #33CC33;padding:4px 5px;font-weight:400;font-size:smaller;color:#060}.EDS-tekenfout{background-color:#fff9e5;border:1px solid #E6C97A;padding:4px 5px;font-weight:400;font-size:smaller;color:var(--EDStekenFoutKleur);margin-top:5px;margin-bottom:5px;cursor:default}.svg-icon{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);pointer-events:none}.svg-icon.cable-run-svg{pointer-events:auto}.svg-icon.cable-run-svg .cable-run-vertex{cursor:grab}.svg-icon.cable-run-svg .cable-run-vertex:active{cursor:grabbing}.context-menu{position:absolute;display:none;border:1px solid var(--border);background-color:var(--context-bg);box-shadow:0 2px 10px #0003;z-index:999999999;font-size:12px;line-height:1}.context-menu-item{padding:4px 6px;cursor:pointer;display:flex;justify-content:space-between;align-items:center}.context-menu-item-disabled{cursor:default}.context-menu-item-disabled:hover{background-color:transparent}.context-menu-item:hover{background-color:var(--context-hover)}.context-menu-shortcut{margin-left:16px;color:var(--muted-text);font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:11px;padding:1px 6px;border:1px solid var(--border);border-radius:6px;background-color:color-mix(in srgb,var(--context-bg) 85%,white 15%)}.context-menu-item-hint{color:var(--muted-text)}.context-menu-item-hint .context-menu-shortcut{color:var(--text);border-color:color-mix(in srgb,var(--border) 50%,#ffb300 50%);background-color:#ffd25a59}.context-menu-separator{border:none;border-top:1px solid var(--border);margin:2px 0}.popup-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center;visibility:hidden;z-index:9999}.popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background-color:var(--popup-bg);padding:5px 20px 20px;border:1px solid var(--border);border-radius:8px;box-shadow:0 4px 8px #0003;z-index:1000000}.popup h3{color:var(--link)}.eds-drawing-header{display:flex;align-items:center;gap:10px}.eds-keybinds-help-button{margin-left:auto;width:26px;height:26px;border-radius:999px;border:1px solid var(--border);background:color-mix(in srgb,var(--popup-bg) 85%,white 15%);color:var(--text);cursor:pointer;font-weight:700;line-height:1}.eds-keybinds-help-button:hover{background:color-mix(in srgb,var(--popup-bg) 70%,white 30%)}.eds-keybinds-modal{width:min(680px,calc(100vw - 32px));max-height:min(720px,calc(100vh - 32px));overflow:auto}.eds-keybinds-header{display:flex;align-items:center;justify-content:space-between;gap:12px}.eds-keybinds-title{margin:10px 0 8px}.eds-keybinds-close{border:none;background:transparent;cursor:pointer;font-size:20px;line-height:1;padding:6px 10px;border-radius:8px;color:var(--text)}.eds-keybinds-close:hover{background:color-mix(in srgb,var(--popup-bg) 70%,black 10%)}.eds-keybinds-body{margin-top:6px}.eds-keybinds-note{color:var(--muted-text);font-size:13px;margin:10px 0}.eds-keybinds-grid{display:grid;grid-template-columns:210px 1fr;gap:10px 14px;padding:12px;border:1px solid var(--border);border-radius:10px;background:color-mix(in srgb,var(--popup-bg) 92%,white 8%)}.eds-keybinds-key{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:12px;color:var(--text);padding:4px 8px;border:1px solid var(--border);border-radius:8px;width:fit-content;background:color-mix(in srgb,var(--popup-bg) 85%,white 15%)}.eds-keybinds-desc{color:var(--text);font-size:13px}@media(max-width:520px){.eds-keybinds-grid{grid-template-columns:1fr}}.rounded-button{margin:10px 7px 0;padding:10px 20px;cursor:pointer;background-color:#39f;color:#fff;border:none;border-radius:5px;display:block;width:100px;transition:background-color .3s ease-in-out}.rounded-button:hover{background-color:#06f}.button-insertChild{background-color:green;width:26px;height:26px;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M4 11h12M4 11L4 4M16 11L11 6M16 11L11 16" stroke="black" stroke-width="2" stroke-linecap="round"/></svg>');background-repeat:no-repeat;background-position:center;background-size:20px 20px;display:inline-block;vertical-align:middle;margin:1px 4px 1px 0}.button-insertAfter{background-color:green;width:26px;height:26px;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M10 4v12M10 16l-5-5M10 16l5-5" stroke="black" stroke-width="2" stroke-linecap="round"/></svg>');background-repeat:no-repeat;background-position:center;background-size:20px 20px;display:inline-block;vertical-align:middle;margin:1px 4px 1px 0}.button-insertBefore{background-color:green;width:26px;height:26px;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M10 4v12M10 4l-5 5M10 4l5 5" stroke="black" stroke-width="2" stroke-linecap="round"/></svg>');background-repeat:no-repeat;background-position:center;background-size:20px 20px;display:inline-block;vertical-align:middle;margin:1px 4px 1px 0}.button-delete{background-color:red;width:26px;height:26px;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M4 4l12 12M16 4L4 16" stroke="black" stroke-width="2" stroke-linecap="round"/></svg>');background-repeat:no-repeat;background-position:center;background-size:20px 20px;display:inline-block;vertical-align:middle;margin:1px 4px 1px 0}.button-delete-garbage-can{background-color:red;width:26px;height:26px;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M5 5 v12 h10 v-12 M4 5 h12 M8 4 h4" stroke="black" stroke-width="2" stroke-linecap="round" fill="none" /><path d="M8.5 8 v6 M11.5 8 v6" stroke="black" stroke-width="1" stroke-linecap="round" fill="none" /></svg>');background-repeat:no-repeat;background-position:center;background-size:20px 20px;display:inline-block;vertical-align:middle;margin:1px 4px 1px 0}table.html_edit_table .button-insertChild,table.html_edit_table .button-insertAfter,table.html_edit_table .button-insertBefore,table.html_edit_table .button-delete-garbage-can{width:20px;height:20px;min-width:20px;padding:0;background-size:16px 16px;margin-right:2px;margin-top:0;margin-bottom:0;border:0}.button-green{background-color:green;height:26px;display:inline-block;align-items:center;justify-content:center;vertical-align:middle;margin:1px 4px 1px 0;font-size:20px}.button-red{background-color:red;height:26px;min-width:26px;display:inline-block;align-items:center;justify-content:center;vertical-align:middle;padding:0;margin:1px 4px 1px 0;font-size:16px}.button-lightblue{background-color:#add8e6;height:26px;min-width:26px;display:inline-block;align-items:center;justify-content:center;vertical-align:middle;margin:1px 4px 1px 0;font-size:14px;padding:0 5px}.type-orange{background-color:orange;height:26px;min-width:26px;display:inline-block;align-items:flex-end;justify-content:flex-end;vertical-align:bottom;margin:1px 4px 1px 0;font-size:14px;padding:2px 5px}html[data-theme=dark] .button-insertChild{background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M4 11h12M4 11L4 4M16 11L11 6M16 11L11 16" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>')}html[data-theme=dark] .button-insertAfter{background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M10 4v12M10 16l-5-5M10 16l5-5" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>')}html[data-theme=dark] .button-insertBefore{background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M10 4v12M10 4l-5 5M10 4l5 5" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>')}html[data-theme=dark] .button-delete{background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M4 4l12 12M16 4L4 16" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>')}html[data-theme=dark] .button-delete-garbage-can{background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M5 5 v12 h10 v-12 M4 5 h12 M8 4 h4" stroke="white" stroke-width="2" stroke-linecap="round" fill="none" /><path d="M8.5 8 v6 M11.5 8 v6" stroke="white" stroke-width="1" stroke-linecap="round" fill="none" /></svg>')}</style>
  </head>
  <body>
    <div id="container" class="container"></div>
  </body>
</html>
